import{d as G,r as C,c as x,o as J,A as T,q as u,x as l,y as s,v as o,H as k,t,n as p,J as v,G as i,F as K,L as Q,B as W,K as X,C as B}from"./vendor-BlPZouPF.js";import{e as Y,m as Z,o as D,x as ee,n as se,k as y,g as r,p as te,q as ae,r as oe,f as ne,y as ie,z as le,i as ce,l as re,w as ue,t as O}from"./ionic-C-hOnMqp.js";import{x as de,y as he,t as pe,q as _e,z as M,m as me,p as ve,d as fe,A as ge,_ as Ce}from"./_plugin-vue_export-helper-B7Fc93E3.js";import{C as ye}from"./main-DpZpFifR.js";const we={class:"header-gradient"},ke={class:"header-content"},Ie={key:0,class:"unit-info"},Pe={class:"status-indicators"},be={class:"status-item available"},$e={class:"status-item occupied"},xe={class:"content-container"},Te={key:0,class:"checklists-section"},Be=["onClick"],De={class:"card-content"},Oe={class:"checklist-info"},Me={class:"machine-section"},Ae={class:"machine-icon"},ze={class:"machine-details"},Ee={class:"machine-id"},Ne={class:"patient-section"},Re={class:"patient-icon"},Ue={class:"patient-details"},Se={class:"phase-info"},je={class:"checklist-actions"},qe={class:"status-section"},Fe={class:"progress-text"},Le={class:"time-info"},Ve={class:"time-label"},He={key:0,class:"paused-indicator"},Ge={key:1,class:"empty-state"},Je={class:"empty-content"},Ke={key:2,class:"loading-state"},Qe=G({__name:"ChecklistListPage",setup(We){const I=W(),A=ye.getInstance().getCurrentUserUseCase(),f=C(!1),w=C(null),d=C([]),_=C([]),P=x(()=>_.value.filter(e=>e.status==="available").length),z=x(()=>_.value.filter(e=>e.status==="occupied").length),E=async()=>{try{w.value=await A.execute()}catch(e){console.error("Error loading user:",e)}},N=async()=>{try{const a=await(await fetch("/api/checklists/active",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();a.success&&(d.value=a.checklists)}catch(e){console.error("Erro ao carregar checklists ativos:",e)}},R=async()=>{try{const e=await fetch("/api/machines",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token")),"Content-Type":"application/json",Accept:"application/json"}});if(!e.ok){console.warn("Failed to load machines: ".concat(e.status)),_.value=[];return}const a=await e.json();a.success&&a.machines?_.value=a.machines:_.value=[]}catch(e){console.error("Erro ao carregar máquinas:",e),_.value=[]}},g=async()=>{f.value=!0;try{await Promise.all([N(),R()])}finally{f.value=!1}},U=async e=>{await g(),e.target.complete()},b=e=>{I.push("/checklist/".concat(e.id))},S=async e=>{await(await re.create({header:"Pausar Checklist",message:"Deseja pausar o checklist da máquina ".concat(e.machine.name,"?"),buttons:[{text:"Cancelar",role:"cancel"},{text:"Pausar",handler:async()=>{const h=await ue.create({message:"Pausando checklist..."});await h.present();try{const c=await(await fetch("/api/checklists/".concat(e.id,"/pause"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();if(c.success)await(await O.create({message:"Checklist pausado com sucesso.",duration:3e3,color:"success"})).present(),await g();else throw new Error(c.message)}catch(n){await(await O.create({message:"Erro ao pausar checklist.",duration:3e3,color:"danger"})).present()}finally{await h.dismiss()}}}]})).present()},$=()=>{I.push("/checklist/new")},j=e=>({pre_dialysis:"Pré-Diálise",during_session:"Durante Sessão",post_dialysis:"Pós-Diálise",completed:"Concluído",interrupted:"Interrompido"})[e]||e,q=e=>({pre_dialysis:"primary",during_session:"warning",post_dialysis:"secondary",completed:"success",interrupted:"danger"})[e]||"medium",F=e=>e.replace("_","-"),L=e=>e.phase_completion!==void 0?Math.round(e.phase_completion):{pre_dialysis:25,during_session:50,post_dialysis:75,completed:100,interrupted:0}[e.current_phase]||0,V=e=>{const a=new Date(e),n=new Date().getTime()-a.getTime(),c=Math.floor(n/(1e3*60*60)),m=Math.floor(n%(1e3*60*60)/(1e3*60));return c>0?"".concat(c,"h ").concat(m,"m"):"".concat(m,"m")},H=e=>{const a=new Date(e),n=new Date().getTime()-a.getTime(),c=Math.floor(n/(1e3*60*60)),m=Math.floor(n%(1e3*60*60)/(1e3*60));return c>0?"".concat(c,"h ").concat(m,"m"):"".concat(m,"m")};return J(async()=>{await E(),await g()}),(e,a)=>(u(),T(s(Y),null,{default:l(()=>[o(s(te),null,{default:l(()=>[o(s(Z),null,{default:l(()=>[o(s(D),{slot:"start"},{default:l(()=>[o(s(ee),{"default-href":"/dashboard"})]),_:1}),o(s(se),null,{default:l(()=>[...a[0]||(a[0]=[k("Checklists Ativos",-1)])]),_:1}),o(s(D),{slot:"end"},{default:l(()=>[o(s(y),{onClick:g,disabled:f.value},{default:l(()=>[o(s(r),{icon:s(de)},null,8,["icon"])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),o(s(ce),{fullscreen:!0},{default:l(()=>{var h;return[o(s(ae),{slot:"fixed",onIonRefresh:U},{default:l(()=>[o(s(oe))]),_:1}),t("div",we,[t("div",ke,[w.value?(u(),p("div",Ie,[t("h2",null,i(((h=w.value.unit)==null?void 0:h.name)||"Unidade de Hemodiálise"),1),t("p",null,i(d.value.length)+" checklist"+i(d.value.length!==1?"s":"")+" "+i(d.value.length===1?"ativo":"ativos"),1)])):v("",!0),t("div",Pe,[t("div",be,[o(s(r),{icon:s(he)},null,8,["icon"]),t("span",null,i(P.value)+" Disponível"+i(P.value!==1?"is":""),1)]),t("div",$e,[o(s(r),{icon:s(pe)},null,8,["icon"]),t("span",null,i(z.value)+" Em Uso",1)])])])]),t("div",xe,[d.value.length>0?(u(),p("div",Te,[(u(!0),p(K,null,Q(d.value,n=>(u(),p("div",{key:n.id,class:"checklist-card",onClick:c=>b(n)},[t("div",De,[t("div",Oe,[t("div",Me,[t("div",Ae,[o(s(r),{icon:s(me)},null,8,["icon"])]),t("div",ze,[t("h3",null,i(n.machine.name),1),t("p",Ee,i(n.machine.identifier),1)])]),t("div",Ne,[t("div",Re,[o(s(r),{icon:s(ve)},null,8,["icon"])]),t("div",Ue,[t("h4",null,i(n.patient.name),1),t("p",Se,i(j(n.current_phase)),1)])])]),t("div",je,[t("div",qe,[t("div",{class:X(["progress-circle",F(n.current_phase)])},[t("span",Fe,i(L(n))+"%",1)],2),t("div",Le,[t("span",Ve,i(V(n.created_at)),1)])]),o(s(y),{color:q(n.current_phase),size:"small",class:"action-button",onClick:B(c=>b(n),["stop"])},{default:l(()=>[k(i(n.paused_at?"RETOMAR":"CONTINUAR"),1)]),_:2},1032,["color","onClick"]),n.paused_at?v("",!0):(u(),T(s(y),{key:0,fill:"clear",size:"small",color:"medium",onClick:B(c=>S(n),["stop"]),class:"pause-btn"},{default:l(()=>[o(s(r),{icon:s(fe),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"]))])]),n.paused_at?(u(),p("div",He,[o(s(r),{icon:s(ge)},null,8,["icon"]),t("span",null,"Pausado há "+i(H(n.paused_at)),1)])):v("",!0)],8,Be))),128))])):v("",!0),d.value.length===0&&!f.value?(u(),p("div",Ge,[t("div",Je,[o(s(r),{icon:s(_e),class:"empty-icon"},null,8,["icon"]),a[2]||(a[2]=t("h3",null,"Nenhum checklist ativo",-1)),a[3]||(a[3]=t("p",null,"Inicie um novo checklist de segurança para começar.",-1)),o(s(y),{color:"primary",onClick:$,class:"start-button"},{default:l(()=>[o(s(r),{icon:s(M),slot:"start"},null,8,["icon"]),a[1]||(a[1]=k(" Iniciar Checklist ",-1))]),_:1})])])):v("",!0),f.value?(u(),p("div",Ke,[o(s(ne),{name:"crescent"}),a[4]||(a[4]=t("p",null,"Carregando checklists...",-1))])):v("",!0)]),o(s(ie),{vertical:"bottom",horizontal:"end",slot:"fixed"},{default:l(()=>[o(s(le),{color:"primary",onClick:$,class:"add-fab"},{default:l(()=>[o(s(r),{icon:s(M)},null,8,["icon"])]),_:1})]),_:1})]}),_:1})]),_:1}))}}),ts=Ce(Qe,[["__scopeId","data-v-e32276b4"]]);export{ts as default};
