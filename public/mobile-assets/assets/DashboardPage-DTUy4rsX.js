import{d as te,c as C,n as b,q as m,t as e,v as o,G as p,x as u,H as O,y as s,I as Ce,J as $,A as M,K as X,r as g,o as ye,B as be,F as $e,L as Ie}from"./vendor-BlPZouPF.js";import{j as ae,g as l,k as P,l as x,e as Se,t as w,m as De,n as Oe,o as Pe,p as Me,q as ze,r as Ae,s as Ue,u as Ee,i as Te,v as Be,w as Le}from"./ionic-C-hOnMqp.js";import{p as je,t as F,d as Y,f as Z,i as qe,_ as oe,g as Ne,h as Re,j as xe,k as ee,n as Fe,o as se,m as He,q as Ve,r as L,u as Ge,v as Je,w as Ke}from"./_plugin-vue_export-helper-B7Fc93E3.js";import{C as Qe}from"./main-DpZpFifR.js";const We={class:"card-header"},Xe={class:"machine-info"},Ye={class:"machine-id"},Ze={class:"patient-info"},es={class:"patient-name"},ss={class:"progress-section"},ts={class:"progress-bar"},as={class:"progress-text"},os={class:"time-info"},ns={class:"time-item"},is={class:"time-value"},ls={key:0,class:"time-item"},cs={class:"time-value"},rs={class:"actions"},us=te({__name:"ActiveChecklistCard",props:{checklist:{}},emits:["continue","pause","resume"],setup(H,{emit:f}){const r=H,T=C(()=>({pre_dialysis:"Pr칠-Di치lise",during_session:"Durante Sess칚o",post_dialysis:"P칩s-Di치lise",completed:"Conclu칤do",interrupted:"Interrompido"})[r.checklist.current_phase]||r.checklist.current_phase),j=C(()=>({pre_dialysis:"primary",during_session:"warning",post_dialysis:"secondary",completed:"success",interrupted:"danger"})[r.checklist.current_phase]||"medium"),h=C(()=>r.checklist.current_phase.replace("_","-")),D=C(()=>r.checklist.phase_completion!==void 0?Math.round(r.checklist.phase_completion):{pre_dialysis:25,during_session:50,post_dialysis:75,completed:100,interrupted:0}[r.checklist.current_phase]||0),z=C(()=>{const i=new Date(r.checklist.created_at),v=new Date().getTime()-i.getTime(),I=Math.floor(v/(1e3*60*60)),_=Math.floor(v%(1e3*60*60)/(1e3*60));return I>0?"".concat(I,"h ").concat(_,"m"):"".concat(_,"m")}),q=C(()=>{if(!r.checklist.paused_at)return"";const i=new Date(r.checklist.paused_at),v=new Date().getTime()-i.getTime(),I=Math.floor(v/(1e3*60*60)),_=Math.floor(v%(1e3*60*60)/(1e3*60));return I>0?"".concat(I,"h ").concat(_,"m"):"".concat(_,"m")}),B=async()=>{await(await x.create({header:"Detalhes do Checklist",subHeader:"".concat(r.checklist.machine.name," - ").concat(r.checklist.patient.name),message:"\n      <strong>Fase:</strong> ".concat(T.value,"<br>\n      <strong>Progresso:</strong> ").concat(D.value,"%<br>\n      <strong>Iniciado:</strong> ").concat(new Date(r.checklist.created_at).toLocaleString("pt-BR"),"<br>\n      ").concat(r.checklist.paused_at?"<strong>Pausado:</strong> ".concat(new Date(r.checklist.paused_at).toLocaleString("pt-BR"),"<br>"):"","\n    "),buttons:["Fechar"]})).present()};return(i,n)=>(m(),b("div",{class:X(["checklist-card",[h.value,{paused:i.checklist.paused_at}]])},[e("div",We,[e("div",Xe,[e("h3",null,p(i.checklist.machine.name),1),e("p",Ye,p(i.checklist.machine.identifier),1)]),o(s(ae),{color:j.value,class:"phase-badge"},{default:u(()=>[O(p(T.value),1)]),_:1},8,["color"])]),e("div",Ze,[o(s(l),{icon:s(je),class:"patient-icon"},null,8,["icon"]),e("span",es,p(i.checklist.patient.name),1)]),e("div",ss,[e("div",ts,[e("div",{class:"progress-fill",style:Ce({width:D.value+"%"})},null,4)]),e("span",as,p(D.value)+"% completo",1)]),e("div",os,[e("div",ns,[o(s(l),{icon:s(F),class:"time-icon"},null,8,["icon"]),n[3]||(n[3]=e("span",{class:"time-label"},"Iniciado h치",-1)),e("span",is,p(z.value),1)]),i.checklist.paused_at?(m(),b("div",ls,[o(s(l),{icon:s(Y),class:"time-icon paused"},null,8,["icon"]),n[4]||(n[4]=e("span",{class:"time-label"},"Pausado h치",-1)),e("span",cs,p(q.value),1)])):$("",!0)]),e("div",rs,[i.checklist.paused_at?$("",!0):(m(),M(s(P),{key:0,fill:"outline",size:"small",onClick:n[0]||(n[0]=v=>i.$emit("continue",i.checklist)),class:"action-button continue"},{default:u(()=>[o(s(l),{icon:s(Z),slot:"start"},null,8,["icon"]),n[5]||(n[5]=O(" Continuar ",-1))]),_:1})),i.checklist.paused_at?(m(),M(s(P),{key:1,fill:"solid",size:"small",onClick:n[1]||(n[1]=v=>i.$emit("resume",i.checklist)),class:"action-button resume",color:"success"},{default:u(()=>[o(s(l),{icon:s(Z),slot:"start"},null,8,["icon"]),n[6]||(n[6]=O(" Retomar ",-1))]),_:1})):$("",!0),i.checklist.paused_at?$("",!0):(m(),M(s(P),{key:2,fill:"outline",size:"small",onClick:n[2]||(n[2]=v=>i.$emit("pause",i.checklist)),class:"action-button pause",color:"warning"},{default:u(()=>[o(s(l),{icon:s(Y),slot:"start"},null,8,["icon"]),n[7]||(n[7]=O(" Pausar ",-1))]),_:1})),o(s(P),{fill:"clear",size:"small",onClick:B,class:"action-button details"},{default:u(()=>[o(s(l),{icon:s(qe),slot:"icon-only"},null,8,["icon"])]),_:1})]),e("div",{class:X(["status-indicator",h.value])},null,2)],2))}}),ds=oe(us,[["__scopeId","data-v-afd1addd"]]),hs={class:"dashboard-container"},ps={key:0,class:"welcome-section"},vs={class:"welcome-header"},ms={class:"welcome-text"},gs={class:"unit-display"},_s={key:0,class:"unit-info-static"},ks={class:"unit-text-static"},fs={class:"unit-name-static"},ws={key:1,class:"unit-info"},Cs={class:"unit-text"},ys={class:"unit-name"},bs={key:1,class:"quick-stats"},$s={class:"stat-icon"},Is={class:"stat-content"},Ss={class:"stat-number"},Ds={class:"stat-icon"},Os={class:"stat-content"},Ps={class:"stat-number"},Ms={class:"stat-card total"},zs={class:"stat-icon"},As={class:"stat-content"},Us={class:"stat-number"},Es={class:"primary-action"},Ts={class:"section"},Bs={class:"quick-actions"},Ls={class:"action-icon warning"},js={class:"action-content"},qs={class:"action-subtitle"},Ns={class:"action-icon tertiary"},Rs={class:"action-icon cleaning"},xs={class:"action-icon primary"},Fs={key:2,class:"section"},Hs={class:"checklists-list"},Vs={class:"connection-status"},Gs=te({__name:"DashboardPage",setup(H){const f=be(),r=Qe.getInstance(),T=r.getCurrentUserUseCase(),j=r.getLogoutUseCase(),h=g(null),D=g(navigator.onLine),z=g(!1),q=g(0),B=g(3),i=g(!1),n=g(!1),v=g([]),I=g([]),_=g([]),A=g([]),S=g(null),y=g(null);C(()=>h.value&&{tecnico:"T칠cnico",admin:"Admin",gestor:"Gestor",coordenador:"Coordenador",supervisor:"Supervisor"}[h.value.role]||"Usu치rio");const N=C(()=>v.value.filter(a=>!a.paused_at).length);C(()=>v.value.filter(a=>a.paused_at).length);const R=C(()=>I.value.length),V=async()=>{try{h.value=await T.execute(),console.log("User loaded:",h.value),await ne()}catch(a){console.error("Error loading user:",a),await(await w.create({message:"Erro ao carregar dados do usu치rio",duration:3e3,color:"danger",position:"top"})).present(),setTimeout(()=>{f.replace("/login")},2e3)}},ne=async()=>{var a,t;try{const d=await(await fetch("/api/user-units",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();if(d.success){A.value=d.units||[];const k=d.current_unit_id;k?(S.value=d.units.find(E=>E.id===k),y.value=k):d.units.length>0&&(S.value=d.units[0],y.value=d.units[0].id),console.log("Unidades carregadas (mobile):",{total:A.value.length,current:(a=S.value)==null?void 0:a.name,currentId:y.value})}}catch(c){console.error("Error loading available units:",c),(t=h.value)!=null&&t.unit&&(S.value=h.value.unit,y.value=h.value.unit.id,A.value=h.value.units||[h.value.unit])}},ie=async()=>{const a=A.value.map(c=>({text:c.name,icon:c.id===y.value?"checkmark-circle-outline":"location-outline",cssClass:c.id===y.value?"unit-selected":"",handler:()=>{c.id!==y.value&&le(c.id)}}));a.push({text:"Cancelar",icon:"close-outline",handler:()=>{}}),await(await Be.create({header:"Selecionar Unidade",subHeader:"Escolha a unidade para visualizar",buttons:a,cssClass:"unit-selector-action-sheet"})).present()},le=async a=>{var t;try{const c=await Le.create({message:"Alternando unidade...",spinner:"crescent",duration:1e4});await c.present();const k=await(await fetch("/api/user-units/switch",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token")),"Content-Type":"application/json"},body:JSON.stringify({unit_id:a})})).json();await c.dismiss(),k.success&&(S.value=k.current_unit,y.value=a,await(await w.create({message:"游늸 Unidade alterada para ".concat(k.current_unit.name),duration:2e3,color:"success",position:"top",cssClass:"custom-toast"})).present(),await U())}catch(c){console.error("Error switching unit:",c),y.value=(t=S.value)==null?void 0:t.id,await(await w.create({message:"Erro ao trocar de unidade",duration:3e3,color:"danger",position:"top"})).present()}},U=async()=>{try{await Promise.all([ce(),re(),ue()]),q.value=v.value.length,B.value=_.value.length,z.value=!0,console.log("Stats loaded")}catch(a){console.error("Error loading stats:",a),z.value=!0}},ce=async()=>{try{const t=await(await fetch("/api/checklists/active",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();t.success&&(v.value=t.checklists)}catch(a){console.error("Erro ao carregar checklists ativos:",a)}},re=async()=>{try{const t=await(await fetch("/api/machines/available",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();t.success&&(I.value=t.machines)}catch(a){console.error("Erro ao carregar m치quinas dispon칤veis:",a)}},ue=async()=>{try{const a=await fetch("/api/machines",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token")),"Content-Type":"application/json",Accept:"application/json"}});if(!a.ok){console.warn("Failed to load machines: ".concat(a.status)),_.value=[];return}const t=await a.json();t.success&&t.machines?_.value=t.machines:_.value=[]}catch(a){console.error("Erro ao carregar m치quinas:",a),_.value=[]}},de=async a=>{try{await Promise.all([V(),U()]),await(await w.create({message:"Dados atualizados",duration:1500,color:"success",position:"top"})).present()}catch(t){console.error("Error refreshing:",t)}finally{a.target.complete()}},he=async()=>{await(await x.create({header:"Confirmar Sa칤da",message:"Deseja realmente sair do aplicativo?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Sair",role:"confirm",handler:async()=>{try{await j.execute(),await(await w.create({message:"Logout realizado com sucesso",duration:2e3,color:"success",position:"top"})).present(),f.replace("/login")}catch(t){console.error("Logout error:",t),f.replace("/login")}}}]})).present()},pe=()=>{console.log("Navigating to new checklist..."),f.push("/checklist/new")},ve=()=>{console.log("Navigating to patients..."),f.push("/patients")},G=()=>{console.log("Navigating to active checklists..."),f.push("/checklists")},J=()=>{f.push("/machines")},me=()=>{console.log("Navigating to cleaning controls..."),f.push("/cleaning-controls")},ge=a=>{f.push("/checklist/".concat(a.id))},_e=async a=>{await(await x.create({header:"Pausar Checklist",message:"Deseja pausar o checklist da m치quina ".concat(a.machine.name,"?"),buttons:[{text:"Cancelar",role:"cancel"},{text:"Pausar",handler:async()=>{try{const d=await(await fetch("/api/checklists/".concat(a.id,"/pause"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();if(d.success)await(await w.create({message:"Checklist pausado com sucesso.",duration:3e3,color:"success"})).present(),await U();else throw new Error(d.message)}catch(c){await(await w.create({message:"Erro ao pausar checklist.",duration:3e3,color:"danger"})).present()}}}]})).present()},ke=async a=>{try{const c=await(await fetch("/api/checklists/".concat(a.id,"/resume"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();if(c.success)await(await w.create({message:"Checklist retomado com sucesso.",duration:3e3,color:"success"})).present(),await U();else throw new Error(c.message)}catch(t){await(await w.create({message:"Erro ao retomar checklist.",duration:3e3,color:"danger"})).present()}},fe=()=>{const a=localStorage.getItem("dark-mode");a!==null?n.value=a==="true":n.value=window.matchMedia("(prefers-color-scheme: dark)").matches,K()},K=()=>{n.value?document.body.classList.add("dark"):document.body.classList.remove("dark")},we=async()=>{n.value=!n.value,localStorage.setItem("dark-mode",n.value.toString()),K(),await(await w.create({message:"Modo ".concat(n.value?"escuro":"claro"," ativado"),duration:1500,color:"medium",position:"bottom"})).present(),console.log("Dark mode toggled:",n.value)},Q=()=>{D.value=navigator.onLine};return ye(async()=>{console.log("Dashboard mounted, loading data..."),fe(),i.value=!0;try{await V(),U(),window.addEventListener("online",Q),window.addEventListener("offline",Q)}catch(a){console.error("Dashboard initialization error:",a)}finally{i.value=!1}}),(a,t)=>(m(),M(s(Se),null,{default:u(()=>[o(s(Me),null,{default:u(()=>[o(s(De),{color:"primary"},{default:u(()=>[o(s(Oe),null,{default:u(()=>[...t[0]||(t[0]=[O("Hemodi치lise Mobile",-1)])]),_:1}),o(s(Pe),{slot:"end"},{default:u(()=>[o(s(P),{onClick:we,fill:"clear",class:"theme-toggle-btn"},{default:u(()=>[o(s(l),{icon:n.value?s(Ne):s(Re),slot:"icon-only"},null,8,["icon"])]),_:1}),o(s(P),{onClick:he,fill:"clear"},{default:u(()=>[o(s(l),{icon:s(xe),slot:"icon-only"},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),o(s(Te),{fullscreen:!0,class:"dashboard-content"},{default:u(()=>{var c,d,k,E;return[o(s(ze),{slot:"fixed",onIonRefresh:de},{default:u(()=>[o(s(Ae))]),_:1}),e("div",hs,[h.value?(m(),b("div",ps,[e("div",vs,[e("div",ms,[e("h1",null,"Ol치, "+p(h.value.name.split(" ")[0])+"! 游녦",1)])]),e("div",gs,[A.value.length<=1?(m(),b("div",_s,[o(s(l),{icon:s(ee),class:"unit-icon-static"},null,8,["icon"]),e("div",ks,[t[1]||(t[1]=e("span",{class:"unit-label-static"},"Unidade",-1)),e("span",fs,p(((c=S.value)==null?void 0:c.name)||((d=h.value.unit)==null?void 0:d.name)||"Carregando..."),1)])])):(m(),b("div",ws,[o(s(l),{icon:s(ee),class:"unit-icon"},null,8,["icon"]),e("div",Cs,[t[2]||(t[2]=e("span",{class:"unit-label"},"Unidade Atual",-1)),e("span",ys,p(((k=S.value)==null?void 0:k.name)||((E=h.value.unit)==null?void 0:E.name)||"Carregando..."),1)]),o(s(P),{fill:"clear",size:"small",onClick:ie,class:"unit-change-btn"},{default:u(()=>[o(s(l),{slot:"icon-only",icon:s(Fe)},null,8,["icon"])]),_:1})]))])])):$("",!0),z.value?(m(),b("div",bs,[e("div",{class:"stat-card available",onClick:J},[e("div",$s,[o(s(l),{icon:s(se)},null,8,["icon"])]),e("div",Is,[e("div",Ss,p(R.value),1),t[3]||(t[3]=e("div",{class:"stat-label"},"Dispon칤veis",-1))])]),e("div",{class:"stat-card active",onClick:G},[e("div",Ds,[o(s(l),{icon:s(F)},null,8,["icon"])]),e("div",Os,[e("div",Ps,p(N.value),1),t[4]||(t[4]=e("div",{class:"stat-label"},"Em Andamento",-1))])]),e("div",Ms,[e("div",zs,[o(s(l),{icon:s(He)},null,8,["icon"])]),e("div",As,[e("div",Us,p(B.value),1),t[5]||(t[5]=e("div",{class:"stat-label"},"Total M치quinas",-1))])])])):$("",!0),e("div",Es,[e("button",{class:"primary-btn",onClick:pe},[o(s(l),{icon:s(Ve)},null,8,["icon"]),t[6]||(t[6]=e("div",{class:"btn-text"},[e("span",{class:"btn-title"},"Novo Checklist"),e("span",{class:"btn-subtitle"},"Iniciar verifica칞칚o de seguran칞a")],-1)),R.value>0?(m(),M(s(ae),{key:0,color:"success"},{default:u(()=>[O(p(R.value),1)]),_:1})):$("",!0)])]),e("div",Ts,[t[11]||(t[11]=e("h2",{class:"section-title"},"Acesso R치pido",-1)),e("div",Bs,[N.value>0?(m(),b("div",{key:0,class:"action-btn",onClick:G},[e("div",Ls,[o(s(l),{icon:s(F)},null,8,["icon"])]),e("div",js,[t[7]||(t[7]=e("span",{class:"action-title"},"Checklists Ativos",-1)),e("span",qs,p(N.value)+" em andamento",1)]),o(s(l),{icon:s(L),class:"chevron"},null,8,["icon"])])):$("",!0),e("div",{class:"action-btn",onClick:J},[e("div",Ns,[o(s(l),{icon:s(se)},null,8,["icon"])]),t[8]||(t[8]=e("div",{class:"action-content"},[e("span",{class:"action-title"},"M치quinas"),e("span",{class:"action-subtitle"},"Status e controle")],-1)),o(s(l),{icon:s(L),class:"chevron"},null,8,["icon"])]),e("div",{class:"action-btn",onClick:me},[e("div",Rs,[o(s(l),{icon:s(Ge)},null,8,["icon"])]),t[9]||(t[9]=e("div",{class:"action-content"},[e("span",{class:"action-title"},"Controle de Limpeza"),e("span",{class:"action-subtitle"},"Limpeza e desinfec칞칚o")],-1)),o(s(l),{icon:s(L),class:"chevron"},null,8,["icon"])]),e("div",{class:"action-btn",onClick:ve},[e("div",xs,[o(s(l),{icon:s(Je)},null,8,["icon"])]),t[10]||(t[10]=e("div",{class:"action-content"},[e("span",{class:"action-title"},"Pacientes"),e("span",{class:"action-subtitle"},"Buscar e gerenciar")],-1)),o(s(l),{icon:s(L),class:"chevron"},null,8,["icon"])])])]),v.value.length>0?(m(),b("div",Fs,[t[12]||(t[12]=e("h2",{class:"section-title"},"Em Andamento",-1)),e("div",Hs,[(m(!0),b($e,null,Ie(v.value,W=>(m(),M(ds,{key:W.id,checklist:W,onContinue:ge,onPause:_e,onResume:ke},null,8,["checklist"]))),128))])])):$("",!0),e("div",Vs,[o(s(Ue),{color:D.value?"success":"danger",class:"status-chip"},{default:u(()=>[o(s(l),{icon:s(Ke)},null,8,["icon"]),o(s(Ee),null,{default:u(()=>[O(p(D.value?"Online":"Offline"),1)]),_:1})]),_:1},8,["color"])])])]}),_:1})]),_:1}))}}),Xs=oe(Gs,[["__scopeId","data-v-a2798274"]]);export{Xs as default};
