import{d as Y,r as _,c as g,o as Z,B as y,q as u,x as m,y as t,v as s,H as C,t as n,n as p,J as h,I as ee,G as f,K as c,L as ne,F as te,C as ae,z as se}from"./vendor-DcQkTNkg.js";import{t as V,e as ie,o as le,q as oe,x as ce,p as ue,r as re,g as l,O as z,E as T,P as B,Q as de,G as me,k as ve,i as pe,l as O}from"./ionic-GHA3wq_y.js";import{z as w,D as E,F as L,m as P,t as fe,h as ge,L as be,j as _e,M as Ce,G as he,a4 as ke,E as ye,K as F,C as D,J as I,a5 as S,T as we,i as Ne,_ as Oe}from"./_plugin-vue_export-helper-CkaGgE-1.js";import{C as De,A as Ie}from"./main-ssEl3vM3.js";const Se={class:"progress-bar"},xe={class:"availability-icon"},Ae={class:"availability-info"},qe={class:"availability-label"},Me={class:"availability-count"},$e={class:"form-container"},Ve={class:"step-card"},ze={class:"form-group"},Te={class:"input-label"},Be={class:"machine-grid"},Ee=["onClick"],Le={class:"machine-icon"},Pe={class:"machine-info"},Fe={class:"machine-name"},Ue={key:0,class:"machine-check"},He={key:0,class:"no-machines-message"},Je={class:"form-group"},Ke={class:"input-label"},Re={class:"shift-selector"},je={class:"form-group"},Ge={class:"input-label"},Qe={class:"step-card"},We={class:"toggle-content"},Xe={class:"toggle-text"},Ye={class:"toggle-hint"},Ze={key:0,class:"time-selector"},en={class:"step-card"},nn={class:"legend-pills"},tn={class:"legend-pill conforme"},an={class:"legend-pill nao-conforme"},sn={class:"legend-pill nao-aplica"},ln={class:"cleaning-items"},on={class:"cleaning-item-card"},cn={class:"item-header"},un={class:"conformity-buttons"},rn={class:"cleaning-item-card"},dn={class:"item-header"},mn={class:"conformity-buttons"},vn={class:"cleaning-item-card"},pn={class:"item-header"},fn={class:"conformity-buttons"},gn={class:"step-card optional"},bn={key:0,class:"completion-info"},_n=Y({__name:"CleaningChecklistNewPage",setup(Cn){const x=De.getInstance(),U=x.getCreateCleaningChecklistUseCase(),H=x.getMachineRepository(),J=se(),k=_([]),b=_(!1),r=_(null),a=_({machine_id:0,checklist_date:new Date().toISOString(),shift:"1",chemical_disinfection_time:void 0,chemical_disinfection_completed:!1,hd_machine_cleaning:void 0,osmosis_cleaning:void 0,serum_support_cleaning:void 0,observations:void 0}),K={matutino:"1",vespertino:"2",noturno:"3",madrugada:"4"},d=_("matutino"),R=g(()=>new Date().toISOString()),A=g(()=>a.value.machine_id>0&&a.value.checklist_date&&a.value.shift),j=g(()=>{let o=0;const e=6;return a.value.machine_id>0&&o++,a.value.checklist_date&&o++,d.value&&o++,a.value.hd_machine_cleaning&&o++,a.value.osmosis_cleaning&&o++,a.value.serum_support_cleaning&&o++,o/e*100});g(()=>k.value.length);const q=g(()=>{let o=0;const e=3;return a.value.hd_machine_cleaning&&o++,a.value.osmosis_cleaning&&o++,a.value.serum_support_cleaning&&o++,o/e*100}),G=g(()=>{const o=q.value;return o===0?"Preencha os itens de limpeza de superfície":o<100?"".concat(Math.round(o),"% completo - Continue preenchendo"):"Checklist completo!"});Z(async()=>{try{k.value=await H.getAvailable(),await M()}catch(o){console.error("Error loading machines:",o),await(await V.create({message:"Erro ao carregar máquinas",duration:2e3,color:"danger"})).present()}});const M=async()=>{try{const o=await fetch("/api/machines/availability",Ie.getFetchConfig());if(!o.ok)throw new Error("Failed to fetch machine availability");const e=await o.json();r.value=e.availability}catch(o){console.error("Error fetching machine availability:",o)}},Q=async()=>{if(await M(),!r.value)return{canCreate:!0};const{available:o,overall_status:e,message:i}=r.value;if(o===0)return await(await O.create({header:"Máquinas Indisponíveis",message:"Não há máquinas disponíveis no momento. Por favor, aguarde até que uma máquina fique disponível para realizar a limpeza.",buttons:["OK"]})).present(),{canCreate:!1};if(e==="warning"||e==="alert"){const v=await O.create({header:"Atenção",message:"".concat(i,". Apenas ").concat(o," máquina(s) disponível(is). Deseja continuar com o checklist de limpeza?"),buttons:[{text:"Cancelar",role:"cancel"},{text:"Continuar",role:"confirm"}]});await v.present();const{role:N}=await v.onDidDismiss();return{canCreate:N==="confirm"}}return{canCreate:!0}},W=async()=>{if(!(!A.value||b.value||!(await Q()).canCreate)){b.value=!0;try{const i=new Date(a.value.checklist_date).toISOString().split("T")[0];let v;if(a.value.chemical_disinfection_completed&&a.value.chemical_disinfection_time){const $=new Date(a.value.chemical_disinfection_time);v="".concat(String($.getHours()).padStart(2,"0"),":").concat(String($.getMinutes()).padStart(2,"0"))}const N=K[d.value],X={...a.value,shift:N,checklist_date:i,chemical_disinfection_time:v};await U.execute(X),await(await V.create({message:"Checklist salvo com sucesso!",duration:2e3,color:"success"})).present(),J.push("/cleaning-controls")}catch(e){console.error("Error creating checklist:",e);let i="Erro ao salvar checklist";e.message&&e.message.includes("Já existe")&&(i="Já existe um checklist para esta máquina, data e turno"),await(await O.create({header:"Erro",message:i,buttons:["OK"]})).present()}finally{b.value=!1}}};return(o,e)=>(u(),y(t(ie),null,{default:m(()=>[s(t(re),null,{default:m(()=>[s(t(le),{color:"primary"},{default:m(()=>[s(t(oe),{slot:"start"},{default:m(()=>[s(t(ce),{"default-href":"/cleaning-controls"})]),_:1}),s(t(ue),null,{default:m(()=>[...e[19]||(e[19]=[C("Checklist de Limpeza",-1)])]),_:1})]),_:1})]),_:1}),s(t(pe),{fullscreen:!0,class:"cleaning-checklist-content"},{default:m(()=>[n("div",Se,[n("div",{class:"progress-fill",style:ee({width:j.value+"%"})},null,4)]),r.value?(u(),p("div",{key:0,class:c(["availability-badge",r.value.overall_status])},[n("div",xe,[r.value.overall_status==="good"?(u(),y(t(l),{key:0,icon:t(w)},null,8,["icon"])):r.value.overall_status==="critical"?(u(),y(t(l),{key:1,icon:t(E)},null,8,["icon"])):(u(),y(t(l),{key:2,icon:t(L)},null,8,["icon"]))]),n("div",Ae,[n("span",qe,f(r.value.message),1),n("span",Me,f(r.value.available)+" de "+f(r.value.total)+" disponíveis para limpeza ",1)])],2)):h("",!0),n("div",$e,[n("div",Ve,[e[33]||(e[33]=n("div",{class:"step-header"},[n("div",{class:"step-number"},"1"),n("h2",null,"Máquina e Turno")],-1)),n("div",ze,[n("label",Te,[s(t(l),{icon:t(P)},null,8,["icon"]),e[20]||(e[20]=C(" Selecione a Máquina para Limpeza ",-1))]),n("div",Be,[(u(!0),p(te,null,ne(k.value,i=>(u(),p("button",{key:i.id,type:"button",class:c(["machine-card",{selected:a.value.machine_id===i.id}]),onClick:v=>a.value.machine_id=i.id},[n("div",Le,[s(t(l),{icon:t(F)},null,8,["icon"])]),n("div",Pe,[n("span",Fe,f(i.name),1),e[21]||(e[21]=n("span",{class:"machine-status"},"Disponível",-1))]),a.value.machine_id===i.id?(u(),p("div",Ue,[s(t(l),{icon:t(w)},null,8,["icon"])])):h("",!0)],10,Ee))),128))]),k.value.length===0?(u(),p("div",He,[s(t(l),{icon:t(L)},null,8,["icon"]),e[22]||(e[22]=n("p",null,"Nenhuma máquina disponível no momento. Aguarde até que uma máquina fique disponível.",-1))])):h("",!0)]),n("div",Je,[n("label",Ke,[s(t(l),{icon:t(fe)},null,8,["icon"]),e[23]||(e[23]=C(" Selecione o Turno da Limpeza ",-1))]),n("div",Re,[n("button",{type:"button",class:c(["shift-btn",{active:d.value==="matutino"}]),onClick:e[0]||(e[0]=i=>d.value="matutino")},[s(t(l),{icon:t(ge)},null,8,["icon"]),e[24]||(e[24]=n("span",null,"Matutino",-1)),e[25]||(e[25]=n("span",{class:"shift-time"},"06:00 - 12:00",-1))],2),n("button",{type:"button",class:c(["shift-btn",{active:d.value==="vespertino"}]),onClick:e[1]||(e[1]=i=>d.value="vespertino")},[s(t(l),{icon:t(be)},null,8,["icon"]),e[26]||(e[26]=n("span",null,"Vespertino",-1)),e[27]||(e[27]=n("span",{class:"shift-time"},"12:00 - 18:00",-1))],2),n("button",{type:"button",class:c(["shift-btn",{active:d.value==="noturno"}]),onClick:e[2]||(e[2]=i=>d.value="noturno")},[s(t(l),{icon:t(_e)},null,8,["icon"]),e[28]||(e[28]=n("span",null,"Noturno",-1)),e[29]||(e[29]=n("span",{class:"shift-time"},"18:00 - 00:00",-1))],2),n("button",{type:"button",class:c(["shift-btn",{active:d.value==="madrugada"}]),onClick:e[3]||(e[3]=i=>d.value="madrugada")},[s(t(l),{icon:t(Ce)},null,8,["icon"]),e[30]||(e[30]=n("span",null,"Madrugada",-1)),e[31]||(e[31]=n("span",{class:"shift-time"},"00:00 - 06:00",-1))],2)])]),n("div",je,[n("label",Ge,[s(t(l),{icon:t(he)},null,8,["icon"]),e[32]||(e[32]=C(" Data da Limpeza ",-1))]),s(t(z),{datetime:"checklist-date",class:"date-btn"}),s(t(T),{"keep-contents-mounted":!0},{default:m(()=>[s(t(B),{id:"checklist-date",modelValue:a.value.checklist_date,"onUpdate:modelValue":e[4]||(e[4]=i=>a.value.checklist_date=i),presentation:"date",max:R.value},null,8,["modelValue","max"])]),_:1})])]),n("div",Qe,[e[36]||(e[36]=n("div",{class:"step-header"},[n("div",{class:"step-number"},"2"),n("h2",null,"Desinfecção Química")],-1)),n("div",{class:"toggle-card",onClick:e[7]||(e[7]=i=>a.value.chemical_disinfection_completed=!a.value.chemical_disinfection_completed)},[n("div",We,[s(t(l),{icon:t(ke),class:"toggle-icon"},null,8,["icon"]),n("div",Xe,[e[34]||(e[34]=n("span",{class:"toggle-title"},"Desinfecção Realizada?",-1)),n("span",Ye,"Toque para "+f(a.value.chemical_disinfection_completed?"desmarcar":"marcar"),1)])]),s(t(de),{modelValue:a.value.chemical_disinfection_completed,"onUpdate:modelValue":e[5]||(e[5]=i=>a.value.chemical_disinfection_completed=i),onClick:e[6]||(e[6]=ae(()=>{},["stop"]))},null,8,["modelValue"])]),a.value.chemical_disinfection_completed?(u(),p("div",Ze,[e[35]||(e[35]=n("label",{class:"quick-label"},"Horário da Desinfecção",-1)),s(t(z),{datetime:"disinfection-time",class:"time-btn"}),s(t(T),{"keep-contents-mounted":!0},{default:m(()=>[s(t(B),{id:"disinfection-time",modelValue:a.value.chemical_disinfection_time,"onUpdate:modelValue":e[8]||(e[8]=i=>a.value.chemical_disinfection_time=i),presentation:"time"},null,8,["modelValue"])]),_:1})])):h("",!0)]),n("div",en,[e[52]||(e[52]=n("div",{class:"step-header"},[n("div",{class:"step-number"},"3"),n("div",{class:"step-header-text"},[n("h2",null,"Limpeza de Superfície"),n("p",{class:"step-legend"},"Marque a conformidade de cada item")])],-1)),n("div",nn,[n("div",tn,[s(t(l),{icon:t(w)},null,8,["icon"]),e[37]||(e[37]=n("span",null,"C - Conforme",-1))]),n("div",an,[s(t(l),{icon:t(E)},null,8,["icon"]),e[38]||(e[38]=n("span",null,"NC - Não Conforme",-1))]),n("div",sn,[s(t(l),{icon:t(ye)},null,8,["icon"]),e[39]||(e[39]=n("span",null,"NA - Não se Aplica",-1))])]),n("div",ln,[n("div",on,[n("div",cn,[s(t(l),{icon:t(F),class:"item-icon hd"},null,8,["icon"]),e[40]||(e[40]=n("span",{class:"item-name"},"Máquina de HD",-1))]),n("div",un,[n("button",{onClick:e[9]||(e[9]=i=>a.value.hd_machine_cleaning="C"),class:c(["conf-btn","conforme",{active:a.value.hd_machine_cleaning==="C"}])},[s(t(l),{icon:t(D)},null,8,["icon"]),e[41]||(e[41]=n("span",null,"C",-1))],2),n("button",{onClick:e[10]||(e[10]=i=>a.value.hd_machine_cleaning="NC"),class:c(["conf-btn","nao-conforme",{active:a.value.hd_machine_cleaning==="NC"}])},[s(t(l),{icon:t(I)},null,8,["icon"]),e[42]||(e[42]=n("span",null,"NC",-1))],2),n("button",{onClick:e[11]||(e[11]=i=>a.value.hd_machine_cleaning="NA"),class:c(["conf-btn","nao-aplica",{active:a.value.hd_machine_cleaning==="NA"}])},[s(t(l),{icon:t(S)},null,8,["icon"]),e[43]||(e[43]=n("span",null,"NA",-1))],2)])]),n("div",rn,[n("div",dn,[s(t(l),{icon:t(we),class:"item-icon osmose"},null,8,["icon"]),e[44]||(e[44]=n("span",{class:"item-name"},"Osmose",-1))]),n("div",mn,[n("button",{onClick:e[12]||(e[12]=i=>a.value.osmosis_cleaning="C"),class:c(["conf-btn","conforme",{active:a.value.osmosis_cleaning==="C"}])},[s(t(l),{icon:t(D)},null,8,["icon"]),e[45]||(e[45]=n("span",null,"C",-1))],2),n("button",{onClick:e[13]||(e[13]=i=>a.value.osmosis_cleaning="NC"),class:c(["conf-btn","nao-conforme",{active:a.value.osmosis_cleaning==="NC"}])},[s(t(l),{icon:t(I)},null,8,["icon"]),e[46]||(e[46]=n("span",null,"NC",-1))],2),n("button",{onClick:e[14]||(e[14]=i=>a.value.osmosis_cleaning="NA"),class:c(["conf-btn","nao-aplica",{active:a.value.osmosis_cleaning==="NA"}])},[s(t(l),{icon:t(S)},null,8,["icon"]),e[47]||(e[47]=n("span",null,"NA",-1))],2)])]),n("div",vn,[n("div",pn,[s(t(l),{icon:t(P),class:"item-icon soro"},null,8,["icon"]),e[48]||(e[48]=n("span",{class:"item-name"},"Suporte de Soro",-1))]),n("div",fn,[n("button",{onClick:e[15]||(e[15]=i=>a.value.serum_support_cleaning="C"),class:c(["conf-btn","conforme",{active:a.value.serum_support_cleaning==="C"}])},[s(t(l),{icon:t(D)},null,8,["icon"]),e[49]||(e[49]=n("span",null,"C",-1))],2),n("button",{onClick:e[16]||(e[16]=i=>a.value.serum_support_cleaning="NC"),class:c(["conf-btn","nao-conforme",{active:a.value.serum_support_cleaning==="NC"}])},[s(t(l),{icon:t(I)},null,8,["icon"]),e[50]||(e[50]=n("span",null,"NC",-1))],2),n("button",{onClick:e[17]||(e[17]=i=>a.value.serum_support_cleaning="NA"),class:c(["conf-btn","nao-aplica",{active:a.value.serum_support_cleaning==="NA"}])},[s(t(l),{icon:t(S)},null,8,["icon"]),e[51]||(e[51]=n("span",null,"NA",-1))],2)])])])]),n("div",gn,[e[53]||(e[53]=n("div",{class:"step-header"},[n("div",{class:"step-number optional"},"4"),n("div",{class:"step-header-text"},[n("h2",null,"Observações"),n("span",{class:"optional-badge"},"Opcional")])],-1)),s(t(me),{modelValue:a.value.observations,"onUpdate:modelValue":e[18]||(e[18]=i=>a.value.observations=i),placeholder:"Adicione observações sobre a limpeza (opcional)...",rows:3,"auto-grow":"",class:"obs-textarea"},null,8,["modelValue"])]),s(t(ve),{expand:"block",onClick:W,disabled:!A.value||b.value,class:"submit-button",size:"large"},{default:m(()=>[s(t(l),{slot:"start",icon:t(w)},null,8,["icon"]),C(" "+f(b.value?"Salvando...":"Concluir Checklist"),1)]),_:1},8,["disabled"]),q.value<100?(u(),p("div",bn,[s(t(l),{icon:t(Ne)},null,8,["icon"]),n("span",null,f(G.value),1)])):h("",!0)])]),_:1})]),_:1}))}}),On=Oe(_n,[["__scopeId","data-v-193001bd"]]);export{On as default};
