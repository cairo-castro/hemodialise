const __vite__fileDeps=["assets/ionic-ZHEFjxIb.js","assets/vendor-BOCCj2ty.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{e as De,t as y,m as ae,o as N,x as Se,n as te,k as M,g as l,p as se,q as Oe,r as Te,B as Ve,C as $e,f as Ae,y as Be,z as Re,E as ze,i as ne,u as B,J as oe,G as Le,K as Ne,l as Pe,j as Ue,L as Fe,_ as P}from"./ionic-ZHEFjxIb.js";import{d as je,r as C,c as I,o as He,B as x,q as p,x as i,y as e,v as o,H as m,t as s,n as g,G as c,K as w,J as b,F as ie,L as le,C as re,z as Je}from"./vendor-BOCCj2ty.js";import{x as Ge,F as Ke,t as U,J as R,y as z,T as F,U as j,z as Qe,V as We,N as Xe,k as Ye,W as Ze,X as ea,Y as aa,p as ta,b as sa,r as na,Z as oa,_ as ia}from"./_plugin-vue_export-helper-B7Fc93E3.js";import{C as la}from"./main-BVikBV_n.js";import{u as ra}from"./useStatsAutoRefresh-CLxGpd_l.js";const ua={class:"machines-container"},ca={class:"time-display"},da={class:"current-date"},va={class:"current-time"},pa={class:"filter-pills"},ma={class:"pill-count"},fa={class:"pill-count"},_a={class:"pill-count"},ga={class:"pill-count"},ba={class:"stats-summary"},ha={class:"stat-info"},ya={class:"stat-number"},wa={class:"stat-info"},ka={class:"stat-number"},Ca={class:"stat-info"},Ma={class:"stat-number"},xa={class:"stat-info"},Ea={class:"stat-number"},Ia={key:0,class:"loading-container"},qa={key:1,class:"machines-list"},Da=["onClick"],Sa={class:"machine-card-header"},Oa={class:"machine-primary-info"},Ta={class:"machine-name"},Va={key:0,class:"machine-identifier"},$a={class:"machine-status-badge"},Aa={class:"status-text"},Ba={key:0,class:"machine-description"},Ra={key:1,class:"session-info-modern"},za={class:"session-tag"},La={class:"session-details-grid"},Na={class:"session-detail"},Pa={class:"detail-value"},Ua={class:"session-detail"},Fa={class:"detail-value"},ja={class:"session-detail"},Ha={class:"detail-value"},Ja={class:"session-action"},Ga={key:3,class:"inactive-overlay"},Ka={key:0,class:"empty-state-modern"},Qa={class:"empty-icon"},Wa={class:"form-section"},Xa={class:"form-group"},Ya={class:"form-group"},Za={class:"form-group"},et={key:0,class:"form-group"},at={class:"form-actions"},tt=je({__name:"MachinesPage",setup(st){const ue=Je(),D=la.getInstance().getMachineRepository(),d=C([]),S=C(!1),k=C("all"),H=C(""),J=C(""),O=C(!1),h=C(!1),_=C(!1),q=C([]),r=C({id:null,name:"",identifier:"",description:"",unit_id:null}),G=()=>{const t=new Date;H.value=t.toLocaleDateString("pt-BR",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),J.value=t.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})};setInterval(G,1e3),G();const K=I(()=>d.value.filter(t=>t.status==="available"&&t.is_active!==!1).length),Q=I(()=>d.value.filter(t=>t.status==="occupied").length),W=I(()=>d.value.filter(t=>t.status==="maintenance").length),ce=I(()=>d.value.filter(t=>t.is_active===!1).length),X=I(()=>{switch(k.value){case"available":return d.value.filter(t=>t.status==="available"&&t.is_active!==!1);case"occupied":return d.value.filter(t=>t.status==="occupied");case"maintenance":return d.value.filter(t=>t.status==="maintenance");case"inactive":return d.value.filter(t=>t.is_active===!1);default:return d.value}}),T=async()=>{S.value=!0;try{const t=await D.getAll();d.value=t}catch(t){console.error("Error loading machines:",t),await(await y.create({message:"Erro ao carregar máquinas",duration:3e3,color:"danger",position:"top"})).present()}finally{S.value=!1}},Y=async()=>{await T()},{isRefreshing:V,forceRefresh:de}=ra(Y,{loadOnMount:!1,interval:15e3,onStatsUpdated:()=>{console.log("[Machines] Stats atualizados automaticamente")}}),ve=async t=>{await de(),t.target.complete()},L=t=>!t.is_active||t.is_active===!1?"inactive":t.status,pe=t=>{if(!t.is_active||t.is_active===!1)return"Desativada";switch(t.status){case"available":return"Disponível";case"occupied":return"Em Uso";case"reserved":return"Reservada";case"maintenance":return"Manutenção";default:return t.status}},me=t=>({pre_dialysis:"Pré-Diálise",during_session:"Durante Sessão",post_dialysis:"Pós-Diálise",completed:"Concluído",interrupted:"Interrompido"})[t]||t,fe=t=>t?new Date(t).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):"",_e=t=>{ue.push("/checklist/".concat(t))},ge=async t=>{const{alertController:a}=await P(()=>import("./ionic-ZHEFjxIb.js").then(u=>u.a6),__vite__mapDeps([0,1]));await(await a.create({header:"Colocar em Manutenção",subHeader:t.name,message:"Descreva brevemente o motivo da manutenção:",inputs:[{name:"reason",type:"textarea",placeholder:"Ex: Troca de filtros, ajuste de pressão, etc."}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Confirmar",handler:u=>{be(t,u.reason||"")}}]})).present()},be=async(t,a)=>{var n,u;try{const v=await D.updateStatus(t.id,{status:"maintenance",reason:a}),f=d.value.findIndex(A=>A.id===t.id);f!==-1&&(d.value[f]={...d.value[f],...v}),await(await y.create({message:"".concat(t.name," colocada em manutenção"),duration:3e3,color:"success",position:"top"})).present()}catch(v){console.error("Error putting machine in maintenance:",v),await(await y.create({message:((u=(n=v.response)==null?void 0:n.data)==null?void 0:u.message)||"Erro ao colocar máquina em manutenção",duration:4e3,color:"danger",position:"top"})).present()}},he=async t=>{const{alertController:a}=await P(()=>import("./ionic-ZHEFjxIb.js").then(u=>u.a6),__vite__mapDeps([0,1]));await(await a.create({header:"Liberar Máquina",subHeader:t.name,message:"Tem certeza que deseja liberar esta máquina? Ela ficará disponível para uso.",buttons:[{text:"Cancelar",role:"cancel"},{text:"Liberar",handler:async()=>{var u,v;try{const f=await D.updateStatus(t.id,{status:"available"}),E=d.value.findIndex(qe=>qe.id===t.id);E!==-1&&(d.value[E]={...d.value[E],...f}),await(await y.create({message:"".concat(t.name," liberada com sucesso"),duration:3e3,color:"success",position:"top"})).present()}catch(f){console.error("Error releasing machine:",f),await(await y.create({message:((v=(u=f.response)==null?void 0:u.data)==null?void 0:v.message)||"Erro ao liberar máquina",duration:4e3,color:"danger",position:"top"})).present()}}}]})).present()},ye=async t=>{const{alertController:a}=await P(()=>import("./ionic-ZHEFjxIb.js").then(v=>v.a6),__vite__mapDeps([0,1])),n=!t.is_active;await(await a.create({header:n?"Ativar Máquina":"Desativar Máquina",subHeader:t.name,message:n?"A máquina será ativada e ficará disponível para uso.":"Descreva brevemente o motivo da desativação:",inputs:n?[]:[{name:"reason",type:"textarea",placeholder:"Ex: Equipamento danificado, aguardando reparo, etc."}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Confirmar",handler:v=>{we(t,(v==null?void 0:v.reason)||"")}}]})).present()},we=async(t,a)=>{var n,u;try{const v=await D.toggleActive(t.id,{reason:a}),f=d.value.findIndex(A=>A.id===t.id);f!==-1&&(d.value[f]={...d.value[f],...v}),await(await y.create({message:v.is_active?"".concat(t.name," ativada com sucesso"):"".concat(t.name," desativada com sucesso"),duration:3e3,color:"success",position:"top"})).present()}catch(v){console.error("Error toggling machine active:",v),await(await y.create({message:((u=(n=v.response)==null?void 0:n.data)==null?void 0:u.message)||"Erro ao alterar estado da máquina",duration:4e3,color:"danger",position:"top"})).present()}},ke=()=>{switch(k.value){case"available":return"Nenhuma máquina disponível no momento";case"occupied":return"Nenhuma máquina em uso";case"maintenance":return"Nenhuma máquina em manutenção";case"inactive":return"Nenhuma máquina desativada";default:return"Nenhuma máquina cadastrada"}},Z=I(()=>r.value.name.trim()!==""&&r.value.identifier.trim()!==""&&(h.value||r.value.unit_id!==null)),ee=async()=>{try{const a=await(await fetch("/api/user-units",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();a.success&&(q.value=a.units||[],a.current_unit_id&&!h.value?r.value.unit_id=a.current_unit_id:q.value.length===1&&(r.value.unit_id=q.value[0].id))}catch(t){console.error("Erro ao carregar unidades:",t)}},Ce=async()=>{h.value=!1,r.value={id:null,name:"",identifier:"",description:"",unit_id:null},await ee(),O.value=!0},Me=async t=>{h.value=!0,r.value={id:t.id,name:t.name,identifier:t.identifier,description:t.description||"",unit_id:t.unit_id},await ee(),O.value=!0},$=()=>{O.value=!1,r.value={id:null,name:"",identifier:"",description:"",unit_id:null}},xe=async()=>{if(Z.value){_.value=!0;try{const t=h.value?"/api/machines/".concat(r.value.id):"/api/machines",a=h.value?"PUT":"POST",u=await(await fetch(t,{method:a,headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))},body:JSON.stringify({name:r.value.name,identifier:r.value.identifier,description:r.value.description,unit_id:r.value.unit_id})})).json();if(u.success)await(await y.create({message:u.message||(h.value?"Máquina atualizada com sucesso!":"Máquina criada com sucesso!"),duration:3e3,color:"success",position:"top"})).present(),$(),await T();else throw new Error(u.message||"Erro ao salvar máquina")}catch(t){await(await y.create({message:t.message||"Erro ao salvar máquina. Tente novamente.",duration:4e3,color:"danger",position:"top"})).present()}finally{_.value=!1}}},Ee=async()=>{await(await Pe.create({header:"Confirmar Exclusão",message:"Tem certeza que deseja excluir a máquina <strong>".concat(r.value.name,"</strong>? Esta ação irá desativá-la."),buttons:[{text:"Cancelar",role:"cancel"},{text:"Excluir",role:"destructive",handler:async()=>{await Ie()}}]})).present()},Ie=async()=>{if(r.value.id){_.value=!0;try{const a=await(await fetch("/api/machines/".concat(r.value.id),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();if(a.success)await(await y.create({message:a.message||"Máquina removida com sucesso!",duration:3e3,color:"success",position:"top"})).present(),$(),await T();else throw new Error(a.message||"Erro ao excluir máquina")}catch(t){await(await y.create({message:t.message||"Erro ao excluir máquina. Tente novamente.",duration:4e3,color:"danger",position:"top"})).present()}finally{_.value=!1}}};return He(()=>{T()}),(t,a)=>(p(),x(e(De),null,{default:i(()=>[o(e(se),{translucent:!0},{default:i(()=>[o(e(ae),{color:"primary"},{default:i(()=>[o(e(N),{slot:"start"},{default:i(()=>[o(e(Se),{"default-href":"/dashboard"})]),_:1}),o(e(te),null,{default:i(()=>[...a[9]||(a[9]=[m("Gestão de Máquinas",-1)])]),_:1}),o(e(N),{slot:"end"},{default:i(()=>[o(e(M),{onClick:Y,disabled:S.value},{default:i(()=>[o(e(l),{icon:e(Ge)},null,8,["icon"])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),o(e(ne),{fullscreen:!0,class:"machines-content"},{default:i(()=>[s("div",ua,[o(e(Oe),{slot:"fixed",onIonRefresh:ve},{default:i(()=>[o(e(Te))]),_:1}),o(e(Ve),{class:"time-header-card"},{default:i(()=>[o(e($e),null,{default:i(()=>[s("div",ca,[s("div",da,[o(e(l),{icon:e(Ke),class:"date-icon"},null,8,["icon"]),m(" "+c(H.value),1)]),s("div",va,[o(e(l),{icon:e(U),class:"time-icon"},null,8,["icon"]),m(" "+c(J.value),1)])])]),_:1})]),_:1}),s("div",pa,[s("button",{class:w(["filter-pill",{active:k.value==="all"}]),onClick:a[0]||(a[0]=n=>k.value="all")},[o(e(l),{icon:e(R)},null,8,["icon"]),a[10]||(a[10]=s("span",null,"Todas",-1)),s("span",ma,c(d.value.length),1)],2),s("button",{class:w(["filter-pill available",{active:k.value==="available"}]),onClick:a[1]||(a[1]=n=>k.value="available")},[o(e(l),{icon:e(z)},null,8,["icon"]),a[11]||(a[11]=s("span",null,"Disponíveis",-1)),s("span",fa,c(K.value),1)],2),s("button",{class:w(["filter-pill occupied",{active:k.value==="occupied"}]),onClick:a[2]||(a[2]=n=>k.value="occupied")},[o(e(l),{icon:e(U)},null,8,["icon"]),a[12]||(a[12]=s("span",null,"Em Uso",-1)),s("span",_a,c(Q.value),1)],2),s("button",{class:w(["filter-pill maintenance",{active:k.value==="maintenance"}]),onClick:a[3]||(a[3]=n=>k.value="maintenance")},[o(e(l),{icon:e(F)},null,8,["icon"]),a[13]||(a[13]=s("span",null,"Manutenção",-1)),s("span",ga,c(W.value),1)],2)]),s("div",ba,[s("div",{class:w(["stat-card available",{updating:e(V)}])},[o(e(l),{icon:e(z)},null,8,["icon"]),s("div",ha,[s("span",ya,c(K.value),1),a[14]||(a[14]=s("span",{class:"stat-label"},"Disponíveis",-1))])],2),s("div",{class:w(["stat-card occupied",{updating:e(V)}])},[o(e(l),{icon:e(U)},null,8,["icon"]),s("div",wa,[s("span",ka,c(Q.value),1),a[15]||(a[15]=s("span",{class:"stat-label"},"Em Uso",-1))])],2),s("div",{class:w(["stat-card maintenance",{updating:e(V)}])},[o(e(l),{icon:e(F)},null,8,["icon"]),s("div",Ca,[s("span",Ma,c(W.value),1),a[16]||(a[16]=s("span",{class:"stat-label"},"Manutenção",-1))])],2),s("div",{class:w(["stat-card inactive",{updating:e(V)}])},[o(e(l),{icon:e(j)},null,8,["icon"]),s("div",xa,[s("span",Ea,c(ce.value),1),a[17]||(a[17]=s("span",{class:"stat-label"},"Desativadas",-1))])],2)]),S.value?(p(),g("div",Ia,[o(e(Ae),{name:"crescent"}),a[18]||(a[18]=s("p",null,"Carregando máquinas...",-1))])):(p(),g("div",qa,[(p(!0),g(ie,null,le(X.value,n=>(p(),g("div",{key:n.id,class:w(["machine-card-modern",L(n)]),onClick:u=>n.current_checklist&&_e(n.current_checklist.id)},[s("div",Sa,[s("div",{class:w(["machine-icon-large",L(n)])},[o(e(l),{icon:e(R)},null,8,["icon"])],2),s("div",Oa,[s("h3",Ta,c(n.name),1),n.identifier?(p(),g("p",Va,c(n.identifier),1)):b("",!0)]),s("div",$a,[s("div",{class:w(["status-dot",L(n)])},null,2),s("span",Aa,c(pe(n)),1)])]),n.description?(p(),g("div",Ba,c(n.description),1)):b("",!0),n.current_checklist?(p(),g("div",Ra,[s("div",za,[o(e(l),{icon:e(ta)},null,8,["icon"]),a[20]||(a[20]=s("span",null,"Sessão Ativa",-1)),n.current_checklist.is_paused?(p(),x(e(Ue),{key:0,color:"warning"},{default:i(()=>[...a[19]||(a[19]=[m("Pausado",-1)])]),_:1})):b("",!0)]),s("div",La,[s("div",Na,[a[21]||(a[21]=s("span",{class:"detail-label"},"Paciente",-1)),s("span",Pa,c(n.current_checklist.patient_name),1)]),s("div",Ua,[a[22]||(a[22]=s("span",{class:"detail-label"},"Fase",-1)),s("span",Fa,c(me(n.current_checklist.current_phase)),1)]),s("div",ja,[a[23]||(a[23]=s("span",{class:"detail-label"},"Início",-1)),s("span",Ha,c(fe(n.current_checklist.started_at)),1)])]),s("div",Ja,[o(e(l),{icon:e(sa)},null,8,["icon"]),a[24]||(a[24]=s("span",null,"Clique para ver checklist",-1)),o(e(l),{icon:e(na)},null,8,["icon"])])])):b("",!0),n.current_checklist?b("",!0):(p(),g("div",{key:2,class:"machine-actions",onClick:a[4]||(a[4]=re(()=>{},["stop"]))},[o(e(M),{fill:"clear",size:"small",color:"medium",onClick:u=>Me(n)},{default:i(()=>[o(e(l),{slot:"start",icon:e(oa)},null,8,["icon"]),a[25]||(a[25]=m(" Editar ",-1))]),_:1},8,["onClick"]),n.is_active&&n.status==="available"?(p(),x(e(M),{key:0,fill:"outline",size:"small",color:"warning",onClick:u=>ge(n)},{default:i(()=>[o(e(l),{slot:"start",icon:e(F)},null,8,["icon"]),a[26]||(a[26]=m(" Manutenção ",-1))]),_:1},8,["onClick"])):b("",!0),n.is_active&&n.status==="maintenance"?(p(),x(e(M),{key:1,fill:"solid",size:"small",color:"success",onClick:u=>he(n)},{default:i(()=>[o(e(l),{slot:"start",icon:e(z)},null,8,["icon"]),a[27]||(a[27]=m(" Liberar Máquina ",-1))]),_:1},8,["onClick"])):b("",!0),n.status!=="occupied"?(p(),x(e(M),{key:2,fill:"outline",size:"small",color:n.is_active?"danger":"success",onClick:u=>ye(n)},{default:i(()=>[o(e(l),{slot:"start",icon:n.is_active?e(j):e(z)},null,8,["icon"]),m(" "+c(n.is_active?"Desativar":"Ativar"),1)]),_:2},1032,["color","onClick"])):b("",!0)])),n.is_active?b("",!0):(p(),g("div",Ga,[o(e(l),{icon:e(j)},null,8,["icon"]),a[28]||(a[28]=s("span",null,"Desativada",-1))]))],10,Da))),128)),X.value.length===0?(p(),g("div",Ka,[s("div",Qa,[o(e(l),{icon:e(R)},null,8,["icon"])]),a[29]||(a[29]=s("h3",null,"Nenhuma máquina encontrada",-1)),s("p",null,c(ke()),1)])):b("",!0)]))]),o(e(Be),{vertical:"bottom",horizontal:"end",slot:"fixed"},{default:i(()=>[o(e(Re),{onClick:Ce},{default:i(()=>[o(e(l),{icon:e(Qe)},null,8,["icon"])]),_:1})]),_:1}),o(e(ze),{"is-open":O.value,onDidDismiss:$},{default:i(()=>[o(e(se),null,{default:i(()=>[o(e(ae),null,{default:i(()=>[o(e(te),null,{default:i(()=>[m(c(h.value?"Editar Máquina":"Nova Máquina"),1)]),_:1}),o(e(N),{slot:"end"},{default:i(()=>[o(e(M),{onClick:$},{default:i(()=>[...a[30]||(a[30]=[m("Cancelar",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),o(e(ne),{class:"machine-modal-content"},{default:i(()=>[s("form",{onSubmit:re(xe,["prevent"]),class:"machine-form"},[s("div",Wa,[a[35]||(a[35]=s("h3",{class:"section-title"},"Informações Básicas",-1)),s("div",Xa,[o(e(B),{position:"stacked",class:"form-label"},{default:i(()=>[o(e(l),{icon:e(R)},null,8,["icon"]),a[31]||(a[31]=m(" Nome da Máquina * ",-1))]),_:1}),o(e(oe),{modelValue:r.value.name,"onUpdate:modelValue":a[5]||(a[5]=n=>r.value.name=n),type:"text",placeholder:"Ex: Máquina 01",required:"",disabled:_.value,class:"custom-input"},null,8,["modelValue","disabled"])]),s("div",Ya,[o(e(B),{position:"stacked",class:"form-label"},{default:i(()=>[o(e(l),{icon:e(We)},null,8,["icon"]),a[32]||(a[32]=m(" Identificador/Código * ",-1))]),_:1}),o(e(oe),{modelValue:r.value.identifier,"onUpdate:modelValue":a[6]||(a[6]=n=>r.value.identifier=n),type:"text",placeholder:"Ex: MAQ-001",required:"",disabled:_.value,class:"custom-input"},null,8,["modelValue","disabled"])]),s("div",Za,[o(e(B),{position:"stacked",class:"form-label"},{default:i(()=>[o(e(l),{icon:e(Xe)},null,8,["icon"]),a[33]||(a[33]=m(" Descrição ",-1))]),_:1}),o(e(Le),{modelValue:r.value.description,"onUpdate:modelValue":a[7]||(a[7]=n=>r.value.description=n),placeholder:"Informações adicionais sobre a máquina",rows:4,disabled:_.value,class:"custom-textarea"},null,8,["modelValue","disabled"])]),h.value?b("",!0):(p(),g("div",et,[o(e(B),{position:"stacked",class:"form-label"},{default:i(()=>[o(e(l),{icon:e(Ye)},null,8,["icon"]),a[34]||(a[34]=m(" Unidade * ",-1))]),_:1}),o(e(Ne),{modelValue:r.value.unit_id,"onUpdate:modelValue":a[8]||(a[8]=n=>r.value.unit_id=n),placeholder:"Selecione a unidade",interface:"action-sheet",disabled:_.value||q.value.length===1,class:"custom-select"},{default:i(()=>[(p(!0),g(ie,null,le(q.value,n=>(p(),x(e(Fe),{key:n.id,value:n.id},{default:i(()=>[m(c(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","disabled"])]))]),s("div",at,[o(e(M),{expand:"block",type:"submit",disabled:_.value||!Z.value,class:"submit-button"},{default:i(()=>[o(e(l),{slot:"start",icon:_.value?e(Ze):e(ea)},null,8,["icon"]),m(" "+c(_.value?"Salvando...":h.value?"Atualizar Máquina":"Criar Máquina"),1)]),_:1},8,["disabled"]),h.value?(p(),x(e(M),{key:0,expand:"block",fill:"outline",color:"danger",onClick:Ee,disabled:_.value,class:"delete-button"},{default:i(()=>[o(e(l),{slot:"start",icon:e(aa)},null,8,["icon"]),a[36]||(a[36]=m(" Excluir Máquina ",-1))]),_:1},8,["disabled"])):b("",!0)])],32)]),_:1})]),_:1},8,["is-open"])]),_:1})]),_:1}))}}),ct=ia(tt,[["__scopeId","data-v-86338f0d"]]);export{ct as default};
