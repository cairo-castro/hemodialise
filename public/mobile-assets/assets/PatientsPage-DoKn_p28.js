import{d as st,r as y,c as R,o as et,B as T,q as u,x as n,y as s,v as a,H as d,t as e,K as v,G as m,n as f,J as b,L as at,F as ot,C as nt}from"./vendor-BOCCj2ty.js";import{e as lt,w as E,t as C,m as $,o as O,x as it,n as F,k as S,g as l,p as M,H as dt,j as U,E as rt,i as q,J as H,K as ut,L as c}from"./ionic-ZHEFjxIb.js";import{z as L,v as A,y as z,G as ct,I as j,p as G,F as J,R as K,i as pt,M as vt,_ as mt}from"./_plugin-vue_export-helper-B7Fc93E3.js";import{C as ft}from"./main-CqZhJj-s.js";import{u as _t}from"./useStatsAutoRefresh-DXoaCQgn.js";const gt={class:"search-container-dash"},ht={class:"search-card"},yt={class:"stats-grid"},bt={class:"stat-icon"},Ct={class:"stat-info"},wt={class:"stat-value"},It={class:"stat-icon"},Pt={class:"stat-info"},kt={class:"stat-value"},Bt={class:"patients-container-dash"},Ot={class:"section-header"},St={class:"patients-grid"},At=["onClick"],Nt={class:"patient-avatar"},Vt={class:"patient-content"},Dt={class:"patient-header-dash"},xt={class:"patient-meta"},Rt={class:"meta-item"},Tt={class:"meta-item"},Et={key:0,class:"patient-details-dash"},$t={key:0,class:"detail-chip"},Ft={class:"patient-arrow"},Mt={key:0,class:"empty-state-dash"},Ut={class:"empty-icon"},qt={key:0},Ht={key:1},Lt={class:"modal-title-dash"},zt={class:"progress-dash"},jt={class:"input-cards-dash"},Gt={class:"input-card-dash"},Jt={class:"card-icon-dash primary"},Kt={class:"card-content-dash"},Qt={class:"input-card-dash"},Wt={class:"card-icon-dash secondary"},Xt={class:"card-content-dash"},Yt={class:"input-card-dash"},Zt={class:"card-icon-dash tertiary"},ts={class:"card-content-dash"},ss={class:"buttons-dash"},es=["disabled"],as=st({__name:"PatientsPage",setup(os){const N=ft.getInstance(),Q=N.getCreatePatientUseCase(),V=N.get("PatientRepository"),_=y([]),h=y(""),p=y(!1),D=y(!1);let w=null;const i=y({full_name:"",birth_date:"",blood_type:"",allergies:"",observations:""}),I=R(()=>_.value),W=R(()=>i.value.full_name.length>0&&i.value.birth_date.length>0),P=async(r="")=>{const t=await E.create({message:r?"Buscando pacientes...":"Carregando pacientes...",spinner:"crescent"});await t.present();try{_.value=await V.getAll(r,100)}catch(o){console.error("Error loading patients:",o),await(await C.create({message:"Erro ao carregar pacientes",duration:3e3,color:"danger",position:"top"})).present()}finally{await t.dismiss()}},X=r=>{var o,g;const t=((o=r.target)==null?void 0:o.value)||((g=r.detail)==null?void 0:g.value)||"";if(h.value=t,w&&clearTimeout(w),!t||t.length===0){P();return}w=setTimeout(async()=>{if(t.length>=2){D.value=!0;try{_.value=await V.quickSearch(t,50)}catch(k){console.error("Error searching patients:",k),await(await C.create({message:"Erro ao buscar pacientes",duration:2e3,color:"warning",position:"top"})).present()}finally{D.value=!1}}},500)},Y=r=>{console.log("Selected patient:",r)},Z=async()=>{const r=await E.create({message:"Cadastrando paciente...",spinner:"crescent"});await r.present();try{const t=await Q.execute(i.value);_.value.unshift(t),i.value={full_name:"",birth_date:"",blood_type:"",allergies:"",observations:""},p.value=!1,await(await C.create({message:"Paciente cadastrado com sucesso!",duration:2e3,color:"success",position:"top"})).present()}catch(t){await(await C.create({message:t.message||"Erro ao cadastrar paciente",duration:3e3,color:"danger",position:"top"})).present()}finally{await r.dismiss()}},tt=r=>{if(!r)return"Data não informada";const t=r.split("-");if(t.length===3){const o=parseInt(t[0]),g=parseInt(t[1])-1,k=parseInt(t[2]),B=new Date(o,g,k);if(!isNaN(B.getTime()))return B.toLocaleDateString("pt-BR")}return"Data inválida"},{isRefreshing:x}=_t(P,{loadOnMount:!1,interval:15e3,onStatsUpdated:()=>{console.log("[Patients] Stats atualizados automaticamente")}});return et(()=>{P()}),(r,t)=>(u(),T(s(lt),null,{default:n(()=>[a(s(M),{translucent:!0},{default:n(()=>[a(s($),{color:"primary"},{default:n(()=>[a(s(O),{slot:"start"},{default:n(()=>[a(s(it),{"default-href":"/dashboard"})]),_:1}),a(s(F),null,{default:n(()=>[...t[10]||(t[10]=[d("Pacientes",-1)])]),_:1}),a(s(O),{slot:"end"},{default:n(()=>[a(s(S),{onClick:t[0]||(t[0]=o=>p.value=!0),class:"add-button"},{default:n(()=>[a(s(l),{icon:s(L),slot:"icon-only"},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),a(s(q),{fullscreen:!0,class:"dashboard-content"},{default:n(()=>[e("div",gt,[e("div",ht,[a(s(l),{icon:s(A),class:"search-icon"},null,8,["icon"]),a(s(dt),{value:h.value,placeholder:"Buscar pacientes...",onIonInput:t[1]||(t[1]=o=>X(o)),onIonClear:t[2]||(t[2]=o=>h.value=""),"show-clear-button":"focus",class:"search-bar-dash",debounce:"300"},null,8,["value"])])]),e("div",yt,[e("div",{class:v(["stat-card primary",{updating:s(x)}])},[e("div",bt,[a(s(l),{icon:s(A)},null,8,["icon"])]),e("div",Ct,[e("span",wt,m(_.value.length),1),t[11]||(t[11]=e("span",{class:"stat-label"},"Total",-1))])],2),e("div",{class:v(["stat-card success",{updating:s(x)}])},[e("div",It,[a(s(l),{icon:s(z)},null,8,["icon"])]),e("div",Pt,[e("span",kt,m(_.value.length),1),t[12]||(t[12]=e("span",{class:"stat-label"},"Ativos",-1))])],2)]),e("div",Bt,[e("div",Ot,[t[13]||(t[13]=e("h2",null,"Lista de Pacientes",-1)),a(s(U),{color:"primary"},{default:n(()=>[d(m(I.value.length),1)]),_:1})]),e("div",St,[(u(!0),f(ot,null,at(I.value,o=>(u(),f("div",{key:o.id,class:"patient-card-dash",onClick:g=>Y(o)},[e("div",Nt,[a(s(l),{icon:s(G)},null,8,["icon"])]),e("div",Vt,[e("div",Dt,[e("h3",null,m(o.full_name),1),a(s(U),{color:"success",class:"status-badge"},{default:n(()=>[...t[14]||(t[14]=[d("Ativo",-1)])]),_:1})]),e("div",xt,[e("div",Rt,[a(s(l),{icon:s(J)},null,8,["icon"]),e("span",null,m(tt(o.birth_date)),1)]),e("div",Tt,[a(s(l),{icon:s(pt)},null,8,["icon"]),e("span",null,m(o.age)+" anos",1)])]),o.blood_type?(u(),f("div",Et,[o.blood_type?(u(),f("div",$t,[a(s(l),{icon:s(K)},null,8,["icon"]),e("span",null,m(o.blood_type),1)])):b("",!0)])):b("",!0)]),e("div",Ft,[a(s(l),{icon:s(vt)},null,8,["icon"])])],8,At))),128))]),I.value.length===0?(u(),f("div",Mt,[e("div",Ut,[a(s(l),{icon:s(A)},null,8,["icon"])]),t[16]||(t[16]=e("h3",null,"Nenhum paciente encontrado",-1)),h.value?(u(),f("p",qt,"Tente ajustar os termos de busca")):(u(),f("p",Ht,"Cadastre o primeiro paciente clicando no botão +")),h.value?b("",!0):(u(),T(s(S),{key:2,onClick:t[3]||(t[3]=o=>p.value=!0),class:"empty-action"},{default:n(()=>[a(s(l),{icon:s(L),slot:"start"},null,8,["icon"]),t[15]||(t[15]=d(" Novo Paciente ",-1))]),_:1}))])):b("",!0)]),a(s(rt),{"is-open":p.value,onWillDismiss:t[9]||(t[9]=o=>p.value=!1)},{default:n(()=>[a(s(M),null,{default:n(()=>[a(s($),{color:"primary"},{default:n(()=>[a(s(F),null,{default:n(()=>[e("div",Lt,[a(s(l),{icon:s(ct)},null,8,["icon"]),t[17]||(t[17]=e("span",null,"Novo Paciente",-1))])]),_:1}),a(s(O),{slot:"end"},{default:n(()=>[a(s(S),{onClick:t[4]||(t[4]=o=>p.value=!1)},{default:n(()=>[a(s(l),{icon:s(j),slot:"icon-only"},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),a(s(q),{class:"modal-content-dash"},{default:n(()=>[e("form",{onSubmit:nt(Z,["prevent"]),class:"form-dash"},[t[34]||(t[34]=e("div",{class:"welcome-card-dash"},[e("h2",null,"Cadastrar Novo Paciente"),e("p",null,"Preencha as informações básicas")],-1)),e("div",zt,[e("div",{class:v(["progress-item",{done:i.value.full_name}])},[...t[18]||(t[18]=[e("div",{class:"progress-dot"},null,-1),e("span",null,"Nome",-1)])],2),e("div",{class:v(["progress-line",{active:i.value.birth_date}])},null,2),e("div",{class:v(["progress-item",{done:i.value.birth_date}])},[...t[19]||(t[19]=[e("div",{class:"progress-dot"},null,-1),e("span",null,"Data",-1)])],2),e("div",{class:v(["progress-line",{active:i.value.blood_type}])},null,2),e("div",{class:v(["progress-item",{done:i.value.blood_type}])},[...t[20]||(t[20]=[e("div",{class:"progress-dot"},null,-1),e("span",null,"Fator RH",-1)])],2)]),e("div",jt,[e("div",Gt,[e("div",Jt,[a(s(l),{icon:s(G)},null,8,["icon"])]),e("div",Kt,[t[21]||(t[21]=e("label",null,"Nome Completo",-1)),a(s(H),{modelValue:i.value.full_name,"onUpdate:modelValue":t[5]||(t[5]=o=>i.value.full_name=o),type:"text",required:"",placeholder:"Digite o nome completo",class:"input-dash"},null,8,["modelValue"])])]),e("div",Qt,[e("div",Wt,[a(s(l),{icon:s(J)},null,8,["icon"])]),e("div",Xt,[t[22]||(t[22]=e("label",null,"Data de Nascimento",-1)),a(s(H),{modelValue:i.value.birth_date,"onUpdate:modelValue":t[6]||(t[6]=o=>i.value.birth_date=o),type:"date",required:"",class:"input-dash"},null,8,["modelValue"])])]),e("div",Yt,[e("div",Zt,[a(s(l),{icon:s(K)},null,8,["icon"])]),e("div",ts,[t[31]||(t[31]=e("label",null,[d("Fator RH "),e("span",{class:"optional"},"(opcional)")],-1)),a(s(ut),{modelValue:i.value.blood_type,"onUpdate:modelValue":t[7]||(t[7]=o=>i.value.blood_type=o),placeholder:"Selecione o tipo sanguíneo",interface:"action-sheet",class:"select-dash"},{default:n(()=>[a(s(c),{value:"A+"},{default:n(()=>[...t[23]||(t[23]=[d("A+",-1)])]),_:1}),a(s(c),{value:"A-"},{default:n(()=>[...t[24]||(t[24]=[d("A-",-1)])]),_:1}),a(s(c),{value:"B+"},{default:n(()=>[...t[25]||(t[25]=[d("B+",-1)])]),_:1}),a(s(c),{value:"B-"},{default:n(()=>[...t[26]||(t[26]=[d("B-",-1)])]),_:1}),a(s(c),{value:"AB+"},{default:n(()=>[...t[27]||(t[27]=[d("AB+",-1)])]),_:1}),a(s(c),{value:"AB-"},{default:n(()=>[...t[28]||(t[28]=[d("AB-",-1)])]),_:1}),a(s(c),{value:"O+"},{default:n(()=>[...t[29]||(t[29]=[d("O+",-1)])]),_:1}),a(s(c),{value:"O-"},{default:n(()=>[...t[30]||(t[30]=[d("O-",-1)])]),_:1})]),_:1},8,["modelValue"])])])]),e("div",ss,[e("button",{type:"button",class:"btn-cancel-dash",onClick:t[8]||(t[8]=o=>p.value=!1)},[a(s(l),{icon:s(j)},null,8,["icon"]),t[32]||(t[32]=d(" Cancelar ",-1))]),e("button",{type:"submit",class:"btn-submit-dash",disabled:!W.value},[a(s(l),{icon:s(z)},null,8,["icon"]),t[33]||(t[33]=d(" Cadastrar ",-1))],8,es)])],32)]),_:1})]),_:1},8,["is-open"])]),_:1})]),_:1}))}}),us=mt(as,[["__scopeId","data-v-a983300c"]]);export{us as default};
