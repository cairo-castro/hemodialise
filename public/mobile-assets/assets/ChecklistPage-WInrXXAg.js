import{d as We,n as m,q as c,t as s,J as g,G as d,K as k,v as o,y as a,B as C,H as f,r as h,c as H,b as Ca,o as Ia,M as Pa,e as Sa,x as u,u as Da,w as $e,D as Re,F as te,L as oe,N as Oa,z as Ta}from"./vendor-CuvbB8Nv.js";import{g as r,A as Ea,e as Aa,t as b,o as qe,q as Me,x as Na,p as xe,r as Be,B as U,C as J,k as V,f as Va,v as Fe,w as ze,D as $a,E as Ra,i as je,F as qa,G as Ma,n as K,l as ne}from"./ionic-DQSKESAG.js";import{r as E,D as W,E as ke,F as Le,G as ie,_ as Ge,H as He,t as ge,I as ye,J as xa,K as be,L as Ue,m as Ba,h as Fa,M as za,j as ja,N as La,g as Ha,O as Je,P as Ua,f as Ja,Q as Ke,R as Ka,S as Wa,w as Ga}from"./_plugin-vue_export-helper-Dt2dLz-X.js";import{C as Qa,A as O}from"./main-B44L1NYL.js";const Xa={class:"item-card-header"},Ya={class:"header-content"},Za={class:"item-card-title"},es={key:0,class:"item-card-description"},as={key:0,class:"header-badge"},ss={class:"status-actions"},ts={class:"action-status-icon success"},os={class:"action-status-icon danger"},ns={class:"action-status-icon neutral"},is={key:0,class:"observation-card"},ls={class:"observation-label"},rs=["value"],cs=We({__name:"ChecklistItem",props:{title:{},description:{default:""},value:{default:null},observation:{default:""},required:{type:Boolean,default:!1}},emits:["update:value","update:observation"],setup(we,{emit:$}){const G=we,P=$,F=p=>{G.value===p?(P("update:value",null),P("update:observation","")):(P("update:value",p),p!=="NC"&&P("update:observation",""))},R=p=>{P("update:observation",p)},Q=p=>{switch(p){case"C":return E;case"NC":return ke;case"NA":return Le;default:return E}};return(p,_)=>(c(),m("div",{class:k(["checklist-item-card",{"has-value":p.value!==null,"is-conforme":p.value==="C","is-nao-conforme":p.value==="NC","is-nao-aplica":p.value==="NA"}])},[s("div",Xa,[s("div",Ya,[s("h3",Za,d(p.title),1),p.description?(c(),m("p",es,d(p.description),1)):g("",!0)]),p.value?(c(),m("div",as,[s("div",{class:k(["status-badge",p.value.toLowerCase()])},[o(a(r),{icon:Q(p.value)},null,8,["icon"])],2)])):g("",!0)]),s("div",ss,[s("button",{class:k(["action-status-btn conforme",{selected:p.value==="C"}]),onClick:_[0]||(_[0]=q=>F("C")),type:"button"},[s("div",ts,[o(a(r),{icon:a(E)},null,8,["icon"])]),_[4]||(_[4]=s("div",{class:"action-status-content"},[s("span",{class:"action-status-label"},"Conforme"),s("span",{class:"action-status-hint"},"Tudo OK")],-1)),p.value==="C"?(c(),C(a(r),{key:0,icon:a(W),class:"selected-check"},null,8,["icon"])):g("",!0)],2),s("button",{class:k(["action-status-btn nao-conforme",{selected:p.value==="NC"}]),onClick:_[1]||(_[1]=q=>F("NC")),type:"button"},[s("div",os,[o(a(r),{icon:a(ke)},null,8,["icon"])]),_[5]||(_[5]=s("div",{class:"action-status-content"},[s("span",{class:"action-status-label"},"N√£o Conforme"),s("span",{class:"action-status-hint"},"Problema")],-1)),p.value==="NC"?(c(),C(a(r),{key:0,icon:a(W),class:"selected-check"},null,8,["icon"])):g("",!0)],2),s("button",{class:k(["action-status-btn nao-aplica",{selected:p.value==="NA"}]),onClick:_[2]||(_[2]=q=>F("NA")),type:"button"},[s("div",ns,[o(a(r),{icon:a(Le)},null,8,["icon"])]),_[6]||(_[6]=s("div",{class:"action-status-content"},[s("span",{class:"action-status-label"},"N√£o Aplica"),s("span",{class:"action-status-hint"},"N/A")],-1)),p.value==="NA"?(c(),C(a(r),{key:0,icon:a(W),class:"selected-check"},null,8,["icon"])):g("",!0)],2)]),p.value==="NC"?(c(),m("div",is,[s("label",ls,[o(a(r),{icon:a(ie)},null,8,["icon"]),_[7]||(_[7]=f(" Descreva o Problema * ",-1))]),s("textarea",{value:p.observation,onInput:_[3]||(_[3]=q=>R(q.target.value)),class:"observation-textarea",rows:"3",placeholder:"Ex: Equipamento apresentando ru√≠do anormal...",required:""},null,40,rs)])):g("",!0)],2))}}),us=Ge(cs,[["__scopeId","data-v-224039b4"]]),ds={class:"checklist-container"},ps={class:"time-display"},vs={class:"current-date"},ms={class:"current-time"},hs={key:0,class:"section"},fs={class:"section-title"},_s={class:"search-card"},gs={class:"search-input-wrapper"},ys={key:0,class:"patient-selected"},bs={class:"action-btn selected"},ks={class:"action-icon success"},ws={class:"action-content"},Cs={class:"action-title"},Is={class:"action-subtitle"},Ps={key:1,class:"search-results"},Ss=["onClick"],Ds={class:"action-icon primary"},Os={class:"action-content"},Ts={class:"action-title"},Es={class:"action-subtitle"},As={key:2,class:"no-results"},Ns={key:3,class:"search-loading"},Vs={key:1,class:"section"},$s={class:"section-title"},Rs={class:"selection-card"},qs={class:"availability-icon"},Ms={class:"availability-info"},xs={class:"availability-label"},Bs={class:"availability-count"},Fs={class:"form-group"},zs={class:"input-label"},js={class:"machine-grid"},Ls=["onClick"],Hs={class:"machine-icon"},Us={class:"machine-info"},Js={class:"machine-name"},Ks={key:0,class:"machine-check"},Ws={class:"form-group"},Gs={class:"input-label"},Qs={class:"shift-selector"},Xs={class:"form-group"},Ys={class:"input-label"},Zs={class:"form-group"},et={class:"input-label"},at={class:"primary-action"},st=["disabled"],tt={key:2},ot={class:"phase-header"},nt={class:"phase-time"},it={class:"phase-progress"},lt={class:"progress-steps"},rt={class:"step-circle"},ct={key:2},ut={class:"step-label"},dt={class:"phase-completion"},pt={class:"patient-summary"},vt={class:"patient-details"},mt={class:"session-time"},ht={key:2,class:"phase-section"},ft={class:"phase-header-card"},_t={class:"phase-header-icon"},gt={class:"phase-header-content"},yt={class:"phase-header-badge"},bt={class:"checklist-items-grid"},kt={class:"observations-card"},wt={class:"card-label"},Ct=["disabled"],It={class:"btn-text"},Pt={class:"btn-title"},St={class:"btn-subtitle"},Dt={class:"dashboard-actions"},Ot={class:"action-card-icon warning"},Tt={class:"action-card-icon danger"},Et={key:3,class:"interrupted-section"},At={class:"interrupted-content"},Nt={class:"interruption-reason"},Vt={key:4,class:"completed-section"},$t={class:"completed-content"},Rt={class:"interrupt-modal-content"},qt={class:"warning-section"},Mt={class:"form-group"},xt={class:"modal-buttons"},Bt=We({__name:"ChecklistPage",setup(we){const $=Ta(),G=Da(),P=Qa.getInstance();P.getSearchPatientUseCase();const F=P.getMachineRepository(),R=h(),Q=h(""),p=h(""),_=H(()=>{const t=new Date;return t.setHours(t.getHours()-72),t.toISOString()}),q=H(()=>new Date().toISOString()),M=h(!1),X=h(""),x=h(0),z=h("machine-patient"),I=h(""),S=h([]),j=h(!1),w=h(null);let le;const re=h(null),ce=h([]),ue=h(null),Ce=h(!1),l=h(null),D=h(null),Ie=h(!1),v=h({machine_id:0,shift:"matutino",session_date:new Date().toISOString(),session_time:new Date().toISOString(),observations:"",machine_disinfected:!1,capillary_lines_identified:!1,reagent_test_performed:!1,pressure_sensors_verified:!1,air_bubble_detector_verified:!1,patient_identification_confirmed:!1,vascular_access_evaluated:!1,av_fistula_arm_washed:!1,patient_weighed:!1,vital_signs_checked:!1,medications_reviewed:!1,dialyzer_membrane_checked:!1,equipment_functioning_verified:!1,dialysis_parameters_verified:!1,heparin_double_checked:!1,antisepsis_performed:!1,vascular_access_monitored:!1,vital_signs_monitored_during:!1,patient_comfort_assessed:!1,fluid_balance_monitored:!1,alarms_responded:!1,session_completed_safely:!1,vascular_access_secured:!1,patient_vital_signs_stable:!1,complications_assessed:!1,equipment_cleaned:!1}),Y=h({}),Z=h({}),Qe=["pre_dialysis","during_session","post_dialysis"];let de;const Xe=H(()=>w.value&&v.value.machine_id&&v.value.shift),ee=H(()=>l.value?L().every(i=>{const n=se(i.key);if(n===null)return!1;if(n==="C"||n==="NA")return!0;if(n==="NC"){const y=me(i.key);return y&&y.trim().length>0}return!1}):!1),Ye=H(()=>l.value?l.value.current_phase==="post_dialysis":!1),Pe=t=>({pre_dialysis:"Pr√©-Di√°lise",during_session:"Durante a Sess√£o",post_dialysis:"P√≥s-Di√°lise",completed:"Conclu√≠do",interrupted:"Interrompido"})[t]||t,Ze=t=>({pre_dialysis:"Pr√©",during_session:"Durante",post_dialysis:"P√≥s"})[t]||t,ea=t=>({pre_dialysis:"Verifica√ß√µes de seguran√ßa antes de iniciar a sess√£o de di√°lise",during_session:"Monitoramento cont√≠nuo durante o procedimento",post_dialysis:"Finaliza√ß√£o segura da sess√£o e limpeza dos equipamentos"})[t]||"",Se=t=>({pre_dialysis:"warning",during_session:"primary",post_dialysis:"secondary",completed:"success",interrupted:"danger"})[t]||"medium",De=t=>E,aa=t=>({pre_dialysis:"Preparando",during_session:"Em Andamento",post_dialysis:"Finalizando",completed:"Conclu√≠do",interrupted:"Interrompido"})[t]||t,sa=t=>({pre_dialysis:"1",during_session:"2",post_dialysis:"3"})[t]||"",Oe=t=>{if(!l.value)return!1;switch(t){case"pre_dialysis":return l.value.pre_dialysis_completed_at!==null;case"during_session":return l.value.during_session_completed_at!==null;case"post_dialysis":return l.value.post_dialysis_completed_at!==null;default:return!1}},L=()=>{var e;return{pre_dialysis:[{key:"machine_disinfected",label:"1. M√°quina Desinfetada",description:"Verificar se a m√°quina foi devidamente desinfetada"},{key:"capillary_lines_identified",label:"2. Linhas e Capilar Identificados (quando h√° reuso)",description:"Identificar e verificar corretamente as linhas capilares"},{key:"reagent_test_performed",label:"3. Teste de Reagente Realizado (pr√©/p√≥s) (quando h√° reuso)",description:"Realizar teste de reagente antes e ap√≥s o procedimento"},{key:"pressure_sensors_verified",label:"4. Sensores de Press√£o Verificados",description:"Verificar sensores: press√£o venosa, arterial e transmembrana"},{key:"air_bubble_detector_verified",label:"5. Detector de Bolhas Funcional e Alinhado",description:"Verificar detector de bolhas de ar e alinhamento √† c√¢mara venosa"},{key:"patient_identification_confirmed",label:"6. Identifica√ß√£o do Paciente Conferida",description:"Confirmar: crach√°, pulseira, cadeira e confirma√ß√£o verbal"},{key:"vascular_access_evaluated",label:"10. Acesso Vascular Verificado",description:"Verificar: curativo, sinais de infec√ß√£o, integridade, heparina no l√∫men"},{key:"av_fistula_arm_washed",label:"7. Lavagem do Bra√ßo da F√≠stula (quando aplic√°vel)",description:"Realizar lavagem do bra√ßo da f√≠stula arteriovenosa"},{key:"patient_weighed",label:"8. Pesagem do Paciente Realizada",description:"Pesar o paciente antes da sess√£o"},{key:"vital_signs_checked",label:"9. Sinais Vitais Conferidos",description:"Verificar sinais vitais conforme protocolo"},{key:"medications_reviewed",label:"11. Prescri√ß√£o M√©dica Conferida",description:"Conferir par√¢metros da m√°quina e medica√ß√µes"},{key:"dialyzer_membrane_checked",label:"Membrana do Dialisador Verificada",description:"Verificar integridade da membrana do dialisador"},{key:"equipment_functioning_verified",label:"Funcionamento dos Equipamentos",description:"Testar funcionamento de todos os equipamentos"}],during_session:[{key:"dialysis_parameters_verified",label:"Par√¢metros de Di√°lise Verificados",description:"Confirmar e ajustar par√¢metros de di√°lise"},{key:"heparin_double_checked",label:"1. Dupla Checagem de Heparina",description:"Realizar dupla checagem da heparina antes de administrar"},{key:"antisepsis_performed",label:"2. Antissepsia Realizada",description:"Antissepsia da pele ou cateter antes da pun√ß√£o/conex√£o"},{key:"vascular_access_monitored",label:"3. Acesso Vascular Monitorado",description:"Monitorar fluxo sangu√≠neo, fixa√ß√£o, conex√£o, sangramento"},{key:"vital_signs_monitored_during",label:"4. Sinais Vitais Durante Sess√£o",description:"Verificar sinais vitais conforme quadro cl√≠nico e protocolo"},{key:"patient_comfort_assessed",label:"Conforto do Paciente Avaliado",description:"Verificar conforto e bem-estar do paciente"},{key:"fluid_balance_monitored",label:"Balan√ßo H√≠drico Monitorado",description:"Acompanhar remo√ß√£o e balan√ßo de fluidos"},{key:"alarms_responded",label:"Resposta a Alarmes",description:"Verificar e responder adequadamente aos alarmes"}],post_dialysis:[{key:"session_completed_safely",label:"1. Desconex√£o Segura Realizada",description:"Desconex√£o sem perda de sangue e sem risco de embolia"},{key:"vascular_access_secured",label:"2. Hemostasia e Curativo do Acesso",description:"Realizar hemostasia e curativo conforme protocolo"},{key:"patient_vital_signs_stable",label:"3. Sinais Vitais Conferidos",description:"Verificar sinais vitais conforme protocolo ou prescri√ß√£o"},{key:"complications_assessed",label:"4. Paciente Avaliado para Complica√ß√µes",description:"Avaliar: sangramento, instabilidade hemodin√¢mica, risco de queda"},{key:"equipment_cleaned",label:"5. Materiais Descartados e M√°quina Programada",description:"Descartar materiais corretamente e programar desinfec√ß√£o"}]}[(e=l.value)==null?void 0:e.current_phase]||[]},Te=()=>{const t=new Date;Q.value=t.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),p.value=t.toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})},ta=()=>{if(le&&clearTimeout(le),I.value.length<3){S.value=[];return}j.value=!0,le=setTimeout(async()=>{await oa()},500)},oa=async()=>{if(I.value.length<3){S.value=[],j.value=!1;return}try{const e=await P.getPatientRepository().quickSearch(I.value,10);S.value=e}catch(t){console.error("Erro ao buscar pacientes:",t),S.value=[]}finally{j.value=!1}},na=t=>{w.value=t,I.value=t.full_name,S.value=[]},ia=()=>{w.value=null,I.value="",S.value=[]},la=()=>{localStorage.setItem("patient_search_query",I.value),$.push("/patients/new")},ra=async()=>{var i,n,y;if(Ce.value){z.value="pre-dialysis";return}if(!(await ha()).canCreate)return;const e=await K.create({message:"Iniciando checklist...",spinner:"crescent"});await e.present();try{const A=new Date(v.value.session_date).toISOString().split("T")[0],B=new Date(v.value.session_time).toTimeString().slice(0,5),N=await fetch("/api/checklists",{method:"POST",headers:O.getAuthHeaders(),body:JSON.stringify({patient_id:(i=w.value)==null?void 0:i.id,machine_id:v.value.machine_id,shift:v.value.shift,session_date:A,session_time:B,observations:v.value.observations})}),T=await N.json();if(N.ok&&T.success){l.value=T.checklist,re.value=ce.value.find(wa=>wa.id===v.value.machine_id)||null,ae();const _e=T.resumed?"Checklist existente carregado!":"Novo checklist iniciado com sucesso!";await(await b.create({message:_e,duration:2e3,color:"success",position:"top"})).present()}else{const _e=T.message||((y=(n=T.errors)==null?void 0:n.machine_id)==null?void 0:y[0])||"Erro ao iniciar checklist";throw new Error(_e)}}catch(A){await(await b.create({message:A.message||"Erro ao iniciar checklist",duration:3e3,color:"danger",position:"top"})).present()}finally{await e.dismiss()}},ca=async()=>{if(!ee.value)return;const t=await K.create({message:"Avan√ßando para pr√≥xima fase...",spinner:"crescent"});await t.present();try{await pe();const i=await(await fetch("/api/checklists/".concat(l.value.id,"/advance"),O.getFetchConfig({method:"POST"}))).json();if(i.success)l.value=i.checklist,ae(),R.value&&R.value.$el&&await R.value.$el.scrollToTop(400),await(await b.create({message:i.message,duration:2e3,color:"success",position:"top"})).present();else throw new Error(i.message||"Erro ao avan√ßar fase")}catch(e){await(await b.create({message:e.message||"Erro ao avan√ßar fase",duration:3e3,color:"danger",position:"top"})).present()}finally{await t.dismiss()}},pe=async()=>{if(l.value)try{const t={},e={};L().forEach(A=>{const B=se(A.key),N=me(A.key);let T=!1;(B==="C"||B==="NA"||B==="NC"&&N&&N.trim().length>0)&&(T=!0),t[A.key]=T,N&&N.trim().length>0&&(e[A.key]=N)});const n=await fetch("/api/checklists/".concat(l.value.id,"/phase"),{method:"PATCH",...O.getFetchConfig({body:JSON.stringify({phase_data:t,observations:v.value.observations,item_observations:e})})});if(!n.ok)throw new Error("Erro ao salvar dados");const y=await n.json();y.success&&(x.value=y.phase_completion)}catch(t){console.error("Erro no updatePhaseData:",t)}},ua=async()=>{const t=await K.create({message:"Interrompendo checklist...",spinner:"crescent"});await t.present();try{const i=await(await fetch("/api/checklists/".concat(l.value.id,"/interrupt"),O.getFetchConfig({method:"POST",body:JSON.stringify({reason:X.value})}))).json();if(i.success)l.value=i.checklist,M.value=!1,await(await b.create({message:"Checklist interrompido com sucesso.",duration:3e3,color:"warning",position:"top"})).present();else throw new Error(i.message||"Erro ao interromper checklist")}catch(e){await(await b.create({message:e.message||"Erro ao interromper checklist",duration:3e3,color:"danger",position:"top"})).present()}finally{await t.dismiss()}},Ee=()=>{$.replace("/dashboard")},da=async()=>{if(!l.value)return;await(await ne.create({header:"Pausar Checklist",message:"Deseja pausar o checklist e voltar ao dashboard ou pausar e continuar aqui?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Pausar e Continuar Aqui",handler:async()=>(await pa(),!0)},{text:"Pausar e Sair",handler:async()=>(await va(),!0)}]})).present()},pa=async()=>{if(!l.value)return;const t=await K.create({message:"Pausando checklist..."});await t.present();try{const i=await(await fetch("/api/checklists/".concat(l.value.id,"/pause"),O.getFetchConfig({method:"POST",body:JSON.stringify({reason:"manual"})}))).json();if(i.success)l.value.paused_at=i.checklist.paused_at,await(await b.create({message:"Checklist pausado com sucesso.",duration:3e3,color:"success",position:"top"})).present();else throw new Error(i.message||"Erro ao pausar checklist")}catch(e){console.error("Erro ao pausar checklist:",e),await(await b.create({message:"Erro ao pausar checklist. Tente novamente.",duration:3e3,color:"danger",position:"top"})).present()}finally{await t.dismiss()}},va=async()=>{if(!l.value)return;const t=await K.create({message:"Pausando checklist..."});await t.present();try{const i=await(await fetch("/api/checklists/".concat(l.value.id,"/pause"),O.getFetchConfig({method:"POST",body:JSON.stringify({reason:"manual"})}))).json();if(i.success)l.value.paused_at=i.checklist.paused_at,await(await b.create({message:"Checklist pausado com sucesso.",duration:2e3,color:"success",position:"top"})).present(),setTimeout(()=>{$.replace("/dashboard")},500);else throw new Error(i.message||"Erro ao pausar checklist")}catch(e){console.error("Erro ao pausar checklist:",e),await(await b.create({message:"Erro ao pausar checklist. Tente novamente.",duration:3e3,color:"danger",position:"top"})).present()}finally{await t.dismiss()}},ae=()=>{const t=L(),e=t.filter(i=>se(i.key)!==null).length;x.value=t.length>0?e/t.length*100:0},ma=async()=>{try{ce.value=await F.getAvailable(),await Ae()}catch(t){console.error("Error loading machines:",t)}},Ae=async()=>{try{Ie.value=!0;const t=await fetch("/api/machines/availability",O.getFetchConfig());if(t.ok){const e=await t.json();D.value=e.availability}}catch(t){console.error("Error fetching machine availability:",t)}finally{Ie.value=!1}},ha=async()=>{if(await Ae(),!D.value)return{canCreate:!0};const{available:t,overall_status:e,message:i}=D.value;if(t===0)return await(await ne.create({header:"M√°quinas Indispon√≠veis",message:i||"N√£o h√° m√°quinas dispon√≠veis no momento. Por favor, aguarde at√© que uma m√°quina fique livre.",buttons:["OK"]})).present(),{canCreate:!1};if(e==="warning"||e==="alert"){const n=await ne.create({header:"Aten√ß√£o",message:"".concat(i,". Apenas ").concat(t," m√°quina(s) dispon√≠vel(is). Deseja continuar?"),buttons:[{text:"Cancelar",role:"cancel"},{text:"Continuar",role:"confirm"}]});await n.present();const{role:y}=await n.onDidDismiss();return{canCreate:y==="confirm"}}return{canCreate:!0}},fa=async()=>{const t=G.params.id;if(t&&t!=="new")try{const e=await fetch("/api/checklists/".concat(t),O.getFetchConfig());if(e.ok){const i=await e.json();switch(l.value=i,ue.value=i.id,Ce.value=!0,re.value=i.machine,w.value=i.patient,i.current_phase){case"pre_dialysis":z.value="pre-dialysis";break;case"during_session":z.value="during-session";break;case"post_dialysis":z.value="post-dialysis";break;default:z.value="pre-dialysis"}i.paused_at&&!i.resumed_at&&await _a(),ga(i),ae(),console.log("Checklist carregado:",i)}}catch(e){console.error("Erro ao carregar checklist:",e)}},_a=async()=>{if(ue.value)try{(await fetch("/api/checklists/".concat(ue.value,"/resume"),O.getFetchConfig({method:"POST"}))).ok&&console.log("Checklist retomado com sucesso")}catch(t){console.error("Erro ao retomar checklist:",t)}},ga=t=>{Object.keys(v.value).forEach(i=>{t[i]!==void 0&&(v.value[i]=t[i])}),t.item_observations&&(Z.value={...t.item_observations}),L().forEach(i=>{const n=t[i.key];n!==void 0&&(n===!0?Y.value[i.key]="C":n===!1&&Z.value[i.key]&&(Y.value[i.key]="NC"))})},Ne=t=>new Date(t).toLocaleDateString("pt-BR"),ve=t=>new Date(t).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),se=t=>Y.value[t]||null,ya=(t,e)=>{Y.value[t]=e,v.value[t]=e==="C",ae(),l.value&&pe()},me=t=>Z.value[t]||"";let he=null;const ba=(t,e)=>{Z.value[t]=e,he&&clearTimeout(he),he=setTimeout(()=>{l.value&&pe()},1e3)},ka=async t=>{try{console.log("üîÑ Carregando paciente ID:",t);const i=await P.getPatientRepository().getById(t);i&&(console.log("‚úÖ Paciente carregado:",i),w.value=i,I.value=i.full_name,S.value=[],await(await b.create({message:"Paciente ".concat(i.full_name," selecionado!"),duration:2e3,color:"success",position:"top"})).present())}catch(e){console.error("‚ùå Erro ao carregar paciente:",e),await(await b.create({message:"Erro ao carregar paciente cadastrado",duration:3e3,color:"danger",position:"top"})).present()}},fe=()=>{const t=localStorage.getItem("return_to_checklist"),e=localStorage.getItem("new_patient_id");console.log("üîç Verificando retorno - return_to_checklist:",t,"new_patient_id:",e),t==="true"&&e&&(console.log("üéØ Detectado retorno de cadastro, carregando paciente..."),ka(parseInt(e)),localStorage.removeItem("return_to_checklist"),localStorage.removeItem("new_patient_id"),localStorage.removeItem("patient_search_query"))};Ea(()=>{console.log("üöÄ onIonViewWillEnter - P√°gina sendo exibida"),fe()}),Ca(()=>G.path,t=>{console.log("üîÑ Rota mudou para:",t),t==="/checklist/new"&&(console.log("üìç Detectado retorno para /checklist/new via watch"),setTimeout(fe,100))}),Ia(()=>{console.log("üèÅ onMounted - P√°gina montada"),ma(),fa(),Te(),de=setInterval(Te,1e3),fe()}),Pa(async(t,e)=>{if(!l.value||l.value.paused_at||l.value.current_phase==="completed"||l.value.is_interrupted)return!0;const i=await ne.create({header:"Pausar Checklist?",message:"Voc√™ est√° saindo do checklist ativo. Deseja paus√°-lo para continuar depois?",buttons:[{text:"Cancelar",role:"cancel",handler:()=>!1},{text:"Sair sem Pausar",role:"destructive",handler:async()=>!0},{text:"Pausar e Sair",handler:async()=>(await Ve(),!0)}]});await i.present();const{role:n}=await i.onDidDismiss();return n==="cancel"||!n?!1:(n==="handler"&&await Ve(),!0)});const Ve=async()=>{if(l.value)try{(await(await fetch("/api/checklists/".concat(l.value.id,"/pause"),O.getFetchConfig({method:"POST",body:JSON.stringify({reason:"auto"})}))).json()).success&&(await(await b.create({message:"Checklist pausado automaticamente.",duration:2e3,color:"warning",position:"top"})).present(),setTimeout(()=>{$.push("/dashboard")},500))}catch(t){console.error("Erro ao pausar checklist automaticamente:",t)}};return Sa(()=>{de&&clearInterval(de)}),(t,e)=>{const i=Oa("ion-datetime");return c(),C(a(Aa),null,{default:u(()=>[o(a(Be),{translucent:!0},{default:u(()=>[o(a(qe),{color:"primary"},{default:u(()=>[o(a(Me),{slot:"start"},{default:u(()=>[o(a(Na),{"default-href":"/dashboard"})]),_:1}),o(a(xe),null,{default:u(()=>[...e[13]||(e[13]=[f("Checklist de Seguran√ßa",-1)])]),_:1})]),_:1})]),_:1}),o(a(je),{ref_key:"contentRef",ref:R,fullscreen:!0},{default:u(()=>[s("div",ds,[o(a(U),{class:"time-header-card"},{default:u(()=>[o(a(J),null,{default:u(()=>[s("div",ps,[s("div",vs,[o(a(r),{icon:a(He),class:"date-icon"},null,8,["icon"]),f(" "+d(p.value),1)]),s("div",ms,[o(a(r),{icon:a(ge),class:"time-icon"},null,8,["icon"]),f(" "+d(Q.value),1)])])]),_:1})]),_:1}),l.value?g("",!0):(c(),m("div",hs,[s("h2",fs,[o(a(r),{icon:a(ye)},null,8,["icon"]),e[14]||(e[14]=f(" Etapa 1: Buscar Paciente ",-1))]),s("div",_s,[s("div",gs,[o(a(r),{icon:a(xa),class:"search-icon"},null,8,["icon"]),$e(s("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>I.value=n),type:"text",placeholder:"Digite o nome do paciente...",class:"search-input",onInput:ta},null,544),[[Re,I.value]])]),w.value?(c(),m("div",ys,[s("div",bs,[s("div",ks,[o(a(r),{icon:a(E)},null,8,["icon"])]),s("div",ws,[s("span",Cs,d(w.value.full_name),1),s("span",Is,d(Ne(w.value.birth_date))+" ‚Ä¢ "+d(w.value.age)+" anos ",1)]),o(a(V),{fill:"clear",onClick:ia},{default:u(()=>[o(a(r),{icon:a(be),slot:"icon-only"},null,8,["icon"])]),_:1})])])):S.value.length>0&&I.value.length>0?(c(),m("div",Ps,[(c(!0),m(te,null,oe(S.value,n=>(c(),m("div",{key:n.id,class:"action-btn",onClick:y=>na(n)},[s("div",Ds,[o(a(r),{icon:a(ye)},null,8,["icon"])]),s("div",Os,[s("span",Ts,d(n.full_name),1),s("span",Es,d(Ne(n.birth_date))+" ‚Ä¢ "+d(n.age)+" anos ",1)]),o(a(r),{icon:a(Ga),class:"chevron"},null,8,["icon"])],8,Ss))),128))])):I.value.length>2&&S.value.length===0&&!j.value?(c(),m("div",As,[o(a(r),{icon:a(ie),class:"no-results-icon"},null,8,["icon"]),e[16]||(e[16]=s("h3",null,"Paciente n√£o encontrado",-1)),e[17]||(e[17]=s("p",null,"N√£o encontramos nenhum paciente com esse nome.",-1)),o(a(V),{expand:"block",onClick:la,class:"register-btn"},{default:u(()=>[o(a(r),{icon:a(ye),slot:"start"},null,8,["icon"]),e[15]||(e[15]=f(" Cadastrar Novo Paciente ",-1))]),_:1})])):g("",!0),j.value?(c(),m("div",Ns,[o(a(Va),{name:"crescent"}),e[18]||(e[18]=s("p",null,"Buscando...",-1))])):g("",!0)])])),w.value&&!l.value?(c(),m("div",Vs,[s("h2",$s,[o(a(r),{icon:a(Ue)},null,8,["icon"]),e[19]||(e[19]=f(" Etapa 2: M√°quina e Turno ",-1))]),s("div",Rs,[D.value?(c(),m("div",{key:0,class:k(["availability-badge",D.value.overall_status])},[s("div",qs,[D.value.overall_status==="good"?(c(),C(a(r),{key:0,icon:a(E)},null,8,["icon"])):D.value.overall_status==="critical"?(c(),C(a(r),{key:1,icon:a(ke)},null,8,["icon"])):(c(),C(a(r),{key:2,icon:a(ie)},null,8,["icon"]))]),s("div",Ms,[s("span",xs,d(D.value.message),1),s("span",Bs,d(D.value.available)+" de "+d(D.value.total)+" dispon√≠veis",1)])],2)):g("",!0),s("div",Fs,[s("label",zs,[o(a(r),{icon:a(Ba)},null,8,["icon"]),e[20]||(e[20]=f(" Selecione a M√°quina ",-1))]),s("div",js,[(c(!0),m(te,null,oe(ce.value,n=>(c(),m("button",{key:n.id,type:"button",class:k(["machine-card",{selected:v.value.machine_id===n.id}]),onClick:y=>v.value.machine_id=n.id},[s("div",Hs,[o(a(r),{icon:a(Ue)},null,8,["icon"])]),s("div",Us,[s("span",Js,d(n.name),1),e[21]||(e[21]=s("span",{class:"machine-status"},"Dispon√≠vel",-1))]),v.value.machine_id===n.id?(c(),m("div",Ks,[o(a(r),{icon:a(E)},null,8,["icon"])])):g("",!0)],10,Ls))),128))])]),s("div",Ws,[s("label",Gs,[o(a(r),{icon:a(ge)},null,8,["icon"]),e[22]||(e[22]=f(" Selecione o Turno ",-1))]),s("div",Qs,[s("button",{type:"button",class:k(["shift-btn",{active:v.value.shift==="matutino"}]),onClick:e[1]||(e[1]=n=>v.value.shift="matutino")},[o(a(r),{icon:a(Fa)},null,8,["icon"]),e[23]||(e[23]=s("span",null,"Matutino",-1)),e[24]||(e[24]=s("span",{class:"shift-time"},"06:00 - 12:00",-1))],2),s("button",{type:"button",class:k(["shift-btn",{active:v.value.shift==="vespertino"}]),onClick:e[2]||(e[2]=n=>v.value.shift="vespertino")},[o(a(r),{icon:a(za)},null,8,["icon"]),e[25]||(e[25]=s("span",null,"Vespertino",-1)),e[26]||(e[26]=s("span",{class:"shift-time"},"12:00 - 18:00",-1))],2),s("button",{type:"button",class:k(["shift-btn",{active:v.value.shift==="noturno"}]),onClick:e[3]||(e[3]=n=>v.value.shift="noturno")},[o(a(r),{icon:a(ja)},null,8,["icon"]),e[27]||(e[27]=s("span",null,"Noturno",-1)),e[28]||(e[28]=s("span",{class:"shift-time"},"18:00 - 00:00",-1))],2),s("button",{type:"button",class:k(["shift-btn",{active:v.value.shift==="madrugada"}]),onClick:e[4]||(e[4]=n=>v.value.shift="madrugada")},[o(a(r),{icon:a(La)},null,8,["icon"]),e[29]||(e[29]=s("span",null,"Madrugada",-1)),e[30]||(e[30]=s("span",{class:"shift-time"},"00:00 - 06:00",-1))],2)])]),s("div",Xs,[s("label",Ys,[o(a(r),{icon:a(He)},null,8,["icon"]),e[31]||(e[31]=f(" Data da Sess√£o ",-1))]),o(i,{modelValue:v.value.session_date,"onUpdate:modelValue":e[5]||(e[5]=n=>v.value.session_date=n),presentation:"date",min:_.value,max:q.value,locale:"pt-BR","first-day-of-week":0,class:"datetime-picker"},null,8,["modelValue","min","max"]),e[32]||(e[32]=s("p",{class:"datetime-hint"},"Pode registrar at√© 3 dias atr√°s",-1))]),s("div",Zs,[s("label",et,[o(a(r),{icon:a(ge)},null,8,["icon"]),e[33]||(e[33]=f(" Hor√°rio da Sess√£o ",-1))]),o(i,{modelValue:v.value.session_time,"onUpdate:modelValue":e[6]||(e[6]=n=>v.value.session_time=n),presentation:"time",locale:"pt-BR",class:"datetime-picker"},null,8,["modelValue"])])]),s("div",at,[s("button",{class:"primary-btn",onClick:ra,disabled:!Xe.value},[o(a(r),{icon:a(Ha)},null,8,["icon"]),e[34]||(e[34]=s("div",{class:"btn-text"},[s("span",{class:"btn-title"},"Iniciar Checklist"),s("span",{class:"btn-subtitle"},"Come√ßar verifica√ß√£o de seguran√ßa")],-1)),o(a(r),{icon:a(Je)},null,8,["icon"])],8,st)])])):g("",!0),l.value?(c(),m("div",tt,[l.value.current_phase!=="completed"?(c(),C(a(U),{key:0,class:"phase-progress-card"},{default:u(()=>[o(a(J),null,{default:u(()=>[s("div",ot,[s("h3",null,d(Pe(l.value.current_phase)),1),s("div",nt,[o(a(Fe),{color:Se(l.value.current_phase)},{default:u(()=>[o(a(r),{icon:De(l.value.current_phase)},null,8,["icon"]),o(a(ze),null,{default:u(()=>[f(d(aa(l.value.current_phase)),1)]),_:1})]),_:1},8,["color"])])]),s("div",it,[s("div",lt,[(c(),m(te,null,oe(Qe,n=>s("div",{class:k(["step",{active:n===l.value.current_phase,completed:Oe(n),interrupted:l.value.is_interrupted}]),key:n},[s("div",rt,[Oe(n)?(c(),C(a(r),{key:0,icon:a(W)},null,8,["icon"])):l.value.is_interrupted?(c(),C(a(r),{key:1,icon:a(be)},null,8,["icon"])):(c(),m("span",ct,d(sa(n)),1))]),s("span",ut,d(Ze(n)),1)],2)),64))])]),s("div",dt,[o(a($a),{value:x.value/100,color:x.value===100?"success":"primary"},null,8,["value","color"]),s("p",null,d(Math.round(x.value))+"% conclu√≠do",1)])]),_:1})]),_:1})):g("",!0),l.value.current_phase!=="completed"?(c(),C(a(U),{key:1,class:"patient-summary-card"},{default:u(()=>[o(a(J),null,{default:u(()=>{var n;return[s("div",pt,[s("div",vt,[s("h4",null,d(w.value.full_name),1),s("p",null,d((n=re.value)==null?void 0:n.name)+" ‚Ä¢ Turno "+d(l.value.shift),1)]),s("div",mt,[s("p",null,"Iniciado √†s "+d(ve(l.value.pre_dialysis_started_at)),1)])])]}),_:1})]),_:1})):g("",!0),!l.value.is_interrupted&&l.value.current_phase!=="completed"?(c(),m("div",ht,[s("div",ft,[s("div",_t,[o(a(r),{icon:De(l.value.current_phase)},null,8,["icon"])]),s("div",gt,[s("h3",null,d(Pe(l.value.current_phase)),1),s("p",null,d(ea(l.value.current_phase)),1)]),s("div",yt,[o(a(Fe),{color:Se(l.value.current_phase)},{default:u(()=>[f(d(Math.round(x.value))+"% ",1)]),_:1},8,["color"])])]),s("div",bt,[(c(!0),m(te,null,oe(L(),n=>(c(),C(us,{key:n.key,title:n.label,description:n.description,value:se(n.key),observation:me(n.key),"onUpdate:value":y=>ya(n.key,y),"onUpdate:observation":y=>ba(n.key,y)},null,8,["title","description","value","observation","onUpdate:value","onUpdate:observation"]))),128))]),s("div",kt,[s("label",wt,[o(a(r),{icon:a(Ua)},null,8,["icon"]),e[35]||(e[35]=f(" Observa√ß√µes Adicionais ",-1))]),$e(s("textarea",{"onUpdate:modelValue":e[7]||(e[7]=n=>v.value.observations=n),class:"observations-input",rows:"4",placeholder:"Digite observa√ß√µes sobre esta fase do checklist..."},null,512),[[Re,v.value.observations]])]),s("button",{class:k(["primary-continue-btn",{disabled:!ee.value}]),disabled:!ee.value,onClick:ca},[o(a(r),{icon:a(E)},null,8,["icon"]),s("div",It,[s("span",Pt,d(Ye.value?"Concluir Checklist":"Avan√ßar para Pr√≥xima Fase"),1),s("span",St,d(ee.value?"Todos os itens verificados":"Complete todos os itens obrigat√≥rios"),1)]),o(a(r),{icon:a(Je)},null,8,["icon"])],10,Ct),s("div",Dt,[s("button",{class:"action-card warning",onClick:da},[s("div",Ot,[o(a(r),{icon:a(Ja)},null,8,["icon"])]),e[36]||(e[36]=s("div",{class:"action-card-content"},[s("span",{class:"action-card-title"},"Pausar"),s("span",{class:"action-card-subtitle"},"Voltar depois")],-1))]),s("button",{class:"action-card danger",onClick:e[8]||(e[8]=n=>M.value=!0)},[s("div",Tt,[o(a(r),{icon:a(Ke)},null,8,["icon"])]),e[37]||(e[37]=s("div",{class:"action-card-content"},[s("span",{class:"action-card-title"},"Interromper"),s("span",{class:"action-card-subtitle"},"Cancelar processo")],-1))])])])):l.value.is_interrupted?(c(),m("div",Et,[o(a(U),{class:"interrupted-card"},{default:u(()=>[o(a(J),null,{default:u(()=>[s("div",At,[o(a(r),{icon:a(ie),class:"interrupted-icon"},null,8,["icon"]),e[40]||(e[40]=s("h3",null,"Checklist Interrompido",-1)),s("p",null,"O checklist foi interrompido em "+d(ve(l.value.interrupted_at)),1),s("p",Nt,[e[38]||(e[38]=s("strong",null,"Motivo:",-1)),f(" "+d(l.value.interruption_reason),1)]),o(a(V),{expand:"block",color:"primary",onClick:Ee,class:"return-button"},{default:u(()=>[o(a(r),{icon:a(Ka),slot:"start"},null,8,["icon"]),e[39]||(e[39]=f(" Retornar ao Dashboard ",-1))]),_:1})])]),_:1})]),_:1})])):g("",!0),l.value.current_phase==="completed"?(c(),m("div",Vt,[o(a(U),{class:"completed-card"},{default:u(()=>[o(a(J),null,{default:u(()=>[s("div",$t,[o(a(r),{icon:a(E),class:"completed-icon"},null,8,["icon"]),e[42]||(e[42]=s("h3",null,"Checklist Conclu√≠do com Sucesso!",-1)),s("p",null,"Todas as fases foram completadas em "+d(ve(l.value.post_dialysis_completed_at)),1),o(a(V),{expand:"block",color:"success",onClick:Ee,class:"return-button"},{default:u(()=>[o(a(r),{icon:a(W),slot:"start"},null,8,["icon"]),e[41]||(e[41]=f(" Finalizar e Retornar ",-1))]),_:1})])]),_:1})]),_:1})])):g("",!0)])):g("",!0)]),o(a(Ra),{"is-open":M.value,onWillDismiss:e[12]||(e[12]=n=>M.value=!1)},{default:u(()=>[o(a(Be),null,{default:u(()=>[o(a(qe),null,{default:u(()=>[o(a(xe),null,{default:u(()=>[...e[43]||(e[43]=[f("Interromper Checklist",-1)])]),_:1}),o(a(Me),{slot:"end"},{default:u(()=>[o(a(V),{onClick:e[9]||(e[9]=n=>M.value=!1)},{default:u(()=>[o(a(r),{icon:a(be)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),o(a(je),null,{default:u(()=>[s("div",Rt,[s("div",qt,[o(a(r),{icon:a(Wa),class:"warning-icon"},null,8,["icon"]),e[44]||(e[44]=s("h3",null,"Aten√ß√£o!",-1)),e[45]||(e[45]=s("p",null,"Voc√™ est√° prestes a interromper o checklist de seguran√ßa. Esta a√ß√£o deve ser usada apenas em casos de emerg√™ncia ou intercorr√™ncias m√©dicas.",-1))]),s("div",Mt,[o(a(qa),{fill:"outline",class:"patient-input"},{default:u(()=>[o(a(ze),{position:"floating"},{default:u(()=>[...e[46]||(e[46]=[f("Motivo da Interrup√ß√£o",-1)])]),_:1}),o(a(Ma),{modelValue:X.value,"onUpdate:modelValue":e[10]||(e[10]=n=>X.value=n),rows:4,placeholder:"Descreva o motivo da interrup√ß√£o (obrigat√≥rio)",required:""},null,8,["modelValue"])]),_:1})]),s("div",xt,[o(a(V),{expand:"block",fill:"outline",color:"medium",onClick:e[11]||(e[11]=n=>M.value=!1)},{default:u(()=>[...e[47]||(e[47]=[f(" Cancelar ",-1)])]),_:1}),o(a(V),{expand:"block",color:"danger",disabled:!X.value.trim(),onClick:ua},{default:u(()=>[o(a(r),{icon:a(Ke),slot:"start"},null,8,["icon"]),e[48]||(e[48]=f(" Confirmar Interrup√ß√£o ",-1))]),_:1},8,["disabled"])])])]),_:1})]),_:1},8,["is-open"])]),_:1},512)]),_:1})}}}),Ut=Ge(Bt,[["__scopeId","data-v-b06e1db9"]]);export{Ut as default};
