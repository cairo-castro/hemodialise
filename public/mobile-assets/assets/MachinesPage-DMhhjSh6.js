const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ionic-GHA3wq_y.js","assets/vendor-DcQkTNkg.js"])))=>i.map(i=>d[i]);
import{e as xe,t as _,o as ee,q as $,x as Ee,p as ae,k as h,g as l,r as te,s as Ie,u as De,B as Re,C as Oe,f as Te,E as Se,i as se,w as P,J as ne,G as Ae,l as Le,j as Ve,_ as N}from"./ionic-GHA3wq_y.js";import{d as Be,r as k,c as E,o as $e,B as I,q as m,x as i,y as a,v as o,H as f,t as s,n as y,G as c,K as w,J as b,F as Pe,L as Ne,C as oe,z as ze}from"./vendor-DcQkTNkg.js";import{A as Ue,B as He,H as je,t as z,L,r as V,X as U,Y as H,Z as Fe,P as Ge,q as Xe,W as Je,$ as We,p as Ke,b as Qe,w as Ye,a0 as Ze,_ as ea}from"./_plugin-vue_export-helper-Dt2dLz-X.js";import{C as aa}from"./main-9RtGANsV.js";import{u as ta}from"./useStatsAutoRefresh-CfdwYHqL.js";const sa={class:"machines-container"},na={class:"time-display"},oa={class:"current-date"},ia={class:"current-time"},la={class:"filter-pills"},ra={class:"pill-count"},ua={class:"pill-count"},ca={class:"pill-count"},da={class:"pill-count"},va={class:"stats-summary"},pa={class:"stat-info"},ma={class:"stat-number"},fa={class:"stat-info"},_a={class:"stat-number"},ga={class:"stat-info"},wa={class:"stat-number"},ba={class:"stat-info"},Ca={class:"stat-number"},ya={key:0,class:"loading-container"},ha={key:1,class:"machines-list"},ka=["onClick"],Ma={class:"machine-card-header"},qa={class:"machine-primary-info"},xa={class:"machine-name"},Ea={key:0,class:"machine-identifier"},Ia={class:"machine-status-badge"},Da={class:"status-text"},Ra={key:0,class:"machine-description"},Oa={key:1,class:"session-info-modern"},Ta={class:"session-tag"},Sa={class:"session-details-grid"},Aa={class:"session-detail"},La={class:"detail-value"},Va={class:"session-detail"},Ba={class:"detail-value"},$a={class:"session-detail"},Pa={class:"detail-value"},Na={class:"session-action"},za={key:3,class:"inactive-overlay"},Ua={key:0,class:"empty-state-modern"},Ha={class:"empty-icon"},ja={class:"form-section"},Fa={class:"form-group"},Ga={class:"form-group"},Xa={class:"form-group"},Ja={class:"form-actions"},Wa=Be({__name:"MachinesPage",setup(Ka){const j=ze(),M=aa.getInstance().getMachineRepository(),d=k([]),R=k(!1),C=k("all"),F=k(""),G=k(""),O=k(!1),q=k(!1),g=k(!1),u=k({id:null,name:"",identifier:"",description:"",unit_id:null}),X=()=>{const t=new Date;F.value=t.toLocaleDateString("pt-BR",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),G.value=t.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})};setInterval(X,1e3),X();const J=E(()=>d.value.filter(t=>t.status==="available"&&t.is_active!==!1).length),W=E(()=>d.value.filter(t=>t.status==="occupied").length),K=E(()=>d.value.filter(t=>t.status==="maintenance").length),ie=E(()=>d.value.filter(t=>t.is_active===!1).length),Q=E(()=>{switch(C.value){case"available":return d.value.filter(t=>t.status==="available"&&t.is_active!==!1);case"occupied":return d.value.filter(t=>t.status==="occupied");case"maintenance":return d.value.filter(t=>t.status==="maintenance");case"inactive":return d.value.filter(t=>t.is_active===!1);default:return d.value}}),T=async()=>{R.value=!0;try{const t=await M.getAll();d.value=t}catch(t){console.error("Error loading machines:",t),await(await _.create({message:"Erro ao carregar máquinas",duration:3e3,color:"danger",position:"top"})).present()}finally{R.value=!1}},Y=async()=>{await T()},{isRefreshing:S,forceRefresh:le}=ta(Y,{loadOnMount:!1,interval:15e3,onStatsUpdated:()=>{console.log("[Machines] Stats atualizados automaticamente")}}),re=async t=>{await le(),t.target.complete()},B=t=>!t.is_active||t.is_active===!1?"inactive":t.status,ue=t=>{if(!t.is_active||t.is_active===!1)return"Desativada";switch(t.status){case"available":return"Disponível";case"occupied":return"Em Uso";case"reserved":return"Reservada";case"maintenance":return"Manutenção";default:return t.status}},ce=t=>({pre_dialysis:"Pré-Diálise",during_session:"Durante Sessão",post_dialysis:"Pós-Diálise",completed:"Concluído",interrupted:"Interrompido"})[t]||t,de=t=>t?new Date(t).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):"",ve=t=>{j.push("/checklist/".concat(t))},pe=async t=>{const{alertController:e}=await N(async()=>{const{alertController:v}=await import("./ionic-GHA3wq_y.js").then(r=>r.a8);return{alertController:v}},__vite__mapDeps([0,1]));await(await e.create({header:"Colocar em Manutenção",subHeader:t.name,message:"Descreva brevemente o motivo da manutenção:",inputs:[{name:"reason",type:"textarea",placeholder:"Ex: Troca de filtros, ajuste de pressão, etc."}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Confirmar",handler:v=>{me(t,v.reason||"")}}]})).present()},me=async(t,e)=>{var n,v;try{const r=await M.updateStatus(t.id,{status:"maintenance",reason:e}),p=d.value.findIndex(A=>A.id===t.id);p!==-1&&(d.value[p]={...d.value[p],...r}),await(await _.create({message:"".concat(t.name," colocada em manutenção"),duration:3e3,color:"success",position:"top"})).present()}catch(r){console.error("Error putting machine in maintenance:",r),await(await _.create({message:((v=(n=r.response)==null?void 0:n.data)==null?void 0:v.message)||"Erro ao colocar máquina em manutenção",duration:4e3,color:"danger",position:"top"})).present()}},fe=async t=>{const{alertController:e}=await N(async()=>{const{alertController:v}=await import("./ionic-GHA3wq_y.js").then(r=>r.a8);return{alertController:v}},__vite__mapDeps([0,1]));await(await e.create({header:"Liberar Máquina",subHeader:t.name,message:"Tem certeza que deseja liberar esta máquina? Ela ficará disponível para uso.",buttons:[{text:"Cancelar",role:"cancel"},{text:"Liberar",handler:async()=>{var v,r;try{const p=await M.updateStatus(t.id,{status:"available"}),x=d.value.findIndex(qe=>qe.id===t.id);x!==-1&&(d.value[x]={...d.value[x],...p}),await(await _.create({message:"".concat(t.name," liberada com sucesso"),duration:3e3,color:"success",position:"top"})).present()}catch(p){console.error("Error releasing machine:",p),await(await _.create({message:((r=(v=p.response)==null?void 0:v.data)==null?void 0:r.message)||"Erro ao liberar máquina",duration:4e3,color:"danger",position:"top"})).present()}}}]})).present()},_e=async t=>{const{alertController:e}=await N(async()=>{const{alertController:r}=await import("./ionic-GHA3wq_y.js").then(p=>p.a8);return{alertController:r}},__vite__mapDeps([0,1])),n=!t.is_active;await(await e.create({header:n?"Ativar Máquina":"Desativar Máquina",subHeader:t.name,message:n?"A máquina será ativada e ficará disponível para uso.":"Descreva brevemente o motivo da desativação:",inputs:n?[]:[{name:"reason",type:"textarea",placeholder:"Ex: Equipamento danificado, aguardando reparo, etc."}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Confirmar",handler:r=>{ge(t,(r==null?void 0:r.reason)||"")}}]})).present()},ge=async(t,e)=>{var n,v;try{const r=await M.toggleActive(t.id,{reason:e}),p=d.value.findIndex(A=>A.id===t.id);p!==-1&&(d.value[p]={...d.value[p],...r}),await(await _.create({message:r.is_active?"".concat(t.name," ativada com sucesso"):"".concat(t.name," desativada com sucesso"),duration:3e3,color:"success",position:"top"})).present()}catch(r){console.error("Error toggling machine active:",r),await(await _.create({message:((v=(n=r.response)==null?void 0:n.data)==null?void 0:v.message)||"Erro ao alterar estado da máquina",duration:4e3,color:"danger",position:"top"})).present()}},we=()=>{switch(C.value){case"available":return"Nenhuma máquina disponível no momento";case"occupied":return"Nenhuma máquina em uso";case"maintenance":return"Nenhuma máquina em manutenção";case"inactive":return"Nenhuma máquina desativada";default:return"Nenhuma máquina cadastrada"}},Z=E(()=>u.value.name.trim()!==""&&u.value.identifier.trim()!==""),be=async()=>{try{const t=await fetch("/api/user-units/current",{credentials:"include",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw console.error("Erro ao carregar unidade"),new Error("Não foi possível carregar a unidade");const e=await t.json();console.log("Resposta de /api/user-units/current:",e),e.success&&e.unit&&e.unit.id?(u.value.unit_id=e.unit.id,console.log("Unit ID configurado:",u.value.unit_id)):(console.error("Nenhuma unidade selecionada"),await(await _.create({message:"Por favor, selecione uma unidade no Dashboard antes de continuar",duration:3e3,color:"warning",position:"top",buttons:[{text:"Ir para Dashboard",handler:()=>{j.push("/dashboard")}}]})).present(),D())}catch(t){console.error("Erro ao carregar unidade:",t),await(await _.create({message:"Erro ao carregar unidade. Por favor, tente novamente.",duration:2e3,color:"danger",position:"top"})).present()}},Ce=async()=>{q.value=!1,u.value={id:null,name:"",identifier:"",description:"",unit_id:null},await be(),O.value=!0},ye=async t=>{q.value=!0,u.value={id:t.id,name:t.name,identifier:t.identifier,description:t.description||"",unit_id:t.unit_id},O.value=!0},D=()=>{O.value=!1,u.value={id:null,name:"",identifier:"",description:"",unit_id:null}},he=async()=>{if(Z.value){g.value=!0;try{const t={name:u.value.name,identifier:u.value.identifier,description:u.value.description,unit_id:u.value.unit_id};let e;if(q.value?e={success:!0,data:await M.update(u.value.id,t)}:e={success:!0,data:await M.create(t)},e.success)await(await _.create({message:e.message||(q.value?"Máquina atualizada com sucesso!":"Máquina criada com sucesso!"),duration:3e3,color:"success",position:"top"})).present(),D(),await T();else throw new Error(e.message||"Erro ao salvar máquina")}catch(t){await(await _.create({message:t.message||"Erro ao salvar máquina. Tente novamente.",duration:4e3,color:"danger",position:"top"})).present()}finally{g.value=!1}}},ke=async()=>{await(await Le.create({header:"Confirmar Exclusão",message:"Tem certeza que deseja excluir a máquina <strong>".concat(u.value.name,"</strong>? Esta ação irá desativá-la."),buttons:[{text:"Cancelar",role:"cancel"},{text:"Excluir",role:"destructive",handler:async()=>{await Me()}}]})).present()},Me=async()=>{if(u.value.id){g.value=!0;try{await M.delete(u.value.id);const t={success:!0};t.success&&(await(await _.create({message:t.message||"Máquina removida com sucesso!",duration:3e3,color:"success",position:"top"})).present(),D(),await T())}catch(t){await(await _.create({message:t.message||"Erro ao excluir máquina. Tente novamente.",duration:4e3,color:"danger",position:"top"})).present()}finally{g.value=!1}}};return $e(()=>{T()}),(t,e)=>(m(),I(a(xe),null,{default:i(()=>[o(a(te),{translucent:!0},{default:i(()=>[o(a(ee),{color:"primary"},{default:i(()=>[o(a($),{slot:"start"},{default:i(()=>[o(a(Ee),{"default-href":"/dashboard"})]),_:1}),o(a(ae),null,{default:i(()=>[...e[8]||(e[8]=[f("Gestão de Máquinas",-1)])]),_:1}),o(a($),{slot:"end"},{default:i(()=>[o(a(h),{onClick:Y,disabled:R.value},{default:i(()=>[o(a(l),{icon:a(Ue)},null,8,["icon"])]),_:1},8,["disabled"]),o(a(h),{onClick:Ce},{default:i(()=>[o(a(l),{icon:a(He)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),o(a(se),{fullscreen:!0,class:"machines-content"},{default:i(()=>[s("div",sa,[o(a(Ie),{slot:"fixed",onIonRefresh:re},{default:i(()=>[o(a(De))]),_:1}),o(a(Re),{class:"time-header-card"},{default:i(()=>[o(a(Oe),null,{default:i(()=>[s("div",na,[s("div",oa,[o(a(l),{icon:a(je),class:"date-icon"},null,8,["icon"]),f(" "+c(F.value),1)]),s("div",ia,[o(a(l),{icon:a(z),class:"time-icon"},null,8,["icon"]),f(" "+c(G.value),1)])])]),_:1})]),_:1}),s("div",la,[s("button",{class:w(["filter-pill",{active:C.value==="all"}]),onClick:e[0]||(e[0]=n=>C.value="all")},[o(a(l),{icon:a(L)},null,8,["icon"]),e[9]||(e[9]=s("span",null,"Todas",-1)),s("span",ra,c(d.value.length),1)],2),s("button",{class:w(["filter-pill available",{active:C.value==="available"}]),onClick:e[1]||(e[1]=n=>C.value="available")},[o(a(l),{icon:a(V)},null,8,["icon"]),e[10]||(e[10]=s("span",null,"Disponíveis",-1)),s("span",ua,c(J.value),1)],2),s("button",{class:w(["filter-pill occupied",{active:C.value==="occupied"}]),onClick:e[2]||(e[2]=n=>C.value="occupied")},[o(a(l),{icon:a(z)},null,8,["icon"]),e[11]||(e[11]=s("span",null,"Em Uso",-1)),s("span",ca,c(W.value),1)],2),s("button",{class:w(["filter-pill maintenance",{active:C.value==="maintenance"}]),onClick:e[3]||(e[3]=n=>C.value="maintenance")},[o(a(l),{icon:a(U)},null,8,["icon"]),e[12]||(e[12]=s("span",null,"Manutenção",-1)),s("span",da,c(K.value),1)],2)]),s("div",va,[s("div",{class:w(["stat-card available",{updating:a(S)}])},[o(a(l),{icon:a(V)},null,8,["icon"]),s("div",pa,[s("span",ma,c(J.value),1),e[13]||(e[13]=s("span",{class:"stat-label"},"Disponíveis",-1))])],2),s("div",{class:w(["stat-card occupied",{updating:a(S)}])},[o(a(l),{icon:a(z)},null,8,["icon"]),s("div",fa,[s("span",_a,c(W.value),1),e[14]||(e[14]=s("span",{class:"stat-label"},"Em Uso",-1))])],2),s("div",{class:w(["stat-card maintenance",{updating:a(S)}])},[o(a(l),{icon:a(U)},null,8,["icon"]),s("div",ga,[s("span",wa,c(K.value),1),e[15]||(e[15]=s("span",{class:"stat-label"},"Manutenção",-1))])],2),s("div",{class:w(["stat-card inactive",{updating:a(S)}])},[o(a(l),{icon:a(H)},null,8,["icon"]),s("div",ba,[s("span",Ca,c(ie.value),1),e[16]||(e[16]=s("span",{class:"stat-label"},"Desativadas",-1))])],2)]),R.value?(m(),y("div",ya,[o(a(Te),{name:"crescent"}),e[17]||(e[17]=s("p",null,"Carregando máquinas...",-1))])):(m(),y("div",ha,[(m(!0),y(Pe,null,Ne(Q.value,n=>(m(),y("div",{key:n.id,class:w(["machine-card-modern",B(n)]),onClick:v=>n.current_checklist&&ve(n.current_checklist.id)},[s("div",Ma,[s("div",{class:w(["machine-icon-large",B(n)])},[o(a(l),{icon:a(L)},null,8,["icon"])],2),s("div",qa,[s("h3",xa,c(n.name),1),n.identifier?(m(),y("p",Ea,c(n.identifier),1)):b("",!0)]),s("div",Ia,[s("div",{class:w(["status-dot",B(n)])},null,2),s("span",Da,c(ue(n)),1)])]),n.description?(m(),y("div",Ra,c(n.description),1)):b("",!0),n.current_checklist?(m(),y("div",Oa,[s("div",Ta,[o(a(l),{icon:a(Ke)},null,8,["icon"]),e[19]||(e[19]=s("span",null,"Sessão Ativa",-1)),n.current_checklist.is_paused?(m(),I(a(Ve),{key:0,color:"warning"},{default:i(()=>[...e[18]||(e[18]=[f("Pausado",-1)])]),_:1})):b("",!0)]),s("div",Sa,[s("div",Aa,[e[20]||(e[20]=s("span",{class:"detail-label"},"Paciente",-1)),s("span",La,c(n.current_checklist.patient_name),1)]),s("div",Va,[e[21]||(e[21]=s("span",{class:"detail-label"},"Fase",-1)),s("span",Ba,c(ce(n.current_checklist.current_phase)),1)]),s("div",$a,[e[22]||(e[22]=s("span",{class:"detail-label"},"Início",-1)),s("span",Pa,c(de(n.current_checklist.started_at)),1)])]),s("div",Na,[o(a(l),{icon:a(Qe)},null,8,["icon"]),e[23]||(e[23]=s("span",null,"Clique para ver checklist",-1)),o(a(l),{icon:a(Ye)},null,8,["icon"])])])):b("",!0),n.current_checklist?b("",!0):(m(),y("div",{key:2,class:"machine-actions",onClick:e[4]||(e[4]=oe(()=>{},["stop"]))},[o(a(h),{fill:"clear",size:"small",color:"medium",onClick:v=>ye(n)},{default:i(()=>[o(a(l),{slot:"start",icon:a(Ze)},null,8,["icon"]),e[24]||(e[24]=f(" Editar ",-1))]),_:1},8,["onClick"]),n.is_active&&n.status==="available"?(m(),I(a(h),{key:0,fill:"outline",size:"small",color:"warning",onClick:v=>pe(n)},{default:i(()=>[o(a(l),{slot:"start",icon:a(U)},null,8,["icon"]),e[25]||(e[25]=f(" Manutenção ",-1))]),_:1},8,["onClick"])):b("",!0),n.is_active&&n.status==="maintenance"?(m(),I(a(h),{key:1,fill:"solid",size:"small",color:"success",onClick:v=>fe(n)},{default:i(()=>[o(a(l),{slot:"start",icon:a(V)},null,8,["icon"]),e[26]||(e[26]=f(" Liberar Máquina ",-1))]),_:1},8,["onClick"])):b("",!0),n.status!=="occupied"?(m(),I(a(h),{key:2,fill:"outline",size:"small",color:n.is_active?"danger":"success",onClick:v=>_e(n)},{default:i(()=>[o(a(l),{slot:"start",icon:n.is_active?a(H):a(V)},null,8,["icon"]),f(" "+c(n.is_active?"Desativar":"Ativar"),1)]),_:2},1032,["color","onClick"])):b("",!0)])),n.is_active?b("",!0):(m(),y("div",za,[o(a(l),{icon:a(H)},null,8,["icon"]),e[27]||(e[27]=s("span",null,"Desativada",-1))]))],10,ka))),128)),Q.value.length===0?(m(),y("div",Ua,[s("div",Ha,[o(a(l),{icon:a(L)},null,8,["icon"])]),e[28]||(e[28]=s("h3",null,"Nenhuma máquina encontrada",-1)),s("p",null,c(we()),1)])):b("",!0)]))]),o(a(Se),{"is-open":O.value,onDidDismiss:D},{default:i(()=>[o(a(te),null,{default:i(()=>[o(a(ee),null,{default:i(()=>[o(a(ae),null,{default:i(()=>[f(c(q.value?"Editar Máquina":"Nova Máquina"),1)]),_:1}),o(a($),{slot:"end"},{default:i(()=>[o(a(h),{onClick:D},{default:i(()=>[...e[29]||(e[29]=[f("Cancelar",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),o(a(se),{class:"machine-modal-content"},{default:i(()=>[s("form",{onSubmit:oe(he,["prevent"]),class:"machine-form"},[s("div",ja,[e[33]||(e[33]=s("h3",{class:"section-title"},"Informações Básicas",-1)),s("div",Fa,[o(a(P),{position:"stacked",class:"form-label"},{default:i(()=>[o(a(l),{icon:a(L)},null,8,["icon"]),e[30]||(e[30]=f(" Nome da Máquina * ",-1))]),_:1}),o(a(ne),{modelValue:u.value.name,"onUpdate:modelValue":e[5]||(e[5]=n=>u.value.name=n),type:"text",placeholder:"Ex: Máquina 01",required:"",disabled:g.value,class:"custom-input"},null,8,["modelValue","disabled"])]),s("div",Ga,[o(a(P),{position:"stacked",class:"form-label"},{default:i(()=>[o(a(l),{icon:a(Fe)},null,8,["icon"]),e[31]||(e[31]=f(" Identificador/Código * ",-1))]),_:1}),o(a(ne),{modelValue:u.value.identifier,"onUpdate:modelValue":e[6]||(e[6]=n=>u.value.identifier=n),type:"text",placeholder:"Ex: MAQ-001",required:"",disabled:g.value,class:"custom-input"},null,8,["modelValue","disabled"])]),s("div",Xa,[o(a(P),{position:"stacked",class:"form-label"},{default:i(()=>[o(a(l),{icon:a(Ge)},null,8,["icon"]),e[32]||(e[32]=f(" Descrição ",-1))]),_:1}),o(a(Ae),{modelValue:u.value.description,"onUpdate:modelValue":e[7]||(e[7]=n=>u.value.description=n),placeholder:"Informações adicionais sobre a máquina",rows:4,disabled:g.value,class:"custom-textarea"},null,8,["modelValue","disabled"])])]),s("div",Ja,[o(a(h),{expand:"block",type:"submit",disabled:g.value||!Z.value,class:"submit-button"},{default:i(()=>[o(a(l),{slot:"start",icon:g.value?a(Xe):a(Je)},null,8,["icon"]),f(" "+c(g.value?"Salvando...":q.value?"Atualizar Máquina":"Criar Máquina"),1)]),_:1},8,["disabled"]),q.value?(m(),I(a(h),{key:0,expand:"block",fill:"outline",color:"danger",onClick:ke,disabled:g.value,class:"delete-button"},{default:i(()=>[o(a(l),{slot:"start",icon:a(We)},null,8,["icon"]),e[34]||(e[34]=f(" Excluir Máquina ",-1))]),_:1},8,["disabled"])):b("",!0)])],32)]),_:1})]),_:1},8,["is-open"])]),_:1})]),_:1}))}}),st=ea(Wa,[["__scopeId","data-v-65c44c83"]]);export{st as default};
