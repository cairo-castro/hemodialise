import{d as X,r as c,c as M,o as z,B as J,q as y,x as l,y as a,v as s,H as m,t as o,n as I,J as P,G as p,C as O,z as G}from"./vendor-DcQkTNkg.js";import{e as W,t as w,o as $,q as K,x as F,p as Q,r as Y,s as Z,u as ee,f as ae,B as V,C as k,g as d,j as se,M as S,N as x,J as b,k as C,i as oe,l as le}from"./ionic-GHA3wq_y.js";import{d as te,n as ne,V as re,e as E,b as R,l as ie,s as de,a6 as ue,G as ce,_ as pe}from"./_plugin-vue_export-helper-CkaGgE-1.js";const fe={class:"profile-container"},me={key:0,class:"loading-state"},ve={key:1},we={class:"profile-header"},_e={class:"profile-avatar"},ge={class:"profile-header-info"},he={class:"user-email"},ye={key:0,class:"profile-unit"},be={class:"form-group"},Ce={class:"form-group"},Ie={class:"form-actions"},Ve={class:"form-group"},ke={class:"password-input"},Be={class:"form-group"},Pe={class:"password-input"},Se={class:"form-group"},xe={class:"password-input"},Ee={class:"form-actions"},Re={class:"info-item"},qe={class:"info-label"},Ae={class:"info-value"},Me={key:0,class:"info-item"},Oe={class:"info-label"},Ne={class:"info-value"},Ue={class:"info-item"},De={class:"info-label"},Te={class:"info-value"},je=X({__name:"ProfilePage",setup(He){G();const n=c(null),B=c(!1),v=c(!1),f=c(!1),u=c({name:"",email:""}),r=c({current_password:"",new_password:"",new_password_confirmation:""}),_=c(!1),g=c(!1),h=c(!1),N=M(()=>n.value?u.value.name!==n.value.name||u.value.email!==n.value.email:!1),U=M(()=>r.value.current_password.length>0&&r.value.new_password.length>0&&r.value.new_password_confirmation.length>0),q=async()=>{try{B.value=!0;const e=await(await fetch("/api/me",{credentials:"include",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();if(e.success&&e.user)n.value=e.user,u.value={name:n.value.name||"",email:n.value.email||""};else throw new Error(e.message||"Erro ao carregar perfil")}catch(t){console.error("Error loading profile:",t),await(await w.create({message:t.message||"Erro ao carregar perfil",duration:3e3,color:"danger",position:"top"})).present()}finally{B.value=!1}},D=async()=>{try{v.value=!0;const e=await(await fetch("/api/profile/update",{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(u.value)})).json();if(e.success)n.value=e.user,u.value={name:n.value.name||"",email:n.value.email||""},await(await w.create({message:e.message||"Perfil atualizado com sucesso",duration:2e3,color:"success",position:"top"})).present();else throw new Error(e.message||"Erro ao atualizar perfil")}catch(t){console.error("Error updating profile:",t),await(await w.create({message:t.message||"Erro ao atualizar perfil",duration:3e3,color:"danger",position:"top"})).present()}finally{v.value=!1}},T=async()=>{if(r.value.new_password!==r.value.new_password_confirmation){await(await w.create({message:"As senhas não coincidem",duration:3e3,color:"warning",position:"top"})).present();return}if(r.value.new_password.length<8){await(await w.create({message:"A nova senha deve ter no mínimo 8 caracteres",duration:3e3,color:"warning",position:"top"})).present();return}try{f.value=!0;const e=await(await fetch("/api/profile/password",{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(r.value)})).json();if(e.success)r.value={current_password:"",new_password:"",new_password_confirmation:""},_.value=!1,g.value=!1,h.value=!1,await(await le.create({header:"Senha Alterada",message:"Sua senha foi alterada com sucesso!",buttons:["OK"]})).present();else throw new Error(e.message||"Erro ao alterar senha")}catch(t){console.error("Error updating password:",t),await(await w.create({message:t.message||"Erro ao alterar senha",duration:3e3,color:"danger",position:"top"})).present()}finally{f.value=!1}},j=async t=>{await q(),t.target.complete()},A=t=>({admin:"Administrador",manager:"Gestor",field_user:"Usuário de Campo",tecnico:"Técnico",coordenador:"Coordenador",supervisor:"Supervisor"})[t]||t,H=t=>({admin:"danger",manager:"warning",field_user:"primary",tecnico:"primary",coordenador:"secondary",supervisor:"tertiary"})[t]||"medium",L=t=>t?new Date(t).toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric"}):"N/A";return z(()=>{q()}),(t,e)=>(y(),J(a(W),null,{default:l(()=>[s(a(Y),{translucent:!0},{default:l(()=>[s(a($),{color:"primary"},{default:l(()=>[s(a(K),{slot:"start"},{default:l(()=>[s(a(F),{"default-href":"/dashboard"})]),_:1}),s(a(Q),null,{default:l(()=>[...e[8]||(e[8]=[m("Meu Perfil",-1)])]),_:1})]),_:1})]),_:1}),s(a(oe),{fullscreen:!0,class:"profile-content"},{default:l(()=>[o("div",fe,[s(a(Z),{slot:"fixed",onIonRefresh:j},{default:l(()=>[s(a(ee))]),_:1}),B.value&&!n.value?(y(),I("div",me,[s(a(ae),{name:"crescent"}),e[9]||(e[9]=o("p",null,"Carregando perfil...",-1))])):n.value?(y(),I("div",ve,[s(a(V),{class:"profile-header-card"},{default:l(()=>[s(a(k),null,{default:l(()=>[o("div",we,[o("div",_e,[s(a(d),{icon:a(te)},null,8,["icon"])]),o("div",ge,[o("h2",null,p(n.value.name),1),o("p",he,p(n.value.email),1),s(a(se),{color:H(n.value.role)},{default:l(()=>[m(p(A(n.value.role)),1)]),_:1},8,["color"])])]),n.value.unit?(y(),I("div",ye,[s(a(d),{icon:a(ne)},null,8,["icon"]),o("span",null,p(n.value.unit.name),1)])):P("",!0)]),_:1})]),_:1}),s(a(V),{class:"form-card"},{default:l(()=>[s(a(S),null,{default:l(()=>[s(a(x),null,{default:l(()=>[...e[10]||(e[10]=[m("Informações Básicas",-1)])]),_:1})]),_:1}),s(a(k),null,{default:l(()=>[o("form",{onSubmit:O(D,["prevent"])},[o("div",be,[e[11]||(e[11]=o("label",null,"Nome Completo",-1)),s(a(b),{modelValue:u.value.name,"onUpdate:modelValue":e[0]||(e[0]=i=>u.value.name=i),type:"text",placeholder:"Digite seu nome",disabled:v.value,required:""},null,8,["modelValue","disabled"])]),o("div",Ce,[e[12]||(e[12]=o("label",null,"E-mail",-1)),s(a(b),{modelValue:u.value.email,"onUpdate:modelValue":e[1]||(e[1]=i=>u.value.email=i),type:"email",placeholder:"Digite seu e-mail",disabled:v.value,required:""},null,8,["modelValue","disabled"])]),o("div",Ie,[s(a(C),{expand:"block",type:"submit",disabled:v.value||!N.value},{default:l(()=>[s(a(d),{slot:"start",icon:a(re)},null,8,["icon"]),m(" "+p(v.value?"Salvando...":"Salvar Alterações"),1)]),_:1},8,["disabled"])])],32)]),_:1})]),_:1}),s(a(V),{class:"form-card"},{default:l(()=>[s(a(S),null,{default:l(()=>[s(a(x),null,{default:l(()=>[...e[13]||(e[13]=[m("Alterar Senha",-1)])]),_:1})]),_:1}),s(a(k),null,{default:l(()=>[o("form",{onSubmit:O(T,["prevent"])},[o("div",Ve,[e[14]||(e[14]=o("label",null,"Senha Atual",-1)),o("div",ke,[s(a(b),{modelValue:r.value.current_password,"onUpdate:modelValue":e[2]||(e[2]=i=>r.value.current_password=i),type:_.value?"text":"password",placeholder:"Digite sua senha atual",disabled:f.value,required:""},null,8,["modelValue","type","disabled"]),s(a(C),{fill:"clear",onClick:e[3]||(e[3]=i=>_.value=!_.value),class:"password-toggle"},{default:l(()=>[s(a(d),{icon:_.value?a(E):a(R)},null,8,["icon"])]),_:1})])]),o("div",Be,[e[15]||(e[15]=o("label",null,"Nova Senha",-1)),o("div",Pe,[s(a(b),{modelValue:r.value.new_password,"onUpdate:modelValue":e[4]||(e[4]=i=>r.value.new_password=i),type:g.value?"text":"password",placeholder:"Digite a nova senha",disabled:f.value,required:""},null,8,["modelValue","type","disabled"]),s(a(C),{fill:"clear",onClick:e[5]||(e[5]=i=>g.value=!g.value),class:"password-toggle"},{default:l(()=>[s(a(d),{icon:g.value?a(E):a(R)},null,8,["icon"])]),_:1})]),e[16]||(e[16]=o("div",{class:"password-hint"}," Mínimo de 8 caracteres ",-1))]),o("div",Se,[e[17]||(e[17]=o("label",null,"Confirmar Nova Senha",-1)),o("div",xe,[s(a(b),{modelValue:r.value.new_password_confirmation,"onUpdate:modelValue":e[6]||(e[6]=i=>r.value.new_password_confirmation=i),type:h.value?"text":"password",placeholder:"Confirme a nova senha",disabled:f.value,required:""},null,8,["modelValue","type","disabled"]),s(a(C),{fill:"clear",onClick:e[7]||(e[7]=i=>h.value=!h.value),class:"password-toggle"},{default:l(()=>[s(a(d),{icon:h.value?a(E):a(R)},null,8,["icon"])]),_:1})])]),o("div",Ee,[s(a(C),{expand:"block",type:"submit",color:"warning",disabled:f.value||!U.value},{default:l(()=>[s(a(d),{slot:"start",icon:a(ie)},null,8,["icon"]),m(" "+p(f.value?"Alterando...":"Alterar Senha"),1)]),_:1},8,["disabled"])])],32)]),_:1})]),_:1}),s(a(V),{class:"info-card"},{default:l(()=>[s(a(S),null,{default:l(()=>[s(a(x),null,{default:l(()=>[...e[18]||(e[18]=[m("Informações da Conta",-1)])]),_:1})]),_:1}),s(a(k),null,{default:l(()=>[o("div",Re,[o("div",qe,[s(a(d),{icon:a(de)},null,8,["icon"]),e[19]||(e[19]=o("span",null,"Tipo de Conta",-1))]),o("div",Ae,p(A(n.value.role)),1)]),n.value.unit?(y(),I("div",Me,[o("div",Oe,[s(a(d),{icon:a(ue)},null,8,["icon"]),e[20]||(e[20]=o("span",null,"Unidade",-1))]),o("div",Ne,p(n.value.unit.name),1)])):P("",!0),o("div",Ue,[o("div",De,[s(a(d),{icon:a(ce)},null,8,["icon"]),e[21]||(e[21]=o("span",null,"Membro desde",-1))]),o("div",Te,p(L(n.value.created_at)),1)])]),_:1})]),_:1})])):P("",!0)])]),_:1})]),_:1}))}}),Je=pe(je,[["__scopeId","data-v-7b1db914"]]);export{Je as default};
