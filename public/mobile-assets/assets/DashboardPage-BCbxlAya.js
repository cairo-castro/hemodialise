import{d as ls,c as y,n as C,q as p,t as e,v as o,G as d,x as r,H as D,y as s,I as Is,J as b,B as T,K as J,r as _,o as Ps,z as Ts,F as Es,L as zs}from"./vendor-DcQkTNkg.js";import{j as rs,g as n,k as I,l as K,e as As,t as w,m as es,n as Ls,o as Rs,p as Fs,q as js,r as Bs,s as Ns,u as qs,v as ts,w as as,i as xs}from"./ionic-GHA3wq_y.js";import{p as Hs,d as Vs,t as Q,f as os,g as ns,i as Gs,_ as us,h as Js,j as Ks,k as Qs,n as is,o as Ws,q as Xs,r as Ys,u as cs,m as Zs,v as se,w as q,x as ee,y as te,z as ae}from"./_plugin-vue_export-helper-Dt2dLz-X.js";import{C as oe,A as M,u as ne}from"./main-BLe5ig7Y.js";import{u as ie}from"./useStatsAutoRefresh-bCOUMI9a.js";const ce={class:"card-header"},le={class:"machine-info"},re={class:"machine-id"},ue={class:"patient-info"},de={class:"patient-name"},he={class:"user-info"},pe={class:"user-name"},ve={class:"progress-section"},me={class:"progress-bar"},ge={class:"progress-text"},fe={class:"time-info"},_e={class:"time-item"},ke={class:"time-value"},we={key:0,class:"time-item"},Ce={class:"time-value"},ye={class:"actions"},be=ls({__name:"ActiveChecklistCard",props:{checklist:{}},emits:["continue","pause","resume"],setup(W,{emit:m}){const u=W,F=y(()=>({pre_dialysis:"PrÃ©-DiÃ¡lise",during_session:"Durante SessÃ£o",post_dialysis:"PÃ³s-DiÃ¡lise",completed:"ConcluÃ­do",interrupted:"Interrompido"})[u.checklist.current_phase]||u.checklist.current_phase),x=y(()=>({pre_dialysis:"primary",during_session:"warning",post_dialysis:"secondary",completed:"success",interrupted:"danger"})[u.checklist.current_phase]||"medium"),E=y(()=>u.checklist.current_phase.replace("_","-")),z=y(()=>u.checklist.phase_completion!==void 0?Math.round(u.checklist.phase_completion):{pre_dialysis:25,during_session:50,post_dialysis:75,completed:100,interrupted:0}[u.checklist.current_phase]||0),v=y(()=>{const c=new Date(u.checklist.created_at),k=new Date().getTime()-c.getTime(),g=Math.floor(k/(1e3*60*60)),O=Math.floor(k%(1e3*60*60)/(1e3*60));return g>0?"".concat(g,"h ").concat(O,"m"):"".concat(O,"m")}),A=y(()=>{if(!u.checklist.paused_at)return"";const c=new Date(u.checklist.paused_at),k=new Date().getTime()-c.getTime(),g=Math.floor(k/(1e3*60*60)),O=Math.floor(k%(1e3*60*60)/(1e3*60));return g>0?"".concat(g,"h ").concat(O,"m"):"".concat(O,"m")}),L=async()=>{await(await K.create({header:"Detalhes do Checklist",subHeader:"".concat(u.checklist.machine.name," - ").concat(u.checklist.patient.name),message:"\n      <strong>TÃ©cnico:</strong> ".concat(u.checklist.user.name,"<br>\n      <strong>Fase:</strong> ").concat(F.value,"<br>\n      <strong>Progresso:</strong> ").concat(z.value,"%<br>\n      <strong>Iniciado:</strong> ").concat(new Date(u.checklist.created_at).toLocaleString("pt-BR"),"<br>\n      ").concat(u.checklist.paused_at?"<strong>Pausado:</strong> ".concat(new Date(u.checklist.paused_at).toLocaleString("pt-BR"),"<br>"):"","\n    "),buttons:["Fechar"]})).present()};return(c,l)=>(p(),C("div",{class:J(["checklist-card",[E.value,{paused:c.checklist.paused_at}]])},[e("div",ce,[e("div",le,[e("h3",null,d(c.checklist.machine.name),1),e("p",re,d(c.checklist.machine.identifier),1)]),o(s(rs),{color:x.value,class:"phase-badge"},{default:r(()=>[D(d(F.value),1)]),_:1},8,["color"])]),e("div",ue,[o(s(n),{icon:s(Hs),class:"patient-icon"},null,8,["icon"]),e("span",de,d(c.checklist.patient.name),1)]),e("div",he,[o(s(n),{icon:s(Vs),class:"user-icon"},null,8,["icon"]),l[3]||(l[3]=e("span",{class:"user-label"},"TÃ©cnico:",-1)),e("span",pe,d(c.checklist.user.name),1)]),e("div",ve,[e("div",me,[e("div",{class:"progress-fill",style:Is({width:z.value+"%"})},null,4)]),e("span",ge,d(z.value)+"% completo",1)]),e("div",fe,[e("div",_e,[o(s(n),{icon:s(Q),class:"time-icon"},null,8,["icon"]),l[4]||(l[4]=e("span",{class:"time-label"},"Iniciado hÃ¡",-1)),e("span",ke,d(v.value),1)]),c.checklist.paused_at?(p(),C("div",we,[o(s(n),{icon:s(os),class:"time-icon paused"},null,8,["icon"]),l[5]||(l[5]=e("span",{class:"time-label"},"Pausado hÃ¡",-1)),e("span",Ce,d(A.value),1)])):b("",!0)]),e("div",ye,[c.checklist.paused_at?b("",!0):(p(),T(s(I),{key:0,fill:"outline",size:"small",onClick:l[0]||(l[0]=k=>c.$emit("continue",c.checklist)),class:"action-button continue"},{default:r(()=>[o(s(n),{icon:s(ns),slot:"start"},null,8,["icon"]),l[6]||(l[6]=D(" Continuar ",-1))]),_:1})),c.checklist.paused_at?(p(),T(s(I),{key:1,fill:"solid",size:"small",onClick:l[1]||(l[1]=k=>c.$emit("resume",c.checklist)),class:"action-button resume",color:"success"},{default:r(()=>[o(s(n),{icon:s(ns),slot:"start"},null,8,["icon"]),l[7]||(l[7]=D(" Retomar ",-1))]),_:1})):b("",!0),c.checklist.paused_at?b("",!0):(p(),T(s(I),{key:2,fill:"outline",size:"small",onClick:l[2]||(l[2]=k=>c.$emit("pause",c.checklist)),class:"action-button pause",color:"warning"},{default:r(()=>[o(s(n),{icon:s(os),slot:"start"},null,8,["icon"]),l[8]||(l[8]=D(" Pausar ",-1))]),_:1})),o(s(I),{fill:"clear",size:"small",onClick:L,class:"action-button details"},{default:r(()=>[o(s(n),{icon:s(Gs),slot:"icon-only"},null,8,["icon"])]),_:1})]),e("div",{class:J(["status-indicator",E.value])},null,2)],2))}}),$e=us(be,[["__scopeId","data-v-279d50f9"]]),Se={class:"dashboard-container"},Oe={key:0,class:"welcome-section"},De={class:"welcome-header"},Ue={class:"welcome-text"},Me={class:"unit-display"},Ie={key:0,class:"unit-info-static"},Pe={class:"unit-text-static"},Te={class:"unit-name-static"},Ee={key:1,class:"unit-info"},ze={class:"unit-text"},Ae={class:"unit-name"},Le={key:1,class:"quick-stats"},Re={key:0,class:"stats-update-badge"},Fe={class:"stat-icon"},je={class:"stat-content"},Be={class:"stat-number"},Ne={class:"stat-icon"},qe={class:"stat-content"},xe={class:"stat-number"},He={class:"stat-icon"},Ve={class:"stat-content"},Ge={class:"stat-number"},Je={class:"primary-action"},Ke={class:"section"},Qe={class:"quick-actions"},We={class:"action-icon warning"},Xe={class:"action-content"},Ye={class:"action-subtitle"},Ze={class:"action-icon tertiary"},st={class:"action-icon cleaning"},et={class:"action-icon primary"},tt={key:2,class:"section"},at={class:"checklists-list"},ot={class:"connection-status"},nt=ls({__name:"DashboardPage",setup(W){const m=Ts(),u=oe.getInstance(),F=u.getCurrentUserUseCase(),x=u.getLogoutUseCase(),{isDarkMode:E,toggleDarkMode:z}=ne(),v=_(null),A=_(navigator.onLine),L=_(!1),c=_(0),l=_(3),k=_(!1),g=_([]),O=_([]),R=_([]),P=_([]),$=_(null),S=_(null);y(()=>v.value&&{tecnico:"TÃ©cnico",admin:"Admin",gestor:"Gestor",coordenador:"Coordenador",supervisor:"Supervisor"}[v.value.role]||"UsuÃ¡rio");const H=y(()=>g.value.filter(a=>!a.paused_at).length);y(()=>g.value.filter(a=>a.paused_at).length);const V=y(()=>O.value.length),X=async()=>{try{v.value=await F.execute(),console.log("User loaded:",v.value),await ds()}catch(a){console.error("Error loading user:",a),await(await w.create({message:"Erro ao carregar dados do usuÃ¡rio",duration:3e3,color:"danger",position:"top"})).present(),setTimeout(()=>{m.replace("/login")},2e3)}},ds=async()=>{var a,t,i;try{const h=await(await fetch("/api/user-units",M.getFetchConfig())).json();if(h.success){P.value=h.units||[];const U=h.current_unit_id;U?($.value=h.units.find(N=>N.id===U),S.value=U,console.log("Unidade jÃ¡ selecionada:",(a=$.value)==null?void 0:a.name)):h.units.length===1?(console.log("Apenas uma unidade disponÃ­vel, selecionando automaticamente..."),await G(h.units[0].id),$.value=h.units[0],S.value=h.units[0].id):h.units.length>1&&(console.log("MÃºltiplas unidades disponÃ­veis, forÃ§ando seleÃ§Ã£o..."),setTimeout(()=>{ps()},500)),console.log("Unidades carregadas (mobile):",{total:P.value.length,current:(t=$.value)==null?void 0:t.name,currentId:S.value})}}catch(f){console.error("Error loading available units:",f),(i=v.value)!=null&&i.unit&&($.value=v.value.unit,S.value=v.value.unit.id,P.value=v.value.units||[v.value.unit])}},hs=async()=>{const a=P.value.map(i=>({text:i.id===S.value?"âœ“ ".concat(i.name):i.name,cssClass:i.id===S.value?"unit-selected":"",handler:()=>{i.id!==S.value&&G(i.id)}}));a.push({text:"Cancelar",role:"cancel",handler:()=>{}}),await(await es.create({header:"Selecionar Unidade",subHeader:"Escolha a unidade para visualizar",buttons:a,cssClass:"unit-selector-action-sheet"})).present()},ps=async()=>{const a=P.value.map(i=>({text:i.name,handler:()=>{G(i.id)}}));await(await es.create({header:"Selecione uma Unidade",subHeader:"Por favor, escolha a unidade para continuar",buttons:a,backdropDismiss:!1,cssClass:"unit-selector-action-sheet mandatory-selection"})).present()},G=async a=>{var t;try{const i=await Ls.create({message:"Alternando unidade...",spinner:"crescent",duration:1e4});await i.present();const h=await(await fetch("/api/user-units/switch",{method:"POST",...M.getFetchConfig({body:JSON.stringify({unit_id:a})})})).json();await i.dismiss(),h.success&&($.value=h.current_unit,S.value=a,await(await w.create({message:"ðŸ“ Unidade alterada para ".concat(h.current_unit.name),duration:1500,color:"success",position:"top",cssClass:"custom-toast"})).present(),setTimeout(()=>{window.location.reload()},1500))}catch(i){console.error("Error switching unit:",i),S.value=(t=$.value)==null?void 0:t.id,await(await w.create({message:"Erro ao trocar de unidade",duration:3e3,color:"danger",position:"top"})).present()}},j=async()=>{try{await Promise.all([gs(),fs(),_s()]),c.value=g.value.length,l.value=R.value.length,L.value=!0,console.log("Stats loaded")}catch(a){console.error("Error loading stats:",a),L.value=!0}},{isRefreshing:B,hasUpdates:vs,forceRefresh:ms}=ie(j,{loadOnMount:!1,interval:15e3,onStatsUpdated:()=>{console.log("[Dashboard] Stats atualizados automaticamente")},debug:!1}),gs=async()=>{try{const t=await(await fetch("/api/checklists/active",M.getFetchConfig())).json();t.success&&(g.value=t.checklists)}catch(a){console.error("Erro ao carregar checklists ativos:",a)}},fs=async()=>{try{const t=await(await fetch("/api/machines/available",M.getFetchConfig())).json();t.success&&(O.value=t.machines)}catch(a){console.error("Erro ao carregar mÃ¡quinas disponÃ­veis:",a)}},_s=async()=>{try{const a=await fetch("/api/machines",M.getFetchConfig());if(!a.ok){console.warn("Failed to load machines: ".concat(a.status)),R.value=[];return}const t=await a.json();t.success&&t.machines?R.value=t.machines:R.value=[]}catch(a){console.error("Erro ao carregar mÃ¡quinas:",a),R.value=[]}},ks=async a=>{try{await Promise.all([X(),ms()]),await(await w.create({message:"Dados atualizados",duration:1500,color:"success",position:"top"})).present()}catch(t){console.error("Error refreshing:",t)}finally{a.target.complete()}},ws=async()=>{await(await K.create({header:"Confirmar SaÃ­da",message:"Deseja realmente sair do aplicativo?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Sair",role:"confirm",handler:async()=>{try{await x.execute(),await(await w.create({message:"Logout realizado com sucesso",duration:2e3,color:"success",position:"top"})).present(),m.replace("/login")}catch(t){console.error("Logout error:",t),m.replace("/login")}}}]})).present()},Cs=()=>{console.log("Navigating to new checklist..."),m.push("/checklist/new")},ys=()=>{console.log("Navigating to patients..."),m.push("/patients")},bs=()=>{console.log("Navigating to profile..."),m.push("/profile")},Y=()=>{console.log("Navigating to active checklists..."),m.push("/checklists")},Z=()=>{m.push("/machines")},$s=()=>{m.push("/machines-overview")},Ss=()=>{console.log("Navigating to cleaning controls..."),m.push("/cleaning-controls")},Os=a=>{m.push("/checklist/".concat(a.id))},Ds=async a=>{await(await K.create({header:"Pausar Checklist",message:"Deseja pausar o checklist da mÃ¡quina ".concat(a.machine.name,"?"),buttons:[{text:"Cancelar",role:"cancel"},{text:"Pausar",handler:async()=>{try{const f=await(await fetch("/api/checklists/".concat(a.id,"/pause"),{method:"POST",...M.getFetchConfig()})).json();if(f.success)await(await w.create({message:"Checklist pausado com sucesso.",duration:3e3,color:"success"})).present(),await j();else throw new Error(f.message)}catch(i){await(await w.create({message:"Erro ao pausar checklist.",duration:3e3,color:"danger"})).present()}}}]})).present()},Us=async a=>{try{const i=await(await fetch("/api/checklists/".concat(a.id,"/resume"),{method:"POST",...M.getFetchConfig()})).json();if(i.success)await(await w.create({message:"Checklist retomado com sucesso.",duration:3e3,color:"success"})).present(),await j();else throw new Error(i.message)}catch(t){await(await w.create({message:"Erro ao retomar checklist.",duration:3e3,color:"danger"})).present()}},Ms=async()=>{z(),await(await w.create({message:"Modo ".concat(E.value?"escuro":"claro"," ativado"),duration:1500,color:"medium",position:"bottom"})).present()},ss=()=>{A.value=navigator.onLine};return Ps(async()=>{console.log("Dashboard mounted, loading data..."),k.value=!0;try{await X(),j(),window.addEventListener("online",ss),window.addEventListener("offline",ss)}catch(a){console.error("Dashboard initialization error:",a)}finally{k.value=!1}}),(a,t)=>(p(),T(s(As),null,{default:r(()=>[o(s(Bs),null,{default:r(()=>[o(s(Rs),{color:"primary"},{default:r(()=>[o(s(Fs),null,{default:r(()=>[...t[0]||(t[0]=[D("HemodiÃ¡lise Mobile",-1)])]),_:1}),o(s(js),{slot:"end"},{default:r(()=>[o(s(I),{onClick:Ms,fill:"clear",class:"theme-toggle-btn"},{default:r(()=>[o(s(n),{icon:s(E)?s(Js):s(Ks),slot:"icon-only"},null,8,["icon"])]),_:1}),o(s(I),{onClick:ws,fill:"clear"},{default:r(()=>[o(s(n),{icon:s(Qs),slot:"icon-only"},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),o(s(xs),{fullscreen:!0,class:"dashboard-content"},{default:r(()=>{var i,f,h,U;return[o(s(Ns),{slot:"fixed",onIonRefresh:ks},{default:r(()=>[o(s(qs))]),_:1}),e("div",Se,[v.value?(p(),C("div",Oe,[e("div",De,[e("div",Ue,[e("h1",{onClick:bs,class:"user-name-link"},"OlÃ¡, "+d(v.value.name.split(" ")[0])+"! ðŸ‘‹",1)])]),e("div",Me,[P.value.length<=1?(p(),C("div",Ie,[o(s(n),{icon:s(is),class:"unit-icon-static"},null,8,["icon"]),e("div",Pe,[t[1]||(t[1]=e("span",{class:"unit-label-static"},"Unidade",-1)),e("span",Te,d(((i=$.value)==null?void 0:i.name)||((f=v.value.unit)==null?void 0:f.name)||"Carregando..."),1)])])):(p(),C("div",Ee,[o(s(n),{icon:s(is),class:"unit-icon"},null,8,["icon"]),e("div",ze,[t[2]||(t[2]=e("span",{class:"unit-label"},"Unidade Atual",-1)),e("span",Ae,d(((h=$.value)==null?void 0:h.name)||((U=v.value.unit)==null?void 0:U.name)||"Carregando..."),1)]),o(s(I),{fill:"clear",size:"small",onClick:hs,class:"unit-change-btn"},{default:r(()=>[o(s(n),{slot:"icon-only",icon:s(Ws)},null,8,["icon"])]),_:1})]))])])):b("",!0),L.value?(p(),C("div",Le,[s(vs)||s(B)?(p(),C("div",Re,[o(s(ts),{color:"success",class:"update-chip"},{default:r(()=>[o(s(n),{icon:s(B)?s(Xs):s(Ys),class:J({spinning:s(B)})},null,8,["icon","class"]),o(s(as),null,{default:r(()=>[D(d(s(B)?"Atualizando...":"Atualizado"),1)]),_:1})]),_:1})])):b("",!0),e("div",{class:"stat-card available",onClick:Z},[e("div",Fe,[o(s(n),{icon:s(cs)},null,8,["icon"])]),e("div",je,[e("div",Be,d(V.value),1),t[3]||(t[3]=e("div",{class:"stat-label"},"DisponÃ­veis",-1))])]),e("div",{class:"stat-card active",onClick:Y},[e("div",Ne,[o(s(n),{icon:s(Q)},null,8,["icon"])]),e("div",qe,[e("div",xe,d(H.value),1),t[4]||(t[4]=e("div",{class:"stat-label"},"Em Andamento",-1))])]),e("div",{class:"stat-card total",onClick:$s},[e("div",He,[o(s(n),{icon:s(Zs)},null,8,["icon"])]),e("div",Ve,[e("div",Ge,d(l.value),1),t[5]||(t[5]=e("div",{class:"stat-label"},"Total MÃ¡quinas",-1))])])])):b("",!0),e("div",Je,[e("button",{class:"primary-btn",onClick:Cs},[o(s(n),{icon:s(se)},null,8,["icon"]),t[6]||(t[6]=e("div",{class:"btn-text"},[e("span",{class:"btn-title"},"Novo Checklist"),e("span",{class:"btn-subtitle"},"Iniciar verificaÃ§Ã£o de seguranÃ§a")],-1)),V.value>0?(p(),T(s(rs),{key:0,color:"success"},{default:r(()=>[D(d(V.value),1)]),_:1})):b("",!0)])]),e("div",Ke,[t[11]||(t[11]=e("h2",{class:"section-title"},"Acesso RÃ¡pido",-1)),e("div",Qe,[H.value>0?(p(),C("div",{key:0,class:"action-btn",onClick:Y},[e("div",We,[o(s(n),{icon:s(Q)},null,8,["icon"])]),e("div",Xe,[t[7]||(t[7]=e("span",{class:"action-title"},"Checklists Ativos",-1)),e("span",Ye,d(H.value)+" em andamento",1)]),o(s(n),{icon:s(q),class:"chevron"},null,8,["icon"])])):b("",!0),e("div",{class:"action-btn",onClick:Z},[e("div",Ze,[o(s(n),{icon:s(cs)},null,8,["icon"])]),t[8]||(t[8]=e("div",{class:"action-content"},[e("span",{class:"action-title"},"MÃ¡quinas"),e("span",{class:"action-subtitle"},"Status e controle")],-1)),o(s(n),{icon:s(q),class:"chevron"},null,8,["icon"])]),e("div",{class:"action-btn",onClick:Ss},[e("div",st,[o(s(n),{icon:s(ee)},null,8,["icon"])]),t[9]||(t[9]=e("div",{class:"action-content"},[e("span",{class:"action-title"},"Controle de Limpeza"),e("span",{class:"action-subtitle"},"Limpeza e desinfecÃ§Ã£o")],-1)),o(s(n),{icon:s(q),class:"chevron"},null,8,["icon"])]),e("div",{class:"action-btn",onClick:ys},[e("div",et,[o(s(n),{icon:s(te)},null,8,["icon"])]),t[10]||(t[10]=e("div",{class:"action-content"},[e("span",{class:"action-title"},"Pacientes"),e("span",{class:"action-subtitle"},"Buscar e gerenciar")],-1)),o(s(n),{icon:s(q),class:"chevron"},null,8,["icon"])])])]),g.value.length>0?(p(),C("div",tt,[t[12]||(t[12]=e("h2",{class:"section-title"},"Em Andamento",-1)),e("div",at,[(p(!0),C(Es,null,zs(g.value,N=>(p(),T($e,{key:N.id,checklist:N,onContinue:Os,onPause:Ds,onResume:Us},null,8,["checklist"]))),128))])])):b("",!0),e("div",ot,[o(s(ts),{color:A.value?"success":"danger",class:"status-chip"},{default:r(()=>[o(s(n),{icon:s(ae)},null,8,["icon"]),o(s(as),null,{default:r(()=>[D(d(A.value?"Online":"Offline"),1)]),_:1})]),_:1},8,["color"])])])]}),_:1})]),_:1}))}}),dt=us(nt,[["__scopeId","data-v-5d8d2852"]]);export{dt as default};
