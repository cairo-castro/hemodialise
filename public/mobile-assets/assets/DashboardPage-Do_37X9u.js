import{d as le,c as y,n as C,q as p,t as s,v as o,G as d,x as r,H as I,y as e,I as Me,J as b,B as A,K as G,r as _,o as Ue,z as Ae,F as Pe,L as Te}from"./vendor-DcQkTNkg.js";import{j as ce,g as n,k as M,l as J,e as ze,t as w,m as ee,n as Ee,o as Le,p as Re,q as Be,r as je,s as qe,u as Ne,v as se,w as te,i as He}from"./ionic-GHA3wq_y.js";import{p as xe,d as Fe,t as X,f as ae,g as oe,i as Ve,_ as re,h as Ge,j as Je,k as Xe,n as ne,o as Ke,q as We,r as Qe,u as ie,m as Ye,v as Ze,w as N,x as es,y as ss,z as ts}from"./_plugin-vue_export-helper-Dt2dLz-X.js";import{C as as,u as os}from"./main-BVnbKpzf.js";import{u as ns}from"./useStatsAutoRefresh-YpkDCZnq.js";const is={class:"card-header"},ls={class:"machine-info"},cs={class:"machine-id"},rs={class:"patient-info"},us={class:"patient-name"},ds={class:"user-info"},hs={class:"user-name"},ps={class:"progress-section"},vs={class:"progress-bar"},ms={class:"progress-text"},gs={class:"time-info"},fs={class:"time-item"},_s={class:"time-value"},ks={key:0,class:"time-item"},ws={class:"time-value"},Cs={class:"actions"},ys=le({__name:"ActiveChecklistCard",props:{checklist:{}},emits:["continue","pause","resume"],setup(K,{emit:m}){const u=K,R=y(()=>({pre_dialysis:"PrÃ©-DiÃ¡lise",during_session:"Durante SessÃ£o",post_dialysis:"PÃ³s-DiÃ¡lise",completed:"ConcluÃ­do",interrupted:"Interrompido"})[u.checklist.current_phase]||u.checklist.current_phase),H=y(()=>({pre_dialysis:"primary",during_session:"warning",post_dialysis:"secondary",completed:"success",interrupted:"danger"})[u.checklist.current_phase]||"medium"),P=y(()=>u.checklist.current_phase.replace("_","-")),T=y(()=>u.checklist.phase_completion!==void 0?Math.round(u.checklist.phase_completion):{pre_dialysis:25,during_session:50,post_dialysis:75,completed:100,interrupted:0}[u.checklist.current_phase]||0),v=y(()=>{const l=new Date(u.checklist.created_at),k=new Date().getTime()-l.getTime(),g=Math.floor(k/(1e3*60*60)),O=Math.floor(k%(1e3*60*60)/(1e3*60));return g>0?"".concat(g,"h ").concat(O,"m"):"".concat(O,"m")}),z=y(()=>{if(!u.checklist.paused_at)return"";const l=new Date(u.checklist.paused_at),k=new Date().getTime()-l.getTime(),g=Math.floor(k/(1e3*60*60)),O=Math.floor(k%(1e3*60*60)/(1e3*60));return g>0?"".concat(g,"h ").concat(O,"m"):"".concat(O,"m")}),E=async()=>{await(await J.create({header:"Detalhes do Checklist",subHeader:"".concat(u.checklist.machine.name," - ").concat(u.checklist.patient.name),message:"\n      <strong>TÃ©cnico:</strong> ".concat(u.checklist.user.name,"<br>\n      <strong>Fase:</strong> ").concat(R.value,"<br>\n      <strong>Progresso:</strong> ").concat(T.value,"%<br>\n      <strong>Iniciado:</strong> ").concat(new Date(u.checklist.created_at).toLocaleString("pt-BR"),"<br>\n      ").concat(u.checklist.paused_at?"<strong>Pausado:</strong> ".concat(new Date(u.checklist.paused_at).toLocaleString("pt-BR"),"<br>"):"","\n    "),buttons:["Fechar"]})).present()};return(l,c)=>(p(),C("div",{class:G(["checklist-card",[P.value,{paused:l.checklist.paused_at}]])},[s("div",is,[s("div",ls,[s("h3",null,d(l.checklist.machine.name),1),s("p",cs,d(l.checklist.machine.identifier),1)]),o(e(ce),{color:H.value,class:"phase-badge"},{default:r(()=>[I(d(R.value),1)]),_:1},8,["color"])]),s("div",rs,[o(e(n),{icon:e(xe),class:"patient-icon"},null,8,["icon"]),s("span",us,d(l.checklist.patient.name),1)]),s("div",ds,[o(e(n),{icon:e(Fe),class:"user-icon"},null,8,["icon"]),c[3]||(c[3]=s("span",{class:"user-label"},"TÃ©cnico:",-1)),s("span",hs,d(l.checklist.user.name),1)]),s("div",ps,[s("div",vs,[s("div",{class:"progress-fill",style:Me({width:T.value+"%"})},null,4)]),s("span",ms,d(T.value)+"% completo",1)]),s("div",gs,[s("div",fs,[o(e(n),{icon:e(X),class:"time-icon"},null,8,["icon"]),c[4]||(c[4]=s("span",{class:"time-label"},"Iniciado hÃ¡",-1)),s("span",_s,d(v.value),1)]),l.checklist.paused_at?(p(),C("div",ks,[o(e(n),{icon:e(ae),class:"time-icon paused"},null,8,["icon"]),c[5]||(c[5]=s("span",{class:"time-label"},"Pausado hÃ¡",-1)),s("span",ws,d(z.value),1)])):b("",!0)]),s("div",Cs,[l.checklist.paused_at?b("",!0):(p(),A(e(M),{key:0,fill:"outline",size:"small",onClick:c[0]||(c[0]=k=>l.$emit("continue",l.checklist)),class:"action-button continue"},{default:r(()=>[o(e(n),{icon:e(oe),slot:"start"},null,8,["icon"]),c[6]||(c[6]=I(" Continuar ",-1))]),_:1})),l.checklist.paused_at?(p(),A(e(M),{key:1,fill:"solid",size:"small",onClick:c[1]||(c[1]=k=>l.$emit("resume",l.checklist)),class:"action-button resume",color:"success"},{default:r(()=>[o(e(n),{icon:e(oe),slot:"start"},null,8,["icon"]),c[7]||(c[7]=I(" Retomar ",-1))]),_:1})):b("",!0),l.checklist.paused_at?b("",!0):(p(),A(e(M),{key:2,fill:"outline",size:"small",onClick:c[2]||(c[2]=k=>l.$emit("pause",l.checklist)),class:"action-button pause",color:"warning"},{default:r(()=>[o(e(n),{icon:e(ae),slot:"start"},null,8,["icon"]),c[8]||(c[8]=I(" Pausar ",-1))]),_:1})),o(e(M),{fill:"clear",size:"small",onClick:E,class:"action-button details"},{default:r(()=>[o(e(n),{icon:e(Ve),slot:"icon-only"},null,8,["icon"])]),_:1})]),s("div",{class:G(["status-indicator",P.value])},null,2)],2))}}),bs=re(ys,[["__scopeId","data-v-279d50f9"]]),$s={class:"dashboard-container"},Ss={key:0,class:"welcome-section"},Os={class:"welcome-header"},Is={class:"welcome-text"},Ds={class:"unit-display"},Ms={key:0,class:"unit-info-static"},Us={class:"unit-text-static"},As={class:"unit-name-static"},Ps={key:1,class:"unit-info"},Ts={class:"unit-text"},zs={class:"unit-name"},Es={key:1,class:"quick-stats"},Ls={key:0,class:"stats-update-badge"},Rs={class:"stat-icon"},Bs={class:"stat-content"},js={class:"stat-number"},qs={class:"stat-icon"},Ns={class:"stat-content"},Hs={class:"stat-number"},xs={class:"stat-icon"},Fs={class:"stat-content"},Vs={class:"stat-number"},Gs={class:"primary-action"},Js={class:"section"},Xs={class:"quick-actions"},Ks={class:"action-icon warning"},Ws={class:"action-content"},Qs={class:"action-subtitle"},Ys={class:"action-icon tertiary"},Zs={class:"action-icon cleaning"},et={class:"action-icon primary"},st={key:2,class:"section"},tt={class:"checklists-list"},at={class:"connection-status"},ot=le({__name:"DashboardPage",setup(K){const m=Ae(),u=as.getInstance(),R=u.getCurrentUserUseCase(),H=u.getLogoutUseCase(),{isDarkMode:P,toggleDarkMode:T}=os(),v=_(null),z=_(navigator.onLine),E=_(!1),l=_(0),c=_(3),k=_(!1),g=_([]),O=_([]),L=_([]),U=_([]),$=_(null),S=_(null);y(()=>v.value&&{tecnico:"TÃ©cnico",admin:"Admin",gestor:"Gestor",coordenador:"Coordenador",supervisor:"Supervisor"}[v.value.role]||"UsuÃ¡rio");const x=y(()=>g.value.filter(a=>!a.paused_at).length);y(()=>g.value.filter(a=>a.paused_at).length);const F=y(()=>O.value.length),W=async()=>{try{v.value=await R.execute(),console.log("User loaded:",v.value),await ue()}catch(a){console.error("Error loading user:",a),await(await w.create({message:"Erro ao carregar dados do usuÃ¡rio",duration:3e3,color:"danger",position:"top"})).present(),setTimeout(()=>{m.replace("/login")},2e3)}},ue=async()=>{var a,t,i;try{const h=await(await fetch("/api/user-units",{credentials:"include",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();if(h.success){U.value=h.units||[];const D=h.current_unit_id;D?($.value=h.units.find(q=>q.id===D),S.value=D,console.log("Unidade jÃ¡ selecionada:",(a=$.value)==null?void 0:a.name)):h.units.length===1?(console.log("Apenas uma unidade disponÃ­vel, selecionando automaticamente..."),await V(h.units[0].id),$.value=h.units[0],S.value=h.units[0].id):h.units.length>1&&(console.log("MÃºltiplas unidades disponÃ­veis, forÃ§ando seleÃ§Ã£o..."),setTimeout(()=>{he()},500)),console.log("Unidades carregadas (mobile):",{total:U.value.length,current:(t=$.value)==null?void 0:t.name,currentId:S.value})}}catch(f){console.error("Error loading available units:",f),(i=v.value)!=null&&i.unit&&($.value=v.value.unit,S.value=v.value.unit.id,U.value=v.value.units||[v.value.unit])}},de=async()=>{const a=U.value.map(i=>({text:i.id===S.value?"âœ“ ".concat(i.name):i.name,cssClass:i.id===S.value?"unit-selected":"",handler:()=>{i.id!==S.value&&V(i.id)}}));a.push({text:"Cancelar",role:"cancel",handler:()=>{}}),await(await ee.create({header:"Selecionar Unidade",subHeader:"Escolha a unidade para visualizar",buttons:a,cssClass:"unit-selector-action-sheet"})).present()},he=async()=>{const a=U.value.map(i=>({text:i.name,handler:()=>{V(i.id)}}));await(await ee.create({header:"Selecione uma Unidade",subHeader:"Por favor, escolha a unidade para continuar",buttons:a,backdropDismiss:!1,cssClass:"unit-selector-action-sheet mandatory-selection"})).present()},V=async a=>{var t;try{const i=await Ee.create({message:"Alternando unidade...",spinner:"crescent",duration:1e4});await i.present();const h=await(await fetch("/api/user-units/switch",{method:"POST",...AuthService.getFetchConfig({body:JSON.stringify({unit_id:a})})})).json();await i.dismiss(),h.success&&($.value=h.current_unit,S.value=a,await(await w.create({message:"ðŸ“ Unidade alterada para ".concat(h.current_unit.name),duration:1500,color:"success",position:"top",cssClass:"custom-toast"})).present(),setTimeout(()=>{window.location.reload()},1500))}catch(i){console.error("Error switching unit:",i),S.value=(t=$.value)==null?void 0:t.id,await(await w.create({message:"Erro ao trocar de unidade",duration:3e3,color:"danger",position:"top"})).present()}},B=async()=>{try{await Promise.all([me(),ge(),fe()]),l.value=g.value.length,c.value=L.value.length,E.value=!0,console.log("Stats loaded")}catch(a){console.error("Error loading stats:",a),E.value=!0}},{isRefreshing:j,hasUpdates:pe,forceRefresh:ve}=ns(B,{loadOnMount:!1,interval:15e3,onStatsUpdated:()=>{console.log("[Dashboard] Stats atualizados automaticamente")},debug:!1}),me=async()=>{try{const t=await(await fetch("/api/checklists/active",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();t.success&&(g.value=t.checklists)}catch(a){console.error("Erro ao carregar checklists ativos:",a)}},ge=async()=>{try{const t=await(await fetch("/api/machines/available",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();t.success&&(O.value=t.machines)}catch(a){console.error("Erro ao carregar mÃ¡quinas disponÃ­veis:",a)}},fe=async()=>{try{const a=await fetch("/api/machines",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token")),"Content-Type":"application/json",Accept:"application/json"}});if(!a.ok){console.warn("Failed to load machines: ".concat(a.status)),L.value=[];return}const t=await a.json();t.success&&t.machines?L.value=t.machines:L.value=[]}catch(a){console.error("Erro ao carregar mÃ¡quinas:",a),L.value=[]}},_e=async a=>{try{await Promise.all([W(),ve()]),await(await w.create({message:"Dados atualizados",duration:1500,color:"success",position:"top"})).present()}catch(t){console.error("Error refreshing:",t)}finally{a.target.complete()}},ke=async()=>{await(await J.create({header:"Confirmar SaÃ­da",message:"Deseja realmente sair do aplicativo?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Sair",role:"confirm",handler:async()=>{try{await H.execute(),await(await w.create({message:"Logout realizado com sucesso",duration:2e3,color:"success",position:"top"})).present(),m.replace("/login")}catch(t){console.error("Logout error:",t),m.replace("/login")}}}]})).present()},we=()=>{console.log("Navigating to new checklist..."),m.push("/checklist/new")},Ce=()=>{console.log("Navigating to patients..."),m.push("/patients")},ye=()=>{console.log("Navigating to profile..."),m.push("/profile")},Q=()=>{console.log("Navigating to active checklists..."),m.push("/checklists")},Y=()=>{m.push("/machines")},be=()=>{m.push("/machines-overview")},$e=()=>{console.log("Navigating to cleaning controls..."),m.push("/cleaning-controls")},Se=a=>{m.push("/checklist/".concat(a.id))},Oe=async a=>{await(await J.create({header:"Pausar Checklist",message:"Deseja pausar o checklist da mÃ¡quina ".concat(a.machine.name,"?"),buttons:[{text:"Cancelar",role:"cancel"},{text:"Pausar",handler:async()=>{try{const f=await(await fetch("/api/checklists/".concat(a.id,"/pause"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();if(f.success)await(await w.create({message:"Checklist pausado com sucesso.",duration:3e3,color:"success"})).present(),await B();else throw new Error(f.message)}catch(i){await(await w.create({message:"Erro ao pausar checklist.",duration:3e3,color:"danger"})).present()}}}]})).present()},Ie=async a=>{try{const i=await(await fetch("/api/checklists/".concat(a.id,"/resume"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();if(i.success)await(await w.create({message:"Checklist retomado com sucesso.",duration:3e3,color:"success"})).present(),await B();else throw new Error(i.message)}catch(t){await(await w.create({message:"Erro ao retomar checklist.",duration:3e3,color:"danger"})).present()}},De=async()=>{T(),await(await w.create({message:"Modo ".concat(P.value?"escuro":"claro"," ativado"),duration:1500,color:"medium",position:"bottom"})).present()},Z=()=>{z.value=navigator.onLine};return Ue(async()=>{console.log("Dashboard mounted, loading data..."),k.value=!0;try{await W(),B(),window.addEventListener("online",Z),window.addEventListener("offline",Z)}catch(a){console.error("Dashboard initialization error:",a)}finally{k.value=!1}}),(a,t)=>(p(),A(e(ze),null,{default:r(()=>[o(e(je),null,{default:r(()=>[o(e(Le),{color:"primary"},{default:r(()=>[o(e(Re),null,{default:r(()=>[...t[0]||(t[0]=[I("HemodiÃ¡lise Mobile",-1)])]),_:1}),o(e(Be),{slot:"end"},{default:r(()=>[o(e(M),{onClick:De,fill:"clear",class:"theme-toggle-btn"},{default:r(()=>[o(e(n),{icon:e(P)?e(Ge):e(Je),slot:"icon-only"},null,8,["icon"])]),_:1}),o(e(M),{onClick:ke,fill:"clear"},{default:r(()=>[o(e(n),{icon:e(Xe),slot:"icon-only"},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),o(e(He),{fullscreen:!0,class:"dashboard-content"},{default:r(()=>{var i,f,h,D;return[o(e(qe),{slot:"fixed",onIonRefresh:_e},{default:r(()=>[o(e(Ne))]),_:1}),s("div",$s,[v.value?(p(),C("div",Ss,[s("div",Os,[s("div",Is,[s("h1",{onClick:ye,class:"user-name-link"},"OlÃ¡, "+d(v.value.name.split(" ")[0])+"! ðŸ‘‹",1)])]),s("div",Ds,[U.value.length<=1?(p(),C("div",Ms,[o(e(n),{icon:e(ne),class:"unit-icon-static"},null,8,["icon"]),s("div",Us,[t[1]||(t[1]=s("span",{class:"unit-label-static"},"Unidade",-1)),s("span",As,d(((i=$.value)==null?void 0:i.name)||((f=v.value.unit)==null?void 0:f.name)||"Carregando..."),1)])])):(p(),C("div",Ps,[o(e(n),{icon:e(ne),class:"unit-icon"},null,8,["icon"]),s("div",Ts,[t[2]||(t[2]=s("span",{class:"unit-label"},"Unidade Atual",-1)),s("span",zs,d(((h=$.value)==null?void 0:h.name)||((D=v.value.unit)==null?void 0:D.name)||"Carregando..."),1)]),o(e(M),{fill:"clear",size:"small",onClick:de,class:"unit-change-btn"},{default:r(()=>[o(e(n),{slot:"icon-only",icon:e(Ke)},null,8,["icon"])]),_:1})]))])])):b("",!0),E.value?(p(),C("div",Es,[e(pe)||e(j)?(p(),C("div",Ls,[o(e(se),{color:"success",class:"update-chip"},{default:r(()=>[o(e(n),{icon:e(j)?e(We):e(Qe),class:G({spinning:e(j)})},null,8,["icon","class"]),o(e(te),null,{default:r(()=>[I(d(e(j)?"Atualizando...":"Atualizado"),1)]),_:1})]),_:1})])):b("",!0),s("div",{class:"stat-card available",onClick:Y},[s("div",Rs,[o(e(n),{icon:e(ie)},null,8,["icon"])]),s("div",Bs,[s("div",js,d(F.value),1),t[3]||(t[3]=s("div",{class:"stat-label"},"DisponÃ­veis",-1))])]),s("div",{class:"stat-card active",onClick:Q},[s("div",qs,[o(e(n),{icon:e(X)},null,8,["icon"])]),s("div",Ns,[s("div",Hs,d(x.value),1),t[4]||(t[4]=s("div",{class:"stat-label"},"Em Andamento",-1))])]),s("div",{class:"stat-card total",onClick:be},[s("div",xs,[o(e(n),{icon:e(Ye)},null,8,["icon"])]),s("div",Fs,[s("div",Vs,d(c.value),1),t[5]||(t[5]=s("div",{class:"stat-label"},"Total MÃ¡quinas",-1))])])])):b("",!0),s("div",Gs,[s("button",{class:"primary-btn",onClick:we},[o(e(n),{icon:e(Ze)},null,8,["icon"]),t[6]||(t[6]=s("div",{class:"btn-text"},[s("span",{class:"btn-title"},"Novo Checklist"),s("span",{class:"btn-subtitle"},"Iniciar verificaÃ§Ã£o de seguranÃ§a")],-1)),F.value>0?(p(),A(e(ce),{key:0,color:"success"},{default:r(()=>[I(d(F.value),1)]),_:1})):b("",!0)])]),s("div",Js,[t[11]||(t[11]=s("h2",{class:"section-title"},"Acesso RÃ¡pido",-1)),s("div",Xs,[x.value>0?(p(),C("div",{key:0,class:"action-btn",onClick:Q},[s("div",Ks,[o(e(n),{icon:e(X)},null,8,["icon"])]),s("div",Ws,[t[7]||(t[7]=s("span",{class:"action-title"},"Checklists Ativos",-1)),s("span",Qs,d(x.value)+" em andamento",1)]),o(e(n),{icon:e(N),class:"chevron"},null,8,["icon"])])):b("",!0),s("div",{class:"action-btn",onClick:Y},[s("div",Ys,[o(e(n),{icon:e(ie)},null,8,["icon"])]),t[8]||(t[8]=s("div",{class:"action-content"},[s("span",{class:"action-title"},"MÃ¡quinas"),s("span",{class:"action-subtitle"},"Status e controle")],-1)),o(e(n),{icon:e(N),class:"chevron"},null,8,["icon"])]),s("div",{class:"action-btn",onClick:$e},[s("div",Zs,[o(e(n),{icon:e(es)},null,8,["icon"])]),t[9]||(t[9]=s("div",{class:"action-content"},[s("span",{class:"action-title"},"Controle de Limpeza"),s("span",{class:"action-subtitle"},"Limpeza e desinfecÃ§Ã£o")],-1)),o(e(n),{icon:e(N),class:"chevron"},null,8,["icon"])]),s("div",{class:"action-btn",onClick:Ce},[s("div",et,[o(e(n),{icon:e(ss)},null,8,["icon"])]),t[10]||(t[10]=s("div",{class:"action-content"},[s("span",{class:"action-title"},"Pacientes"),s("span",{class:"action-subtitle"},"Buscar e gerenciar")],-1)),o(e(n),{icon:e(N),class:"chevron"},null,8,["icon"])])])]),g.value.length>0?(p(),C("div",st,[t[12]||(t[12]=s("h2",{class:"section-title"},"Em Andamento",-1)),s("div",tt,[(p(!0),C(Pe,null,Te(g.value,q=>(p(),A(bs,{key:q.id,checklist:q,onContinue:Se,onPause:Oe,onResume:Ie},null,8,["checklist"]))),128))])])):b("",!0),s("div",at,[o(e(se),{color:z.value?"success":"danger",class:"status-chip"},{default:r(()=>[o(e(n),{icon:e(ts)},null,8,["icon"]),o(e(te),null,{default:r(()=>[I(d(z.value?"Online":"Offline"),1)]),_:1})]),_:1},8,["color"])])])]}),_:1})]),_:1}))}}),ut=re(ot,[["__scopeId","data-v-5967e8a1"]]);export{ut as default};
