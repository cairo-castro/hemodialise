import{d as Z,r as _,c as p,o as ee,B as y,q as u,x as m,y as t,v as s,H as C,t as n,n as f,J as h,I as ne,G as g,K as c,L as te,F as ae,C as se,z as ie}from"./vendor-CuvbB8Nv.js";import{t as V,e as le,o as oe,q as ce,x as ue,p as re,r as de,g as o,O as z,E as B,P as E,Q as me,G as ve,k as pe,i as fe,l as O}from"./ionic-DQSKESAG.js";import{r as w,E as T,G as P,m as H,t as ge,h as be,M as _e,j as Ce,N as he,H as ke,a4 as ye,F as we,L,D,K as S,a5 as I,U as Ne,i as Oe,_ as De}from"./_plugin-vue_export-helper-Dt2dLz-X.js";import{C as Se,A as Ie}from"./main-B44L1NYL.js";const xe={class:"progress-bar"},Ae={class:"availability-icon"},qe={class:"availability-info"},Me={class:"availability-label"},$e={class:"availability-count"},Ve={class:"form-container"},ze={class:"step-card"},Be={class:"form-group"},Ee={class:"input-label"},Te={class:"machine-grid"},Pe=["onClick"],He={class:"machine-icon"},Le={class:"machine-info"},Ue={class:"machine-name"},Fe={key:0,class:"machine-check"},Ke={key:0,class:"no-machines-message"},Re={class:"form-group"},je={class:"input-label"},Ge={class:"shift-selector"},Je={class:"form-group"},Qe={class:"input-label"},We={class:"step-card"},Xe={class:"toggle-content"},Ye={class:"toggle-text"},Ze={class:"toggle-hint"},en={key:0,class:"time-selector"},nn={class:"step-card"},tn={class:"legend-pills"},an={class:"legend-pill conforme"},sn={class:"legend-pill nao-conforme"},ln={class:"legend-pill nao-aplica"},on={class:"cleaning-items"},cn={class:"cleaning-item-card"},un={class:"item-header"},rn={class:"conformity-buttons"},dn={class:"cleaning-item-card"},mn={class:"item-header"},vn={class:"conformity-buttons"},pn={class:"cleaning-item-card"},fn={class:"item-header"},gn={class:"conformity-buttons"},bn={class:"step-card optional"},_n={key:0,class:"completion-info"},Cn=Z({__name:"CleaningChecklistNewPage",setup(hn){const x=Se.getInstance(),U=x.getCreateCleaningChecklistUseCase(),F=x.getMachineRepository(),K=ie(),k=_([]),b=_(!1),r=_(null),a=_({machine_id:0,checklist_date:new Date().toISOString(),shift:"1",chemical_disinfection_time:void 0,chemical_disinfection_completed:!1,hd_machine_cleaning:void 0,osmosis_cleaning:void 0,serum_support_cleaning:void 0,observations:void 0}),R={matutino:"1",vespertino:"2",noturno:"3",madrugada:"4"},d=_("matutino"),j=p(()=>new Date().toISOString()),G=p(()=>{const l=new Date;return l.setHours(l.getHours()-72),l.toISOString()}),A=p(()=>a.value.machine_id>0&&a.value.checklist_date&&a.value.shift),J=p(()=>{let l=0;const e=6;return a.value.machine_id>0&&l++,a.value.checklist_date&&l++,d.value&&l++,a.value.hd_machine_cleaning&&l++,a.value.osmosis_cleaning&&l++,a.value.serum_support_cleaning&&l++,l/e*100});p(()=>k.value.length);const q=p(()=>{let l=0;const e=3;return a.value.hd_machine_cleaning&&l++,a.value.osmosis_cleaning&&l++,a.value.serum_support_cleaning&&l++,l/e*100}),Q=p(()=>{const l=q.value;return l===0?"Preencha os itens de limpeza de superfície":l<100?"".concat(Math.round(l),"% completo - Continue preenchendo"):"Checklist completo!"});ee(async()=>{try{k.value=await F.getAvailable(),await M()}catch(l){console.error("Error loading machines:",l),await(await V.create({message:"Erro ao carregar máquinas",duration:2e3,color:"danger"})).present()}});const M=async()=>{try{const l=await fetch("/api/machines/availability",Ie.getFetchConfig());if(!l.ok)throw new Error("Failed to fetch machine availability");const e=await l.json();r.value=e.availability}catch(l){console.error("Error fetching machine availability:",l)}},W=async()=>{if(await M(),!r.value)return{canCreate:!0};const{available:l,overall_status:e,message:i}=r.value;if(l===0)return await(await O.create({header:"Máquinas Indisponíveis",message:"Não há máquinas disponíveis no momento. Por favor, aguarde até que uma máquina fique disponível para realizar a limpeza.",buttons:["OK"]})).present(),{canCreate:!1};if(e==="warning"||e==="alert"){const v=await O.create({header:"Atenção",message:"".concat(i,". Apenas ").concat(l," máquina(s) disponível(is). Deseja continuar com o checklist de limpeza?"),buttons:[{text:"Cancelar",role:"cancel"},{text:"Continuar",role:"confirm"}]});await v.present();const{role:N}=await v.onDidDismiss();return{canCreate:N==="confirm"}}return{canCreate:!0}},X=async()=>{if(!(!A.value||b.value||!(await W()).canCreate)){b.value=!0;try{const i=new Date(a.value.checklist_date).toISOString().split("T")[0];let v;if(a.value.chemical_disinfection_completed&&a.value.chemical_disinfection_time){const $=new Date(a.value.chemical_disinfection_time);v="".concat(String($.getHours()).padStart(2,"0"),":").concat(String($.getMinutes()).padStart(2,"0"))}const N=R[d.value],Y={...a.value,shift:N,checklist_date:i,chemical_disinfection_time:v};await U.execute(Y),await(await V.create({message:"Checklist salvo com sucesso!",duration:2e3,color:"success"})).present(),K.push("/cleaning-controls")}catch(e){console.error("Error creating checklist:",e);let i="Erro ao salvar checklist";e.message&&e.message.includes("Já existe")&&(i="Já existe um checklist para esta máquina, data e turno"),await(await O.create({header:"Erro",message:i,buttons:["OK"]})).present()}finally{b.value=!1}}};return(l,e)=>(u(),y(t(le),null,{default:m(()=>[s(t(de),null,{default:m(()=>[s(t(oe),{color:"primary"},{default:m(()=>[s(t(ce),{slot:"start"},{default:m(()=>[s(t(ue),{"default-href":"/cleaning-controls"})]),_:1}),s(t(re),null,{default:m(()=>[...e[19]||(e[19]=[C("Checklist de Limpeza",-1)])]),_:1})]),_:1})]),_:1}),s(t(fe),{fullscreen:!0,class:"cleaning-checklist-content"},{default:m(()=>[n("div",xe,[n("div",{class:"progress-fill",style:ne({width:J.value+"%"})},null,4)]),r.value?(u(),f("div",{key:0,class:c(["availability-badge",r.value.overall_status])},[n("div",Ae,[r.value.overall_status==="good"?(u(),y(t(o),{key:0,icon:t(w)},null,8,["icon"])):r.value.overall_status==="critical"?(u(),y(t(o),{key:1,icon:t(T)},null,8,["icon"])):(u(),y(t(o),{key:2,icon:t(P)},null,8,["icon"]))]),n("div",qe,[n("span",Me,g(r.value.message),1),n("span",$e,g(r.value.available)+" de "+g(r.value.total)+" disponíveis para limpeza ",1)])],2)):h("",!0),n("div",Ve,[n("div",ze,[e[34]||(e[34]=n("div",{class:"step-header"},[n("div",{class:"step-number"},"1"),n("h2",null,"Máquina e Turno")],-1)),n("div",Be,[n("label",Ee,[s(t(o),{icon:t(H)},null,8,["icon"]),e[20]||(e[20]=C(" Selecione a Máquina para Limpeza ",-1))]),n("div",Te,[(u(!0),f(ae,null,te(k.value,i=>(u(),f("button",{key:i.id,type:"button",class:c(["machine-card",{selected:a.value.machine_id===i.id}]),onClick:v=>a.value.machine_id=i.id},[n("div",He,[s(t(o),{icon:t(L)},null,8,["icon"])]),n("div",Le,[n("span",Ue,g(i.name),1),e[21]||(e[21]=n("span",{class:"machine-status"},"Disponível",-1))]),a.value.machine_id===i.id?(u(),f("div",Fe,[s(t(o),{icon:t(w)},null,8,["icon"])])):h("",!0)],10,Pe))),128))]),k.value.length===0?(u(),f("div",Ke,[s(t(o),{icon:t(P)},null,8,["icon"]),e[22]||(e[22]=n("p",null,"Nenhuma máquina disponível no momento. Aguarde até que uma máquina fique disponível.",-1))])):h("",!0)]),n("div",Re,[n("label",je,[s(t(o),{icon:t(ge)},null,8,["icon"]),e[23]||(e[23]=C(" Selecione o Turno da Limpeza ",-1))]),n("div",Ge,[n("button",{type:"button",class:c(["shift-btn",{active:d.value==="matutino"}]),onClick:e[0]||(e[0]=i=>d.value="matutino")},[s(t(o),{icon:t(be)},null,8,["icon"]),e[24]||(e[24]=n("span",null,"Matutino",-1)),e[25]||(e[25]=n("span",{class:"shift-time"},"06:00 - 12:00",-1))],2),n("button",{type:"button",class:c(["shift-btn",{active:d.value==="vespertino"}]),onClick:e[1]||(e[1]=i=>d.value="vespertino")},[s(t(o),{icon:t(_e)},null,8,["icon"]),e[26]||(e[26]=n("span",null,"Vespertino",-1)),e[27]||(e[27]=n("span",{class:"shift-time"},"12:00 - 18:00",-1))],2),n("button",{type:"button",class:c(["shift-btn",{active:d.value==="noturno"}]),onClick:e[2]||(e[2]=i=>d.value="noturno")},[s(t(o),{icon:t(Ce)},null,8,["icon"]),e[28]||(e[28]=n("span",null,"Noturno",-1)),e[29]||(e[29]=n("span",{class:"shift-time"},"18:00 - 00:00",-1))],2),n("button",{type:"button",class:c(["shift-btn",{active:d.value==="madrugada"}]),onClick:e[3]||(e[3]=i=>d.value="madrugada")},[s(t(o),{icon:t(he)},null,8,["icon"]),e[30]||(e[30]=n("span",null,"Madrugada",-1)),e[31]||(e[31]=n("span",{class:"shift-time"},"00:00 - 06:00",-1))],2)])]),n("div",Je,[n("label",Qe,[s(t(o),{icon:t(ke)},null,8,["icon"]),e[32]||(e[32]=C(" Data da Limpeza ",-1))]),s(t(z),{datetime:"checklist-date",class:"date-btn"}),s(t(B),{"keep-contents-mounted":!0},{default:m(()=>[s(t(E),{id:"checklist-date",modelValue:a.value.checklist_date,"onUpdate:modelValue":e[4]||(e[4]=i=>a.value.checklist_date=i),presentation:"date",min:G.value,max:j.value},null,8,["modelValue","min","max"])]),_:1}),e[33]||(e[33]=n("p",{class:"datetime-hint"},"Pode registrar até 3 dias atrás",-1))])]),n("div",We,[e[37]||(e[37]=n("div",{class:"step-header"},[n("div",{class:"step-number"},"2"),n("h2",null,"Desinfecção Química")],-1)),n("div",{class:"toggle-card",onClick:e[7]||(e[7]=i=>a.value.chemical_disinfection_completed=!a.value.chemical_disinfection_completed)},[n("div",Xe,[s(t(o),{icon:t(ye),class:"toggle-icon"},null,8,["icon"]),n("div",Ye,[e[35]||(e[35]=n("span",{class:"toggle-title"},"Desinfecção Realizada?",-1)),n("span",Ze,"Toque para "+g(a.value.chemical_disinfection_completed?"desmarcar":"marcar"),1)])]),s(t(me),{modelValue:a.value.chemical_disinfection_completed,"onUpdate:modelValue":e[5]||(e[5]=i=>a.value.chemical_disinfection_completed=i),onClick:e[6]||(e[6]=se(()=>{},["stop"]))},null,8,["modelValue"])]),a.value.chemical_disinfection_completed?(u(),f("div",en,[e[36]||(e[36]=n("label",{class:"quick-label"},"Horário da Desinfecção",-1)),s(t(z),{datetime:"disinfection-time",class:"time-btn"}),s(t(B),{"keep-contents-mounted":!0},{default:m(()=>[s(t(E),{id:"disinfection-time",modelValue:a.value.chemical_disinfection_time,"onUpdate:modelValue":e[8]||(e[8]=i=>a.value.chemical_disinfection_time=i),presentation:"time"},null,8,["modelValue"])]),_:1})])):h("",!0)]),n("div",nn,[e[53]||(e[53]=n("div",{class:"step-header"},[n("div",{class:"step-number"},"3"),n("div",{class:"step-header-text"},[n("h2",null,"Limpeza de Superfície"),n("p",{class:"step-legend"},"Marque a conformidade de cada item")])],-1)),n("div",tn,[n("div",an,[s(t(o),{icon:t(w)},null,8,["icon"]),e[38]||(e[38]=n("span",null,"C - Conforme",-1))]),n("div",sn,[s(t(o),{icon:t(T)},null,8,["icon"]),e[39]||(e[39]=n("span",null,"NC - Não Conforme",-1))]),n("div",ln,[s(t(o),{icon:t(we)},null,8,["icon"]),e[40]||(e[40]=n("span",null,"NA - Não se Aplica",-1))])]),n("div",on,[n("div",cn,[n("div",un,[s(t(o),{icon:t(L),class:"item-icon hd"},null,8,["icon"]),e[41]||(e[41]=n("span",{class:"item-name"},"Máquina de HD",-1))]),n("div",rn,[n("button",{onClick:e[9]||(e[9]=i=>a.value.hd_machine_cleaning="C"),class:c(["conf-btn","conforme",{active:a.value.hd_machine_cleaning==="C"}])},[s(t(o),{icon:t(D)},null,8,["icon"]),e[42]||(e[42]=n("span",null,"C",-1))],2),n("button",{onClick:e[10]||(e[10]=i=>a.value.hd_machine_cleaning="NC"),class:c(["conf-btn","nao-conforme",{active:a.value.hd_machine_cleaning==="NC"}])},[s(t(o),{icon:t(S)},null,8,["icon"]),e[43]||(e[43]=n("span",null,"NC",-1))],2),n("button",{onClick:e[11]||(e[11]=i=>a.value.hd_machine_cleaning="NA"),class:c(["conf-btn","nao-aplica",{active:a.value.hd_machine_cleaning==="NA"}])},[s(t(o),{icon:t(I)},null,8,["icon"]),e[44]||(e[44]=n("span",null,"NA",-1))],2)])]),n("div",dn,[n("div",mn,[s(t(o),{icon:t(Ne),class:"item-icon osmose"},null,8,["icon"]),e[45]||(e[45]=n("span",{class:"item-name"},"Osmose",-1))]),n("div",vn,[n("button",{onClick:e[12]||(e[12]=i=>a.value.osmosis_cleaning="C"),class:c(["conf-btn","conforme",{active:a.value.osmosis_cleaning==="C"}])},[s(t(o),{icon:t(D)},null,8,["icon"]),e[46]||(e[46]=n("span",null,"C",-1))],2),n("button",{onClick:e[13]||(e[13]=i=>a.value.osmosis_cleaning="NC"),class:c(["conf-btn","nao-conforme",{active:a.value.osmosis_cleaning==="NC"}])},[s(t(o),{icon:t(S)},null,8,["icon"]),e[47]||(e[47]=n("span",null,"NC",-1))],2),n("button",{onClick:e[14]||(e[14]=i=>a.value.osmosis_cleaning="NA"),class:c(["conf-btn","nao-aplica",{active:a.value.osmosis_cleaning==="NA"}])},[s(t(o),{icon:t(I)},null,8,["icon"]),e[48]||(e[48]=n("span",null,"NA",-1))],2)])]),n("div",pn,[n("div",fn,[s(t(o),{icon:t(H),class:"item-icon soro"},null,8,["icon"]),e[49]||(e[49]=n("span",{class:"item-name"},"Suporte de Soro",-1))]),n("div",gn,[n("button",{onClick:e[15]||(e[15]=i=>a.value.serum_support_cleaning="C"),class:c(["conf-btn","conforme",{active:a.value.serum_support_cleaning==="C"}])},[s(t(o),{icon:t(D)},null,8,["icon"]),e[50]||(e[50]=n("span",null,"C",-1))],2),n("button",{onClick:e[16]||(e[16]=i=>a.value.serum_support_cleaning="NC"),class:c(["conf-btn","nao-conforme",{active:a.value.serum_support_cleaning==="NC"}])},[s(t(o),{icon:t(S)},null,8,["icon"]),e[51]||(e[51]=n("span",null,"NC",-1))],2),n("button",{onClick:e[17]||(e[17]=i=>a.value.serum_support_cleaning="NA"),class:c(["conf-btn","nao-aplica",{active:a.value.serum_support_cleaning==="NA"}])},[s(t(o),{icon:t(I)},null,8,["icon"]),e[52]||(e[52]=n("span",null,"NA",-1))],2)])])])]),n("div",bn,[e[54]||(e[54]=n("div",{class:"step-header"},[n("div",{class:"step-number optional"},"4"),n("div",{class:"step-header-text"},[n("h2",null,"Observações"),n("span",{class:"optional-badge"},"Opcional")])],-1)),s(t(ve),{modelValue:a.value.observations,"onUpdate:modelValue":e[18]||(e[18]=i=>a.value.observations=i),placeholder:"Adicione observações sobre a limpeza (opcional)...",rows:3,"auto-grow":"",class:"obs-textarea"},null,8,["modelValue"])]),s(t(pe),{expand:"block",onClick:X,disabled:!A.value||b.value,class:"submit-button",size:"large"},{default:m(()=>[s(t(o),{slot:"start",icon:t(w)},null,8,["icon"]),C(" "+g(b.value?"Salvando...":"Concluir Checklist"),1)]),_:1},8,["disabled"]),q.value<100?(u(),f("div",_n,[s(t(o),{icon:t(Oe)},null,8,["icon"]),n("span",null,g(Q.value),1)])):h("",!0)])]),_:1})]),_:1}))}}),Dn=De(Cn,[["__scopeId","data-v-f0cedefd"]]);export{Dn as default};
