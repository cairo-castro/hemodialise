import{d as G,r as c,c as D,o as H,B as L,q as y,x as l,y as a,v as o,H as m,t as s,n as I,J as B,G as p,C as M,z as $}from"./vendor-DcQkTNkg.js";import{A as P}from"./main-ssEl3vM3.js";import{e as K,t as w,o as Q,q as W,x as X,p as Y,r as Z,s as ee,u as ae,f as oe,B as V,C as k,g as d,j as se,M as x,N as E,J as b,k as C,i as le,l as te}from"./ionic-GHA3wq_y.js";import{d as ne,n as re,V as ie,e as O,b as A,l as de,s as ue,a6 as ce,G as pe,_ as fe}from"./_plugin-vue_export-helper-CkaGgE-1.js";const me={class:"profile-container"},ve={key:0,class:"loading-state"},we={key:1},_e={class:"profile-header"},ge={class:"profile-avatar"},he={class:"profile-header-info"},ye={class:"user-email"},be={key:0,class:"profile-unit"},Ce={class:"form-group"},Ie={class:"form-group"},Ve={class:"form-actions"},ke={class:"form-group"},Se={class:"password-input"},Be={class:"form-group"},Pe={class:"password-input"},xe={class:"form-group"},Ee={class:"password-input"},Oe={class:"form-actions"},Ae={class:"info-item"},Ne={class:"info-label"},Ue={class:"info-value"},De={key:0,class:"info-item"},Me={class:"info-label"},Re={class:"info-value"},Te={class:"info-item"},qe={class:"info-label"},je={class:"info-value"},ze=G({__name:"ProfilePage",setup(Je){$();const n=c(null),S=c(!1),v=c(!1),f=c(!1),u=c({name:"",email:""}),r=c({current_password:"",new_password:"",new_password_confirmation:""}),_=c(!1),g=c(!1),h=c(!1),R=D(()=>n.value?u.value.name!==n.value.name||u.value.email!==n.value.email:!1),T=D(()=>r.value.current_password.length>0&&r.value.new_password.length>0&&r.value.new_password_confirmation.length>0),N=async()=>{try{S.value=!0;const e=await(await fetch("/api/me",P.getFetchConfig())).json();if(e.success&&e.user)n.value=e.user,u.value={name:n.value.name||"",email:n.value.email||""};else throw new Error(e.message||"Erro ao carregar perfil")}catch(t){console.error("Error loading profile:",t),await(await w.create({message:t.message||"Erro ao carregar perfil",duration:3e3,color:"danger",position:"top"})).present()}finally{S.value=!1}},q=async()=>{try{v.value=!0;const e=await(await fetch("/api/profile/update",P.getFetchConfig({method:"PUT",body:JSON.stringify(u.value)}))).json();if(e.success)n.value=e.user,u.value={name:n.value.name||"",email:n.value.email||""},await(await w.create({message:e.message||"Perfil atualizado com sucesso",duration:2e3,color:"success",position:"top"})).present();else throw new Error(e.message||"Erro ao atualizar perfil")}catch(t){console.error("Error updating profile:",t),await(await w.create({message:t.message||"Erro ao atualizar perfil",duration:3e3,color:"danger",position:"top"})).present()}finally{v.value=!1}},j=async()=>{if(r.value.new_password!==r.value.new_password_confirmation){await(await w.create({message:"As senhas não coincidem",duration:3e3,color:"warning",position:"top"})).present();return}if(r.value.new_password.length<8){await(await w.create({message:"A nova senha deve ter no mínimo 8 caracteres",duration:3e3,color:"warning",position:"top"})).present();return}try{f.value=!0;const e=await(await fetch("/api/profile/password",P.getFetchConfig({method:"PUT",body:JSON.stringify(r.value)}))).json();if(e.success)r.value={current_password:"",new_password:"",new_password_confirmation:""},_.value=!1,g.value=!1,h.value=!1,await(await te.create({header:"Senha Alterada",message:"Sua senha foi alterada com sucesso!",buttons:["OK"]})).present();else throw new Error(e.message||"Erro ao alterar senha")}catch(t){console.error("Error updating password:",t),await(await w.create({message:t.message||"Erro ao alterar senha",duration:3e3,color:"danger",position:"top"})).present()}finally{f.value=!1}},z=async t=>{await N(),t.target.complete()},U=t=>({admin:"Administrador",manager:"Gestor",field_user:"Usuário de Campo",tecnico:"Técnico",coordenador:"Coordenador",supervisor:"Supervisor"})[t]||t,J=t=>({admin:"danger",manager:"warning",field_user:"primary",tecnico:"primary",coordenador:"secondary",supervisor:"tertiary"})[t]||"medium",F=t=>t?new Date(t).toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric"}):"N/A";return H(()=>{N()}),(t,e)=>(y(),L(a(K),null,{default:l(()=>[o(a(Z),{translucent:!0},{default:l(()=>[o(a(Q),{color:"primary"},{default:l(()=>[o(a(W),{slot:"start"},{default:l(()=>[o(a(X),{"default-href":"/dashboard"})]),_:1}),o(a(Y),null,{default:l(()=>[...e[8]||(e[8]=[m("Meu Perfil",-1)])]),_:1})]),_:1})]),_:1}),o(a(le),{fullscreen:!0,class:"profile-content"},{default:l(()=>[s("div",me,[o(a(ee),{slot:"fixed",onIonRefresh:z},{default:l(()=>[o(a(ae))]),_:1}),S.value&&!n.value?(y(),I("div",ve,[o(a(oe),{name:"crescent"}),e[9]||(e[9]=s("p",null,"Carregando perfil...",-1))])):n.value?(y(),I("div",we,[o(a(V),{class:"profile-header-card"},{default:l(()=>[o(a(k),null,{default:l(()=>[s("div",_e,[s("div",ge,[o(a(d),{icon:a(ne)},null,8,["icon"])]),s("div",he,[s("h2",null,p(n.value.name),1),s("p",ye,p(n.value.email),1),o(a(se),{color:J(n.value.role)},{default:l(()=>[m(p(U(n.value.role)),1)]),_:1},8,["color"])])]),n.value.unit?(y(),I("div",be,[o(a(d),{icon:a(re)},null,8,["icon"]),s("span",null,p(n.value.unit.name),1)])):B("",!0)]),_:1})]),_:1}),o(a(V),{class:"form-card"},{default:l(()=>[o(a(x),null,{default:l(()=>[o(a(E),null,{default:l(()=>[...e[10]||(e[10]=[m("Informações Básicas",-1)])]),_:1})]),_:1}),o(a(k),null,{default:l(()=>[s("form",{onSubmit:M(q,["prevent"])},[s("div",Ce,[e[11]||(e[11]=s("label",null,"Nome Completo",-1)),o(a(b),{modelValue:u.value.name,"onUpdate:modelValue":e[0]||(e[0]=i=>u.value.name=i),type:"text",placeholder:"Digite seu nome",disabled:v.value,required:""},null,8,["modelValue","disabled"])]),s("div",Ie,[e[12]||(e[12]=s("label",null,"E-mail",-1)),o(a(b),{modelValue:u.value.email,"onUpdate:modelValue":e[1]||(e[1]=i=>u.value.email=i),type:"email",placeholder:"Digite seu e-mail",disabled:v.value,required:""},null,8,["modelValue","disabled"])]),s("div",Ve,[o(a(C),{expand:"block",type:"submit",disabled:v.value||!R.value},{default:l(()=>[o(a(d),{slot:"start",icon:a(ie)},null,8,["icon"]),m(" "+p(v.value?"Salvando...":"Salvar Alterações"),1)]),_:1},8,["disabled"])])],32)]),_:1})]),_:1}),o(a(V),{class:"form-card"},{default:l(()=>[o(a(x),null,{default:l(()=>[o(a(E),null,{default:l(()=>[...e[13]||(e[13]=[m("Alterar Senha",-1)])]),_:1})]),_:1}),o(a(k),null,{default:l(()=>[s("form",{onSubmit:M(j,["prevent"])},[s("div",ke,[e[14]||(e[14]=s("label",null,"Senha Atual",-1)),s("div",Se,[o(a(b),{modelValue:r.value.current_password,"onUpdate:modelValue":e[2]||(e[2]=i=>r.value.current_password=i),type:_.value?"text":"password",placeholder:"Digite sua senha atual",disabled:f.value,required:""},null,8,["modelValue","type","disabled"]),o(a(C),{fill:"clear",onClick:e[3]||(e[3]=i=>_.value=!_.value),class:"password-toggle"},{default:l(()=>[o(a(d),{icon:_.value?a(O):a(A)},null,8,["icon"])]),_:1})])]),s("div",Be,[e[15]||(e[15]=s("label",null,"Nova Senha",-1)),s("div",Pe,[o(a(b),{modelValue:r.value.new_password,"onUpdate:modelValue":e[4]||(e[4]=i=>r.value.new_password=i),type:g.value?"text":"password",placeholder:"Digite a nova senha",disabled:f.value,required:""},null,8,["modelValue","type","disabled"]),o(a(C),{fill:"clear",onClick:e[5]||(e[5]=i=>g.value=!g.value),class:"password-toggle"},{default:l(()=>[o(a(d),{icon:g.value?a(O):a(A)},null,8,["icon"])]),_:1})]),e[16]||(e[16]=s("div",{class:"password-hint"}," Mínimo de 8 caracteres ",-1))]),s("div",xe,[e[17]||(e[17]=s("label",null,"Confirmar Nova Senha",-1)),s("div",Ee,[o(a(b),{modelValue:r.value.new_password_confirmation,"onUpdate:modelValue":e[6]||(e[6]=i=>r.value.new_password_confirmation=i),type:h.value?"text":"password",placeholder:"Confirme a nova senha",disabled:f.value,required:""},null,8,["modelValue","type","disabled"]),o(a(C),{fill:"clear",onClick:e[7]||(e[7]=i=>h.value=!h.value),class:"password-toggle"},{default:l(()=>[o(a(d),{icon:h.value?a(O):a(A)},null,8,["icon"])]),_:1})])]),s("div",Oe,[o(a(C),{expand:"block",type:"submit",color:"warning",disabled:f.value||!T.value},{default:l(()=>[o(a(d),{slot:"start",icon:a(de)},null,8,["icon"]),m(" "+p(f.value?"Alterando...":"Alterar Senha"),1)]),_:1},8,["disabled"])])],32)]),_:1})]),_:1}),o(a(V),{class:"info-card"},{default:l(()=>[o(a(x),null,{default:l(()=>[o(a(E),null,{default:l(()=>[...e[18]||(e[18]=[m("Informações da Conta",-1)])]),_:1})]),_:1}),o(a(k),null,{default:l(()=>[s("div",Ae,[s("div",Ne,[o(a(d),{icon:a(ue)},null,8,["icon"]),e[19]||(e[19]=s("span",null,"Tipo de Conta",-1))]),s("div",Ue,p(U(n.value.role)),1)]),n.value.unit?(y(),I("div",De,[s("div",Me,[o(a(d),{icon:a(ce)},null,8,["icon"]),e[20]||(e[20]=s("span",null,"Unidade",-1))]),s("div",Re,p(n.value.unit.name),1)])):B("",!0),s("div",Te,[s("div",qe,[o(a(d),{icon:a(pe)},null,8,["icon"]),e[21]||(e[21]=s("span",null,"Membro desde",-1))]),s("div",je,p(F(n.value.created_at)),1)])]),_:1})]),_:1})])):B("",!0)])]),_:1})]),_:1}))}}),$e=fe(ze,[["__scopeId","data-v-c39f475d"]]);export{$e as default};
