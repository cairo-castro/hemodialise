const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/useSessionHandler-DLuHMSqo.js","assets/ionic-GHA3wq_y.js","assets/vendor-DcQkTNkg.js","assets/LoginPage-Crn-Vbkc.js","assets/_plugin-vue_export-helper-CkaGgE-1.js","assets/LoginPage-CyMI9zAO.css","assets/DashboardPage-DhULyOUj.js","assets/useStatsAutoRefresh-BM3gXwB1.js","assets/DashboardPage-CnixvaBa.css","assets/ChecklistListPage-CdkWrDm6.js","assets/ChecklistListPage-Bt7_GHXr.css","assets/ChecklistPage-Du_Idt6h.js","assets/ChecklistPage-D8fCeeEq.css","assets/PatientsPage-BZMNfiA_.js","assets/PatientsPage-BXhzIzT4.css","assets/PatientFormPage-BCPyTCvz.js","assets/PatientFormPage-DOYN7LH5.css","assets/MachinesPage-BIJH-wIl.js","assets/MachinesPage-F6XF8HeM.css","assets/MachinesOverviewPage-DMZPQKMi.js","assets/MachinesOverviewPage-lNXXlqst.css","assets/CleaningControlsPage-bdUco7cT.js","assets/CleaningControlsPage-CGd-2HLL.css","assets/CleaningChecklistNewPage-CUPwoMp6.js","assets/CleaningChecklistNewPage-CKbwYGdd.css","assets/ProfilePage-CQWJN7mP.js","assets/ProfilePage-Cur6zvZ6.css"])))=>i.map(i=>d[i]);
var q=Object.defineProperty;var Y=(r,e,t)=>e in r?q(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var d=(r,e,t)=>Y(r,typeof e!="symbol"?e+"":e,t);import{r as m,b as z,o as H,e as j,l as P,d as X,n as J,q as W,t as E,v as L,x as Q,y as O,F as Z,z as ee,A as te}from"./vendor-DcQkTNkg.js";import{I as ae,a as se,_ as h,c as oe,b as re,d as ne}from"./ionic-GHA3wq_y.js";function Ne(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}const p=m(!1),b=m(!1);function ie(){const r=()=>{console.log("[useDarkMode] Applying dark mode:",p.value),p.value?(document.documentElement.classList.add("ion-palette-dark"),console.log("[useDarkMode] Added ion-palette-dark class")):(document.documentElement.classList.remove("ion-palette-dark"),console.log("[useDarkMode] Removed ion-palette-dark class")),console.log("[useDarkMode] HTML classes:",document.documentElement.className)};return{isDarkMode:p,toggleDarkMode:()=>{console.log("[useDarkMode] Toggle called. Current:",p.value),p.value=!p.value,console.log("[useDarkMode] New value:",p.value)},initializeDarkMode:()=>{if(b.value)return;const s=localStorage.getItem("dark-mode");s!==null?p.value=s==="true":p.value=window.matchMedia("(prefers-color-scheme: dark)").matches,r(),z(p,o=>{localStorage.setItem("dark-mode",o.toString()),r()}),b.value=!0,console.log("Dark mode initialized:",p.value)},setDarkMode:s=>{p.value=s}}}function ce(r={}){const{interval:e=15e3,onUpdate:t}=r,a=m(!1),s=m(null),o=m(!1),l=m(null),i=m(null);let S=null,c=0;const u=3,f=async()=>{var T,N,R;try{if(i.value=null,localStorage.getItem("is_authenticated")!=="true")return;const V=await P.get("/api/sync/check-updates",{params:{last_check:s.value||new Date(Date.now()-5*60*1e3).toISOString()},timeout:5e3}),{has_updates:x,last_update:B,data:_,checked_at:F}=V.data;s.value=F,x?(o.value=!0,l.value=_,c=0,console.log("[DataSync] Novas atualizaÃ§Ãµes detectadas:",{last_update:B,safety_checklists:((T=_.safety_checklists)==null?void 0:T.length)||0,cleaning_controls:((N=_.cleaning_controls)==null?void 0:N.length)||0,chemical_disinfections:((R=_.chemical_disinfections)==null?void 0:R.length)||0}),t&&t(_)):o.value=!1}catch(U){c++,console.error("[DataSync] Erro ao verificar atualizaÃ§Ãµes (tentativa ".concat(c,"):"),U),c>=u&&(i.value="Falha na sincronizaÃ§Ã£o apÃ³s mÃºltiplas tentativas",k())}},y=()=>{if(a.value){console.warn("[DataSync] Polling jÃ¡ estÃ¡ ativo");return}console.log("[DataSync] Iniciando polling a cada ".concat(e/1e3,"s")),a.value=!0,c=0,f(),S=setInterval(f,e)},k=()=>{S&&(console.log("[DataSync] Parando polling"),clearInterval(S),S=null),a.value=!1},$=async()=>{console.log("[DataSync] VerificaÃ§Ã£o manual solicitada"),await f()},K=async()=>{try{await P.post("/api/sync/invalidate-cache"),console.log("[DataSync] Cache do servidor invalidado"),await f()}catch(T){console.error("[DataSync] Erro ao invalidar cache:",T)}},G=()=>{s.value=null,o.value=!1,l.value=null,i.value=null,c=0};return H(()=>{y()}),j(()=>{k()}),{isPolling:a,hasUpdates:o,latestData:l,error:i,startPolling:y,stopPolling:k,checkNow:$,invalidateServerCache:K,reset:G}}const le=X({__name:"App",setup(r){const{initializeDarkMode:e}=ie(),t=ee(),{isPolling:a}=ce({interval:15e3,onUpdate:s=>{var l,i;console.log("[App] Novas atualizaÃ§Ãµes recebidas:",s);const o=t.currentRoute.value.name;o==="ChecklistList"&&((l=s.safety_checklists)==null?void 0:l.length)>0&&console.log("[App] AtualizaÃ§Ãµes em checklists detectadas"),o==="CleaningControls"&&((i=s.cleaning_controls)==null?void 0:i.length)>0&&console.log("[App] AtualizaÃ§Ãµes em controles de limpeza detectadas")}});return H(()=>{e(),console.log("[App] Mobile App montado"),console.log("[App] Dark mode inicializado"),console.log("[App] Data sync ativo:",a.value)}),(s,o)=>(W(),J(Z,null,[o[0]||(o[0]=E("div",{class:"desktop-warning",style:{display:"none"}},[E("h1",null,"ðŸ“± Aplicativo Mobile"),E("p",null,"Este aplicativo foi projetado exclusivamente para dispositivos mÃ³veis."),E("p",null,"Acesse pelo seu smartphone ou tablet para uma melhor experiÃªncia."),E("div",{style:{"margin-top":"2rem",padding:"1rem",background:"rgba(255,255,255,0.1)","border-radius":"8px"}},[E("p",{style:{"font-size":"1rem"}},"Para testar no navegador, use as ferramentas de desenvolvedor (F12) e ative a visualizaÃ§Ã£o mobile.")])],-1)),L(O(ae),null,{default:Q(()=>[L(O(se))]),_:1})],64))}}),n={BASE_URL:"",getApiUrl(){return this.BASE_URL},ENDPOINTS:{LOGIN:"/login",LOGOUT:"/logout",ME:"/api/me",PATIENTS:"/api/patients",PATIENTS_SEARCH:"/api/patients/search",PATIENTS_QUICK_SEARCH:"/api/patients/quick-search",CHECKLISTS:"/api/checklists",CHECKLISTS_TODAY:"/api/checklists/today",CHECKLISTS_PENDING:"/api/checklists/pending",CHECKLISTS_BY_USER:"/api/checklists/user",CHECKLISTS_BY_MACHINE:"/api/checklists/machine",CLEANING_CHECKLISTS:"/api/cleaning-checklists",CLEANING_CHECKLISTS_STATS:"/api/cleaning-checklists/stats",MACHINES:"/api/machines",MACHINES_AVAILABLE:"/api/machines/available",MACHINES_BY_UNIT:"/api/machines/unit"}};class ue{constructor(e){d(this,"baseUrl");d(this,"authRepository",null);d(this,"retryCount",0);d(this,"maxRetries",1);this.baseUrl=e||n.getApiUrl()}setAuthRepository(e){this.authRepository=e}getCsrfToken(){const e=document.cookie.match(/XSRF-TOKEN=([^;]+)/);return e?decodeURIComponent(e[1]):null}async get(e,t){return this.request("GET",e,void 0,t)}async post(e,t,a){return this.request("POST",e,t,a)}async put(e,t,a){return this.request("PUT",e,t,a)}async delete(e,t){return this.request("DELETE",e,void 0,t)}async request(e,t,a,s){const o="".concat(this.baseUrl).concat(t),l={"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},i=this.getCsrfToken();i&&(l["X-XSRF-TOKEN"]=i),s&&(l.Authorization="Bearer ".concat(s));const S={method:e,headers:l,credentials:"include"};a&&(e==="POST"||e==="PUT")&&(S.body=JSON.stringify(a));try{const c=await fetch(o,S),u=await c.json();if(!c.ok){if(c.status===401&&t!=="/login")throw this.authRepository&&this.authRepository.removeToken(),{message:"SessÃ£o expirada. FaÃ§a login novamente.",status:401};if(c.status===419){console.log("[ApiDataSource] Session expired (419) - forcing logout");let y=!1;try{u&&u.session_expired===!0&&(y=!0)}catch(k){}throw{message:"Sua sessÃ£o expirou por motivos de seguranÃ§a. Por favor, faÃ§a login novamente.",status:419,session_expired:!0,shouldLogout:!0}}throw{message:u.message||"Erro na requisiÃ§Ã£o",errors:u.errors,status:c.status}}return this.retryCount=0,u&&typeof u=="object"&&"data"in u?u:{data:u,success:!0}}catch(c){if(c.shouldLogout)return console.log("[ApiDataSource] Handling session expiration - logging out"),h(async()=>{const{handleSessionExpiredStatic:u}=await import("./useSessionHandler-DLuHMSqo.js");return{handleSessionExpiredStatic:u}},__vite__mapDeps([0,1,2])).then(({handleSessionExpiredStatic:u})=>{u(c.message)}),{data:null,success:!1};throw c instanceof Error&&c.name==="TypeError"?{message:"Erro de conectividade. Verifique sua conexÃ£o.",status:0}:c}}}class he{set(e,t){try{localStorage.setItem(e,t)}catch(a){console.error("Erro ao salvar no localStorage:",a)}}get(e){try{return localStorage.getItem(e)}catch(t){return console.error("Erro ao ler do localStorage:",t),null}}remove(e){try{localStorage.removeItem(e)}catch(t){console.error("Erro ao remover do localStorage:",t)}}clear(){try{localStorage.clear()}catch(e){console.error("Erro ao limpar localStorage:",e)}}setObject(e,t){try{this.set(e,JSON.stringify(t))}catch(a){console.error("Erro ao salvar objeto no localStorage:",a)}}getObject(e){try{const t=this.get(e);return t?JSON.parse(t):null}catch(t){return console.error("Erro ao ler objeto do localStorage:",t),null}}}class pe{constructor(e,t){d(this,"TOKEN_KEY","auth_token");d(this,"AUTH_FLAG_KEY","is_authenticated");this.apiDataSource=e,this.localStorageDataSource=t}async login(e){await this.refreshCsrfToken();const t=await this.apiDataSource.post(n.ENDPOINTS.LOGIN,e);return t.data||t}async getCurrentUser(){var t;const e=await this.apiDataSource.get(n.ENDPOINTS.ME);return this.localStorageDataSource.set(this.AUTH_FLAG_KEY,"true"),((t=e.data)==null?void 0:t.user)||e.user||e}async logout(){var e;try{const t=await this.apiDataSource.post(n.ENDPOINTS.LOGOUT,{});this.removeToken();const a=t.csrf_token||((e=t.data)==null?void 0:e.csrf_token);if(a){const s=document.querySelector('meta[name="csrf-token"]');s&&(s.setAttribute("content",a),console.log("CSRF token updated from logout response"))}}catch(t){throw this.removeToken(),t}await this.refreshCsrfToken()}async refreshCsrfToken(){try{const e=await fetch("/csrf-token",{method:"GET",credentials:"include",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(e.ok){const a=(await e.json()).csrf_token;if(a){const s=document.querySelector('meta[name="csrf-token"]');s&&(s.setAttribute("content",a),console.log("CSRF token refreshed successfully"))}}}catch(e){console.error("Error refreshing CSRF token:",e)}}getStoredToken(){return this.localStorageDataSource.get(this.AUTH_FLAG_KEY)}storeToken(e){this.localStorageDataSource.set(this.AUTH_FLAG_KEY,e)}removeToken(){this.localStorageDataSource.remove(this.AUTH_FLAG_KEY),this.localStorageDataSource.remove(this.TOKEN_KEY)}isAuthenticated(){return this.localStorageDataSource.get(this.AUTH_FLAG_KEY)==="true"}}class de{constructor(e,t){this.apiDataSource=e,this.localStorageDataSource=t}async search(e){try{const t=await this.apiDataSource.post(n.ENDPOINTS.PATIENTS_SEARCH,{full_name:e.full_name,birth_date:e.birth_date});return t.data.found&&t.data.patient?t.data.patient:null}catch(t){if(t.status===404||t.status===422)return null;throw t}}async create(e){return(await this.apiDataSource.post(n.ENDPOINTS.PATIENTS,e)).data.patient}async getById(e){const t=await this.apiDataSource.get("".concat(n.ENDPOINTS.PATIENTS,"/").concat(e));if(t.data&&t.data.patient)return t.data.patient;throw new Error("Paciente nÃ£o encontrado")}async getAll(e,t=100){const a=new URLSearchParams;a.append("per_page",t.toString()),e&&a.append("search",e);const s="".concat(n.ENDPOINTS.PATIENTS,"?").concat(a.toString()),o=await this.apiDataSource.get(s);return o.data&&o.data.patients?o.data.patients:Array.isArray(o.data)?o.data:[]}async quickSearch(e,t=20){const a=new URLSearchParams;a.append("query",e),a.append("limit",t.toString());const s="".concat(n.ENDPOINTS.PATIENTS_QUICK_SEARCH,"?").concat(a.toString()),o=await this.apiDataSource.get(s);return o.data&&o.data.patients?o.data.patients:[]}async update(e,t){return(await this.apiDataSource.put("".concat(n.ENDPOINTS.PATIENTS,"/").concat(e),t)).data}}class ge{constructor(e,t){this.apiDataSource=e,this.localStorageDataSource=t}async create(e){return(await this.apiDataSource.post(n.ENDPOINTS.CHECKLISTS,e)).data}async getById(e){return(await this.apiDataSource.get("".concat(n.ENDPOINTS.CHECKLISTS,"/").concat(e))).data}async getByUser(e,t){const a=new URLSearchParams;t&&a.append("limit",t.toString());const s="".concat(n.ENDPOINTS.CHECKLISTS_BY_USER,"/").concat(e).concat(a.toString()?"?"+a.toString():"");return(await this.apiDataSource.get(s)).data}async getByMachine(e,t){const a=new URLSearchParams;t&&a.append("date",t);const s="".concat(n.ENDPOINTS.CHECKLISTS_BY_MACHINE,"/").concat(e).concat(a.toString()?"?"+a.toString():"");return(await this.apiDataSource.get(s)).data}async getTodaysChecklists(){const e=new Date().toISOString().split("T")[0];return(await this.apiDataSource.get("".concat(n.ENDPOINTS.CHECKLISTS_TODAY,"/").concat(e))).data}async getPendingChecklists(){return(await this.apiDataSource.get(n.ENDPOINTS.CHECKLISTS_PENDING)).data}}class Se{constructor(e,t){this.apiDataSource=e,this.localStorageDataSource=t}async getAll(){const e=await this.apiDataSource.get(n.ENDPOINTS.MACHINES);return e.data&&e.data.machines?e.data.machines:Array.isArray(e.data)?e.data:[]}async getById(e){return(await this.apiDataSource.get("".concat(n.ENDPOINTS.MACHINES,"/").concat(e))).data}async getByUnit(e){return(await this.apiDataSource.get("".concat(n.ENDPOINTS.MACHINES_BY_UNIT,"/").concat(e))).data}async getAvailable(){var t;const e=await this.apiDataSource.get(n.ENDPOINTS.MACHINES_AVAILABLE);return(t=e.data)!=null&&t.machines?e.data.machines:e.machines?e.machines:e.data||e}async create(e){const t=await this.apiDataSource.post(n.ENDPOINTS.MACHINES,e);return t.data.machine||t.data}async update(e,t){const a=await this.apiDataSource.put("".concat(n.ENDPOINTS.MACHINES,"/").concat(e),t);return a.data.machine||a.data}async delete(e){await this.apiDataSource.delete("".concat(n.ENDPOINTS.MACHINES,"/").concat(e))}async updateStatus(e,t){return(await this.apiDataSource.put("".concat(n.ENDPOINTS.MACHINES,"/").concat(e,"/status"),t)).data.machine}async toggleActive(e,t){return(await this.apiDataSource.put("".concat(n.ENDPOINTS.MACHINES,"/").concat(e,"/toggle-active"),t)).data.machine}}class me{constructor(e,t){this.apiDataSource=e,this.authRepository=t}async getAll(e){const t=new URLSearchParams;e&&(e.start_date&&t.append("start_date",e.start_date),e.end_date&&t.append("end_date",e.end_date),e.machine_id&&t.append("machine_id",e.machine_id.toString()),e.shift&&t.append("shift",e.shift));const a=t.toString(),s="".concat(n.ENDPOINTS.CLEANING_CHECKLISTS).concat(a?"?".concat(a):""),o=await this.apiDataSource.get(s);return o.data&&o.data.checklists?o.data.checklists:Array.isArray(o.data)?o.data:[]}async getById(e){const t=await this.apiDataSource.get("".concat(n.ENDPOINTS.CLEANING_CHECKLISTS,"/").concat(e));if(t.data&&t.data.checklist)return t.data.checklist;throw new Error("Checklist nÃ£o encontrado")}async create(e){const t=await this.apiDataSource.post(n.ENDPOINTS.CLEANING_CHECKLISTS,e);if(t.data&&t.data.checklist)return t.data.checklist;throw new Error("Erro ao criar checklist")}async update(e,t){const a=await this.apiDataSource.put("".concat(n.ENDPOINTS.CLEANING_CHECKLISTS,"/").concat(e),t);if(a.data&&a.data.checklist)return a.data.checklist;throw new Error("Erro ao atualizar checklist")}async delete(e){await this.apiDataSource.delete("".concat(n.ENDPOINTS.CLEANING_CHECKLISTS,"/").concat(e))}async getStats(){const e=await this.apiDataSource.get(n.ENDPOINTS.CLEANING_CHECKLISTS_STATS);if(e.data&&e.data.stats)return e.data.stats;throw new Error("Erro ao obter estatÃ­sticas")}}class Ce{constructor(e){this.authRepository=e}async execute(e){if(!e.email||!e.password)throw new Error("Email e senha sÃ£o obrigatÃ³rios");if(!this.isValidEmail(e.email))throw new Error("Email deve ter um formato vÃ¡lido");const t=await this.authRepository.login(e);return this.authRepository.storeToken(t.token||t.access_token),t}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}}class Ee{constructor(e){this.authRepository=e}async execute(){try{return await this.authRepository.getCurrentUser()}catch(e){throw this.authRepository.removeToken(),new Error("SessÃ£o expirada. FaÃ§a login novamente.")}}}class fe{constructor(e){this.authRepository=e}async execute(){try{await this.authRepository.logout()}catch(e){console.warn("Erro ao fazer logout na API:",e)}finally{this.authRepository.removeToken()}}}class _e{constructor(e){this.patientRepository=e}async execute(e){var a;if(!((a=e.full_name)!=null&&a.trim()))throw new Error("Nome completo Ã© obrigatÃ³rio");if(!e.birth_date)throw new Error("Data de nascimento Ã© obrigatÃ³ria");if(!this.isValidDate(e.birth_date))throw new Error("Data de nascimento deve estar no formato vÃ¡lido");const t={full_name:e.full_name.trim(),birth_date:e.birth_date};return await this.patientRepository.search(t)}isValidDate(e){const t=new Date(e);return t instanceof Date&&!isNaN(t.getTime())}}class ye{constructor(e){this.patientRepository=e}async execute(e){var a,s,o,l,i;if(!((a=e.full_name)!=null&&a.trim()))throw new Error("Nome completo Ã© obrigatÃ³rio");if(!e.birth_date)throw new Error("Data de nascimento Ã© obrigatÃ³ria");if(!this.isValidDate(e.birth_date))throw new Error("Data de nascimento deve estar no formato vÃ¡lido");if(e.blood_group&&!this.isValidBloodGroup(e.blood_group))throw new Error("Tipo sanguÃ­neo invÃ¡lido");if(e.rh_factor&&!this.isValidRhFactor(e.rh_factor))throw new Error("Fator RH invÃ¡lido");const t={full_name:e.full_name.trim(),birth_date:e.birth_date,blood_group:(s=e.blood_group)==null?void 0:s.trim(),rh_factor:(o=e.rh_factor)==null?void 0:o.trim(),allergies:(l=e.allergies)==null?void 0:l.trim(),observations:(i=e.observations)==null?void 0:i.trim()};return await this.patientRepository.create(t)}isValidDate(e){const t=new Date(e);return t instanceof Date&&!isNaN(t.getTime())}isValidBloodGroup(e){return["A","B","AB","O"].includes(e)}isValidRhFactor(e){return["+","-"].includes(e)}}class ke{constructor(e){this.checklistRepository=e}async execute(e){if(!e.patient_id)throw new Error("ID do paciente Ã© obrigatÃ³rio");if(!e.machine_id)throw new Error("ID da mÃ¡quina Ã© obrigatÃ³rio");if(!e.shift)throw new Error("Turno Ã© obrigatÃ³rio");if(!this.isValidShift(e.shift))throw new Error("Turno deve ser: matutino, vespertino ou noturno");if(![e.patient_identification,e.access_patency,e.vital_signs,e.weight_measurement,e.machine_parameters,e.anticoagulation,e.alarm_tests,e.emergency_procedures].every(a=>a===!0))throw new Error("Todos os 8 itens de seguranÃ§a devem ser verificados");return await this.checklistRepository.create(e)}isValidShift(e){return["matutino","vespertino","noturno"].includes(e)}}class Te{constructor(e){this.cleaningChecklistRepository=e}async execute(e){return await this.cleaningChecklistRepository.getAll(e)}}class we{constructor(e){this.cleaningChecklistRepository=e}async execute(e){return await this.cleaningChecklistRepository.create(e)}}class ve{constructor(e){this.cleaningChecklistRepository=e}async execute(){return await this.cleaningChecklistRepository.getStats()}}const C=class C{constructor(){d(this,"services",new Map);this.registerServices()}static getInstance(){return C.instance||(C.instance=new C),C.instance}registerServices(){const e=new ue,t=new he;this.services.set("ApiDataSource",e),this.services.set("LocalStorageDataSource",t);const a=new pe(e,t);e.setAuthRepository(a);const s=new de(e,t),o=new ge(e,t),l=new Se(e,t),i=new me(e,a);this.services.set("AuthRepository",a),this.services.set("PatientRepository",s),this.services.set("ChecklistRepository",o),this.services.set("MachineRepository",l),this.services.set("CleaningChecklistRepository",i),this.services.set("LoginUseCase",new Ce(a)),this.services.set("GetCurrentUserUseCase",new Ee(a)),this.services.set("LogoutUseCase",new fe(a)),this.services.set("SearchPatientUseCase",new _e(s)),this.services.set("CreatePatientUseCase",new ye(s)),this.services.set("CreateChecklistUseCase",new ke(o)),this.services.set("GetCleaningChecklistsUseCase",new Te(i)),this.services.set("CreateCleaningChecklistUseCase",new we(i)),this.services.set("GetCleaningChecklistStatsUseCase",new ve(i))}get(e){const t=this.services.get(e);if(!t)throw new Error("Service ".concat(e," not found"));return t}getLoginUseCase(){return this.get("LoginUseCase")}getCurrentUserUseCase(){return this.get("GetCurrentUserUseCase")}getLogoutUseCase(){return this.get("LogoutUseCase")}getSearchPatientUseCase(){return this.get("SearchPatientUseCase")}getCreatePatientUseCase(){return this.get("CreatePatientUseCase")}getCreateChecklistUseCase(){return this.get("CreateChecklistUseCase")}getAuthRepository(){return this.get("AuthRepository")}getPatientRepository(){return this.get("PatientRepository")}getMachineRepository(){return this.get("MachineRepository")}getGetCleaningChecklistsUseCase(){return this.get("GetCleaningChecklistsUseCase")}getCreateCleaningChecklistUseCase(){return this.get("CreateCleaningChecklistUseCase")}getGetCleaningChecklistStatsUseCase(){return this.get("GetCleaningChecklistStatsUseCase")}getCleaningChecklistRepository(){return this.get("CleaningChecklistRepository")}};d(C,"instance");let D=C;const I=D.getInstance(),w=I.getAuthRepository(),g=async(r,e,t)=>{if(console.log("requiresAuth guard - checking authentication..."),!w.getStoredToken()){console.log("No token found, redirecting to login"),t("/login");return}try{await I.getCurrentUserUseCase().execute(),console.log("Token is valid, allowing access to:",r.path),t()}catch(s){console.log("Token validation failed, clearing token and redirecting to login"),w.removeToken(),t("/login")}},De=async(r,e,t)=>{if(console.log("redirectIfAuthenticated guard - checking authentication..."),!w.getStoredToken()){console.log("No token, allowing access to login"),t();return}try{await I.getCurrentUserUseCase().execute(),console.log("User is authenticated, redirecting to dashboard"),t("/dashboard")}catch(s){console.log("Token validation failed, clearing token and allowing login"),w.removeToken(),t()}},Ie=[{path:"/",redirect:"/login"},{path:"/login",name:"Login",component:()=>h(()=>import("./LoginPage-Crn-Vbkc.js"),__vite__mapDeps([3,2,1,4,5])),beforeEnter:De},{path:"/dashboard",name:"Dashboard",component:()=>h(()=>import("./DashboardPage-DhULyOUj.js"),__vite__mapDeps([6,2,1,4,7,8])),beforeEnter:g},{path:"/checklists",name:"ChecklistList",component:()=>h(()=>import("./ChecklistListPage-CdkWrDm6.js"),__vite__mapDeps([9,2,1,4,7,10])),beforeEnter:g},{path:"/checklist/new",name:"NewChecklist",component:()=>h(()=>import("./ChecklistPage-Du_Idt6h.js"),__vite__mapDeps([11,2,1,4,12])),beforeEnter:g},{path:"/checklist/:id",name:"Checklist",component:()=>h(()=>import("./ChecklistPage-Du_Idt6h.js"),__vite__mapDeps([11,2,1,4,12])),beforeEnter:g},{path:"/checklist",redirect:"/checklists"},{path:"/patients",name:"Patients",component:()=>h(()=>import("./PatientsPage-BZMNfiA_.js"),__vite__mapDeps([13,2,1,4,7,14])),beforeEnter:g},{path:"/patients/new",name:"NewPatient",component:()=>h(()=>import("./PatientFormPage-BCPyTCvz.js"),__vite__mapDeps([15,2,1,4,16])),beforeEnter:g},{path:"/machines",name:"Machines",component:()=>h(()=>import("./MachinesPage-BIJH-wIl.js"),__vite__mapDeps([17,1,2,4,7,18])),beforeEnter:g},{path:"/machines-overview",name:"MachinesOverview",component:()=>h(()=>import("./MachinesOverviewPage-DMZPQKMi.js"),__vite__mapDeps([19,2,1,4,20])),beforeEnter:g},{path:"/cleaning-controls",name:"CleaningControls",component:()=>h(()=>import("./CleaningControlsPage-bdUco7cT.js"),__vite__mapDeps([21,2,1,4,7,22])),beforeEnter:g},{path:"/cleaning-checklist/new",name:"NewCleaningChecklist",component:()=>h(()=>import("./CleaningChecklistNewPage-CUPwoMp6.js"),__vite__mapDeps([23,2,1,4,24])),beforeEnter:g},{path:"/profile",name:"Profile",component:()=>h(()=>import("./ProfilePage-CQWJN7mP.js"),__vite__mapDeps([25,2,1,4,26])),beforeEnter:g},{path:"/:pathMatch(.*)*",redirect:"/login"}],M=oe({history:re("/mobile/"),routes:Ie});class v{static getToken(){return localStorage.getItem(this.TOKEN_KEY)}static setToken(e){localStorage.setItem(this.TOKEN_KEY,e)}static removeToken(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.USER_KEY)}static getUser(){const e=localStorage.getItem(this.USER_KEY);return e?JSON.parse(e):null}static setUser(e){localStorage.setItem(this.USER_KEY,JSON.stringify(e))}static isAuthenticated(){const e=this.getToken(),t=this.getUser();return!!(e&&t)}static getAuthHeaders(){const e=this.getToken(),t={"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"};e&&(t.Authorization="Bearer ".concat(e));const a=this.getCsrfToken();return a&&(t["X-XSRF-TOKEN"]=a),t}static getFetchConfig(e={}){return{...e,headers:{...this.getAuthHeaders(),...e.headers},credentials:"include"}}static getCsrfToken(){const e=document.cookie.match(/XSRF-TOKEN=([^;]+)/);return e?decodeURIComponent(e[1]):null}static async logout(){try{await fetch("/api/logout",{method:"POST",headers:this.getAuthHeaders()})}catch(e){console.error("Logout error:",e)}finally{this.removeToken()}}static async checkAuth(){if(!this.isAuthenticated())return!1;try{const e=await fetch("/api/me",{headers:this.getAuthHeaders()});if(e.ok){const t=await e.json();return this.setUser(t),!0}else return e.status===401?(console.log("Token expired, attempting refresh..."),await this.refreshToken()):(this.removeToken(),!1)}catch(e){return console.error("Auth check error:",e),this.removeToken(),!1}}static async refreshToken(){try{const e=await fetch("/api/refresh",{method:"POST",headers:this.getAuthHeaders()});if(e.ok){const t=await e.json();return this.setToken(t.token),this.setUser(t.user),console.log("Token refreshed successfully"),!0}else return console.log("Token refresh failed, redirecting to login"),this.removeToken(),!1}catch(e){return console.error("Token refresh error:",e),this.removeToken(),!1}}static async login(e,t){const a=await fetch("/login",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:e,password:t})});if(!a.ok){const o=await a.json();throw new Error(o.message||"Login failed")}const s=await a.json();return this.setToken(s.token||s.access_token),this.setUser(s.user),s}}d(v,"TOKEN_KEY","auth_token"),d(v,"USER_KEY","auth_user");const A=te(le).use(ne,{backButtonText:"Voltar",mode:"ios"}).use(M);A.config.globalProperties.$auth=v;A.provide("auth",v);M.isReady().then(()=>{A.mount("#app")});export{v as A,D as C,Ne as __vite_legacy_guard,ce as a,ie as u};
