import{d as Ue,n as h,q as r,t as s,J as g,G as d,K as b,v as n,y as a,B as C,H as _,r as f,c as me,b as ya,o as ba,M as ka,e as Ca,x as c,u as wa,w as Ae,D as Te,F as ee,L as ae,z as Pa}from"./vendor-DcQkTNkg.js";import{g as l,A as Ia,e as Sa,t as y,o as Ne,q as $e,x as Oa,p as qe,r as Ve,B as j,C as L,k as q,f as Da,v as Re,w as Me,D as Ea,E as Aa,i as xe,F as Ta,G as Na,n as U,l as se}from"./ionic-GHA3wq_y.js";import{r as $,D as H,E as _e,F as Fe,G as te,_ as He,H as $a,t as Be,I as he,J as qa,K as fe,L as ze,m as Va,h as Ra,M as Ma,j as xa,N as Fa,g as Ba,O as je,P as za,f as ja,Q as Le,R as La,S as Ua,w as Ha}from"./_plugin-vue_export-helper-Dt2dLz-X.js";import{C as Ja,A as E}from"./main-BLe5ig7Y.js";const Ka={class:"item-card-header"},Wa={class:"header-content"},Ga={class:"item-card-title"},Qa={key:0,class:"item-card-description"},Xa={key:0,class:"header-badge"},Ya={class:"status-actions"},Za={class:"action-status-icon success"},es={class:"action-status-icon danger"},as={class:"action-status-icon neutral"},ss={key:0,class:"observation-card"},ts={class:"observation-label"},os=["value"],ns=Ue({__name:"ChecklistItem",props:{title:{},description:{default:""},value:{default:null},observation:{default:""},required:{type:Boolean,default:!1}},emits:["update:value","update:observation"],setup(ge,{emit:V}){const J=ge,P=V,x=p=>{J.value===p?(P("update:value",null),P("update:observation","")):(P("update:value",p),p!=="NC"&&P("update:observation",""))},R=p=>{P("update:observation",p)},K=p=>{switch(p){case"C":return $;case"NC":return _e;case"NA":return Fe;default:return $}};return(p,v)=>(r(),h("div",{class:b(["checklist-item-card",{"has-value":p.value!==null,"is-conforme":p.value==="C","is-nao-conforme":p.value==="NC","is-nao-aplica":p.value==="NA"}])},[s("div",Ka,[s("div",Wa,[s("h3",Ga,d(p.title),1),p.description?(r(),h("p",Qa,d(p.description),1)):g("",!0)]),p.value?(r(),h("div",Xa,[s("div",{class:b(["status-badge",p.value.toLowerCase()])},[n(a(l),{icon:K(p.value)},null,8,["icon"])],2)])):g("",!0)]),s("div",Ya,[s("button",{class:b(["action-status-btn conforme",{selected:p.value==="C"}]),onClick:v[0]||(v[0]=A=>x("C")),type:"button"},[s("div",Za,[n(a(l),{icon:a($)},null,8,["icon"])]),v[4]||(v[4]=s("div",{class:"action-status-content"},[s("span",{class:"action-status-label"},"Conforme"),s("span",{class:"action-status-hint"},"Tudo OK")],-1)),p.value==="C"?(r(),C(a(l),{key:0,icon:a(H),class:"selected-check"},null,8,["icon"])):g("",!0)],2),s("button",{class:b(["action-status-btn nao-conforme",{selected:p.value==="NC"}]),onClick:v[1]||(v[1]=A=>x("NC")),type:"button"},[s("div",es,[n(a(l),{icon:a(_e)},null,8,["icon"])]),v[5]||(v[5]=s("div",{class:"action-status-content"},[s("span",{class:"action-status-label"},"N√£o Conforme"),s("span",{class:"action-status-hint"},"Problema")],-1)),p.value==="NC"?(r(),C(a(l),{key:0,icon:a(H),class:"selected-check"},null,8,["icon"])):g("",!0)],2),s("button",{class:b(["action-status-btn nao-aplica",{selected:p.value==="NA"}]),onClick:v[2]||(v[2]=A=>x("NA")),type:"button"},[s("div",as,[n(a(l),{icon:a(Fe)},null,8,["icon"])]),v[6]||(v[6]=s("div",{class:"action-status-content"},[s("span",{class:"action-status-label"},"N√£o Aplica"),s("span",{class:"action-status-hint"},"N/A")],-1)),p.value==="NA"?(r(),C(a(l),{key:0,icon:a(H),class:"selected-check"},null,8,["icon"])):g("",!0)],2)]),p.value==="NC"?(r(),h("div",ss,[s("label",ts,[n(a(l),{icon:a(te)},null,8,["icon"]),v[7]||(v[7]=_(" Descreva o Problema * ",-1))]),s("textarea",{value:p.observation,onInput:v[3]||(v[3]=A=>R(A.target.value)),class:"observation-textarea",rows:"3",placeholder:"Ex: Equipamento apresentando ru√≠do anormal...",required:""},null,40,os)])):g("",!0)],2))}}),is=He(ns,[["__scopeId","data-v-224039b4"]]),ls={class:"checklist-container"},rs={class:"time-display"},cs={class:"current-date"},us={class:"current-time"},ds={key:0,class:"section"},ps={class:"section-title"},vs={class:"search-card"},ms={class:"search-input-wrapper"},hs={key:0,class:"patient-selected"},fs={class:"action-btn selected"},_s={class:"action-icon success"},gs={class:"action-content"},ys={class:"action-title"},bs={class:"action-subtitle"},ks={key:1,class:"search-results"},Cs=["onClick"],ws={class:"action-icon primary"},Ps={class:"action-content"},Is={class:"action-title"},Ss={class:"action-subtitle"},Os={key:2,class:"no-results"},Ds={key:3,class:"search-loading"},Es={key:1,class:"section"},As={class:"section-title"},Ts={class:"selection-card"},Ns={class:"availability-icon"},$s={class:"availability-info"},qs={class:"availability-label"},Vs={class:"availability-count"},Rs={class:"form-group"},Ms={class:"input-label"},xs={class:"machine-grid"},Fs=["onClick"],Bs={class:"machine-icon"},zs={class:"machine-info"},js={class:"machine-name"},Ls={key:0,class:"machine-check"},Us={class:"form-group"},Hs={class:"input-label"},Js={class:"shift-selector"},Ks={class:"primary-action"},Ws=["disabled"],Gs={key:2},Qs={class:"phase-header"},Xs={class:"phase-time"},Ys={class:"phase-progress"},Zs={class:"progress-steps"},et={class:"step-circle"},at={key:2},st={class:"step-label"},tt={class:"phase-completion"},ot={class:"patient-summary"},nt={class:"patient-details"},it={class:"session-time"},lt={key:2,class:"phase-section"},rt={class:"phase-header-card"},ct={class:"phase-header-icon"},ut={class:"phase-header-content"},dt={class:"phase-header-badge"},pt={class:"checklist-items-grid"},vt={class:"observations-card"},mt={class:"card-label"},ht=["disabled"],ft={class:"btn-text"},_t={class:"btn-title"},gt={class:"btn-subtitle"},yt={class:"dashboard-actions"},bt={class:"action-card-icon warning"},kt={class:"action-card-icon danger"},Ct={key:3,class:"interrupted-section"},wt={class:"interrupted-content"},Pt={class:"interruption-reason"},It={key:4,class:"completed-section"},St={class:"completed-content"},Ot={class:"interrupt-modal-content"},Dt={class:"warning-section"},Et={class:"form-group"},At={class:"modal-buttons"},Tt=Ue({__name:"ChecklistPage",setup(ge){const V=Pa(),J=wa(),P=Ja.getInstance();P.getSearchPatientUseCase();const x=P.getMachineRepository(),R=f(),K=f(""),p=f(""),v=f(!1),A=f(""),M=f(0),F=f("machine-patient"),w=f(""),I=f([]),B=f(!1),k=f(null);let oe;const ne=f(null),ie=f([]),le=f(null),ye=f(!1),i=f(null),S=f(null),be=f(!1),m=f({machine_id:0,shift:"matutino",observations:"",machine_disinfected:!1,capillary_lines_identified:!1,reagent_test_performed:!1,pressure_sensors_verified:!1,air_bubble_detector_verified:!1,patient_identification_confirmed:!1,vascular_access_evaluated:!1,av_fistula_arm_washed:!1,patient_weighed:!1,vital_signs_checked:!1,medications_reviewed:!1,dialyzer_membrane_checked:!1,equipment_functioning_verified:!1,dialysis_parameters_verified:!1,heparin_double_checked:!1,antisepsis_performed:!1,vascular_access_monitored:!1,vital_signs_monitored_during:!1,patient_comfort_assessed:!1,fluid_balance_monitored:!1,alarms_responded:!1,session_completed_safely:!1,vascular_access_secured:!1,patient_vital_signs_stable:!1,complications_assessed:!1,equipment_cleaned:!1}),W=f({}),G=f({}),Je=["pre_dialysis","during_session","post_dialysis"];let re;const Ke=me(()=>k.value&&m.value.machine_id&&m.value.shift),Q=me(()=>i.value?z().every(t=>{const u=Y(t.key);if(u===null)return!1;if(u==="C"||u==="NA")return!0;if(u==="NC"){const O=de(t.key);return O&&O.trim().length>0}return!1}):!1),We=me(()=>i.value?i.value.current_phase==="post_dialysis":!1),ke=o=>({pre_dialysis:"Pr√©-Di√°lise",during_session:"Durante a Sess√£o",post_dialysis:"P√≥s-Di√°lise",completed:"Conclu√≠do",interrupted:"Interrompido"})[o]||o,Ge=o=>({pre_dialysis:"Pr√©",during_session:"Durante",post_dialysis:"P√≥s"})[o]||o,Qe=o=>({pre_dialysis:"Verifica√ß√µes de seguran√ßa antes de iniciar a sess√£o de di√°lise",during_session:"Monitoramento cont√≠nuo durante o procedimento",post_dialysis:"Finaliza√ß√£o segura da sess√£o e limpeza dos equipamentos"})[o]||"",Ce=o=>({pre_dialysis:"warning",during_session:"primary",post_dialysis:"secondary",completed:"success",interrupted:"danger"})[o]||"medium",we=o=>$,Xe=o=>({pre_dialysis:"Preparando",during_session:"Em Andamento",post_dialysis:"Finalizando",completed:"Conclu√≠do",interrupted:"Interrompido"})[o]||o,Ye=o=>({pre_dialysis:"1",during_session:"2",post_dialysis:"3"})[o]||"",Pe=o=>{if(!i.value)return!1;switch(o){case"pre_dialysis":return i.value.pre_dialysis_completed_at!==null;case"during_session":return i.value.during_session_completed_at!==null;case"post_dialysis":return i.value.post_dialysis_completed_at!==null;default:return!1}},z=()=>{var e;return{pre_dialysis:[{key:"machine_disinfected",label:"1. M√°quina Desinfetada",description:"Verificar se a m√°quina foi devidamente desinfetada"},{key:"capillary_lines_identified",label:"2. Linhas e Capilar Identificados (quando h√° reuso)",description:"Identificar e verificar corretamente as linhas capilares"},{key:"reagent_test_performed",label:"3. Teste de Reagente Realizado (pr√©/p√≥s) (quando h√° reuso)",description:"Realizar teste de reagente antes e ap√≥s o procedimento"},{key:"pressure_sensors_verified",label:"4. Sensores de Press√£o Verificados",description:"Verificar sensores: press√£o venosa, arterial e transmembrana"},{key:"air_bubble_detector_verified",label:"5. Detector de Bolhas Funcional e Alinhado",description:"Verificar detector de bolhas de ar e alinhamento √† c√¢mara venosa"},{key:"patient_identification_confirmed",label:"6. Identifica√ß√£o do Paciente Conferida",description:"Confirmar: crach√°, pulseira, cadeira e confirma√ß√£o verbal"},{key:"vascular_access_evaluated",label:"10. Acesso Vascular Verificado",description:"Verificar: curativo, sinais de infec√ß√£o, integridade, heparina no l√∫men"},{key:"av_fistula_arm_washed",label:"7. Lavagem do Bra√ßo da F√≠stula (quando aplic√°vel)",description:"Realizar lavagem do bra√ßo da f√≠stula arteriovenosa"},{key:"patient_weighed",label:"8. Pesagem do Paciente Realizada",description:"Pesar o paciente antes da sess√£o"},{key:"vital_signs_checked",label:"9. Sinais Vitais Conferidos",description:"Verificar sinais vitais conforme protocolo"},{key:"medications_reviewed",label:"11. Prescri√ß√£o M√©dica Conferida",description:"Conferir par√¢metros da m√°quina e medica√ß√µes"},{key:"dialyzer_membrane_checked",label:"Membrana do Dialisador Verificada",description:"Verificar integridade da membrana do dialisador"},{key:"equipment_functioning_verified",label:"Funcionamento dos Equipamentos",description:"Testar funcionamento de todos os equipamentos"}],during_session:[{key:"dialysis_parameters_verified",label:"Par√¢metros de Di√°lise Verificados",description:"Confirmar e ajustar par√¢metros de di√°lise"},{key:"heparin_double_checked",label:"1. Dupla Checagem de Heparina",description:"Realizar dupla checagem da heparina antes de administrar"},{key:"antisepsis_performed",label:"2. Antissepsia Realizada",description:"Antissepsia da pele ou cateter antes da pun√ß√£o/conex√£o"},{key:"vascular_access_monitored",label:"3. Acesso Vascular Monitorado",description:"Monitorar fluxo sangu√≠neo, fixa√ß√£o, conex√£o, sangramento"},{key:"vital_signs_monitored_during",label:"4. Sinais Vitais Durante Sess√£o",description:"Verificar sinais vitais conforme quadro cl√≠nico e protocolo"},{key:"patient_comfort_assessed",label:"Conforto do Paciente Avaliado",description:"Verificar conforto e bem-estar do paciente"},{key:"fluid_balance_monitored",label:"Balan√ßo H√≠drico Monitorado",description:"Acompanhar remo√ß√£o e balan√ßo de fluidos"},{key:"alarms_responded",label:"Resposta a Alarmes",description:"Verificar e responder adequadamente aos alarmes"}],post_dialysis:[{key:"session_completed_safely",label:"1. Desconex√£o Segura Realizada",description:"Desconex√£o sem perda de sangue e sem risco de embolia"},{key:"vascular_access_secured",label:"2. Hemostasia e Curativo do Acesso",description:"Realizar hemostasia e curativo conforme protocolo"},{key:"patient_vital_signs_stable",label:"3. Sinais Vitais Conferidos",description:"Verificar sinais vitais conforme protocolo ou prescri√ß√£o"},{key:"complications_assessed",label:"4. Paciente Avaliado para Complica√ß√µes",description:"Avaliar: sangramento, instabilidade hemodin√¢mica, risco de queda"},{key:"equipment_cleaned",label:"5. Materiais Descartados e M√°quina Programada",description:"Descartar materiais corretamente e programar desinfec√ß√£o"}]}[(e=i.value)==null?void 0:e.current_phase]||[]},Ie=()=>{const o=new Date;K.value=o.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),p.value=o.toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})},Ze=()=>{if(oe&&clearTimeout(oe),w.value.length<3){I.value=[];return}B.value=!0,oe=setTimeout(async()=>{await ea()},500)},ea=async()=>{if(w.value.length<3){I.value=[],B.value=!1;return}try{const e=await P.getPatientRepository().quickSearch(w.value,10);I.value=e}catch(o){console.error("Erro ao buscar pacientes:",o),I.value=[]}finally{B.value=!1}},aa=o=>{k.value=o,w.value=o.full_name,I.value=[]},sa=()=>{k.value=null,w.value="",I.value=[]},ta=()=>{localStorage.setItem("patient_search_query",w.value),V.push("/patients/new")},oa=async()=>{var t,u,O;if(ye.value){F.value="pre-dialysis";return}if(!(await da()).canCreate)return;const e=await U.create({message:"Iniciando checklist...",spinner:"crescent"});await e.present();try{const T=await fetch("/api/checklists",{method:"POST",headers:E.getAuthHeaders(),body:JSON.stringify({patient_id:(t=k.value)==null?void 0:t.id,machine_id:m.value.machine_id,shift:m.value.shift,observations:m.value.observations})}),D=await T.json();if(T.ok&&D.success){i.value=D.checklist,ne.value=ie.value.find(ga=>ga.id===m.value.machine_id)||null,X();const N=D.resumed?"Checklist existente carregado!":"Novo checklist iniciado com sucesso!";await(await y.create({message:N,duration:2e3,color:"success",position:"top"})).present()}else{const N=D.message||((O=(u=D.errors)==null?void 0:u.machine_id)==null?void 0:O[0])||"Erro ao iniciar checklist";throw new Error(N)}}catch(T){await(await y.create({message:T.message||"Erro ao iniciar checklist",duration:3e3,color:"danger",position:"top"})).present()}finally{await e.dismiss()}},na=async()=>{if(!Q.value)return;const o=await U.create({message:"Avan√ßando para pr√≥xima fase...",spinner:"crescent"});await o.present();try{await ce();const t=await(await fetch("/api/checklists/".concat(i.value.id,"/advance"),E.getFetchConfig({method:"POST"}))).json();if(t.success)i.value=t.checklist,X(),R.value&&R.value.$el&&await R.value.$el.scrollToTop(400),await(await y.create({message:t.message,duration:2e3,color:"success",position:"top"})).present();else throw new Error(t.message||"Erro ao avan√ßar fase")}catch(e){await(await y.create({message:e.message||"Erro ao avan√ßar fase",duration:3e3,color:"danger",position:"top"})).present()}finally{await o.dismiss()}},ce=async()=>{if(i.value)try{const o={},e={};z().forEach(T=>{const D=Y(T.key),N=de(T.key);let Z=!1;(D==="C"||D==="NA"||D==="NC"&&N&&N.trim().length>0)&&(Z=!0),o[T.key]=Z,N&&N.trim().length>0&&(e[T.key]=N)});const u=await fetch("/api/checklists/".concat(i.value.id,"/phase"),{method:"PATCH",...E.getFetchConfig({body:JSON.stringify({phase_data:o,observations:m.value.observations,item_observations:e})})});if(!u.ok)throw new Error("Erro ao salvar dados");const O=await u.json();O.success&&(M.value=O.phase_completion)}catch(o){console.error("Erro no updatePhaseData:",o)}},ia=async()=>{const o=await U.create({message:"Interrompendo checklist...",spinner:"crescent"});await o.present();try{const t=await(await fetch("/api/checklists/".concat(i.value.id,"/interrupt"),E.getFetchConfig({method:"POST",body:JSON.stringify({reason:A.value})}))).json();if(t.success)i.value=t.checklist,v.value=!1,await(await y.create({message:"Checklist interrompido com sucesso.",duration:3e3,color:"warning",position:"top"})).present();else throw new Error(t.message||"Erro ao interromper checklist")}catch(e){await(await y.create({message:e.message||"Erro ao interromper checklist",duration:3e3,color:"danger",position:"top"})).present()}finally{await o.dismiss()}},Se=()=>{V.replace("/dashboard")},la=async()=>{if(!i.value)return;await(await se.create({header:"Pausar Checklist",message:"Deseja pausar o checklist e voltar ao dashboard ou pausar e continuar aqui?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Pausar e Continuar Aqui",handler:async()=>(await ra(),!0)},{text:"Pausar e Sair",handler:async()=>(await ca(),!0)}]})).present()},ra=async()=>{if(!i.value)return;const o=await U.create({message:"Pausando checklist..."});await o.present();try{const t=await(await fetch("/api/checklists/".concat(i.value.id,"/pause"),E.getFetchConfig({method:"POST",body:JSON.stringify({reason:"manual"})}))).json();if(t.success)i.value.paused_at=t.checklist.paused_at,await(await y.create({message:"Checklist pausado com sucesso.",duration:3e3,color:"success",position:"top"})).present();else throw new Error(t.message||"Erro ao pausar checklist")}catch(e){console.error("Erro ao pausar checklist:",e),await(await y.create({message:"Erro ao pausar checklist. Tente novamente.",duration:3e3,color:"danger",position:"top"})).present()}finally{await o.dismiss()}},ca=async()=>{if(!i.value)return;const o=await U.create({message:"Pausando checklist..."});await o.present();try{const t=await(await fetch("/api/checklists/".concat(i.value.id,"/pause"),E.getFetchConfig({method:"POST",body:JSON.stringify({reason:"manual"})}))).json();if(t.success)i.value.paused_at=t.checklist.paused_at,await(await y.create({message:"Checklist pausado com sucesso.",duration:2e3,color:"success",position:"top"})).present(),setTimeout(()=>{V.replace("/dashboard")},500);else throw new Error(t.message||"Erro ao pausar checklist")}catch(e){console.error("Erro ao pausar checklist:",e),await(await y.create({message:"Erro ao pausar checklist. Tente novamente.",duration:3e3,color:"danger",position:"top"})).present()}finally{await o.dismiss()}},X=()=>{const o=z(),e=o.filter(t=>Y(t.key)!==null).length;M.value=o.length>0?e/o.length*100:0},ua=async()=>{try{ie.value=await x.getAvailable(),await Oe()}catch(o){console.error("Error loading machines:",o)}},Oe=async()=>{try{be.value=!0;const o=await fetch("/api/machines/availability",E.getFetchConfig());if(o.ok){const e=await o.json();S.value=e.availability}}catch(o){console.error("Error fetching machine availability:",o)}finally{be.value=!1}},da=async()=>{if(await Oe(),!S.value)return{canCreate:!0};const{available:o,overall_status:e,message:t}=S.value;if(o===0)return await(await se.create({header:"M√°quinas Indispon√≠veis",message:t||"N√£o h√° m√°quinas dispon√≠veis no momento. Por favor, aguarde at√© que uma m√°quina fique livre.",buttons:["OK"]})).present(),{canCreate:!1};if(e==="warning"||e==="alert"){const u=await se.create({header:"Aten√ß√£o",message:"".concat(t,". Apenas ").concat(o," m√°quina(s) dispon√≠vel(is). Deseja continuar?"),buttons:[{text:"Cancelar",role:"cancel"},{text:"Continuar",role:"confirm"}]});await u.present();const{role:O}=await u.onDidDismiss();return{canCreate:O==="confirm"}}return{canCreate:!0}},pa=async()=>{const o=J.params.id;if(o&&o!=="new")try{const e=await fetch("/api/checklists/".concat(o),E.getFetchConfig());if(e.ok){const t=await e.json();switch(i.value=t,le.value=t.id,ye.value=!0,ne.value=t.machine,k.value=t.patient,t.current_phase){case"pre_dialysis":F.value="pre-dialysis";break;case"during_session":F.value="during-session";break;case"post_dialysis":F.value="post-dialysis";break;default:F.value="pre-dialysis"}t.paused_at&&!t.resumed_at&&await va(),ma(t),X(),console.log("Checklist carregado:",t)}}catch(e){console.error("Erro ao carregar checklist:",e)}},va=async()=>{if(le.value)try{(await fetch("/api/checklists/".concat(le.value,"/resume"),E.getFetchConfig({method:"POST"}))).ok&&console.log("Checklist retomado com sucesso")}catch(o){console.error("Erro ao retomar checklist:",o)}},ma=o=>{Object.keys(m.value).forEach(t=>{o[t]!==void 0&&(m.value[t]=o[t])}),o.item_observations&&(G.value={...o.item_observations}),z().forEach(t=>{const u=o[t.key];u!==void 0&&(u===!0?W.value[t.key]="C":u===!1&&G.value[t.key]&&(W.value[t.key]="NC"))})},De=o=>new Date(o).toLocaleDateString("pt-BR"),ue=o=>new Date(o).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),Y=o=>W.value[o]||null,ha=(o,e)=>{W.value[o]=e,m.value[o]=e==="C",X(),i.value&&ce()},de=o=>G.value[o]||"";let pe=null;const fa=(o,e)=>{G.value[o]=e,pe&&clearTimeout(pe),pe=setTimeout(()=>{i.value&&ce()},1e3)},_a=async o=>{try{console.log("üîÑ Carregando paciente ID:",o);const t=await P.getPatientRepository().getById(o);t&&(console.log("‚úÖ Paciente carregado:",t),k.value=t,w.value=t.full_name,I.value=[],await(await y.create({message:"Paciente ".concat(t.full_name," selecionado!"),duration:2e3,color:"success",position:"top"})).present())}catch(e){console.error("‚ùå Erro ao carregar paciente:",e),await(await y.create({message:"Erro ao carregar paciente cadastrado",duration:3e3,color:"danger",position:"top"})).present()}},ve=()=>{const o=localStorage.getItem("return_to_checklist"),e=localStorage.getItem("new_patient_id");console.log("üîç Verificando retorno - return_to_checklist:",o,"new_patient_id:",e),o==="true"&&e&&(console.log("üéØ Detectado retorno de cadastro, carregando paciente..."),_a(parseInt(e)),localStorage.removeItem("return_to_checklist"),localStorage.removeItem("new_patient_id"),localStorage.removeItem("patient_search_query"))};Ia(()=>{console.log("üöÄ onIonViewWillEnter - P√°gina sendo exibida"),ve()}),ya(()=>J.path,o=>{console.log("üîÑ Rota mudou para:",o),o==="/checklist/new"&&(console.log("üìç Detectado retorno para /checklist/new via watch"),setTimeout(ve,100))}),ba(()=>{console.log("üèÅ onMounted - P√°gina montada"),ua(),pa(),Ie(),re=setInterval(Ie,1e3),ve()}),ka(async(o,e)=>{if(!i.value||i.value.paused_at||i.value.current_phase==="completed"||i.value.is_interrupted)return!0;const t=await se.create({header:"Pausar Checklist?",message:"Voc√™ est√° saindo do checklist ativo. Deseja paus√°-lo para continuar depois?",buttons:[{text:"Cancelar",role:"cancel",handler:()=>!1},{text:"Sair sem Pausar",role:"destructive",handler:async()=>!0},{text:"Pausar e Sair",handler:async()=>(await Ee(),!0)}]});await t.present();const{role:u}=await t.onDidDismiss();return u==="cancel"||!u?!1:(u==="handler"&&await Ee(),!0)});const Ee=async()=>{if(i.value)try{(await(await fetch("/api/checklists/".concat(i.value.id,"/pause"),E.getFetchConfig({method:"POST",body:JSON.stringify({reason:"auto"})}))).json()).success&&(await(await y.create({message:"Checklist pausado automaticamente.",duration:2e3,color:"warning",position:"top"})).present(),setTimeout(()=>{V.push("/dashboard")},500))}catch(o){console.error("Erro ao pausar checklist automaticamente:",o)}};return Ca(()=>{re&&clearInterval(re)}),(o,e)=>(r(),C(a(Sa),null,{default:c(()=>[n(a(Ve),{translucent:!0},{default:c(()=>[n(a(Ne),{color:"primary"},{default:c(()=>[n(a($e),{slot:"start"},{default:c(()=>[n(a(Oa),{"default-href":"/dashboard"})]),_:1}),n(a(qe),null,{default:c(()=>[...e[11]||(e[11]=[_("Checklist de Seguran√ßa",-1)])]),_:1})]),_:1})]),_:1}),n(a(xe),{ref_key:"contentRef",ref:R,fullscreen:!0},{default:c(()=>[s("div",ls,[n(a(j),{class:"time-header-card"},{default:c(()=>[n(a(L),null,{default:c(()=>[s("div",rs,[s("div",cs,[n(a(l),{icon:a($a),class:"date-icon"},null,8,["icon"]),_(" "+d(p.value),1)]),s("div",us,[n(a(l),{icon:a(Be),class:"time-icon"},null,8,["icon"]),_(" "+d(K.value),1)])])]),_:1})]),_:1}),i.value?g("",!0):(r(),h("div",ds,[s("h2",ps,[n(a(l),{icon:a(he)},null,8,["icon"]),e[12]||(e[12]=_(" Etapa 1: Buscar Paciente ",-1))]),s("div",vs,[s("div",ms,[n(a(l),{icon:a(qa),class:"search-icon"},null,8,["icon"]),Ae(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>w.value=t),type:"text",placeholder:"Digite o nome do paciente...",class:"search-input",onInput:Ze},null,544),[[Te,w.value]])]),k.value?(r(),h("div",hs,[s("div",fs,[s("div",_s,[n(a(l),{icon:a($)},null,8,["icon"])]),s("div",gs,[s("span",ys,d(k.value.full_name),1),s("span",bs,d(De(k.value.birth_date))+" ‚Ä¢ "+d(k.value.age)+" anos ",1)]),n(a(q),{fill:"clear",onClick:sa},{default:c(()=>[n(a(l),{icon:a(fe),slot:"icon-only"},null,8,["icon"])]),_:1})])])):I.value.length>0&&w.value.length>0?(r(),h("div",ks,[(r(!0),h(ee,null,ae(I.value,t=>(r(),h("div",{key:t.id,class:"action-btn",onClick:u=>aa(t)},[s("div",ws,[n(a(l),{icon:a(he)},null,8,["icon"])]),s("div",Ps,[s("span",Is,d(t.full_name),1),s("span",Ss,d(De(t.birth_date))+" ‚Ä¢ "+d(t.age)+" anos ",1)]),n(a(l),{icon:a(Ha),class:"chevron"},null,8,["icon"])],8,Cs))),128))])):w.value.length>2&&I.value.length===0&&!B.value?(r(),h("div",Os,[n(a(l),{icon:a(te),class:"no-results-icon"},null,8,["icon"]),e[14]||(e[14]=s("h3",null,"Paciente n√£o encontrado",-1)),e[15]||(e[15]=s("p",null,"N√£o encontramos nenhum paciente com esse nome.",-1)),n(a(q),{expand:"block",onClick:ta,class:"register-btn"},{default:c(()=>[n(a(l),{icon:a(he),slot:"start"},null,8,["icon"]),e[13]||(e[13]=_(" Cadastrar Novo Paciente ",-1))]),_:1})])):g("",!0),B.value?(r(),h("div",Ds,[n(a(Da),{name:"crescent"}),e[16]||(e[16]=s("p",null,"Buscando...",-1))])):g("",!0)])])),k.value&&!i.value?(r(),h("div",Es,[s("h2",As,[n(a(l),{icon:a(ze)},null,8,["icon"]),e[17]||(e[17]=_(" Etapa 2: M√°quina e Turno ",-1))]),s("div",Ts,[S.value?(r(),h("div",{key:0,class:b(["availability-badge",S.value.overall_status])},[s("div",Ns,[S.value.overall_status==="good"?(r(),C(a(l),{key:0,icon:a($)},null,8,["icon"])):S.value.overall_status==="critical"?(r(),C(a(l),{key:1,icon:a(_e)},null,8,["icon"])):(r(),C(a(l),{key:2,icon:a(te)},null,8,["icon"]))]),s("div",$s,[s("span",qs,d(S.value.message),1),s("span",Vs,d(S.value.available)+" de "+d(S.value.total)+" dispon√≠veis",1)])],2)):g("",!0),s("div",Rs,[s("label",Ms,[n(a(l),{icon:a(Va)},null,8,["icon"]),e[18]||(e[18]=_(" Selecione a M√°quina ",-1))]),s("div",xs,[(r(!0),h(ee,null,ae(ie.value,t=>(r(),h("button",{key:t.id,type:"button",class:b(["machine-card",{selected:m.value.machine_id===t.id}]),onClick:u=>m.value.machine_id=t.id},[s("div",Bs,[n(a(l),{icon:a(ze)},null,8,["icon"])]),s("div",zs,[s("span",js,d(t.name),1),e[19]||(e[19]=s("span",{class:"machine-status"},"Dispon√≠vel",-1))]),m.value.machine_id===t.id?(r(),h("div",Ls,[n(a(l),{icon:a($)},null,8,["icon"])])):g("",!0)],10,Fs))),128))])]),s("div",Us,[s("label",Hs,[n(a(l),{icon:a(Be)},null,8,["icon"]),e[20]||(e[20]=_(" Selecione o Turno ",-1))]),s("div",Js,[s("button",{type:"button",class:b(["shift-btn",{active:m.value.shift==="matutino"}]),onClick:e[1]||(e[1]=t=>m.value.shift="matutino")},[n(a(l),{icon:a(Ra)},null,8,["icon"]),e[21]||(e[21]=s("span",null,"Matutino",-1)),e[22]||(e[22]=s("span",{class:"shift-time"},"06:00 - 12:00",-1))],2),s("button",{type:"button",class:b(["shift-btn",{active:m.value.shift==="vespertino"}]),onClick:e[2]||(e[2]=t=>m.value.shift="vespertino")},[n(a(l),{icon:a(Ma)},null,8,["icon"]),e[23]||(e[23]=s("span",null,"Vespertino",-1)),e[24]||(e[24]=s("span",{class:"shift-time"},"12:00 - 18:00",-1))],2),s("button",{type:"button",class:b(["shift-btn",{active:m.value.shift==="noturno"}]),onClick:e[3]||(e[3]=t=>m.value.shift="noturno")},[n(a(l),{icon:a(xa)},null,8,["icon"]),e[25]||(e[25]=s("span",null,"Noturno",-1)),e[26]||(e[26]=s("span",{class:"shift-time"},"18:00 - 00:00",-1))],2),s("button",{type:"button",class:b(["shift-btn",{active:m.value.shift==="madrugada"}]),onClick:e[4]||(e[4]=t=>m.value.shift="madrugada")},[n(a(l),{icon:a(Fa)},null,8,["icon"]),e[27]||(e[27]=s("span",null,"Madrugada",-1)),e[28]||(e[28]=s("span",{class:"shift-time"},"00:00 - 06:00",-1))],2)])])]),s("div",Ks,[s("button",{class:"primary-btn",onClick:oa,disabled:!Ke.value},[n(a(l),{icon:a(Ba)},null,8,["icon"]),e[29]||(e[29]=s("div",{class:"btn-text"},[s("span",{class:"btn-title"},"Iniciar Checklist"),s("span",{class:"btn-subtitle"},"Come√ßar verifica√ß√£o de seguran√ßa")],-1)),n(a(l),{icon:a(je)},null,8,["icon"])],8,Ws)])])):g("",!0),i.value?(r(),h("div",Gs,[i.value.current_phase!=="completed"?(r(),C(a(j),{key:0,class:"phase-progress-card"},{default:c(()=>[n(a(L),null,{default:c(()=>[s("div",Qs,[s("h3",null,d(ke(i.value.current_phase)),1),s("div",Xs,[n(a(Re),{color:Ce(i.value.current_phase)},{default:c(()=>[n(a(l),{icon:we(i.value.current_phase)},null,8,["icon"]),n(a(Me),null,{default:c(()=>[_(d(Xe(i.value.current_phase)),1)]),_:1})]),_:1},8,["color"])])]),s("div",Ys,[s("div",Zs,[(r(),h(ee,null,ae(Je,t=>s("div",{class:b(["step",{active:t===i.value.current_phase,completed:Pe(t),interrupted:i.value.is_interrupted}]),key:t},[s("div",et,[Pe(t)?(r(),C(a(l),{key:0,icon:a(H)},null,8,["icon"])):i.value.is_interrupted?(r(),C(a(l),{key:1,icon:a(fe)},null,8,["icon"])):(r(),h("span",at,d(Ye(t)),1))]),s("span",st,d(Ge(t)),1)],2)),64))])]),s("div",tt,[n(a(Ea),{value:M.value/100,color:M.value===100?"success":"primary"},null,8,["value","color"]),s("p",null,d(Math.round(M.value))+"% conclu√≠do",1)])]),_:1})]),_:1})):g("",!0),i.value.current_phase!=="completed"?(r(),C(a(j),{key:1,class:"patient-summary-card"},{default:c(()=>[n(a(L),null,{default:c(()=>{var t;return[s("div",ot,[s("div",nt,[s("h4",null,d(k.value.full_name),1),s("p",null,d((t=ne.value)==null?void 0:t.name)+" ‚Ä¢ Turno "+d(i.value.shift),1)]),s("div",it,[s("p",null,"Iniciado √†s "+d(ue(i.value.pre_dialysis_started_at)),1)])])]}),_:1})]),_:1})):g("",!0),!i.value.is_interrupted&&i.value.current_phase!=="completed"?(r(),h("div",lt,[s("div",rt,[s("div",ct,[n(a(l),{icon:we(i.value.current_phase)},null,8,["icon"])]),s("div",ut,[s("h3",null,d(ke(i.value.current_phase)),1),s("p",null,d(Qe(i.value.current_phase)),1)]),s("div",dt,[n(a(Re),{color:Ce(i.value.current_phase)},{default:c(()=>[_(d(Math.round(M.value))+"% ",1)]),_:1},8,["color"])])]),s("div",pt,[(r(!0),h(ee,null,ae(z(),t=>(r(),C(is,{key:t.key,title:t.label,description:t.description,value:Y(t.key),observation:de(t.key),"onUpdate:value":u=>ha(t.key,u),"onUpdate:observation":u=>fa(t.key,u)},null,8,["title","description","value","observation","onUpdate:value","onUpdate:observation"]))),128))]),s("div",vt,[s("label",mt,[n(a(l),{icon:a(za)},null,8,["icon"]),e[30]||(e[30]=_(" Observa√ß√µes Adicionais ",-1))]),Ae(s("textarea",{"onUpdate:modelValue":e[5]||(e[5]=t=>m.value.observations=t),class:"observations-input",rows:"4",placeholder:"Digite observa√ß√µes sobre esta fase do checklist..."},null,512),[[Te,m.value.observations]])]),s("button",{class:b(["primary-continue-btn",{disabled:!Q.value}]),disabled:!Q.value,onClick:na},[n(a(l),{icon:a($)},null,8,["icon"]),s("div",ft,[s("span",_t,d(We.value?"Concluir Checklist":"Avan√ßar para Pr√≥xima Fase"),1),s("span",gt,d(Q.value?"Todos os itens verificados":"Complete todos os itens obrigat√≥rios"),1)]),n(a(l),{icon:a(je)},null,8,["icon"])],10,ht),s("div",yt,[s("button",{class:"action-card warning",onClick:la},[s("div",bt,[n(a(l),{icon:a(ja)},null,8,["icon"])]),e[31]||(e[31]=s("div",{class:"action-card-content"},[s("span",{class:"action-card-title"},"Pausar"),s("span",{class:"action-card-subtitle"},"Voltar depois")],-1))]),s("button",{class:"action-card danger",onClick:e[6]||(e[6]=t=>v.value=!0)},[s("div",kt,[n(a(l),{icon:a(Le)},null,8,["icon"])]),e[32]||(e[32]=s("div",{class:"action-card-content"},[s("span",{class:"action-card-title"},"Interromper"),s("span",{class:"action-card-subtitle"},"Cancelar processo")],-1))])])])):i.value.is_interrupted?(r(),h("div",Ct,[n(a(j),{class:"interrupted-card"},{default:c(()=>[n(a(L),null,{default:c(()=>[s("div",wt,[n(a(l),{icon:a(te),class:"interrupted-icon"},null,8,["icon"]),e[35]||(e[35]=s("h3",null,"Checklist Interrompido",-1)),s("p",null,"O checklist foi interrompido em "+d(ue(i.value.interrupted_at)),1),s("p",Pt,[e[33]||(e[33]=s("strong",null,"Motivo:",-1)),_(" "+d(i.value.interruption_reason),1)]),n(a(q),{expand:"block",color:"primary",onClick:Se,class:"return-button"},{default:c(()=>[n(a(l),{icon:a(La),slot:"start"},null,8,["icon"]),e[34]||(e[34]=_(" Retornar ao Dashboard ",-1))]),_:1})])]),_:1})]),_:1})])):g("",!0),i.value.current_phase==="completed"?(r(),h("div",It,[n(a(j),{class:"completed-card"},{default:c(()=>[n(a(L),null,{default:c(()=>[s("div",St,[n(a(l),{icon:a($),class:"completed-icon"},null,8,["icon"]),e[37]||(e[37]=s("h3",null,"Checklist Conclu√≠do com Sucesso!",-1)),s("p",null,"Todas as fases foram completadas em "+d(ue(i.value.post_dialysis_completed_at)),1),n(a(q),{expand:"block",color:"success",onClick:Se,class:"return-button"},{default:c(()=>[n(a(l),{icon:a(H),slot:"start"},null,8,["icon"]),e[36]||(e[36]=_(" Finalizar e Retornar ",-1))]),_:1})])]),_:1})]),_:1})])):g("",!0)])):g("",!0)]),n(a(Aa),{"is-open":v.value,onWillDismiss:e[10]||(e[10]=t=>v.value=!1)},{default:c(()=>[n(a(Ve),null,{default:c(()=>[n(a(Ne),null,{default:c(()=>[n(a(qe),null,{default:c(()=>[...e[38]||(e[38]=[_("Interromper Checklist",-1)])]),_:1}),n(a($e),{slot:"end"},{default:c(()=>[n(a(q),{onClick:e[7]||(e[7]=t=>v.value=!1)},{default:c(()=>[n(a(l),{icon:a(fe)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),n(a(xe),null,{default:c(()=>[s("div",Ot,[s("div",Dt,[n(a(l),{icon:a(Ua),class:"warning-icon"},null,8,["icon"]),e[39]||(e[39]=s("h3",null,"Aten√ß√£o!",-1)),e[40]||(e[40]=s("p",null,"Voc√™ est√° prestes a interromper o checklist de seguran√ßa. Esta a√ß√£o deve ser usada apenas em casos de emerg√™ncia ou intercorr√™ncias m√©dicas.",-1))]),s("div",Et,[n(a(Ta),{fill:"outline",class:"patient-input"},{default:c(()=>[n(a(Me),{position:"floating"},{default:c(()=>[...e[41]||(e[41]=[_("Motivo da Interrup√ß√£o",-1)])]),_:1}),n(a(Na),{modelValue:A.value,"onUpdate:modelValue":e[8]||(e[8]=t=>A.value=t),rows:4,placeholder:"Descreva o motivo da interrup√ß√£o (obrigat√≥rio)",required:""},null,8,["modelValue"])]),_:1})]),s("div",At,[n(a(q),{expand:"block",fill:"outline",color:"medium",onClick:e[9]||(e[9]=t=>v.value=!1)},{default:c(()=>[...e[42]||(e[42]=[_(" Cancelar ",-1)])]),_:1}),n(a(q),{expand:"block",color:"danger",disabled:!A.value.trim(),onClick:ia},{default:c(()=>[n(a(l),{icon:a(Le),slot:"start"},null,8,["icon"]),e[43]||(e[43]=_(" Confirmar Interrup√ß√£o ",-1))]),_:1},8,["disabled"])])])]),_:1})]),_:1},8,["is-open"])]),_:1},512)]),_:1}))}}),Rt=He(Tt,[["__scopeId","data-v-9ac56ecf"]]);export{Rt as default};
