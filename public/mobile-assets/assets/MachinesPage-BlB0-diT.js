const __vite__fileDeps=["assets/ionic-C-hOnMqp.js","assets/vendor-BlPZouPF.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{e as Ie,t as h,m as ee,o as N,x as qe,n as ae,k as C,g as l,p as te,q as De,r as Te,B as Oe,C as Se,f as Ve,y as $e,z as Ae,E as Be,i as se,u as A,J as ne,G as Le,K as ze,l as Ne,j as Pe,L as Re,_ as P}from"./ionic-C-hOnMqp.js";import{d as Ue,r as k,c as I,o as Fe,A as M,q as p,x as i,y as a,v as o,H as m,t as s,n as g,G as c,K as x,J as b,F as oe,L as ie,C as le,B as je}from"./vendor-BlPZouPF.js";import{x as He,F as Je,t as R,J as B,y as L,T as U,U as F,z as Ge,V as Ke,N as Qe,k as We,W as Xe,X as Ye,Y as Ze,p as ea,b as aa,r as ta,Z as sa,_ as na}from"./_plugin-vue_export-helper-B7Fc93E3.js";import{C as oa}from"./main-DR8MU-et.js";const ia={class:"machines-container"},la={class:"time-display"},ra={class:"current-date"},ua={class:"current-time"},ca={class:"filter-pills"},da={class:"pill-count"},va={class:"pill-count"},pa={class:"pill-count"},ma={class:"pill-count"},fa={class:"stats-summary"},_a={class:"stat-card available"},ga={class:"stat-info"},ba={class:"stat-number"},ya={class:"stat-card occupied"},ha={class:"stat-info"},wa={class:"stat-number"},ka={class:"stat-card maintenance"},Ca={class:"stat-info"},Ma={class:"stat-number"},xa={class:"stat-card inactive"},Ea={class:"stat-info"},Ia={class:"stat-number"},qa={key:0,class:"loading-container"},Da={key:1,class:"machines-list"},Ta=["onClick"],Oa={class:"machine-card-header"},Sa={class:"machine-primary-info"},Va={class:"machine-name"},$a={key:0,class:"machine-identifier"},Aa={class:"machine-status-badge"},Ba={class:"status-text"},La={key:0,class:"machine-description"},za={key:1,class:"session-info-modern"},Na={class:"session-tag"},Pa={class:"session-details-grid"},Ra={class:"session-detail"},Ua={class:"detail-value"},Fa={class:"session-detail"},ja={class:"detail-value"},Ha={class:"session-detail"},Ja={class:"detail-value"},Ga={class:"session-action"},Ka={key:3,class:"inactive-overlay"},Qa={key:0,class:"empty-state-modern"},Wa={class:"empty-icon"},Xa={class:"form-section"},Ya={class:"form-group"},Za={class:"form-group"},et={class:"form-group"},at={key:0,class:"form-group"},tt={class:"form-actions"},st=Ue({__name:"MachinesPage",setup(nt){const re=je(),D=oa.getInstance().getMachineRepository(),d=k([]),T=k(!1),w=k("all"),j=k(""),H=k(""),O=k(!1),y=k(!1),_=k(!1),q=k([]),r=k({id:null,name:"",identifier:"",description:"",unit_id:null}),J=()=>{const t=new Date;j.value=t.toLocaleDateString("pt-BR",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),H.value=t.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})};setInterval(J,1e3),J();const G=I(()=>d.value.filter(t=>t.status==="available"&&t.is_active!==!1).length),K=I(()=>d.value.filter(t=>t.status==="occupied").length),Q=I(()=>d.value.filter(t=>t.status==="maintenance").length),ue=I(()=>d.value.filter(t=>t.is_active===!1).length),W=I(()=>{switch(w.value){case"available":return d.value.filter(t=>t.status==="available"&&t.is_active!==!1);case"occupied":return d.value.filter(t=>t.status==="occupied");case"maintenance":return d.value.filter(t=>t.status==="maintenance");case"inactive":return d.value.filter(t=>t.is_active===!1);default:return d.value}}),S=async()=>{T.value=!0;try{const t=await D.getAll();d.value=t}catch(t){console.error("Error loading machines:",t),await(await h.create({message:"Erro ao carregar máquinas",duration:3e3,color:"danger",position:"top"})).present()}finally{T.value=!1}},X=async()=>{await S()},ce=async t=>{await X(),t.target.complete()},z=t=>!t.is_active||t.is_active===!1?"inactive":t.status,de=t=>{if(!t.is_active||t.is_active===!1)return"Desativada";switch(t.status){case"available":return"Disponível";case"occupied":return"Em Uso";case"reserved":return"Reservada";case"maintenance":return"Manutenção";default:return t.status}},ve=t=>({pre_dialysis:"Pré-Diálise",during_session:"Durante Sessão",post_dialysis:"Pós-Diálise",completed:"Concluído",interrupted:"Interrompido"})[t]||t,pe=t=>t?new Date(t).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):"",me=t=>{re.push("/checklist/".concat(t))},fe=async t=>{const{alertController:e}=await P(()=>import("./ionic-C-hOnMqp.js").then(u=>u.a6),__vite__mapDeps([0,1]));await(await e.create({header:"Colocar em Manutenção",subHeader:t.name,message:"Descreva brevemente o motivo da manutenção:",inputs:[{name:"reason",type:"textarea",placeholder:"Ex: Troca de filtros, ajuste de pressão, etc."}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Confirmar",handler:u=>{_e(t,u.reason||"")}}]})).present()},_e=async(t,e)=>{var n,u;try{const v=await D.updateStatus(t.id,{status:"maintenance",reason:e}),f=d.value.findIndex($=>$.id===t.id);f!==-1&&(d.value[f]={...d.value[f],...v}),await(await h.create({message:"".concat(t.name," colocada em manutenção"),duration:3e3,color:"success",position:"top"})).present()}catch(v){console.error("Error putting machine in maintenance:",v),await(await h.create({message:((u=(n=v.response)==null?void 0:n.data)==null?void 0:u.message)||"Erro ao colocar máquina em manutenção",duration:4e3,color:"danger",position:"top"})).present()}},ge=async t=>{const{alertController:e}=await P(()=>import("./ionic-C-hOnMqp.js").then(u=>u.a6),__vite__mapDeps([0,1]));await(await e.create({header:"Liberar Máquina",subHeader:t.name,message:"Tem certeza que deseja liberar esta máquina? Ela ficará disponível para uso.",buttons:[{text:"Cancelar",role:"cancel"},{text:"Liberar",handler:async()=>{var u,v;try{const f=await D.updateStatus(t.id,{status:"available"}),E=d.value.findIndex(Ee=>Ee.id===t.id);E!==-1&&(d.value[E]={...d.value[E],...f}),await(await h.create({message:"".concat(t.name," liberada com sucesso"),duration:3e3,color:"success",position:"top"})).present()}catch(f){console.error("Error releasing machine:",f),await(await h.create({message:((v=(u=f.response)==null?void 0:u.data)==null?void 0:v.message)||"Erro ao liberar máquina",duration:4e3,color:"danger",position:"top"})).present()}}}]})).present()},be=async t=>{const{alertController:e}=await P(()=>import("./ionic-C-hOnMqp.js").then(v=>v.a6),__vite__mapDeps([0,1])),n=!t.is_active;await(await e.create({header:n?"Ativar Máquina":"Desativar Máquina",subHeader:t.name,message:n?"A máquina será ativada e ficará disponível para uso.":"Descreva brevemente o motivo da desativação:",inputs:n?[]:[{name:"reason",type:"textarea",placeholder:"Ex: Equipamento danificado, aguardando reparo, etc."}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Confirmar",handler:v=>{ye(t,(v==null?void 0:v.reason)||"")}}]})).present()},ye=async(t,e)=>{var n,u;try{const v=await D.toggleActive(t.id,{reason:e}),f=d.value.findIndex($=>$.id===t.id);f!==-1&&(d.value[f]={...d.value[f],...v}),await(await h.create({message:v.is_active?"".concat(t.name," ativada com sucesso"):"".concat(t.name," desativada com sucesso"),duration:3e3,color:"success",position:"top"})).present()}catch(v){console.error("Error toggling machine active:",v),await(await h.create({message:((u=(n=v.response)==null?void 0:n.data)==null?void 0:u.message)||"Erro ao alterar estado da máquina",duration:4e3,color:"danger",position:"top"})).present()}},he=()=>{switch(w.value){case"available":return"Nenhuma máquina disponível no momento";case"occupied":return"Nenhuma máquina em uso";case"maintenance":return"Nenhuma máquina em manutenção";case"inactive":return"Nenhuma máquina desativada";default:return"Nenhuma máquina cadastrada"}},Y=I(()=>r.value.name.trim()!==""&&r.value.identifier.trim()!==""&&(y.value||r.value.unit_id!==null)),Z=async()=>{try{const e=await(await fetch("/api/user-units",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();e.success&&(q.value=e.units||[],e.current_unit_id&&!y.value?r.value.unit_id=e.current_unit_id:q.value.length===1&&(r.value.unit_id=q.value[0].id))}catch(t){console.error("Erro ao carregar unidades:",t)}},we=async()=>{y.value=!1,r.value={id:null,name:"",identifier:"",description:"",unit_id:null},await Z(),O.value=!0},ke=async t=>{y.value=!0,r.value={id:t.id,name:t.name,identifier:t.identifier,description:t.description||"",unit_id:t.unit_id},await Z(),O.value=!0},V=()=>{O.value=!1,r.value={id:null,name:"",identifier:"",description:"",unit_id:null}},Ce=async()=>{if(Y.value){_.value=!0;try{const t=y.value?"/api/machines/".concat(r.value.id):"/api/machines",e=y.value?"PUT":"POST",u=await(await fetch(t,{method:e,headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))},body:JSON.stringify({name:r.value.name,identifier:r.value.identifier,description:r.value.description,unit_id:r.value.unit_id})})).json();if(u.success)await(await h.create({message:u.message||(y.value?"Máquina atualizada com sucesso!":"Máquina criada com sucesso!"),duration:3e3,color:"success",position:"top"})).present(),V(),await S();else throw new Error(u.message||"Erro ao salvar máquina")}catch(t){await(await h.create({message:t.message||"Erro ao salvar máquina. Tente novamente.",duration:4e3,color:"danger",position:"top"})).present()}finally{_.value=!1}}},Me=async()=>{await(await Ne.create({header:"Confirmar Exclusão",message:"Tem certeza que deseja excluir a máquina <strong>".concat(r.value.name,"</strong>? Esta ação irá desativá-la."),buttons:[{text:"Cancelar",role:"cancel"},{text:"Excluir",role:"destructive",handler:async()=>{await xe()}}]})).present()},xe=async()=>{if(r.value.id){_.value=!0;try{const e=await(await fetch("/api/machines/".concat(r.value.id),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();if(e.success)await(await h.create({message:e.message||"Máquina removida com sucesso!",duration:3e3,color:"success",position:"top"})).present(),V(),await S();else throw new Error(e.message||"Erro ao excluir máquina")}catch(t){await(await h.create({message:t.message||"Erro ao excluir máquina. Tente novamente.",duration:4e3,color:"danger",position:"top"})).present()}finally{_.value=!1}}};return Fe(()=>{S()}),(t,e)=>(p(),M(a(Ie),null,{default:i(()=>[o(a(te),{translucent:!0},{default:i(()=>[o(a(ee),{color:"primary"},{default:i(()=>[o(a(N),{slot:"start"},{default:i(()=>[o(a(qe),{"default-href":"/dashboard"})]),_:1}),o(a(ae),null,{default:i(()=>[...e[9]||(e[9]=[m("Gestão de Máquinas",-1)])]),_:1}),o(a(N),{slot:"end"},{default:i(()=>[o(a(C),{onClick:X,disabled:T.value},{default:i(()=>[o(a(l),{icon:a(He)},null,8,["icon"])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),o(a(se),{fullscreen:!0,class:"machines-content"},{default:i(()=>[s("div",ia,[o(a(De),{slot:"fixed",onIonRefresh:ce},{default:i(()=>[o(a(Te))]),_:1}),o(a(Oe),{class:"time-header-card"},{default:i(()=>[o(a(Se),null,{default:i(()=>[s("div",la,[s("div",ra,[o(a(l),{icon:a(Je),class:"date-icon"},null,8,["icon"]),m(" "+c(j.value),1)]),s("div",ua,[o(a(l),{icon:a(R),class:"time-icon"},null,8,["icon"]),m(" "+c(H.value),1)])])]),_:1})]),_:1}),s("div",ca,[s("button",{class:x(["filter-pill",{active:w.value==="all"}]),onClick:e[0]||(e[0]=n=>w.value="all")},[o(a(l),{icon:a(B)},null,8,["icon"]),e[10]||(e[10]=s("span",null,"Todas",-1)),s("span",da,c(d.value.length),1)],2),s("button",{class:x(["filter-pill available",{active:w.value==="available"}]),onClick:e[1]||(e[1]=n=>w.value="available")},[o(a(l),{icon:a(L)},null,8,["icon"]),e[11]||(e[11]=s("span",null,"Disponíveis",-1)),s("span",va,c(G.value),1)],2),s("button",{class:x(["filter-pill occupied",{active:w.value==="occupied"}]),onClick:e[2]||(e[2]=n=>w.value="occupied")},[o(a(l),{icon:a(R)},null,8,["icon"]),e[12]||(e[12]=s("span",null,"Em Uso",-1)),s("span",pa,c(K.value),1)],2),s("button",{class:x(["filter-pill maintenance",{active:w.value==="maintenance"}]),onClick:e[3]||(e[3]=n=>w.value="maintenance")},[o(a(l),{icon:a(U)},null,8,["icon"]),e[13]||(e[13]=s("span",null,"Manutenção",-1)),s("span",ma,c(Q.value),1)],2)]),s("div",fa,[s("div",_a,[o(a(l),{icon:a(L)},null,8,["icon"]),s("div",ga,[s("span",ba,c(G.value),1),e[14]||(e[14]=s("span",{class:"stat-label"},"Disponíveis",-1))])]),s("div",ya,[o(a(l),{icon:a(R)},null,8,["icon"]),s("div",ha,[s("span",wa,c(K.value),1),e[15]||(e[15]=s("span",{class:"stat-label"},"Em Uso",-1))])]),s("div",ka,[o(a(l),{icon:a(U)},null,8,["icon"]),s("div",Ca,[s("span",Ma,c(Q.value),1),e[16]||(e[16]=s("span",{class:"stat-label"},"Manutenção",-1))])]),s("div",xa,[o(a(l),{icon:a(F)},null,8,["icon"]),s("div",Ea,[s("span",Ia,c(ue.value),1),e[17]||(e[17]=s("span",{class:"stat-label"},"Desativadas",-1))])])]),T.value?(p(),g("div",qa,[o(a(Ve),{name:"crescent"}),e[18]||(e[18]=s("p",null,"Carregando máquinas...",-1))])):(p(),g("div",Da,[(p(!0),g(oe,null,ie(W.value,n=>(p(),g("div",{key:n.id,class:x(["machine-card-modern",z(n)]),onClick:u=>n.current_checklist&&me(n.current_checklist.id)},[s("div",Oa,[s("div",{class:x(["machine-icon-large",z(n)])},[o(a(l),{icon:a(B)},null,8,["icon"])],2),s("div",Sa,[s("h3",Va,c(n.name),1),n.identifier?(p(),g("p",$a,c(n.identifier),1)):b("",!0)]),s("div",Aa,[s("div",{class:x(["status-dot",z(n)])},null,2),s("span",Ba,c(de(n)),1)])]),n.description?(p(),g("div",La,c(n.description),1)):b("",!0),n.current_checklist?(p(),g("div",za,[s("div",Na,[o(a(l),{icon:a(ea)},null,8,["icon"]),e[20]||(e[20]=s("span",null,"Sessão Ativa",-1)),n.current_checklist.is_paused?(p(),M(a(Pe),{key:0,color:"warning"},{default:i(()=>[...e[19]||(e[19]=[m("Pausado",-1)])]),_:1})):b("",!0)]),s("div",Pa,[s("div",Ra,[e[21]||(e[21]=s("span",{class:"detail-label"},"Paciente",-1)),s("span",Ua,c(n.current_checklist.patient_name),1)]),s("div",Fa,[e[22]||(e[22]=s("span",{class:"detail-label"},"Fase",-1)),s("span",ja,c(ve(n.current_checklist.current_phase)),1)]),s("div",Ha,[e[23]||(e[23]=s("span",{class:"detail-label"},"Início",-1)),s("span",Ja,c(pe(n.current_checklist.started_at)),1)])]),s("div",Ga,[o(a(l),{icon:a(aa)},null,8,["icon"]),e[24]||(e[24]=s("span",null,"Clique para ver checklist",-1)),o(a(l),{icon:a(ta)},null,8,["icon"])])])):b("",!0),n.current_checklist?b("",!0):(p(),g("div",{key:2,class:"machine-actions",onClick:e[4]||(e[4]=le(()=>{},["stop"]))},[o(a(C),{fill:"clear",size:"small",color:"medium",onClick:u=>ke(n)},{default:i(()=>[o(a(l),{slot:"start",icon:a(sa)},null,8,["icon"]),e[25]||(e[25]=m(" Editar ",-1))]),_:1},8,["onClick"]),n.is_active&&n.status==="available"?(p(),M(a(C),{key:0,fill:"outline",size:"small",color:"warning",onClick:u=>fe(n)},{default:i(()=>[o(a(l),{slot:"start",icon:a(U)},null,8,["icon"]),e[26]||(e[26]=m(" Manutenção ",-1))]),_:1},8,["onClick"])):b("",!0),n.is_active&&n.status==="maintenance"?(p(),M(a(C),{key:1,fill:"solid",size:"small",color:"success",onClick:u=>ge(n)},{default:i(()=>[o(a(l),{slot:"start",icon:a(L)},null,8,["icon"]),e[27]||(e[27]=m(" Liberar Máquina ",-1))]),_:1},8,["onClick"])):b("",!0),n.status!=="occupied"?(p(),M(a(C),{key:2,fill:"outline",size:"small",color:n.is_active?"danger":"success",onClick:u=>be(n)},{default:i(()=>[o(a(l),{slot:"start",icon:n.is_active?a(F):a(L)},null,8,["icon"]),m(" "+c(n.is_active?"Desativar":"Ativar"),1)]),_:2},1032,["color","onClick"])):b("",!0)])),n.is_active?b("",!0):(p(),g("div",Ka,[o(a(l),{icon:a(F)},null,8,["icon"]),e[28]||(e[28]=s("span",null,"Desativada",-1))]))],10,Ta))),128)),W.value.length===0?(p(),g("div",Qa,[s("div",Wa,[o(a(l),{icon:a(B)},null,8,["icon"])]),e[29]||(e[29]=s("h3",null,"Nenhuma máquina encontrada",-1)),s("p",null,c(he()),1)])):b("",!0)]))]),o(a($e),{vertical:"bottom",horizontal:"end",slot:"fixed"},{default:i(()=>[o(a(Ae),{onClick:we},{default:i(()=>[o(a(l),{icon:a(Ge)},null,8,["icon"])]),_:1})]),_:1}),o(a(Be),{"is-open":O.value,onDidDismiss:V},{default:i(()=>[o(a(te),null,{default:i(()=>[o(a(ee),null,{default:i(()=>[o(a(ae),null,{default:i(()=>[m(c(y.value?"Editar Máquina":"Nova Máquina"),1)]),_:1}),o(a(N),{slot:"end"},{default:i(()=>[o(a(C),{onClick:V},{default:i(()=>[...e[30]||(e[30]=[m("Cancelar",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),o(a(se),{class:"machine-modal-content"},{default:i(()=>[s("form",{onSubmit:le(Ce,["prevent"]),class:"machine-form"},[s("div",Xa,[e[35]||(e[35]=s("h3",{class:"section-title"},"Informações Básicas",-1)),s("div",Ya,[o(a(A),{position:"stacked",class:"form-label"},{default:i(()=>[o(a(l),{icon:a(B)},null,8,["icon"]),e[31]||(e[31]=m(" Nome da Máquina * ",-1))]),_:1}),o(a(ne),{modelValue:r.value.name,"onUpdate:modelValue":e[5]||(e[5]=n=>r.value.name=n),type:"text",placeholder:"Ex: Máquina 01",required:"",disabled:_.value,class:"custom-input"},null,8,["modelValue","disabled"])]),s("div",Za,[o(a(A),{position:"stacked",class:"form-label"},{default:i(()=>[o(a(l),{icon:a(Ke)},null,8,["icon"]),e[32]||(e[32]=m(" Identificador/Código * ",-1))]),_:1}),o(a(ne),{modelValue:r.value.identifier,"onUpdate:modelValue":e[6]||(e[6]=n=>r.value.identifier=n),type:"text",placeholder:"Ex: MAQ-001",required:"",disabled:_.value,class:"custom-input"},null,8,["modelValue","disabled"])]),s("div",et,[o(a(A),{position:"stacked",class:"form-label"},{default:i(()=>[o(a(l),{icon:a(Qe)},null,8,["icon"]),e[33]||(e[33]=m(" Descrição ",-1))]),_:1}),o(a(Le),{modelValue:r.value.description,"onUpdate:modelValue":e[7]||(e[7]=n=>r.value.description=n),placeholder:"Informações adicionais sobre a máquina",rows:4,disabled:_.value,class:"custom-textarea"},null,8,["modelValue","disabled"])]),y.value?b("",!0):(p(),g("div",at,[o(a(A),{position:"stacked",class:"form-label"},{default:i(()=>[o(a(l),{icon:a(We)},null,8,["icon"]),e[34]||(e[34]=m(" Unidade * ",-1))]),_:1}),o(a(ze),{modelValue:r.value.unit_id,"onUpdate:modelValue":e[8]||(e[8]=n=>r.value.unit_id=n),placeholder:"Selecione a unidade",interface:"action-sheet",disabled:_.value||q.value.length===1,class:"custom-select"},{default:i(()=>[(p(!0),g(oe,null,ie(q.value,n=>(p(),M(a(Re),{key:n.id,value:n.id},{default:i(()=>[m(c(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","disabled"])]))]),s("div",tt,[o(a(C),{expand:"block",type:"submit",disabled:_.value||!Y.value,class:"submit-button"},{default:i(()=>[o(a(l),{slot:"start",icon:_.value?a(Xe):a(Ye)},null,8,["icon"]),m(" "+c(_.value?"Salvando...":y.value?"Atualizar Máquina":"Criar Máquina"),1)]),_:1},8,["disabled"]),y.value?(p(),M(a(C),{key:0,expand:"block",fill:"outline",color:"danger",onClick:Me,disabled:_.value,class:"delete-button"},{default:i(()=>[o(a(l),{slot:"start",icon:a(Ze)},null,8,["icon"]),e[36]||(e[36]=m(" Excluir Máquina ",-1))]),_:1},8,["disabled"])):b("",!0)])],32)]),_:1})]),_:1},8,["is-open"])]),_:1})]),_:1}))}}),ct=na(st,[["__scopeId","data-v-004a3035"]]);export{ct as default};
