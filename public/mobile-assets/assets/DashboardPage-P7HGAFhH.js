import{d as ne,c as y,n as C,q as p,t as s,v as o,G as h,x as r,H as D,y as e,I as Se,J as b,B as z,K as F,r as g,o as Ie,z as De,F as Oe,L as ze}from"./vendor-BOCCj2ty.js";import{j as ie,g as n,k as O,l as V,e as Ue,t as w,m as Ae,n as Me,o as Pe,p as Ee,q as Te,r as Be,s as Z,u as ee,i as Le,v as Re,w as je}from"./ionic-ZHEFjxIb.js";import{p as qe,t as G,d as se,f as te,i as Ne,_ as le,g as xe,h as He,j as Fe,k as ae,n as Ve,o as oe,m as Ge,q as Je,r as q,u as Ke,v as Qe,w as We}from"./_plugin-vue_export-helper-B7Fc93E3.js";import{C as Xe,u as Ye}from"./main-DBJYqMy6.js";import{u as Ze}from"./useStatsAutoRefresh-D7WZpa6s.js";const es={class:"card-header"},ss={class:"machine-info"},ts={class:"machine-id"},as={class:"patient-info"},os={class:"patient-name"},ns={class:"progress-section"},is={class:"progress-bar"},ls={class:"progress-text"},cs={class:"time-info"},rs={class:"time-item"},us={class:"time-value"},ds={key:0,class:"time-item"},hs={class:"time-value"},ps={class:"actions"},vs=ne({__name:"ActiveChecklistCard",props:{checklist:{}},emits:["continue","pause","resume"],setup(J,{emit:k}){const u=J,R=y(()=>({pre_dialysis:"Pr칠-Di치lise",during_session:"Durante Sess칚o",post_dialysis:"P칩s-Di치lise",completed:"Conclu칤do",interrupted:"Interrompido"})[u.checklist.current_phase]||u.checklist.current_phase),N=y(()=>({pre_dialysis:"primary",during_session:"warning",post_dialysis:"secondary",completed:"success",interrupted:"danger"})[u.checklist.current_phase]||"medium"),U=y(()=>u.checklist.current_phase.replace("_","-")),A=y(()=>u.checklist.phase_completion!==void 0?Math.round(u.checklist.phase_completion):{pre_dialysis:25,during_session:50,post_dialysis:75,completed:100,interrupted:0}[u.checklist.current_phase]||0),v=y(()=>{const i=new Date(u.checklist.created_at),_=new Date().getTime()-i.getTime(),m=Math.floor(_/(1e3*60*60)),S=Math.floor(_%(1e3*60*60)/(1e3*60));return m>0?"".concat(m,"h ").concat(S,"m"):"".concat(S,"m")}),M=y(()=>{if(!u.checklist.paused_at)return"";const i=new Date(u.checklist.paused_at),_=new Date().getTime()-i.getTime(),m=Math.floor(_/(1e3*60*60)),S=Math.floor(_%(1e3*60*60)/(1e3*60));return m>0?"".concat(m,"h ").concat(S,"m"):"".concat(S,"m")}),P=async()=>{await(await V.create({header:"Detalhes do Checklist",subHeader:"".concat(u.checklist.machine.name," - ").concat(u.checklist.patient.name),message:"\n      <strong>Fase:</strong> ".concat(R.value,"<br>\n      <strong>Progresso:</strong> ").concat(A.value,"%<br>\n      <strong>Iniciado:</strong> ").concat(new Date(u.checklist.created_at).toLocaleString("pt-BR"),"<br>\n      ").concat(u.checklist.paused_at?"<strong>Pausado:</strong> ".concat(new Date(u.checklist.paused_at).toLocaleString("pt-BR"),"<br>"):"","\n    "),buttons:["Fechar"]})).present()};return(i,c)=>(p(),C("div",{class:F(["checklist-card",[U.value,{paused:i.checklist.paused_at}]])},[s("div",es,[s("div",ss,[s("h3",null,h(i.checklist.machine.name),1),s("p",ts,h(i.checklist.machine.identifier),1)]),o(e(ie),{color:N.value,class:"phase-badge"},{default:r(()=>[D(h(R.value),1)]),_:1},8,["color"])]),s("div",as,[o(e(n),{icon:e(qe),class:"patient-icon"},null,8,["icon"]),s("span",os,h(i.checklist.patient.name),1)]),s("div",ns,[s("div",is,[s("div",{class:"progress-fill",style:Se({width:A.value+"%"})},null,4)]),s("span",ls,h(A.value)+"% completo",1)]),s("div",cs,[s("div",rs,[o(e(n),{icon:e(G),class:"time-icon"},null,8,["icon"]),c[3]||(c[3]=s("span",{class:"time-label"},"Iniciado h치",-1)),s("span",us,h(v.value),1)]),i.checklist.paused_at?(p(),C("div",ds,[o(e(n),{icon:e(se),class:"time-icon paused"},null,8,["icon"]),c[4]||(c[4]=s("span",{class:"time-label"},"Pausado h치",-1)),s("span",hs,h(M.value),1)])):b("",!0)]),s("div",ps,[i.checklist.paused_at?b("",!0):(p(),z(e(O),{key:0,fill:"outline",size:"small",onClick:c[0]||(c[0]=_=>i.$emit("continue",i.checklist)),class:"action-button continue"},{default:r(()=>[o(e(n),{icon:e(te),slot:"start"},null,8,["icon"]),c[5]||(c[5]=D(" Continuar ",-1))]),_:1})),i.checklist.paused_at?(p(),z(e(O),{key:1,fill:"solid",size:"small",onClick:c[1]||(c[1]=_=>i.$emit("resume",i.checklist)),class:"action-button resume",color:"success"},{default:r(()=>[o(e(n),{icon:e(te),slot:"start"},null,8,["icon"]),c[6]||(c[6]=D(" Retomar ",-1))]),_:1})):b("",!0),i.checklist.paused_at?b("",!0):(p(),z(e(O),{key:2,fill:"outline",size:"small",onClick:c[2]||(c[2]=_=>i.$emit("pause",i.checklist)),class:"action-button pause",color:"warning"},{default:r(()=>[o(e(n),{icon:e(se),slot:"start"},null,8,["icon"]),c[7]||(c[7]=D(" Pausar ",-1))]),_:1})),o(e(O),{fill:"clear",size:"small",onClick:P,class:"action-button details"},{default:r(()=>[o(e(n),{icon:e(Ne),slot:"icon-only"},null,8,["icon"])]),_:1})]),s("div",{class:F(["status-indicator",U.value])},null,2)],2))}}),ms=le(vs,[["__scopeId","data-v-afd1addd"]]),gs={class:"dashboard-container"},_s={key:0,class:"welcome-section"},fs={class:"welcome-header"},ks={class:"welcome-text"},ws={class:"unit-display"},Cs={key:0,class:"unit-info-static"},ys={class:"unit-text-static"},bs={class:"unit-name-static"},$s={key:1,class:"unit-info"},Ss={class:"unit-text"},Is={class:"unit-name"},Ds={key:1,class:"quick-stats"},Os={key:0,class:"stats-update-badge"},zs={class:"stat-icon"},Us={class:"stat-content"},As={class:"stat-number"},Ms={class:"stat-icon"},Ps={class:"stat-content"},Es={class:"stat-number"},Ts={class:"stat-card total"},Bs={class:"stat-icon"},Ls={class:"stat-content"},Rs={class:"stat-number"},js={class:"primary-action"},qs={class:"section"},Ns={class:"quick-actions"},xs={class:"action-icon warning"},Hs={class:"action-content"},Fs={class:"action-subtitle"},Vs={class:"action-icon tertiary"},Gs={class:"action-icon cleaning"},Js={class:"action-icon primary"},Ks={key:2,class:"section"},Qs={class:"checklists-list"},Ws={class:"connection-status"},Xs=ne({__name:"DashboardPage",setup(J){const k=De(),u=Xe.getInstance(),R=u.getCurrentUserUseCase(),N=u.getLogoutUseCase(),{isDarkMode:U,toggleDarkMode:A}=Ye(),v=g(null),M=g(navigator.onLine),P=g(!1),i=g(0),c=g(3),_=g(!1),m=g([]),S=g([]),E=g([]),T=g([]),I=g(null),$=g(null);y(()=>v.value&&{tecnico:"T칠cnico",admin:"Admin",gestor:"Gestor",coordenador:"Coordenador",supervisor:"Supervisor"}[v.value.role]||"Usu치rio");const x=y(()=>m.value.filter(a=>!a.paused_at).length);y(()=>m.value.filter(a=>a.paused_at).length);const H=y(()=>S.value.length),K=async()=>{try{v.value=await R.execute(),console.log("User loaded:",v.value),await ce()}catch(a){console.error("Error loading user:",a),await(await w.create({message:"Erro ao carregar dados do usu치rio",duration:3e3,color:"danger",position:"top"})).present(),setTimeout(()=>{k.replace("/login")},2e3)}},ce=async()=>{var a,t;try{const d=await(await fetch("/api/user-units",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();if(d.success){T.value=d.units||[];const f=d.current_unit_id;f?(I.value=d.units.find(L=>L.id===f),$.value=f):d.units.length>0&&(I.value=d.units[0],$.value=d.units[0].id),console.log("Unidades carregadas (mobile):",{total:T.value.length,current:(a=I.value)==null?void 0:a.name,currentId:$.value})}}catch(l){console.error("Error loading available units:",l),(t=v.value)!=null&&t.unit&&(I.value=v.value.unit,$.value=v.value.unit.id,T.value=v.value.units||[v.value.unit])}},re=async()=>{const a=T.value.map(l=>({text:l.name,icon:l.id===$.value?"checkmark-circle-outline":"location-outline",cssClass:l.id===$.value?"unit-selected":"",handler:()=>{l.id!==$.value&&ue(l.id)}}));a.push({text:"Cancelar",icon:"close-outline",handler:()=>{}}),await(await Re.create({header:"Selecionar Unidade",subHeader:"Escolha a unidade para visualizar",buttons:a,cssClass:"unit-selector-action-sheet"})).present()},ue=async a=>{var t;try{const l=await je.create({message:"Alternando unidade...",spinner:"crescent",duration:1e4});await l.present();const f=await(await fetch("/api/user-units/switch",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token")),"Content-Type":"application/json"},body:JSON.stringify({unit_id:a})})).json();await l.dismiss(),f.success&&(I.value=f.current_unit,$.value=a,await(await w.create({message:"游늸 Unidade alterada para ".concat(f.current_unit.name),duration:2e3,color:"success",position:"top",cssClass:"custom-toast"})).present(),await B())}catch(l){console.error("Error switching unit:",l),$.value=(t=I.value)==null?void 0:t.id,await(await w.create({message:"Erro ao trocar de unidade",duration:3e3,color:"danger",position:"top"})).present()}},B=async()=>{try{await Promise.all([pe(),ve(),me()]),i.value=m.value.length,c.value=E.value.length,P.value=!0,console.log("Stats loaded")}catch(a){console.error("Error loading stats:",a),P.value=!0}},{isRefreshing:j,hasUpdates:de,forceRefresh:he}=Ze(B,{loadOnMount:!1,interval:15e3,onStatsUpdated:()=>{console.log("[Dashboard] Stats atualizados automaticamente")},debug:!1}),pe=async()=>{try{const t=await(await fetch("/api/checklists/active",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();t.success&&(m.value=t.checklists)}catch(a){console.error("Erro ao carregar checklists ativos:",a)}},ve=async()=>{try{const t=await(await fetch("/api/machines/available",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();t.success&&(S.value=t.machines)}catch(a){console.error("Erro ao carregar m치quinas dispon칤veis:",a)}},me=async()=>{try{const a=await fetch("/api/machines",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token")),"Content-Type":"application/json",Accept:"application/json"}});if(!a.ok){console.warn("Failed to load machines: ".concat(a.status)),E.value=[];return}const t=await a.json();t.success&&t.machines?E.value=t.machines:E.value=[]}catch(a){console.error("Erro ao carregar m치quinas:",a),E.value=[]}},ge=async a=>{try{await Promise.all([K(),he()]),await(await w.create({message:"Dados atualizados",duration:1500,color:"success",position:"top"})).present()}catch(t){console.error("Error refreshing:",t)}finally{a.target.complete()}},_e=async()=>{await(await V.create({header:"Confirmar Sa칤da",message:"Deseja realmente sair do aplicativo?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Sair",role:"confirm",handler:async()=>{try{await N.execute(),await(await w.create({message:"Logout realizado com sucesso",duration:2e3,color:"success",position:"top"})).present(),k.replace("/login")}catch(t){console.error("Logout error:",t),k.replace("/login")}}}]})).present()},fe=()=>{console.log("Navigating to new checklist..."),k.push("/checklist/new")},ke=()=>{console.log("Navigating to patients..."),k.push("/patients")},Q=()=>{console.log("Navigating to active checklists..."),k.push("/checklists")},W=()=>{k.push("/machines")},we=()=>{console.log("Navigating to cleaning controls..."),k.push("/cleaning-controls")},Ce=a=>{k.push("/checklist/".concat(a.id))},ye=async a=>{await(await V.create({header:"Pausar Checklist",message:"Deseja pausar o checklist da m치quina ".concat(a.machine.name,"?"),buttons:[{text:"Cancelar",role:"cancel"},{text:"Pausar",handler:async()=>{try{const d=await(await fetch("/api/checklists/".concat(a.id,"/pause"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();if(d.success)await(await w.create({message:"Checklist pausado com sucesso.",duration:3e3,color:"success"})).present(),await B();else throw new Error(d.message)}catch(l){await(await w.create({message:"Erro ao pausar checklist.",duration:3e3,color:"danger"})).present()}}}]})).present()},be=async a=>{try{const l=await(await fetch("/api/checklists/".concat(a.id,"/resume"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();if(l.success)await(await w.create({message:"Checklist retomado com sucesso.",duration:3e3,color:"success"})).present(),await B();else throw new Error(l.message)}catch(t){await(await w.create({message:"Erro ao retomar checklist.",duration:3e3,color:"danger"})).present()}},$e=async()=>{A(),await(await w.create({message:"Modo ".concat(U.value?"escuro":"claro"," ativado"),duration:1500,color:"medium",position:"bottom"})).present()},X=()=>{M.value=navigator.onLine};return Ie(async()=>{console.log("Dashboard mounted, loading data..."),_.value=!0;try{await K(),B(),window.addEventListener("online",X),window.addEventListener("offline",X)}catch(a){console.error("Dashboard initialization error:",a)}finally{_.value=!1}}),(a,t)=>(p(),z(e(Ue),null,{default:r(()=>[o(e(Ee),null,{default:r(()=>[o(e(Ae),{color:"primary"},{default:r(()=>[o(e(Me),null,{default:r(()=>[...t[0]||(t[0]=[D("Hemodi치lise Mobile",-1)])]),_:1}),o(e(Pe),{slot:"end"},{default:r(()=>[o(e(O),{onClick:$e,fill:"clear",class:"theme-toggle-btn"},{default:r(()=>[o(e(n),{icon:e(U)?e(xe):e(He),slot:"icon-only"},null,8,["icon"])]),_:1}),o(e(O),{onClick:_e,fill:"clear"},{default:r(()=>[o(e(n),{icon:e(Fe),slot:"icon-only"},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),o(e(Le),{fullscreen:!0,class:"dashboard-content"},{default:r(()=>{var l,d,f,L;return[o(e(Te),{slot:"fixed",onIonRefresh:ge},{default:r(()=>[o(e(Be))]),_:1}),s("div",gs,[v.value?(p(),C("div",_s,[s("div",fs,[s("div",ks,[s("h1",null,"Ol치, "+h(v.value.name.split(" ")[0])+"! 游녦",1)])]),s("div",ws,[T.value.length<=1?(p(),C("div",Cs,[o(e(n),{icon:e(ae),class:"unit-icon-static"},null,8,["icon"]),s("div",ys,[t[1]||(t[1]=s("span",{class:"unit-label-static"},"Unidade",-1)),s("span",bs,h(((l=I.value)==null?void 0:l.name)||((d=v.value.unit)==null?void 0:d.name)||"Carregando..."),1)])])):(p(),C("div",$s,[o(e(n),{icon:e(ae),class:"unit-icon"},null,8,["icon"]),s("div",Ss,[t[2]||(t[2]=s("span",{class:"unit-label"},"Unidade Atual",-1)),s("span",Is,h(((f=I.value)==null?void 0:f.name)||((L=v.value.unit)==null?void 0:L.name)||"Carregando..."),1)]),o(e(O),{fill:"clear",size:"small",onClick:re,class:"unit-change-btn"},{default:r(()=>[o(e(n),{slot:"icon-only",icon:e(Ve)},null,8,["icon"])]),_:1})]))])])):b("",!0),P.value?(p(),C("div",Ds,[e(de)||e(j)?(p(),C("div",Os,[o(e(Z),{color:"success",class:"update-chip"},{default:r(()=>[o(e(n),{icon:e(j)?"sync-outline":"checkmark-circle-outline",class:F({spinning:e(j)})},null,8,["icon","class"]),o(e(ee),null,{default:r(()=>[D(h(e(j)?"Atualizando...":"Atualizado"),1)]),_:1})]),_:1})])):b("",!0),s("div",{class:"stat-card available",onClick:W},[s("div",zs,[o(e(n),{icon:e(oe)},null,8,["icon"])]),s("div",Us,[s("div",As,h(H.value),1),t[3]||(t[3]=s("div",{class:"stat-label"},"Dispon칤veis",-1))])]),s("div",{class:"stat-card active",onClick:Q},[s("div",Ms,[o(e(n),{icon:e(G)},null,8,["icon"])]),s("div",Ps,[s("div",Es,h(x.value),1),t[4]||(t[4]=s("div",{class:"stat-label"},"Em Andamento",-1))])]),s("div",Ts,[s("div",Bs,[o(e(n),{icon:e(Ge)},null,8,["icon"])]),s("div",Ls,[s("div",Rs,h(c.value),1),t[5]||(t[5]=s("div",{class:"stat-label"},"Total M치quinas",-1))])])])):b("",!0),s("div",js,[s("button",{class:"primary-btn",onClick:fe},[o(e(n),{icon:e(Je)},null,8,["icon"]),t[6]||(t[6]=s("div",{class:"btn-text"},[s("span",{class:"btn-title"},"Novo Checklist"),s("span",{class:"btn-subtitle"},"Iniciar verifica칞칚o de seguran칞a")],-1)),H.value>0?(p(),z(e(ie),{key:0,color:"success"},{default:r(()=>[D(h(H.value),1)]),_:1})):b("",!0)])]),s("div",qs,[t[11]||(t[11]=s("h2",{class:"section-title"},"Acesso R치pido",-1)),s("div",Ns,[x.value>0?(p(),C("div",{key:0,class:"action-btn",onClick:Q},[s("div",xs,[o(e(n),{icon:e(G)},null,8,["icon"])]),s("div",Hs,[t[7]||(t[7]=s("span",{class:"action-title"},"Checklists Ativos",-1)),s("span",Fs,h(x.value)+" em andamento",1)]),o(e(n),{icon:e(q),class:"chevron"},null,8,["icon"])])):b("",!0),s("div",{class:"action-btn",onClick:W},[s("div",Vs,[o(e(n),{icon:e(oe)},null,8,["icon"])]),t[8]||(t[8]=s("div",{class:"action-content"},[s("span",{class:"action-title"},"M치quinas"),s("span",{class:"action-subtitle"},"Status e controle")],-1)),o(e(n),{icon:e(q),class:"chevron"},null,8,["icon"])]),s("div",{class:"action-btn",onClick:we},[s("div",Gs,[o(e(n),{icon:e(Ke)},null,8,["icon"])]),t[9]||(t[9]=s("div",{class:"action-content"},[s("span",{class:"action-title"},"Controle de Limpeza"),s("span",{class:"action-subtitle"},"Limpeza e desinfec칞칚o")],-1)),o(e(n),{icon:e(q),class:"chevron"},null,8,["icon"])]),s("div",{class:"action-btn",onClick:ke},[s("div",Js,[o(e(n),{icon:e(Qe)},null,8,["icon"])]),t[10]||(t[10]=s("div",{class:"action-content"},[s("span",{class:"action-title"},"Pacientes"),s("span",{class:"action-subtitle"},"Buscar e gerenciar")],-1)),o(e(n),{icon:e(q),class:"chevron"},null,8,["icon"])])])]),m.value.length>0?(p(),C("div",Ks,[t[12]||(t[12]=s("h2",{class:"section-title"},"Em Andamento",-1)),s("div",Qs,[(p(!0),C(Oe,null,ze(m.value,Y=>(p(),z(ms,{key:Y.id,checklist:Y,onContinue:Ce,onPause:ye,onResume:be},null,8,["checklist"]))),128))])])):b("",!0),s("div",Ws,[o(e(Z),{color:M.value?"success":"danger",class:"status-chip"},{default:r(()=>[o(e(n),{icon:e(We)},null,8,["icon"]),o(e(ee),null,{default:r(()=>[D(h(M.value?"Online":"Offline"),1)]),_:1})]),_:1},8,["color"])])])]}),_:1})]),_:1}))}}),at=le(Xs,[["__scopeId","data-v-96a36055"]]);export{at as default};
