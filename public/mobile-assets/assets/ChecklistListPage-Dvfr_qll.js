import{d as W,r as C,c as $,o as X,B as D,q as u,x as c,y as e,v as o,H as k,t,n as p,J as f,G as i,K as I,F as Y,L as Z,z as ee,C as M}from"./vendor-DcQkTNkg.js";import{e as se,o as te,q as B,x as ae,p as oe,k as y,g as r,r as ne,s as ie,u as ce,f as le,y as re,z as ue,i as de,l as he,n as pe,t as S}from"./ionic-GHA3wq_y.js";import{A as me,r as _e,t as fe,v as ve,B as E,m as ge,p as Ce,f as ye,C as we,_ as ke}from"./_plugin-vue_export-helper-Dt2dLz-X.js";import{C as Ie,A as P}from"./main-Cs0jJiUE.js";import{u as Pe}from"./useStatsAutoRefresh--H7iRpss.js";const be={class:"header-gradient"},xe={class:"header-content"},Oe={key:0,class:"unit-info"},Re={class:"status-indicators"},Te={class:"content-container"},$e={key:0,class:"checklists-section"},De=["onClick"],Me={class:"card-content"},Be={class:"checklist-info"},Se={class:"machine-section"},Ee={class:"machine-icon"},Ue={class:"machine-details"},Ae={class:"machine-id"},Fe={class:"patient-section"},Ne={class:"patient-icon"},ze={class:"patient-details"},Le={class:"phase-info"},je={class:"checklist-actions"},qe={class:"status-section"},Ve={class:"progress-text"},He={class:"time-info"},Ge={class:"time-label"},Je={key:0,class:"paused-indicator"},Ke={key:1,class:"empty-state"},Qe={class:"empty-content"},We={key:2,class:"loading-state"},Xe=W({__name:"ChecklistListPage",setup(Ye){const b=ee(),U=Ie.getInstance().getCurrentUserUseCase(),v=C(!1),w=C(null),d=C([]),m=C([]),x=$(()=>m.value.filter(s=>s.status==="available").length),A=$(()=>m.value.filter(s=>s.status==="occupied").length),F=async()=>{try{w.value=await U.execute()}catch(s){console.error("Error loading user:",s)}},N=async()=>{try{const a=await(await fetch("/api/checklists/active",P.getFetchConfig())).json();a.success&&(d.value=a.checklists)}catch(s){console.error("Erro ao carregar checklists ativos:",s)}},z=async()=>{try{const s=await fetch("/api/machines",P.getFetchConfig());if(!s.ok){console.warn("Failed to load machines: ".concat(s.status)),m.value=[];return}const a=await s.json();a.success&&a.machines?m.value=a.machines:m.value=[]}catch(s){console.error("Erro ao carregar máquinas:",s),m.value=[]}},g=async()=>{v.value=!0;try{await Promise.all([N(),z()])}finally{v.value=!1}},{isRefreshing:O,forceRefresh:L}=Pe(g,{loadOnMount:!1,interval:15e3,onStatsUpdated:()=>{console.log("[ChecklistList] Stats atualizados automaticamente")}}),j=async s=>{await L(),s.target.complete()},R=s=>{b.push("/checklist/".concat(s.id))},q=async s=>{await(await he.create({header:"Pausar Checklist",message:"Deseja pausar o checklist da máquina ".concat(s.machine.name,"?"),buttons:[{text:"Cancelar",role:"cancel"},{text:"Pausar",handler:async()=>{const h=await pe.create({message:"Pausando checklist..."});await h.present();try{const l=await(await fetch("/api/checklists/".concat(s.id,"/pause"),{method:"POST",...P.getFetchConfig()})).json();if(l.success)await(await S.create({message:"Checklist pausado com sucesso.",duration:3e3,color:"success"})).present(),await g();else throw new Error(l.message)}catch(n){await(await S.create({message:"Erro ao pausar checklist.",duration:3e3,color:"danger"})).present()}finally{await h.dismiss()}}}]})).present()},T=()=>{b.push("/checklist/new")},V=s=>({pre_dialysis:"Pré-Diálise",during_session:"Durante Sessão",post_dialysis:"Pós-Diálise",completed:"Concluído",interrupted:"Interrompido"})[s]||s,H=s=>({pre_dialysis:"primary",during_session:"warning",post_dialysis:"secondary",completed:"success",interrupted:"danger"})[s]||"medium",G=s=>s.replace("_","-"),J=s=>s.phase_completion!==void 0?Math.round(s.phase_completion):{pre_dialysis:25,during_session:50,post_dialysis:75,completed:100,interrupted:0}[s.current_phase]||0,K=s=>{const a=new Date(s),n=new Date().getTime()-a.getTime(),l=Math.floor(n/(1e3*60*60)),_=Math.floor(n%(1e3*60*60)/(1e3*60));return l>0?"".concat(l,"h ").concat(_,"m"):"".concat(_,"m")},Q=s=>{const a=new Date(s),n=new Date().getTime()-a.getTime(),l=Math.floor(n/(1e3*60*60)),_=Math.floor(n%(1e3*60*60)/(1e3*60));return l>0?"".concat(l,"h ").concat(_,"m"):"".concat(_,"m")};return X(async()=>{await F(),await g()}),(s,a)=>(u(),D(e(se),null,{default:c(()=>[o(e(ne),null,{default:c(()=>[o(e(te),{color:"primary"},{default:c(()=>[o(e(B),{slot:"start"},{default:c(()=>[o(e(ae),{"default-href":"/dashboard"})]),_:1}),o(e(oe),null,{default:c(()=>[...a[0]||(a[0]=[k("Checklists Ativos",-1)])]),_:1}),o(e(B),{slot:"end"},{default:c(()=>[o(e(y),{onClick:g,disabled:v.value},{default:c(()=>[o(e(r),{icon:e(me)},null,8,["icon"])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),o(e(de),{fullscreen:!0},{default:c(()=>{var h;return[o(e(ie),{slot:"fixed",onIonRefresh:j},{default:c(()=>[o(e(ce))]),_:1}),t("div",be,[t("div",xe,[w.value?(u(),p("div",Oe,[t("h2",null,i(((h=w.value.unit)==null?void 0:h.name)||"Unidade de Hemodiálise"),1),t("p",null,i(d.value.length)+" checklist"+i(d.value.length!==1?"s":"")+" "+i(d.value.length===1?"ativo":"ativos"),1)])):f("",!0),t("div",Re,[t("div",{class:I(["status-item available",{updating:e(O)}])},[o(e(r),{icon:e(_e)},null,8,["icon"]),t("span",null,i(x.value)+" Disponível"+i(x.value!==1?"is":""),1)],2),t("div",{class:I(["status-item occupied",{updating:e(O)}])},[o(e(r),{icon:e(fe)},null,8,["icon"]),t("span",null,i(A.value)+" Em Uso",1)],2)])])]),t("div",Te,[d.value.length>0?(u(),p("div",$e,[(u(!0),p(Y,null,Z(d.value,n=>(u(),p("div",{key:n.id,class:"checklist-card",onClick:l=>R(n)},[t("div",Me,[t("div",Be,[t("div",Se,[t("div",Ee,[o(e(r),{icon:e(ge)},null,8,["icon"])]),t("div",Ue,[t("h3",null,i(n.machine.name),1),t("p",Ae,i(n.machine.identifier),1)])]),t("div",Fe,[t("div",Ne,[o(e(r),{icon:e(Ce)},null,8,["icon"])]),t("div",ze,[t("h4",null,i(n.patient.name),1),t("p",Le,i(V(n.current_phase)),1)])])]),t("div",je,[t("div",qe,[t("div",{class:I(["progress-circle",G(n.current_phase)])},[t("span",Ve,i(J(n))+"%",1)],2),t("div",He,[t("span",Ge,i(K(n.created_at)),1)])]),o(e(y),{color:H(n.current_phase),size:"small",class:"action-button",onClick:M(l=>R(n),["stop"])},{default:c(()=>[k(i(n.paused_at?"RETOMAR":"CONTINUAR"),1)]),_:2},1032,["color","onClick"]),n.paused_at?f("",!0):(u(),D(e(y),{key:0,fill:"clear",size:"small",color:"medium",onClick:M(l=>q(n),["stop"]),class:"pause-btn"},{default:c(()=>[o(e(r),{icon:e(ye),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"]))])]),n.paused_at?(u(),p("div",Je,[o(e(r),{icon:e(we)},null,8,["icon"]),t("span",null,"Pausado há "+i(Q(n.paused_at)),1)])):f("",!0)],8,De))),128))])):f("",!0),d.value.length===0&&!v.value?(u(),p("div",Ke,[t("div",Qe,[o(e(r),{icon:e(ve),class:"empty-icon"},null,8,["icon"]),a[2]||(a[2]=t("h3",null,"Nenhum checklist ativo",-1)),a[3]||(a[3]=t("p",null,"Inicie um novo checklist de segurança para começar.",-1)),o(e(y),{color:"primary",onClick:T,class:"start-button"},{default:c(()=>[o(e(r),{icon:e(E),slot:"start"},null,8,["icon"]),a[1]||(a[1]=k(" Iniciar Checklist ",-1))]),_:1})])])):f("",!0),v.value?(u(),p("div",We,[o(e(le),{name:"crescent"}),a[4]||(a[4]=t("p",null,"Carregando checklists...",-1))])):f("",!0)]),o(e(re),{vertical:"bottom",horizontal:"end",slot:"fixed"},{default:c(()=>[o(e(ue),{color:"primary",onClick:T,class:"add-fab"},{default:c(()=>[o(e(r),{icon:e(E)},null,8,["icon"])]),_:1})]),_:1})]}),_:1})]),_:1}))}}),ns=ke(Xe,[["__scopeId","data-v-8b569413"]]);export{ns as default};
