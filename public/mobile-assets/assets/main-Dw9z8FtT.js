const __vite__fileDeps=["assets/LoginPage-CEjHQF3W.js","assets/vendor-C2XN_qWx.js","assets/ionic-Duh8nJBT.js","assets/_plugin-vue_export-helper-BGt4Pv6P.js","assets/LoginPage-C72DWICJ.css","assets/DashboardPage-DejrPl3k.js","assets/DashboardPage-JojdIn0T.css","assets/ChecklistPage-DVEu0LS0.js","assets/ChecklistPage-7FvsEyiY.css","assets/PatientsPage-BdXJnSSs.js","assets/PatientsPage-DpDa4B6j.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var E=Object.defineProperty;var _=(s,e,t)=>e in s?E(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var h=(s,e,t)=>(_(s,typeof e!="symbol"?e+"":e,t),t);import{d as v,l as C,n as D,q as u,t as k,v as A,x as f,F as U,y as b}from"./vendor-C2XN_qWx.js";import{I as R,a as I,c as O,b as N,_ as g,d as P}from"./ionic-Duh8nJBT.js";function ee(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}const L=v({__name:"App",setup(s){return(e,t)=>(D(),C(U,null,[t[0]||(t[0]=u("div",{class:"desktop-warning",style:{display:"none"}},[u("h1",null,"üì± Aplicativo Mobile"),u("p",null,"Este aplicativo foi projetado exclusivamente para dispositivos m√≥veis."),u("p",null,"Acesse pelo seu smartphone ou tablet para uma melhor experi√™ncia."),u("div",{style:{"margin-top":"2rem",padding:"1rem",background:"rgba(255,255,255,0.1)","border-radius":"8px"}},[u("p",{style:{"font-size":"1rem"}},"Para testar no navegador, use as ferramentas de desenvolvedor (F12) e ative a visualiza√ß√£o mobile.")])],-1)),k(f(R),null,{default:A(()=>[k(f(I))]),_:1})],64))}}),K={BASE_URL:"/api",getApiUrl(){return this.BASE_URL},ENDPOINTS:{LOGIN:"/login",LOGOUT:"/logout",ME:"/me",PATIENTS:"/patients",PATIENTS_SEARCH:"/patients/search",CHECKLISTS:"/checklists",CHECKLISTS_TODAY:"/checklists/today",CHECKLISTS_PENDING:"/checklists/pending",CHECKLISTS_BY_USER:"/checklists/user",CHECKLISTS_BY_MACHINE:"/checklists/machine",MACHINES:"/machines",MACHINES_AVAILABLE:"/machines/available",MACHINES_BY_UNIT:"/machines/unit"}};class B{constructor(e){h(this,"baseUrl");this.baseUrl=e||K.getApiUrl()}async get(e,t){return this.request("GET",e,void 0,t)}async post(e,t,o){return this.request("POST",e,t,o)}async put(e,t,o){return this.request("PUT",e,t,o)}async delete(e,t){return this.request("DELETE",e,void 0,t)}async request(e,t,o,r){const a="".concat(this.baseUrl).concat(t),n={"Content-Type":"application/json",Accept:"application/json"};r&&(n.Authorization="Bearer ".concat(r));const p={method:e,headers:n};o&&(e==="POST"||e==="PUT")&&(p.body=JSON.stringify(o));try{const i=await fetch(a,p),c=await i.json();if(!i.ok)throw{message:c.message||"Erro na requisi√ß√£o",errors:c.errors,status:i.status};return c&&typeof c=="object"&&"data"in c?c:{data:c,success:!0}}catch(i){throw i instanceof Error&&i.name==="TypeError"?{message:"Erro de conectividade. Verifique sua conex√£o.",status:0}:i}}}class V{set(e,t){try{localStorage.setItem(e,t)}catch(o){console.error("Erro ao salvar no localStorage:",o)}}get(e){try{return localStorage.getItem(e)}catch(t){return console.error("Erro ao ler do localStorage:",t),null}}remove(e){try{localStorage.removeItem(e)}catch(t){console.error("Erro ao remover do localStorage:",t)}}clear(){try{localStorage.clear()}catch(e){console.error("Erro ao limpar localStorage:",e)}}setObject(e,t){try{this.set(e,JSON.stringify(t))}catch(o){console.error("Erro ao salvar objeto no localStorage:",o)}}getObject(e){try{const t=this.get(e);return t?JSON.parse(t):null}catch(t){return console.error("Erro ao ler objeto do localStorage:",t),null}}}class x{constructor(e,t){h(this,"TOKEN_KEY","auth_token");this.apiDataSource=e,this.localStorageDataSource=t}async login(e){return await this.apiDataSource.post("/login",e)}async getCurrentUser(){const e=this.getStoredToken();if(!e)throw new Error("Token n√£o encontrado");const t=await this.apiDataSource.get("/me",e);return t.user||t}async logout(){const e=this.getStoredToken();e&&await this.apiDataSource.post("/logout",{},e)}getStoredToken(){return this.localStorageDataSource.get(this.TOKEN_KEY)}storeToken(e){this.localStorageDataSource.set(this.TOKEN_KEY,e)}removeToken(){this.localStorageDataSource.remove(this.TOKEN_KEY)}isAuthenticated(){const e=this.getStoredToken();return e!==null&&e!==""}}class j{constructor(e,t){this.apiDataSource=e,this.localStorageDataSource=t}getToken(){const e=this.localStorageDataSource.get("auth_token");if(!e)throw new Error("Token de autentica√ß√£o n√£o encontrado");return e}async search(e){const t=this.getToken();try{const o=await this.apiDataSource.post("/patients/search",{full_name:e.full_name,birth_date:e.birth_date},t);return o.data.found&&o.data.patient?o.data.patient:null}catch(o){if(o.status===404||o.status===422)return null;throw o}}async create(e){const t=this.getToken();return(await this.apiDataSource.post("/patients",e,t)).data}async getById(e){const t=this.getToken();return(await this.apiDataSource.get("/patients/".concat(e),t)).data}async getAll(){const e=this.getToken();return(await this.apiDataSource.get("/patients",e)).data}async update(e,t){const o=this.getToken();return(await this.apiDataSource.put("/patients/".concat(e),t,o)).data}}class ${constructor(e,t){this.apiDataSource=e,this.localStorageDataSource=t}getToken(){const e=this.localStorageDataSource.get("auth_token");if(!e)throw new Error("Token de autentica√ß√£o n√£o encontrado");return e}async create(e){const t=this.getToken();return(await this.apiDataSource.post("/checklists",e,t)).data}async getById(e){const t=this.getToken();return(await this.apiDataSource.get("/checklists/".concat(e),t)).data}async getByUser(e,t){const o=this.getToken(),r=new URLSearchParams;t&&r.append("limit",t.toString());const a="/checklists/user/".concat(e).concat(r.toString()?"?"+r.toString():"");return(await this.apiDataSource.get(a,o)).data}async getByMachine(e,t){const o=this.getToken(),r=new URLSearchParams;t&&r.append("date",t);const a="/checklists/machine/".concat(e).concat(r.toString()?"?"+r.toString():"");return(await this.apiDataSource.get(a,o)).data}async getTodaysChecklists(){const e=this.getToken(),t=new Date().toISOString().split("T")[0];return(await this.apiDataSource.get("/checklists/today/".concat(t),e)).data}async getPendingChecklists(){const e=this.getToken();return(await this.apiDataSource.get("/checklists/pending",e)).data}}class Y{constructor(e,t){this.apiDataSource=e,this.localStorageDataSource=t}getToken(){const e=this.localStorageDataSource.get("auth_token");if(!e)throw new Error("Token de autentica√ß√£o n√£o encontrado");return e}async getAll(){const e=this.getToken();return(await this.apiDataSource.get("/machines",e)).data}async getById(e){const t=this.getToken();return(await this.apiDataSource.get("/machines/".concat(e),t)).data}async getByUnit(e){const t=this.getToken();return(await this.apiDataSource.get("/machines/unit/".concat(e),t)).data}async getAvailable(){const e=this.getToken(),t=await this.apiDataSource.get("/machines/available",e);return t.data.machines?t.data.machines:t.data}}class H{constructor(e){this.authRepository=e}async execute(e){if(!e.email||!e.password)throw new Error("Email e senha s√£o obrigat√≥rios");if(!this.isValidEmail(e.email))throw new Error("Email deve ter um formato v√°lido");const t=await this.authRepository.login(e);return this.authRepository.storeToken(t.token||t.access_token),t}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}}class M{constructor(e){this.authRepository=e}async execute(){if(!this.authRepository.isAuthenticated())throw new Error("Usu√°rio n√£o est√° autenticado");try{return await this.authRepository.getCurrentUser()}catch(e){throw this.authRepository.removeToken(),new Error("Sess√£o expirada. Fa√ßa login novamente.")}}}class q{constructor(e){this.authRepository=e}async execute(){try{await this.authRepository.logout()}catch(e){console.warn("Erro ao fazer logout na API:",e)}finally{this.authRepository.removeToken()}}}class G{constructor(e){this.patientRepository=e}async execute(e){var o;if(!((o=e.full_name)!=null&&o.trim()))throw new Error("Nome completo √© obrigat√≥rio");if(!e.birth_date)throw new Error("Data de nascimento √© obrigat√≥ria");if(!this.isValidDate(e.birth_date))throw new Error("Data de nascimento deve estar no formato v√°lido");const t={full_name:e.full_name.trim(),birth_date:e.birth_date};return await this.patientRepository.search(t)}isValidDate(e){const t=new Date(e);return t instanceof Date&&!isNaN(t.getTime())}}class z{constructor(e){this.patientRepository=e}async execute(e){var o,r,a,n,p;if(!((o=e.full_name)!=null&&o.trim()))throw new Error("Nome completo √© obrigat√≥rio");if(!e.birth_date)throw new Error("Data de nascimento √© obrigat√≥ria");if(!((r=e.medical_record)!=null&&r.trim()))throw new Error("Prontu√°rio m√©dico √© obrigat√≥rio");if(!this.isValidDate(e.birth_date))throw new Error("Data de nascimento deve estar no formato v√°lido");if(e.blood_type&&!this.isValidBloodType(e.blood_type))throw new Error("Tipo sangu√≠neo inv√°lido");const t={full_name:e.full_name.trim(),birth_date:e.birth_date,medical_record:e.medical_record.trim(),blood_type:(a=e.blood_type)==null?void 0:a.trim(),allergies:(n=e.allergies)==null?void 0:n.trim(),observations:(p=e.observations)==null?void 0:p.trim()};return await this.patientRepository.create(t)}isValidDate(e){const t=new Date(e);return t instanceof Date&&!isNaN(t.getTime())}isValidBloodType(e){return["A+","A-","B+","B-","AB+","AB-","O+","O-"].includes(e)}}class F{constructor(e){this.checklistRepository=e}async execute(e){if(!e.patient_id)throw new Error("ID do paciente √© obrigat√≥rio");if(!e.machine_id)throw new Error("ID da m√°quina √© obrigat√≥rio");if(!e.shift)throw new Error("Turno √© obrigat√≥rio");if(!this.isValidShift(e.shift))throw new Error("Turno deve ser: matutino, vespertino ou noturno");if(![e.patient_identification,e.access_patency,e.vital_signs,e.weight_measurement,e.machine_parameters,e.anticoagulation,e.alarm_tests,e.emergency_procedures].every(o=>o===!0))throw new Error("Todos os 8 itens de seguran√ßa devem ser verificados");return await this.checklistRepository.create(e)}isValidShift(e){return["matutino","vespertino","noturno"].includes(e)}}const l=class l{constructor(){h(this,"services",new Map);this.registerServices()}static getInstance(){return l.instance||(l.instance=new l),l.instance}registerServices(){const e=new B,t=new V;this.services.set("ApiDataSource",e),this.services.set("LocalStorageDataSource",t);const o=new x(e,t),r=new j(e,t),a=new $(e,t),n=new Y(e,t);this.services.set("AuthRepository",o),this.services.set("PatientRepository",r),this.services.set("ChecklistRepository",a),this.services.set("MachineRepository",n),this.services.set("LoginUseCase",new H(o)),this.services.set("GetCurrentUserUseCase",new M(o)),this.services.set("LogoutUseCase",new q(o)),this.services.set("SearchPatientUseCase",new G(r)),this.services.set("CreatePatientUseCase",new z(r)),this.services.set("CreateChecklistUseCase",new F(a))}get(e){const t=this.services.get(e);if(!t)throw new Error("Service ".concat(e," not found"));return t}getLoginUseCase(){return this.get("LoginUseCase")}getCurrentUserUseCase(){return this.get("GetCurrentUserUseCase")}getLogoutUseCase(){return this.get("LogoutUseCase")}getSearchPatientUseCase(){return this.get("SearchPatientUseCase")}getCreatePatientUseCase(){return this.get("CreatePatientUseCase")}getCreateChecklistUseCase(){return this.get("CreateChecklistUseCase")}getAuthRepository(){return this.get("AuthRepository")}getMachineRepository(){return this.get("MachineRepository")}};h(l,"instance");let y=l;const J=y.getInstance(),w=J.getAuthRepository(),m=(s,e,t)=>{console.log("requiresAuth guard - checking authentication..."),w.isAuthenticated()?(console.log("User is authenticated, allowing access to:",s.path),t()):(console.log("User not authenticated, redirecting to login"),t("/login"))},W=(s,e,t)=>{console.log("redirectIfAuthenticated guard - checking authentication..."),w.isAuthenticated()?(console.log("User is authenticated, redirecting to dashboard"),t("/dashboard")):(console.log("User not authenticated, allowing access to login"),t())},X=[{path:"/",redirect:"/login"},{path:"/login",name:"Login",component:()=>g(()=>import("./LoginPage-CEjHQF3W.js"),__vite__mapDeps([0,1,2,3,4])),beforeEnter:W},{path:"/dashboard",name:"Dashboard",component:()=>g(()=>import("./DashboardPage-DejrPl3k.js"),__vite__mapDeps([5,1,2,3,6])),beforeEnter:m},{path:"/checklist",name:"Checklist",component:()=>g(()=>import("./ChecklistPage-DVEu0LS0.js"),__vite__mapDeps([7,1,2,3,8])),beforeEnter:m},{path:"/patients",name:"Patients",component:()=>g(()=>import("./PatientsPage-BdXJnSSs.js"),__vite__mapDeps([9,1,2,3,10])),beforeEnter:m},{path:"/:pathMatch(.*)*",redirect:"/login"}],T=O({history:N("/mobile/"),routes:X});class d{static getToken(){return localStorage.getItem(this.TOKEN_KEY)}static setToken(e){localStorage.setItem(this.TOKEN_KEY,e)}static removeToken(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.USER_KEY)}static getUser(){const e=localStorage.getItem(this.USER_KEY);return e?JSON.parse(e):null}static setUser(e){localStorage.setItem(this.USER_KEY,JSON.stringify(e))}static isAuthenticated(){const e=this.getToken(),t=this.getUser();return!!(e&&t)}static getAuthHeaders(){var r;const e=this.getToken(),t={"Content-Type":"application/json",Accept:"application/json"};e&&(t.Authorization="Bearer ".concat(e));const o=(r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content");return o&&(t["X-CSRF-TOKEN"]=o),t}static async logout(){try{await fetch("/api/logout",{method:"POST",headers:this.getAuthHeaders()})}catch(e){console.error("Logout error:",e)}finally{this.removeToken()}}static async checkAuth(){if(!this.isAuthenticated())return!1;try{const e=await fetch("/api/me",{headers:this.getAuthHeaders()});if(e.ok){const t=await e.json();return this.setUser(t),!0}else return e.status===401?(console.log("Token expired, attempting refresh..."),await this.refreshToken()):(this.removeToken(),!1)}catch(e){return console.error("Auth check error:",e),this.removeToken(),!1}}static async refreshToken(){try{const e=await fetch("/api/refresh",{method:"POST",headers:this.getAuthHeaders()});if(e.ok){const t=await e.json();return this.setToken(t.token),this.setUser(t.user),console.log("Token refreshed successfully"),!0}else return console.log("Token refresh failed, redirecting to login"),this.removeToken(),!1}catch(e){return console.error("Token refresh error:",e),this.removeToken(),!1}}static async login(e,t){const o=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:e,password:t})});if(!o.ok){const a=await o.json();throw new Error(a.message||"Login failed")}const r=await o.json();return this.setToken(r.token||r.access_token),this.setUser(r.user),r}}h(d,"TOKEN_KEY","auth_token"),h(d,"USER_KEY","auth_user");const S=b(L).use(P).use(T);S.config.globalProperties.$auth=d;S.provide("auth",d);T.isReady().then(()=>{S.mount("#app")});export{d as A,y as C,ee as __vite_legacy_guard};
