const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ionic-KXdFhEAd.js","assets/vendor-CjSOND1d.js"])))=>i.map(i=>d[i]);
import{e as qe,t as _,o as ee,q as B,x as xe,p as ae,k as C,g as l,r as te,s as Ie,u as De,B as Oe,C as Re,f as Te,E as Se,i as se,w as P,J as ne,G as Ae,l as $e,j as Ve,_ as N}from"./ionic-KXdFhEAd.js";import{d as Le,r as k,c as q,o as Be,A as x,n as m,v as i,x as a,t as o,G as f,q as s,l as y,E as d,J as w,I as b,F as Pe,K as Ne,B as oe,y as ze}from"./vendor-CjSOND1d.js";import{y as Ue,A as je,G as Fe,t as z,K as $,z as V,X as U,Y as j,Z as He,O as Xe,$ as Ge,V as Je,a0 as Ke,p as We,b as Qe,u as Ye,a1 as Ze,_ as ea}from"./_plugin-vue_export-helper-BkiP5rQj.js";import{C as aa}from"./main-XLfDU2ui.js";import{u as ta}from"./useStatsAutoRefresh-DSwAJnqU.js";const sa={class:"machines-container"},na={class:"time-display"},oa={class:"current-date"},ia={class:"current-time"},la={class:"filter-pills"},ra={class:"pill-count"},ua={class:"pill-count"},ca={class:"pill-count"},da={class:"pill-count"},va={class:"stats-summary"},pa={class:"stat-info"},ma={class:"stat-number"},fa={class:"stat-info"},_a={class:"stat-number"},ga={class:"stat-info"},wa={class:"stat-number"},ba={class:"stat-info"},ha={class:"stat-number"},ya={key:0,class:"loading-container"},Ca={key:1,class:"machines-list"},ka=["onClick"],Ma={class:"machine-card-header"},Ea={class:"machine-primary-info"},qa={class:"machine-name"},xa={key:0,class:"machine-identifier"},Ia={class:"machine-status-badge"},Da={class:"status-text"},Oa={key:0,class:"machine-description"},Ra={key:1,class:"session-info-modern"},Ta={class:"session-tag"},Sa={class:"session-details-grid"},Aa={class:"session-detail"},$a={class:"detail-value"},Va={class:"session-detail"},La={class:"detail-value"},Ba={class:"session-detail"},Pa={class:"detail-value"},Na={class:"session-action"},za={key:3,class:"inactive-overlay"},Ua={key:0,class:"empty-state-modern"},ja={class:"empty-icon"},Fa={class:"form-section"},Ha={class:"form-group"},Xa={class:"form-group"},Ga={class:"form-group"},Ja={class:"form-actions"},Ka=Le({__name:"MachinesPage",setup(Wa){const F=ze(),D=aa.getInstance().getMachineRepository(),v=k([]),O=k(!1),h=k("all"),H=k(""),X=k(""),R=k(!1),M=k(!1),g=k(!1),c=k({id:null,name:"",identifier:"",description:"",unit_id:null}),G=()=>{const t=new Date;H.value=t.toLocaleDateString("pt-BR",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),X.value=t.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})};setInterval(G,1e3),G();const J=q(()=>v.value.filter(t=>t.status==="available"&&t.is_active!==!1).length),K=q(()=>v.value.filter(t=>t.status==="occupied").length),W=q(()=>v.value.filter(t=>t.status==="maintenance").length),ie=q(()=>v.value.filter(t=>t.is_active===!1).length),Q=q(()=>{switch(h.value){case"available":return v.value.filter(t=>t.status==="available"&&t.is_active!==!1);case"occupied":return v.value.filter(t=>t.status==="occupied");case"maintenance":return v.value.filter(t=>t.status==="maintenance");case"inactive":return v.value.filter(t=>t.is_active===!1);default:return v.value}}),T=async()=>{O.value=!0;try{const t=await D.getAll();v.value=t}catch(t){console.error("Error loading machines:",t),await(await _.create({message:"Erro ao carregar máquinas",duration:3e3,color:"danger",position:"top"})).present()}finally{O.value=!1}},Y=async()=>{await T()},{isRefreshing:S,forceRefresh:le}=ta(Y,{loadOnMount:!1,interval:15e3,onStatsUpdated:()=>{console.log("[Machines] Stats atualizados automaticamente")}}),re=async t=>{await le(),t.target.complete()},L=t=>!t.is_active||t.is_active===!1?"inactive":t.status,ue=t=>{if(!t.is_active||t.is_active===!1)return"Desativada";switch(t.status){case"available":return"Disponível";case"occupied":return"Em Uso";case"reserved":return"Reservada";case"maintenance":return"Manutenção";default:return t.status}},ce=t=>({pre_dialysis:"Pré-Diálise",during_session:"Durante Sessão",post_dialysis:"Pós-Diálise",completed:"Concluído",interrupted:"Interrompido"})[t]||t,de=t=>t?new Date(t).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):"",ve=t=>{F.push("/checklist/".concat(t))},pe=async t=>{const{alertController:e}=await N(async()=>{const{alertController:r}=await import("./ionic-KXdFhEAd.js").then(u=>u.a8);return{alertController:r}},__vite__mapDeps([0,1]));await(await e.create({header:"Colocar em Manutenção",subHeader:t.name,message:"Descreva brevemente o motivo da manutenção:",inputs:[{name:"reason",type:"textarea",placeholder:"Ex: Troca de filtros, ajuste de pressão, etc."}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Confirmar",handler:r=>{me(t,r.reason||"")}}]})).present()},me=async(t,e)=>{var n,r;try{const u=await D.updateStatus(t.id,{status:"maintenance",reason:e}),p=v.value.findIndex(A=>A.id===t.id);p!==-1&&(v.value[p]={...v.value[p],...u}),await(await _.create({message:"".concat(t.name," colocada em manutenção"),duration:3e3,color:"success",position:"top"})).present()}catch(u){console.error("Error putting machine in maintenance:",u),await(await _.create({message:((r=(n=u.response)==null?void 0:n.data)==null?void 0:r.message)||"Erro ao colocar máquina em manutenção",duration:4e3,color:"danger",position:"top"})).present()}},fe=async t=>{const{alertController:e}=await N(async()=>{const{alertController:r}=await import("./ionic-KXdFhEAd.js").then(u=>u.a8);return{alertController:r}},__vite__mapDeps([0,1]));await(await e.create({header:"Liberar Máquina",subHeader:t.name,message:"Tem certeza que deseja liberar esta máquina? Ela ficará disponível para uso.",buttons:[{text:"Cancelar",role:"cancel"},{text:"Liberar",handler:async()=>{var r,u;try{const p=await D.updateStatus(t.id,{status:"available"}),E=v.value.findIndex(Ee=>Ee.id===t.id);E!==-1&&(v.value[E]={...v.value[E],...p}),await(await _.create({message:"".concat(t.name," liberada com sucesso"),duration:3e3,color:"success",position:"top"})).present()}catch(p){console.error("Error releasing machine:",p),await(await _.create({message:((u=(r=p.response)==null?void 0:r.data)==null?void 0:u.message)||"Erro ao liberar máquina",duration:4e3,color:"danger",position:"top"})).present()}}}]})).present()},_e=async t=>{const{alertController:e}=await N(async()=>{const{alertController:u}=await import("./ionic-KXdFhEAd.js").then(p=>p.a8);return{alertController:u}},__vite__mapDeps([0,1])),n=!t.is_active;await(await e.create({header:n?"Ativar Máquina":"Desativar Máquina",subHeader:t.name,message:n?"A máquina será ativada e ficará disponível para uso.":"Descreva brevemente o motivo da desativação:",inputs:n?[]:[{name:"reason",type:"textarea",placeholder:"Ex: Equipamento danificado, aguardando reparo, etc."}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Confirmar",handler:u=>{ge(t,(u==null?void 0:u.reason)||"")}}]})).present()},ge=async(t,e)=>{var n,r;try{const u=await D.toggleActive(t.id,{reason:e}),p=v.value.findIndex(A=>A.id===t.id);p!==-1&&(v.value[p]={...v.value[p],...u}),await(await _.create({message:u.is_active?"".concat(t.name," ativada com sucesso"):"".concat(t.name," desativada com sucesso"),duration:3e3,color:"success",position:"top"})).present()}catch(u){console.error("Error toggling machine active:",u),await(await _.create({message:((r=(n=u.response)==null?void 0:n.data)==null?void 0:r.message)||"Erro ao alterar estado da máquina",duration:4e3,color:"danger",position:"top"})).present()}},we=()=>{switch(h.value){case"available":return"Nenhuma máquina disponível no momento";case"occupied":return"Nenhuma máquina em uso";case"maintenance":return"Nenhuma máquina em manutenção";case"inactive":return"Nenhuma máquina desativada";default:return"Nenhuma máquina cadastrada"}},Z=q(()=>c.value.name.trim()!==""&&c.value.identifier.trim()!==""),be=async()=>{try{const t=await fetch("/api/user-units/current",{credentials:"include",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw console.error("Erro ao carregar unidade"),new Error("Não foi possível carregar a unidade");const e=await t.json();console.log("Resposta de /api/user-units/current:",e),e.success&&e.unit&&e.unit.id?(c.value.unit_id=e.unit.id,console.log("Unit ID configurado:",c.value.unit_id)):(console.error("Nenhuma unidade selecionada"),await(await _.create({message:"Por favor, selecione uma unidade no Dashboard antes de continuar",duration:3e3,color:"warning",position:"top",buttons:[{text:"Ir para Dashboard",handler:()=>{F.push("/dashboard")}}]})).present(),I())}catch(t){console.error("Erro ao carregar unidade:",t),await(await _.create({message:"Erro ao carregar unidade. Por favor, tente novamente.",duration:2e3,color:"danger",position:"top"})).present()}},he=async()=>{M.value=!1,c.value={id:null,name:"",identifier:"",description:"",unit_id:null},await be(),R.value=!0},ye=async t=>{M.value=!0,c.value={id:t.id,name:t.name,identifier:t.identifier,description:t.description||"",unit_id:t.unit_id},R.value=!0},I=()=>{R.value=!1,c.value={id:null,name:"",identifier:"",description:"",unit_id:null}},Ce=async()=>{if(Z.value){g.value=!0;try{const t=M.value?"/api/machines/".concat(c.value.id):"/api/machines",e=M.value?"PUT":"POST",r=await(await fetch(t,{method:e,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({name:c.value.name,identifier:c.value.identifier,description:c.value.description,unit_id:c.value.unit_id})})).json();if(r.success)await(await _.create({message:r.message||(M.value?"Máquina atualizada com sucesso!":"Máquina criada com sucesso!"),duration:3e3,color:"success",position:"top"})).present(),I(),await T();else throw new Error(r.message||"Erro ao salvar máquina")}catch(t){await(await _.create({message:t.message||"Erro ao salvar máquina. Tente novamente.",duration:4e3,color:"danger",position:"top"})).present()}finally{g.value=!1}}},ke=async()=>{await(await $e.create({header:"Confirmar Exclusão",message:"Tem certeza que deseja excluir a máquina <strong>".concat(c.value.name,"</strong>? Esta ação irá desativá-la."),buttons:[{text:"Cancelar",role:"cancel"},{text:"Excluir",role:"destructive",handler:async()=>{await Me()}}]})).present()},Me=async()=>{if(c.value.id){g.value=!0;try{const e=await(await fetch("/api/machines/".concat(c.value.id),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();if(e.success)await(await _.create({message:e.message||"Máquina removida com sucesso!",duration:3e3,color:"success",position:"top"})).present(),I(),await T();else throw new Error(e.message||"Erro ao excluir máquina")}catch(t){await(await _.create({message:t.message||"Erro ao excluir máquina. Tente novamente.",duration:4e3,color:"danger",position:"top"})).present()}finally{g.value=!1}}};return Be(()=>{T()}),(t,e)=>(m(),x(a(qe),null,{default:i(()=>[o(a(te),{translucent:!0},{default:i(()=>[o(a(ee),{color:"primary"},{default:i(()=>[o(a(B),{slot:"start"},{default:i(()=>[o(a(xe),{"default-href":"/dashboard"})]),_:1}),o(a(ae),null,{default:i(()=>[...e[8]||(e[8]=[f("Gestão de Máquinas",-1)])]),_:1}),o(a(B),{slot:"end"},{default:i(()=>[o(a(C),{onClick:Y,disabled:O.value},{default:i(()=>[o(a(l),{icon:a(Ue)},null,8,["icon"])]),_:1},8,["disabled"]),o(a(C),{onClick:he},{default:i(()=>[o(a(l),{icon:a(je)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),o(a(se),{fullscreen:!0,class:"machines-content"},{default:i(()=>[s("div",sa,[o(a(Ie),{slot:"fixed",onIonRefresh:re},{default:i(()=>[o(a(De))]),_:1}),o(a(Oe),{class:"time-header-card"},{default:i(()=>[o(a(Re),null,{default:i(()=>[s("div",na,[s("div",oa,[o(a(l),{icon:a(Fe),class:"date-icon"},null,8,["icon"]),f(" "+d(H.value),1)]),s("div",ia,[o(a(l),{icon:a(z),class:"time-icon"},null,8,["icon"]),f(" "+d(X.value),1)])])]),_:1})]),_:1}),s("div",la,[s("button",{class:w(["filter-pill",{active:h.value==="all"}]),onClick:e[0]||(e[0]=n=>h.value="all")},[o(a(l),{icon:a($)},null,8,["icon"]),e[9]||(e[9]=s("span",null,"Todas",-1)),s("span",ra,d(v.value.length),1)],2),s("button",{class:w(["filter-pill available",{active:h.value==="available"}]),onClick:e[1]||(e[1]=n=>h.value="available")},[o(a(l),{icon:a(V)},null,8,["icon"]),e[10]||(e[10]=s("span",null,"Disponíveis",-1)),s("span",ua,d(J.value),1)],2),s("button",{class:w(["filter-pill occupied",{active:h.value==="occupied"}]),onClick:e[2]||(e[2]=n=>h.value="occupied")},[o(a(l),{icon:a(z)},null,8,["icon"]),e[11]||(e[11]=s("span",null,"Em Uso",-1)),s("span",ca,d(K.value),1)],2),s("button",{class:w(["filter-pill maintenance",{active:h.value==="maintenance"}]),onClick:e[3]||(e[3]=n=>h.value="maintenance")},[o(a(l),{icon:a(U)},null,8,["icon"]),e[12]||(e[12]=s("span",null,"Manutenção",-1)),s("span",da,d(W.value),1)],2)]),s("div",va,[s("div",{class:w(["stat-card available",{updating:a(S)}])},[o(a(l),{icon:a(V)},null,8,["icon"]),s("div",pa,[s("span",ma,d(J.value),1),e[13]||(e[13]=s("span",{class:"stat-label"},"Disponíveis",-1))])],2),s("div",{class:w(["stat-card occupied",{updating:a(S)}])},[o(a(l),{icon:a(z)},null,8,["icon"]),s("div",fa,[s("span",_a,d(K.value),1),e[14]||(e[14]=s("span",{class:"stat-label"},"Em Uso",-1))])],2),s("div",{class:w(["stat-card maintenance",{updating:a(S)}])},[o(a(l),{icon:a(U)},null,8,["icon"]),s("div",ga,[s("span",wa,d(W.value),1),e[15]||(e[15]=s("span",{class:"stat-label"},"Manutenção",-1))])],2),s("div",{class:w(["stat-card inactive",{updating:a(S)}])},[o(a(l),{icon:a(j)},null,8,["icon"]),s("div",ba,[s("span",ha,d(ie.value),1),e[16]||(e[16]=s("span",{class:"stat-label"},"Desativadas",-1))])],2)]),O.value?(m(),y("div",ya,[o(a(Te),{name:"crescent"}),e[17]||(e[17]=s("p",null,"Carregando máquinas...",-1))])):(m(),y("div",Ca,[(m(!0),y(Pe,null,Ne(Q.value,n=>(m(),y("div",{key:n.id,class:w(["machine-card-modern",L(n)]),onClick:r=>n.current_checklist&&ve(n.current_checklist.id)},[s("div",Ma,[s("div",{class:w(["machine-icon-large",L(n)])},[o(a(l),{icon:a($)},null,8,["icon"])],2),s("div",Ea,[s("h3",qa,d(n.name),1),n.identifier?(m(),y("p",xa,d(n.identifier),1)):b("",!0)]),s("div",Ia,[s("div",{class:w(["status-dot",L(n)])},null,2),s("span",Da,d(ue(n)),1)])]),n.description?(m(),y("div",Oa,d(n.description),1)):b("",!0),n.current_checklist?(m(),y("div",Ra,[s("div",Ta,[o(a(l),{icon:a(We)},null,8,["icon"]),e[19]||(e[19]=s("span",null,"Sessão Ativa",-1)),n.current_checklist.is_paused?(m(),x(a(Ve),{key:0,color:"warning"},{default:i(()=>[...e[18]||(e[18]=[f("Pausado",-1)])]),_:1})):b("",!0)]),s("div",Sa,[s("div",Aa,[e[20]||(e[20]=s("span",{class:"detail-label"},"Paciente",-1)),s("span",$a,d(n.current_checklist.patient_name),1)]),s("div",Va,[e[21]||(e[21]=s("span",{class:"detail-label"},"Fase",-1)),s("span",La,d(ce(n.current_checklist.current_phase)),1)]),s("div",Ba,[e[22]||(e[22]=s("span",{class:"detail-label"},"Início",-1)),s("span",Pa,d(de(n.current_checklist.started_at)),1)])]),s("div",Na,[o(a(l),{icon:a(Qe)},null,8,["icon"]),e[23]||(e[23]=s("span",null,"Clique para ver checklist",-1)),o(a(l),{icon:a(Ye)},null,8,["icon"])])])):b("",!0),n.current_checklist?b("",!0):(m(),y("div",{key:2,class:"machine-actions",onClick:e[4]||(e[4]=oe(()=>{},["stop"]))},[o(a(C),{fill:"clear",size:"small",color:"medium",onClick:r=>ye(n)},{default:i(()=>[o(a(l),{slot:"start",icon:a(Ze)},null,8,["icon"]),e[24]||(e[24]=f(" Editar ",-1))]),_:1},8,["onClick"]),n.is_active&&n.status==="available"?(m(),x(a(C),{key:0,fill:"outline",size:"small",color:"warning",onClick:r=>pe(n)},{default:i(()=>[o(a(l),{slot:"start",icon:a(U)},null,8,["icon"]),e[25]||(e[25]=f(" Manutenção ",-1))]),_:1},8,["onClick"])):b("",!0),n.is_active&&n.status==="maintenance"?(m(),x(a(C),{key:1,fill:"solid",size:"small",color:"success",onClick:r=>fe(n)},{default:i(()=>[o(a(l),{slot:"start",icon:a(V)},null,8,["icon"]),e[26]||(e[26]=f(" Liberar Máquina ",-1))]),_:1},8,["onClick"])):b("",!0),n.status!=="occupied"?(m(),x(a(C),{key:2,fill:"outline",size:"small",color:n.is_active?"danger":"success",onClick:r=>_e(n)},{default:i(()=>[o(a(l),{slot:"start",icon:n.is_active?a(j):a(V)},null,8,["icon"]),f(" "+d(n.is_active?"Desativar":"Ativar"),1)]),_:2},1032,["color","onClick"])):b("",!0)])),n.is_active?b("",!0):(m(),y("div",za,[o(a(l),{icon:a(j)},null,8,["icon"]),e[27]||(e[27]=s("span",null,"Desativada",-1))]))],10,ka))),128)),Q.value.length===0?(m(),y("div",Ua,[s("div",ja,[o(a(l),{icon:a($)},null,8,["icon"])]),e[28]||(e[28]=s("h3",null,"Nenhuma máquina encontrada",-1)),s("p",null,d(we()),1)])):b("",!0)]))]),o(a(Se),{"is-open":R.value,onDidDismiss:I},{default:i(()=>[o(a(te),null,{default:i(()=>[o(a(ee),null,{default:i(()=>[o(a(ae),null,{default:i(()=>[f(d(M.value?"Editar Máquina":"Nova Máquina"),1)]),_:1}),o(a(B),{slot:"end"},{default:i(()=>[o(a(C),{onClick:I},{default:i(()=>[...e[29]||(e[29]=[f("Cancelar",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),o(a(se),{class:"machine-modal-content"},{default:i(()=>[s("form",{onSubmit:oe(Ce,["prevent"]),class:"machine-form"},[s("div",Fa,[e[33]||(e[33]=s("h3",{class:"section-title"},"Informações Básicas",-1)),s("div",Ha,[o(a(P),{position:"stacked",class:"form-label"},{default:i(()=>[o(a(l),{icon:a($)},null,8,["icon"]),e[30]||(e[30]=f(" Nome da Máquina * ",-1))]),_:1}),o(a(ne),{modelValue:c.value.name,"onUpdate:modelValue":e[5]||(e[5]=n=>c.value.name=n),type:"text",placeholder:"Ex: Máquina 01",required:"",disabled:g.value,class:"custom-input"},null,8,["modelValue","disabled"])]),s("div",Xa,[o(a(P),{position:"stacked",class:"form-label"},{default:i(()=>[o(a(l),{icon:a(He)},null,8,["icon"]),e[31]||(e[31]=f(" Identificador/Código * ",-1))]),_:1}),o(a(ne),{modelValue:c.value.identifier,"onUpdate:modelValue":e[6]||(e[6]=n=>c.value.identifier=n),type:"text",placeholder:"Ex: MAQ-001",required:"",disabled:g.value,class:"custom-input"},null,8,["modelValue","disabled"])]),s("div",Ga,[o(a(P),{position:"stacked",class:"form-label"},{default:i(()=>[o(a(l),{icon:a(Xe)},null,8,["icon"]),e[32]||(e[32]=f(" Descrição ",-1))]),_:1}),o(a(Ae),{modelValue:c.value.description,"onUpdate:modelValue":e[7]||(e[7]=n=>c.value.description=n),placeholder:"Informações adicionais sobre a máquina",rows:4,disabled:g.value,class:"custom-textarea"},null,8,["modelValue","disabled"])])]),s("div",Ja,[o(a(C),{expand:"block",type:"submit",disabled:g.value||!Z.value,class:"submit-button"},{default:i(()=>[o(a(l),{slot:"start",icon:g.value?a(Ge):a(Je)},null,8,["icon"]),f(" "+d(g.value?"Salvando...":M.value?"Atualizar Máquina":"Criar Máquina"),1)]),_:1},8,["disabled"]),M.value?(m(),x(a(C),{key:0,expand:"block",fill:"outline",color:"danger",onClick:ke,disabled:g.value,class:"delete-button"},{default:i(()=>[o(a(l),{slot:"start",icon:a(Ke)},null,8,["icon"]),e[34]||(e[34]=f(" Excluir Máquina ",-1))]),_:1},8,["disabled"])):b("",!0)])],32)]),_:1})]),_:1},8,["is-open"])]),_:1})]),_:1}))}}),st=ea(Ka,[["__scopeId","data-v-0394af6e"]]);export{st as default};
