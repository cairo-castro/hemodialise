import{d as it,r as _,c as K,o as dt,B as T,q as p,x as l,y as e,v as s,H as d,t as a,K as y,G as u,n as m,J as g,L as rt,F as ut,C as ct}from"./vendor-BAY9JQbk.js";import{e as pt,n as R,t as w,o as V,q as B,x as vt,p as x,k as I,g as n,r as $,H as mt,j as q,E as Q,i as H,J as Y,K as ft,L as h,B as _t,C as gt}from"./ionic-B_Arm38Z.js";import{A as Z,w as M,z as j,H as ht,J as A,p as L,G as F,S as U,i as tt,r as bt,F as yt,T as wt,N as Ct,_ as kt}from"./_plugin-vue_export-helper-BgNw2jzN.js";import{C as It}from"./main-Cm9J612g.js";import{u as Pt}from"./useStatsAutoRefresh-jtzHKU-G.js";const Bt={class:"search-container-dash"},At={class:"search-card"},Ot={class:"stats-grid"},St={class:"stat-icon"},Dt={class:"stat-info"},Et={class:"stat-value"},Nt={class:"stat-icon"},Tt={class:"stat-info"},Rt={class:"stat-value"},Vt={class:"patients-container-dash"},xt={class:"section-header"},$t={class:"patients-grid"},qt=["onClick"],Ht={class:"patient-avatar"},Mt={class:"patient-content"},jt={class:"patient-header-dash"},Lt={class:"patient-meta"},Ft={class:"meta-item"},Ut={class:"meta-item"},zt={key:0,class:"patient-details-dash"},Wt={key:0,class:"detail-chip"},Xt={class:"patient-arrow"},Jt={key:0,class:"empty-state-dash"},Gt={class:"empty-icon"},Kt={key:0},Qt={key:1},Yt={class:"modal-title-dash"},Zt={class:"progress-dash"},te={class:"input-cards-dash"},ee={class:"input-card-dash"},ae={class:"card-icon-dash primary"},se={class:"card-content-dash"},oe={class:"input-card-dash"},le={class:"card-icon-dash secondary"},ne={class:"card-content-dash"},ie={class:"input-card-dash"},de={class:"card-icon-dash tertiary"},re={class:"card-content-dash"},ue={class:"buttons-dash"},ce=["disabled"],pe={class:"patient-details-modal"},ve={class:"details-header"},me={class:"details-avatar"},fe={class:"details-title"},_e={class:"details-grid"},ge={class:"detail-item"},he={class:"detail-value"},be={class:"detail-item"},ye={class:"detail-value"},we={key:0,class:"detail-item"},Ce={class:"detail-value"},ke={class:"detail-item"},Ie={class:"detail-value"},Pe={key:0,class:"detail-section"},Be={key:1,class:"detail-section"},Ae={class:"details-actions"},Oe=it({__name:"PatientsPage",setup(Se){const z=It.getInstance(),et=z.getCreatePatientUseCase(),W=z.get("PatientRepository"),f=_([]),C=_(""),b=_(!1),P=_(!1),i=_(null),X=_(!1),O=_(!1);let S=null;const c=_({full_name:"",birth_date:"",blood_type:"",allergies:"",observations:""}),D=K(()=>f.value),at=K(()=>c.value.full_name.length>0&&c.value.birth_date.length>0),E=async(r="")=>{const t=await R.create({message:r?"Buscando pacientes...":"Carregando pacientes...",spinner:"crescent"});await t.present();try{f.value=await W.getAll(r,100)}catch(o){console.error("Error loading patients:",o),await(await w.create({message:"Erro ao carregar pacientes",duration:3e3,color:"danger",position:"top"})).present()}finally{await t.dismiss()}},st=r=>{var o,v;const t=((o=r.target)==null?void 0:o.value)||((v=r.detail)==null?void 0:v.value)||"";if(C.value=t,S&&clearTimeout(S),!t||t.length===0){E();return}S=setTimeout(async()=>{if(t.length>=2){X.value=!0;try{f.value=await W.quickSearch(t,50)}catch(k){console.error("Error searching patients:",k),await(await w.create({message:"Erro ao buscar pacientes",duration:2e3,color:"warning",position:"top"})).present()}finally{X.value=!1}}},500)},ot=async r=>{try{const t=await R.create({message:"Carregando detalhes...",spinner:"crescent"});await t.present();const v=await(await fetch("/api/patients/".concat(r.id),{credentials:"include",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();if(v.success)i.value=v.patient,P.value=!0;else throw new Error(v.message||"Erro ao carregar detalhes");await t.dismiss()}catch(t){console.error("Error loading patient details:",t),await(await w.create({message:t.message||"Erro ao carregar detalhes do paciente",duration:3e3,color:"danger",position:"top"})).present()}},lt=async()=>{if(i.value)try{O.value=!0;const t=await(await fetch("/api/patients/".concat(i.value.id,"/toggle-active"),{method:"PATCH",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}})).json();if(t.success){i.value.active=t.patient.active;const o=f.value.findIndex(k=>k.id===i.value.id);o!==-1&&(f.value[o]={...f.value[o],active:t.patient.active}),await(await w.create({message:t.message,duration:2e3,color:"success",position:"top"})).present()}else throw new Error(t.message||"Erro ao alterar status")}catch(r){console.error("Error toggling patient status:",r),await(await w.create({message:r.message||"Erro ao alterar status do paciente",duration:3e3,color:"danger",position:"top"})).present()}finally{O.value=!1}},nt=async()=>{const r=await R.create({message:"Cadastrando paciente...",spinner:"crescent"});await r.present();try{const t=await et.execute(c.value);f.value.unshift(t),c.value={full_name:"",birth_date:"",blood_type:"",allergies:"",observations:""},b.value=!1,await(await w.create({message:"Paciente cadastrado com sucesso!",duration:2e3,color:"success",position:"top"})).present()}catch(t){await(await w.create({message:t.message||"Erro ao cadastrar paciente",duration:3e3,color:"danger",position:"top"})).present()}finally{await r.dismiss()}},J=r=>{if(!r)return"Data não informada";const t=r.split("-");if(t.length===3){const o=parseInt(t[0]),v=parseInt(t[1])-1,k=parseInt(t[2]),N=new Date(o,v,k);if(!isNaN(N.getTime()))return N.toLocaleDateString("pt-BR")}return"Data inválida"},{isRefreshing:G}=Pt(E,{loadOnMount:!1,interval:15e3,onStatsUpdated:()=>{console.log("[Patients] Stats atualizados automaticamente")}});return dt(()=>{E()}),(r,t)=>(p(),T(e(pt),null,{default:l(()=>[s(e($),{translucent:!0},{default:l(()=>[s(e(V),{color:"primary"},{default:l(()=>[s(e(B),{slot:"start"},{default:l(()=>[s(e(vt),{"default-href":"/dashboard"})]),_:1}),s(e(x),null,{default:l(()=>[...t[12]||(t[12]=[d("Pacientes",-1)])]),_:1}),s(e(B),{slot:"end"},{default:l(()=>[s(e(I),{onClick:t[0]||(t[0]=o=>b.value=!0),class:"add-button"},{default:l(()=>[s(e(n),{icon:e(Z),slot:"icon-only"},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),s(e(H),{fullscreen:!0,class:"dashboard-content"},{default:l(()=>[a("div",Bt,[a("div",At,[s(e(n),{icon:e(M),class:"search-icon"},null,8,["icon"]),s(e(mt),{value:C.value,placeholder:"Buscar pacientes...",onIonInput:t[1]||(t[1]=o=>st(o)),onIonClear:t[2]||(t[2]=o=>C.value=""),"show-clear-button":"focus",class:"search-bar-dash",debounce:"300"},null,8,["value"])])]),a("div",Ot,[a("div",{class:y(["stat-card primary",{updating:e(G)}])},[a("div",St,[s(e(n),{icon:e(M)},null,8,["icon"])]),a("div",Dt,[a("span",Et,u(f.value.length),1),t[13]||(t[13]=a("span",{class:"stat-label"},"Total",-1))])],2),a("div",{class:y(["stat-card success",{updating:e(G)}])},[a("div",Nt,[s(e(n),{icon:e(j)},null,8,["icon"])]),a("div",Tt,[a("span",Rt,u(f.value.length),1),t[14]||(t[14]=a("span",{class:"stat-label"},"Ativos",-1))])],2)]),a("div",Vt,[a("div",xt,[t[15]||(t[15]=a("h2",null,"Lista de Pacientes",-1)),s(e(q),{color:"primary"},{default:l(()=>[d(u(D.value.length),1)]),_:1})]),a("div",$t,[(p(!0),m(ut,null,rt(D.value,o=>(p(),m("div",{key:o.id,class:"patient-card-dash",onClick:v=>ot(o)},[a("div",Ht,[s(e(n),{icon:e(L)},null,8,["icon"])]),a("div",Mt,[a("div",jt,[a("h3",null,u(o.full_name),1),s(e(q),{color:"success",class:"status-badge"},{default:l(()=>[...t[16]||(t[16]=[d("Ativo",-1)])]),_:1})]),a("div",Lt,[a("div",Ft,[s(e(n),{icon:e(F)},null,8,["icon"]),a("span",null,u(J(o.birth_date)),1)]),a("div",Ut,[s(e(n),{icon:e(tt)},null,8,["icon"]),a("span",null,u(o.age)+" anos",1)])]),o.blood_type?(p(),m("div",zt,[o.blood_type?(p(),m("div",Wt,[s(e(n),{icon:e(U)},null,8,["icon"]),a("span",null,u(o.blood_type),1)])):g("",!0)])):g("",!0)]),a("div",Xt,[s(e(n),{icon:e(Ct)},null,8,["icon"])])],8,qt))),128))]),D.value.length===0?(p(),m("div",Jt,[a("div",Gt,[s(e(n),{icon:e(M)},null,8,["icon"])]),t[18]||(t[18]=a("h3",null,"Nenhum paciente encontrado",-1)),C.value?(p(),m("p",Kt,"Tente ajustar os termos de busca")):(p(),m("p",Qt,"Cadastre o primeiro paciente clicando no botão +")),C.value?g("",!0):(p(),T(e(I),{key:2,onClick:t[3]||(t[3]=o=>b.value=!0),class:"empty-action"},{default:l(()=>[s(e(n),{icon:e(Z),slot:"start"},null,8,["icon"]),t[17]||(t[17]=d(" Novo Paciente ",-1))]),_:1}))])):g("",!0)]),s(e(Q),{"is-open":b.value,onWillDismiss:t[9]||(t[9]=o=>b.value=!1)},{default:l(()=>[s(e($),null,{default:l(()=>[s(e(V),{color:"primary"},{default:l(()=>[s(e(x),null,{default:l(()=>[a("div",Yt,[s(e(n),{icon:e(ht)},null,8,["icon"]),t[19]||(t[19]=a("span",null,"Novo Paciente",-1))])]),_:1}),s(e(B),{slot:"end"},{default:l(()=>[s(e(I),{onClick:t[4]||(t[4]=o=>b.value=!1)},{default:l(()=>[s(e(n),{icon:e(A),slot:"icon-only"},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),s(e(H),{class:"modal-content-dash"},{default:l(()=>[a("form",{onSubmit:ct(nt,["prevent"]),class:"form-dash"},[t[36]||(t[36]=a("div",{class:"welcome-card-dash"},[a("h2",null,"Cadastrar Novo Paciente"),a("p",null,"Preencha as informações básicas")],-1)),a("div",Zt,[a("div",{class:y(["progress-item",{done:c.value.full_name}])},[...t[20]||(t[20]=[a("div",{class:"progress-dot"},null,-1),a("span",null,"Nome",-1)])],2),a("div",{class:y(["progress-line",{active:c.value.birth_date}])},null,2),a("div",{class:y(["progress-item",{done:c.value.birth_date}])},[...t[21]||(t[21]=[a("div",{class:"progress-dot"},null,-1),a("span",null,"Data",-1)])],2),a("div",{class:y(["progress-line",{active:c.value.blood_type}])},null,2),a("div",{class:y(["progress-item",{done:c.value.blood_type}])},[...t[22]||(t[22]=[a("div",{class:"progress-dot"},null,-1),a("span",null,"Fator RH",-1)])],2)]),a("div",te,[a("div",ee,[a("div",ae,[s(e(n),{icon:e(L)},null,8,["icon"])]),a("div",se,[t[23]||(t[23]=a("label",null,"Nome Completo",-1)),s(e(Y),{modelValue:c.value.full_name,"onUpdate:modelValue":t[5]||(t[5]=o=>c.value.full_name=o),type:"text",required:"",placeholder:"Digite o nome completo",class:"input-dash"},null,8,["modelValue"])])]),a("div",oe,[a("div",le,[s(e(n),{icon:e(F)},null,8,["icon"])]),a("div",ne,[t[24]||(t[24]=a("label",null,"Data de Nascimento",-1)),s(e(Y),{modelValue:c.value.birth_date,"onUpdate:modelValue":t[6]||(t[6]=o=>c.value.birth_date=o),type:"date",required:"",class:"input-dash"},null,8,["modelValue"])])]),a("div",ie,[a("div",de,[s(e(n),{icon:e(U)},null,8,["icon"])]),a("div",re,[t[33]||(t[33]=a("label",null,[d("Fator RH "),a("span",{class:"optional"},"(opcional)")],-1)),s(e(ft),{modelValue:c.value.blood_type,"onUpdate:modelValue":t[7]||(t[7]=o=>c.value.blood_type=o),placeholder:"Selecione o tipo sanguíneo",interface:"action-sheet",class:"select-dash"},{default:l(()=>[s(e(h),{value:"A+"},{default:l(()=>[...t[25]||(t[25]=[d("A+",-1)])]),_:1}),s(e(h),{value:"A-"},{default:l(()=>[...t[26]||(t[26]=[d("A-",-1)])]),_:1}),s(e(h),{value:"B+"},{default:l(()=>[...t[27]||(t[27]=[d("B+",-1)])]),_:1}),s(e(h),{value:"B-"},{default:l(()=>[...t[28]||(t[28]=[d("B-",-1)])]),_:1}),s(e(h),{value:"AB+"},{default:l(()=>[...t[29]||(t[29]=[d("AB+",-1)])]),_:1}),s(e(h),{value:"AB-"},{default:l(()=>[...t[30]||(t[30]=[d("AB-",-1)])]),_:1}),s(e(h),{value:"O+"},{default:l(()=>[...t[31]||(t[31]=[d("O+",-1)])]),_:1}),s(e(h),{value:"O-"},{default:l(()=>[...t[32]||(t[32]=[d("O-",-1)])]),_:1})]),_:1},8,["modelValue"])])])]),a("div",ue,[a("button",{type:"button",class:"btn-cancel-dash",onClick:t[8]||(t[8]=o=>b.value=!1)},[s(e(n),{icon:e(A)},null,8,["icon"]),t[34]||(t[34]=d(" Cancelar ",-1))]),a("button",{type:"submit",class:"btn-submit-dash",disabled:!at.value},[s(e(n),{icon:e(j)},null,8,["icon"]),t[35]||(t[35]=d(" Cadastrar ",-1))],8,ce)])],32)]),_:1})]),_:1},8,["is-open"]),s(e(Q),{"is-open":P.value,onWillDismiss:t[11]||(t[11]=o=>P.value=!1)},{default:l(()=>[s(e($),null,{default:l(()=>[s(e(V),{color:"primary"},{default:l(()=>[s(e(x),null,{default:l(()=>[...t[37]||(t[37]=[d("Detalhes do Paciente",-1)])]),_:1}),s(e(B),{slot:"end"},{default:l(()=>[s(e(I),{onClick:t[10]||(t[10]=o=>P.value=!1)},{default:l(()=>[s(e(n),{icon:e(A)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),i.value?(p(),T(e(H),{key:0,class:"ion-padding"},{default:l(()=>[a("div",pe,[s(e(_t),{class:"details-card"},{default:l(()=>[s(e(gt),null,{default:l(()=>[a("div",ve,[a("div",me,[s(e(n),{icon:e(L)},null,8,["icon"])]),a("div",fe,[a("h2",null,u(i.value.full_name),1),s(e(q),{color:i.value.active?"success":"danger"},{default:l(()=>[d(u(i.value.active?"Ativo":"Inativo"),1)]),_:1},8,["color"])])]),a("div",_e,[a("div",ge,[s(e(n),{icon:e(F)},null,8,["icon"]),a("div",null,[t[38]||(t[38]=a("span",{class:"detail-label"},"Data de Nascimento",-1)),a("span",he,u(J(i.value.birth_date)),1)])]),a("div",be,[s(e(n),{icon:e(tt)},null,8,["icon"]),a("div",null,[t[39]||(t[39]=a("span",{class:"detail-label"},"Idade",-1)),a("span",ye,u(i.value.age)+" anos",1)])]),i.value.blood_type?(p(),m("div",we,[s(e(n),{icon:e(U)},null,8,["icon"]),a("div",null,[t[40]||(t[40]=a("span",{class:"detail-label"},"Tipo Sanguíneo",-1)),a("span",Ce,u(i.value.blood_type),1)])])):g("",!0),a("div",ke,[s(e(n),{icon:e(bt)},null,8,["icon"]),a("div",null,[t[41]||(t[41]=a("span",{class:"detail-label"},"Checklists Realizados",-1)),a("span",Ie,u(i.value.checklists_count),1)])])]),i.value.allergies?(p(),m("div",Pe,[a("h4",null,[s(e(n),{icon:e(yt)},null,8,["icon"]),t[42]||(t[42]=d(" Alergias",-1))]),a("p",null,u(i.value.allergies),1)])):g("",!0),i.value.observations?(p(),m("div",Be,[a("h4",null,[s(e(n),{icon:e(wt)},null,8,["icon"]),t[43]||(t[43]=d(" Observações",-1))]),a("p",null,u(i.value.observations),1)])):g("",!0)]),_:1})]),_:1}),a("div",Ae,[s(e(I),{expand:"block",color:i.value.active?"warning":"success",onClick:lt,disabled:O.value},{default:l(()=>[s(e(n),{icon:i.value.active?e(A):e(j),slot:"start"},null,8,["icon"]),d(" "+u(i.value.active?"Desativar Paciente":"Ativar Paciente"),1)]),_:1},8,["color","disabled"])])])]),_:1})):g("",!0)]),_:1},8,["is-open"])]),_:1})]),_:1}))}}),Ve=kt(Oe,[["__scopeId","data-v-6396ea66"]]);export{Ve as default};
