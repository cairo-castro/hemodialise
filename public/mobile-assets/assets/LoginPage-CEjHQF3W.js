import{d as U,r as u,c as V,o as L,z as A,n as p,v as n,x as o,A as B,t as s,l as h,q as a,B as f,C as S}from"./vendor-C2XN_qWx.js";import{e as T,f as D,g as w,h as C,i as I,j as x,k as M,l as R,m as q,t as N}from"./ionic-Duh8nJBT.js";import{m as O,l as P,_ as $}from"./_plugin-vue_export-helper-BGt4Pv6P.js";import{C as j}from"./main-Dw9z8FtT.js";const z={key:0,class:"loading-container"},F={key:1,class:"login-container"},G={class:"login-header"},H={class:"logo-container"},K={class:"form-group"},Q={class:"form-group"},J=U({__name:"LoginPage",setup(W){const v=B(),d=j.getInstance(),y=d.getLoginUseCase(),b=d.getCurrentUserUseCase(),c=d.getAuthRepository(),l=u({email:"",password:""}),r=u(!1),m=u(!1),g=u({header:"",message:""}),E=V(()=>l.value.email.length>0&&l.value.password.length>0),_=async()=>{console.log("Starting login process..."),r.value=!0;try{console.log("Executing login use case..."),await y.execute(l.value),console.log("Login use case completed successfully"),console.log("Getting current user...");const t=await b.execute();if(console.log("Current user:",t),t.role!=="tecnico")throw new Error("Este aplicativo é destinado apenas para usuários de campo. Use o sistema web para acessar a área administrativa.");console.log("User role validation passed"),await(await N.create({message:"Bem-vindo, ".concat(t.name,"!"),duration:1500,color:"success",position:"top"})).present(),console.log("Toast presented"),console.log("About to navigate to dashboard..."),setTimeout(()=>{console.log("Executing router.replace to /dashboard"),v.replace("/dashboard"),console.log("Router.replace called")},100)}catch(t){console.error("Login error:",t),g.value={header:"Erro no Login",message:t.message||"Erro interno. Tente novamente."},m.value=!0}finally{r.value=!1}},k=async()=>{try{c.isAuthenticated()&&((await b.execute()).role==="tecnico"?v.replace("/dashboard"):c.removeToken())}catch(t){c.removeToken()}};return L(()=>{k()}),(t,e)=>(p(),A(o(T),null,{default:n(()=>[s(o(q),{fullscreen:!0,class:"login-content"},{default:n(()=>[r.value?(p(),h("div",z,[s(o(D),{name:"crescent"}),e[3]||(e[3]=a("p",null,"Entrando...",-1))])):(p(),h("div",F,[a("div",G,[a("div",H,[s(o(w),{icon:o(O),class:"logo-icon"},null,8,["icon"])]),e[4]||(e[4]=a("h1",null,"Hemodiálise",-1)),e[5]||(e[5]=a("p",null,"Sistema Mobile de Segurança",-1))]),a("form",{onSubmit:S(_,["prevent"]),class:"login-form"},[a("div",K,[s(o(C),{class:"mobile-input",fill:"outline"},{default:n(()=>[s(o(I),{position:"floating"},{default:n(()=>[...e[6]||(e[6]=[f("Email",-1)])]),_:1}),s(o(x),{modelValue:l.value.email,"onUpdate:modelValue":e[0]||(e[0]=i=>l.value.email=i),type:"email",required:"",disabled:r.value,placeholder:"Digite seu email"},null,8,["modelValue","disabled"])]),_:1})]),a("div",Q,[s(o(C),{class:"mobile-input",fill:"outline"},{default:n(()=>[s(o(I),{position:"floating"},{default:n(()=>[...e[7]||(e[7]=[f("Senha",-1)])]),_:1}),s(o(x),{modelValue:l.value.password,"onUpdate:modelValue":e[1]||(e[1]=i=>l.value.password=i),type:"password",required:"",disabled:r.value,placeholder:"Digite sua senha"},null,8,["modelValue","disabled"])]),_:1})]),s(o(M),{expand:"block",type:"submit",class:"mobile-button",disabled:r.value||!E.value},{default:n(()=>[s(o(w),{icon:o(P),slot:"start"},null,8,["icon"]),e[8]||(e[8]=f(" Entrar ",-1))]),_:1},8,["disabled"])],32),s(o(R),{"is-open":m.value,header:g.value.header,message:g.value.message,buttons:["OK"],onDidDismiss:e[2]||(e[2]=i=>m.value=!1)},null,8,["is-open","header","message"]),e[9]||(e[9]=a("div",{class:"login-footer"},[a("p",null,"Sistema de Controle de Qualidade"),a("p",null,"Estado do Maranhão")],-1))]))]),_:1})]),_:1}))}}),oe=$(J,[["__scopeId","data-v-8c042eaf"]]);export{oe as default};
