const __vite__fileDeps=["assets/ionic-B_Arm38Z.js","assets/vendor-BAY9JQbk.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{e as qe,t as _,o as ee,q as B,x as xe,p as ae,k as C,g as l,r as te,s as Ie,u as De,B as Oe,C as Re,f as Te,E as Se,i as se,w as P,J as ne,G as $e,l as Ae,j as Le,_ as N}from"./ionic-B_Arm38Z.js";import{d as Ve,r as k,c as q,o as Be,B as x,q as p,x as i,y as a,v as o,H as m,t as s,n as y,G as c,K as b,J as w,F as Pe,L as Ne,C as oe,z as ze}from"./vendor-BAY9JQbk.js";import{y as Ue,A as je,G as He,t as z,K as A,z as L,V as U,W as j,X as Fe,O as Xe,Y as Ge,Z as Je,$ as We,p as Ke,b as Qe,u as Ye,a0 as Ze,_ as ea}from"./_plugin-vue_export-helper-BgNw2jzN.js";import{C as aa}from"./main-BdbvssAv.js";import{u as ta}from"./useStatsAutoRefresh-CFANOfIQ.js";const sa={class:"machines-container"},na={class:"time-display"},oa={class:"current-date"},ia={class:"current-time"},la={class:"filter-pills"},ra={class:"pill-count"},ua={class:"pill-count"},ca={class:"pill-count"},da={class:"pill-count"},va={class:"stats-summary"},pa={class:"stat-info"},ma={class:"stat-number"},fa={class:"stat-info"},_a={class:"stat-number"},ga={class:"stat-info"},ba={class:"stat-number"},wa={class:"stat-info"},ha={class:"stat-number"},ya={key:0,class:"loading-container"},Ca={key:1,class:"machines-list"},ka=["onClick"],Ma={class:"machine-card-header"},Ea={class:"machine-primary-info"},qa={class:"machine-name"},xa={key:0,class:"machine-identifier"},Ia={class:"machine-status-badge"},Da={class:"status-text"},Oa={key:0,class:"machine-description"},Ra={key:1,class:"session-info-modern"},Ta={class:"session-tag"},Sa={class:"session-details-grid"},$a={class:"session-detail"},Aa={class:"detail-value"},La={class:"session-detail"},Va={class:"detail-value"},Ba={class:"session-detail"},Pa={class:"detail-value"},Na={class:"session-action"},za={key:3,class:"inactive-overlay"},Ua={key:0,class:"empty-state-modern"},ja={class:"empty-icon"},Ha={class:"form-section"},Fa={class:"form-group"},Xa={class:"form-group"},Ga={class:"form-group"},Ja={class:"form-actions"},Wa=Ve({__name:"MachinesPage",setup(Ka){const H=ze(),D=aa.getInstance().getMachineRepository(),d=k([]),O=k(!1),h=k("all"),F=k(""),X=k(""),R=k(!1),M=k(!1),g=k(!1),u=k({id:null,name:"",identifier:"",description:"",unit_id:null}),G=()=>{const t=new Date;F.value=t.toLocaleDateString("pt-BR",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),X.value=t.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})};setInterval(G,1e3),G();const J=q(()=>d.value.filter(t=>t.status==="available"&&t.is_active!==!1).length),W=q(()=>d.value.filter(t=>t.status==="occupied").length),K=q(()=>d.value.filter(t=>t.status==="maintenance").length),ie=q(()=>d.value.filter(t=>t.is_active===!1).length),Q=q(()=>{switch(h.value){case"available":return d.value.filter(t=>t.status==="available"&&t.is_active!==!1);case"occupied":return d.value.filter(t=>t.status==="occupied");case"maintenance":return d.value.filter(t=>t.status==="maintenance");case"inactive":return d.value.filter(t=>t.is_active===!1);default:return d.value}}),T=async()=>{O.value=!0;try{const t=await D.getAll();d.value=t}catch(t){console.error("Error loading machines:",t),await(await _.create({message:"Erro ao carregar máquinas",duration:3e3,color:"danger",position:"top"})).present()}finally{O.value=!1}},Y=async()=>{await T()},{isRefreshing:S,forceRefresh:le}=ta(Y,{loadOnMount:!1,interval:15e3,onStatsUpdated:()=>{console.log("[Machines] Stats atualizados automaticamente")}}),re=async t=>{await le(),t.target.complete()},V=t=>!t.is_active||t.is_active===!1?"inactive":t.status,ue=t=>{if(!t.is_active||t.is_active===!1)return"Desativada";switch(t.status){case"available":return"Disponível";case"occupied":return"Em Uso";case"reserved":return"Reservada";case"maintenance":return"Manutenção";default:return t.status}},ce=t=>({pre_dialysis:"Pré-Diálise",during_session:"Durante Sessão",post_dialysis:"Pós-Diálise",completed:"Concluído",interrupted:"Interrompido"})[t]||t,de=t=>t?new Date(t).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):"",ve=t=>{H.push("/checklist/".concat(t))},pe=async t=>{const{alertController:e}=await N(()=>import("./ionic-B_Arm38Z.js").then(r=>r.a8),__vite__mapDeps([0,1]));await(await e.create({header:"Colocar em Manutenção",subHeader:t.name,message:"Descreva brevemente o motivo da manutenção:",inputs:[{name:"reason",type:"textarea",placeholder:"Ex: Troca de filtros, ajuste de pressão, etc."}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Confirmar",handler:r=>{me(t,r.reason||"")}}]})).present()},me=async(t,e)=>{var n,r;try{const v=await D.updateStatus(t.id,{status:"maintenance",reason:e}),f=d.value.findIndex($=>$.id===t.id);f!==-1&&(d.value[f]={...d.value[f],...v}),await(await _.create({message:"".concat(t.name," colocada em manutenção"),duration:3e3,color:"success",position:"top"})).present()}catch(v){console.error("Error putting machine in maintenance:",v),await(await _.create({message:((r=(n=v.response)==null?void 0:n.data)==null?void 0:r.message)||"Erro ao colocar máquina em manutenção",duration:4e3,color:"danger",position:"top"})).present()}},fe=async t=>{const{alertController:e}=await N(()=>import("./ionic-B_Arm38Z.js").then(r=>r.a8),__vite__mapDeps([0,1]));await(await e.create({header:"Liberar Máquina",subHeader:t.name,message:"Tem certeza que deseja liberar esta máquina? Ela ficará disponível para uso.",buttons:[{text:"Cancelar",role:"cancel"},{text:"Liberar",handler:async()=>{var r,v;try{const f=await D.updateStatus(t.id,{status:"available"}),E=d.value.findIndex(Ee=>Ee.id===t.id);E!==-1&&(d.value[E]={...d.value[E],...f}),await(await _.create({message:"".concat(t.name," liberada com sucesso"),duration:3e3,color:"success",position:"top"})).present()}catch(f){console.error("Error releasing machine:",f),await(await _.create({message:((v=(r=f.response)==null?void 0:r.data)==null?void 0:v.message)||"Erro ao liberar máquina",duration:4e3,color:"danger",position:"top"})).present()}}}]})).present()},_e=async t=>{const{alertController:e}=await N(()=>import("./ionic-B_Arm38Z.js").then(v=>v.a8),__vite__mapDeps([0,1])),n=!t.is_active;await(await e.create({header:n?"Ativar Máquina":"Desativar Máquina",subHeader:t.name,message:n?"A máquina será ativada e ficará disponível para uso.":"Descreva brevemente o motivo da desativação:",inputs:n?[]:[{name:"reason",type:"textarea",placeholder:"Ex: Equipamento danificado, aguardando reparo, etc."}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Confirmar",handler:v=>{ge(t,(v==null?void 0:v.reason)||"")}}]})).present()},ge=async(t,e)=>{var n,r;try{const v=await D.toggleActive(t.id,{reason:e}),f=d.value.findIndex($=>$.id===t.id);f!==-1&&(d.value[f]={...d.value[f],...v}),await(await _.create({message:v.is_active?"".concat(t.name," ativada com sucesso"):"".concat(t.name," desativada com sucesso"),duration:3e3,color:"success",position:"top"})).present()}catch(v){console.error("Error toggling machine active:",v),await(await _.create({message:((r=(n=v.response)==null?void 0:n.data)==null?void 0:r.message)||"Erro ao alterar estado da máquina",duration:4e3,color:"danger",position:"top"})).present()}},be=()=>{switch(h.value){case"available":return"Nenhuma máquina disponível no momento";case"occupied":return"Nenhuma máquina em uso";case"maintenance":return"Nenhuma máquina em manutenção";case"inactive":return"Nenhuma máquina desativada";default:return"Nenhuma máquina cadastrada"}},Z=q(()=>u.value.name.trim()!==""&&u.value.identifier.trim()!==""),we=async()=>{try{const t=await fetch("/api/user-units/current",{credentials:"include",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw console.error("Erro ao carregar unidade"),new Error("Não foi possível carregar a unidade");const e=await t.json();console.log("Resposta de /api/user-units/current:",e),e.success&&e.unit&&e.unit.id?(u.value.unit_id=e.unit.id,console.log("Unit ID configurado:",u.value.unit_id)):(console.error("Nenhuma unidade selecionada"),await(await _.create({message:"Por favor, selecione uma unidade no Dashboard antes de continuar",duration:3e3,color:"warning",position:"top",buttons:[{text:"Ir para Dashboard",handler:()=>{H.push("/dashboard")}}]})).present(),I())}catch(t){console.error("Erro ao carregar unidade:",t),await(await _.create({message:"Erro ao carregar unidade. Por favor, tente novamente.",duration:2e3,color:"danger",position:"top"})).present()}},he=async()=>{M.value=!1,u.value={id:null,name:"",identifier:"",description:"",unit_id:null},await we(),R.value=!0},ye=async t=>{M.value=!0,u.value={id:t.id,name:t.name,identifier:t.identifier,description:t.description||"",unit_id:t.unit_id},R.value=!0},I=()=>{R.value=!1,u.value={id:null,name:"",identifier:"",description:"",unit_id:null}},Ce=async()=>{if(Z.value){g.value=!0;try{const t=M.value?"/api/machines/".concat(u.value.id):"/api/machines",e=M.value?"PUT":"POST",r=await(await fetch(t,{method:e,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({name:u.value.name,identifier:u.value.identifier,description:u.value.description,unit_id:u.value.unit_id})})).json();if(r.success)await(await _.create({message:r.message||(M.value?"Máquina atualizada com sucesso!":"Máquina criada com sucesso!"),duration:3e3,color:"success",position:"top"})).present(),I(),await T();else throw new Error(r.message||"Erro ao salvar máquina")}catch(t){await(await _.create({message:t.message||"Erro ao salvar máquina. Tente novamente.",duration:4e3,color:"danger",position:"top"})).present()}finally{g.value=!1}}},ke=async()=>{await(await Ae.create({header:"Confirmar Exclusão",message:"Tem certeza que deseja excluir a máquina <strong>".concat(u.value.name,"</strong>? Esta ação irá desativá-la."),buttons:[{text:"Cancelar",role:"cancel"},{text:"Excluir",role:"destructive",handler:async()=>{await Me()}}]})).present()},Me=async()=>{if(u.value.id){g.value=!0;try{const e=await(await fetch("/api/machines/".concat(u.value.id),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();if(e.success)await(await _.create({message:e.message||"Máquina removida com sucesso!",duration:3e3,color:"success",position:"top"})).present(),I(),await T();else throw new Error(e.message||"Erro ao excluir máquina")}catch(t){await(await _.create({message:t.message||"Erro ao excluir máquina. Tente novamente.",duration:4e3,color:"danger",position:"top"})).present()}finally{g.value=!1}}};return Be(()=>{T()}),(t,e)=>(p(),x(a(qe),null,{default:i(()=>[o(a(te),{translucent:!0},{default:i(()=>[o(a(ee),{color:"primary"},{default:i(()=>[o(a(B),{slot:"start"},{default:i(()=>[o(a(xe),{"default-href":"/dashboard"})]),_:1}),o(a(ae),null,{default:i(()=>[...e[8]||(e[8]=[m("Gestão de Máquinas",-1)])]),_:1}),o(a(B),{slot:"end"},{default:i(()=>[o(a(C),{onClick:Y,disabled:O.value},{default:i(()=>[o(a(l),{icon:a(Ue)},null,8,["icon"])]),_:1},8,["disabled"]),o(a(C),{onClick:he},{default:i(()=>[o(a(l),{icon:a(je)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),o(a(se),{fullscreen:!0,class:"machines-content"},{default:i(()=>[s("div",sa,[o(a(Ie),{slot:"fixed",onIonRefresh:re},{default:i(()=>[o(a(De))]),_:1}),o(a(Oe),{class:"time-header-card"},{default:i(()=>[o(a(Re),null,{default:i(()=>[s("div",na,[s("div",oa,[o(a(l),{icon:a(He),class:"date-icon"},null,8,["icon"]),m(" "+c(F.value),1)]),s("div",ia,[o(a(l),{icon:a(z),class:"time-icon"},null,8,["icon"]),m(" "+c(X.value),1)])])]),_:1})]),_:1}),s("div",la,[s("button",{class:b(["filter-pill",{active:h.value==="all"}]),onClick:e[0]||(e[0]=n=>h.value="all")},[o(a(l),{icon:a(A)},null,8,["icon"]),e[9]||(e[9]=s("span",null,"Todas",-1)),s("span",ra,c(d.value.length),1)],2),s("button",{class:b(["filter-pill available",{active:h.value==="available"}]),onClick:e[1]||(e[1]=n=>h.value="available")},[o(a(l),{icon:a(L)},null,8,["icon"]),e[10]||(e[10]=s("span",null,"Disponíveis",-1)),s("span",ua,c(J.value),1)],2),s("button",{class:b(["filter-pill occupied",{active:h.value==="occupied"}]),onClick:e[2]||(e[2]=n=>h.value="occupied")},[o(a(l),{icon:a(z)},null,8,["icon"]),e[11]||(e[11]=s("span",null,"Em Uso",-1)),s("span",ca,c(W.value),1)],2),s("button",{class:b(["filter-pill maintenance",{active:h.value==="maintenance"}]),onClick:e[3]||(e[3]=n=>h.value="maintenance")},[o(a(l),{icon:a(U)},null,8,["icon"]),e[12]||(e[12]=s("span",null,"Manutenção",-1)),s("span",da,c(K.value),1)],2)]),s("div",va,[s("div",{class:b(["stat-card available",{updating:a(S)}])},[o(a(l),{icon:a(L)},null,8,["icon"]),s("div",pa,[s("span",ma,c(J.value),1),e[13]||(e[13]=s("span",{class:"stat-label"},"Disponíveis",-1))])],2),s("div",{class:b(["stat-card occupied",{updating:a(S)}])},[o(a(l),{icon:a(z)},null,8,["icon"]),s("div",fa,[s("span",_a,c(W.value),1),e[14]||(e[14]=s("span",{class:"stat-label"},"Em Uso",-1))])],2),s("div",{class:b(["stat-card maintenance",{updating:a(S)}])},[o(a(l),{icon:a(U)},null,8,["icon"]),s("div",ga,[s("span",ba,c(K.value),1),e[15]||(e[15]=s("span",{class:"stat-label"},"Manutenção",-1))])],2),s("div",{class:b(["stat-card inactive",{updating:a(S)}])},[o(a(l),{icon:a(j)},null,8,["icon"]),s("div",wa,[s("span",ha,c(ie.value),1),e[16]||(e[16]=s("span",{class:"stat-label"},"Desativadas",-1))])],2)]),O.value?(p(),y("div",ya,[o(a(Te),{name:"crescent"}),e[17]||(e[17]=s("p",null,"Carregando máquinas...",-1))])):(p(),y("div",Ca,[(p(!0),y(Pe,null,Ne(Q.value,n=>(p(),y("div",{key:n.id,class:b(["machine-card-modern",V(n)]),onClick:r=>n.current_checklist&&ve(n.current_checklist.id)},[s("div",Ma,[s("div",{class:b(["machine-icon-large",V(n)])},[o(a(l),{icon:a(A)},null,8,["icon"])],2),s("div",Ea,[s("h3",qa,c(n.name),1),n.identifier?(p(),y("p",xa,c(n.identifier),1)):w("",!0)]),s("div",Ia,[s("div",{class:b(["status-dot",V(n)])},null,2),s("span",Da,c(ue(n)),1)])]),n.description?(p(),y("div",Oa,c(n.description),1)):w("",!0),n.current_checklist?(p(),y("div",Ra,[s("div",Ta,[o(a(l),{icon:a(Ke)},null,8,["icon"]),e[19]||(e[19]=s("span",null,"Sessão Ativa",-1)),n.current_checklist.is_paused?(p(),x(a(Le),{key:0,color:"warning"},{default:i(()=>[...e[18]||(e[18]=[m("Pausado",-1)])]),_:1})):w("",!0)]),s("div",Sa,[s("div",$a,[e[20]||(e[20]=s("span",{class:"detail-label"},"Paciente",-1)),s("span",Aa,c(n.current_checklist.patient_name),1)]),s("div",La,[e[21]||(e[21]=s("span",{class:"detail-label"},"Fase",-1)),s("span",Va,c(ce(n.current_checklist.current_phase)),1)]),s("div",Ba,[e[22]||(e[22]=s("span",{class:"detail-label"},"Início",-1)),s("span",Pa,c(de(n.current_checklist.started_at)),1)])]),s("div",Na,[o(a(l),{icon:a(Qe)},null,8,["icon"]),e[23]||(e[23]=s("span",null,"Clique para ver checklist",-1)),o(a(l),{icon:a(Ye)},null,8,["icon"])])])):w("",!0),n.current_checklist?w("",!0):(p(),y("div",{key:2,class:"machine-actions",onClick:e[4]||(e[4]=oe(()=>{},["stop"]))},[o(a(C),{fill:"clear",size:"small",color:"medium",onClick:r=>ye(n)},{default:i(()=>[o(a(l),{slot:"start",icon:a(Ze)},null,8,["icon"]),e[24]||(e[24]=m(" Editar ",-1))]),_:1},8,["onClick"]),n.is_active&&n.status==="available"?(p(),x(a(C),{key:0,fill:"outline",size:"small",color:"warning",onClick:r=>pe(n)},{default:i(()=>[o(a(l),{slot:"start",icon:a(U)},null,8,["icon"]),e[25]||(e[25]=m(" Manutenção ",-1))]),_:1},8,["onClick"])):w("",!0),n.is_active&&n.status==="maintenance"?(p(),x(a(C),{key:1,fill:"solid",size:"small",color:"success",onClick:r=>fe(n)},{default:i(()=>[o(a(l),{slot:"start",icon:a(L)},null,8,["icon"]),e[26]||(e[26]=m(" Liberar Máquina ",-1))]),_:1},8,["onClick"])):w("",!0),n.status!=="occupied"?(p(),x(a(C),{key:2,fill:"outline",size:"small",color:n.is_active?"danger":"success",onClick:r=>_e(n)},{default:i(()=>[o(a(l),{slot:"start",icon:n.is_active?a(j):a(L)},null,8,["icon"]),m(" "+c(n.is_active?"Desativar":"Ativar"),1)]),_:2},1032,["color","onClick"])):w("",!0)])),n.is_active?w("",!0):(p(),y("div",za,[o(a(l),{icon:a(j)},null,8,["icon"]),e[27]||(e[27]=s("span",null,"Desativada",-1))]))],10,ka))),128)),Q.value.length===0?(p(),y("div",Ua,[s("div",ja,[o(a(l),{icon:a(A)},null,8,["icon"])]),e[28]||(e[28]=s("h3",null,"Nenhuma máquina encontrada",-1)),s("p",null,c(be()),1)])):w("",!0)]))]),o(a(Se),{"is-open":R.value,onDidDismiss:I},{default:i(()=>[o(a(te),null,{default:i(()=>[o(a(ee),null,{default:i(()=>[o(a(ae),null,{default:i(()=>[m(c(M.value?"Editar Máquina":"Nova Máquina"),1)]),_:1}),o(a(B),{slot:"end"},{default:i(()=>[o(a(C),{onClick:I},{default:i(()=>[...e[29]||(e[29]=[m("Cancelar",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),o(a(se),{class:"machine-modal-content"},{default:i(()=>[s("form",{onSubmit:oe(Ce,["prevent"]),class:"machine-form"},[s("div",Ha,[e[33]||(e[33]=s("h3",{class:"section-title"},"Informações Básicas",-1)),s("div",Fa,[o(a(P),{position:"stacked",class:"form-label"},{default:i(()=>[o(a(l),{icon:a(A)},null,8,["icon"]),e[30]||(e[30]=m(" Nome da Máquina * ",-1))]),_:1}),o(a(ne),{modelValue:u.value.name,"onUpdate:modelValue":e[5]||(e[5]=n=>u.value.name=n),type:"text",placeholder:"Ex: Máquina 01",required:"",disabled:g.value,class:"custom-input"},null,8,["modelValue","disabled"])]),s("div",Xa,[o(a(P),{position:"stacked",class:"form-label"},{default:i(()=>[o(a(l),{icon:a(Fe)},null,8,["icon"]),e[31]||(e[31]=m(" Identificador/Código * ",-1))]),_:1}),o(a(ne),{modelValue:u.value.identifier,"onUpdate:modelValue":e[6]||(e[6]=n=>u.value.identifier=n),type:"text",placeholder:"Ex: MAQ-001",required:"",disabled:g.value,class:"custom-input"},null,8,["modelValue","disabled"])]),s("div",Ga,[o(a(P),{position:"stacked",class:"form-label"},{default:i(()=>[o(a(l),{icon:a(Xe)},null,8,["icon"]),e[32]||(e[32]=m(" Descrição ",-1))]),_:1}),o(a($e),{modelValue:u.value.description,"onUpdate:modelValue":e[7]||(e[7]=n=>u.value.description=n),placeholder:"Informações adicionais sobre a máquina",rows:4,disabled:g.value,class:"custom-textarea"},null,8,["modelValue","disabled"])])]),s("div",Ja,[o(a(C),{expand:"block",type:"submit",disabled:g.value||!Z.value,class:"submit-button"},{default:i(()=>[o(a(l),{slot:"start",icon:g.value?a(Ge):a(Je)},null,8,["icon"]),m(" "+c(g.value?"Salvando...":M.value?"Atualizar Máquina":"Criar Máquina"),1)]),_:1},8,["disabled"]),M.value?(p(),x(a(C),{key:0,expand:"block",fill:"outline",color:"danger",onClick:ke,disabled:g.value,class:"delete-button"},{default:i(()=>[o(a(l),{slot:"start",icon:a(We)},null,8,["icon"]),e[34]||(e[34]=m(" Excluir Máquina ",-1))]),_:1},8,["disabled"])):w("",!0)])],32)]),_:1})]),_:1},8,["is-open"])]),_:1})]),_:1}))}}),st=ea(Wa,[["__scopeId","data-v-0394af6e"]]);export{st as default};
