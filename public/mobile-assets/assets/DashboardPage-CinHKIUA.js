import{d as le,c as y,n as C,q as p,t as s,v as o,G as d,x as r,H as M,y as e,I as De,J as b,B as T,K as X,r as _,o as Ue,z as Te,F as Ae,L as Pe}from"./vendor-BAY9JQbk.js";import{j as ce,g as n,k as D,l as G,e as ze,t as w,m as ee,n as Ee,o as Re,p as Le,q as je,r as Be,s as qe,u as Ne,v as se,w as te,i as He}from"./ionic-B_Arm38Z.js";import{p as xe,d as Fe,t as J,f as ae,g as oe,i as Ve,_ as re,h as Xe,j as Ge,k as Je,n as ne,o as We,q as ie,m as Ke,r as Qe,u as N,v as Ye,w as Ze,x as es}from"./_plugin-vue_export-helper-BgNw2jzN.js";import{C as ss,u as ts}from"./main-Cm9J612g.js";import{u as as}from"./useStatsAutoRefresh-jtzHKU-G.js";const os={class:"card-header"},ns={class:"machine-info"},is={class:"machine-id"},ls={class:"patient-info"},cs={class:"patient-name"},rs={class:"user-info"},us={class:"user-name"},ds={class:"progress-section"},hs={class:"progress-bar"},ps={class:"progress-text"},ms={class:"time-info"},vs={class:"time-item"},gs={class:"time-value"},fs={key:0,class:"time-item"},_s={class:"time-value"},ks={class:"actions"},ws=le({__name:"ActiveChecklistCard",props:{checklist:{}},emits:["continue","pause","resume"],setup(W,{emit:v}){const u=W,L=y(()=>({pre_dialysis:"Pré-Diálise",during_session:"Durante Sessão",post_dialysis:"Pós-Diálise",completed:"Concluído",interrupted:"Interrompido"})[u.checklist.current_phase]||u.checklist.current_phase),H=y(()=>({pre_dialysis:"primary",during_session:"warning",post_dialysis:"secondary",completed:"success",interrupted:"danger"})[u.checklist.current_phase]||"medium"),A=y(()=>u.checklist.current_phase.replace("_","-")),P=y(()=>u.checklist.phase_completion!==void 0?Math.round(u.checklist.phase_completion):{pre_dialysis:25,during_session:50,post_dialysis:75,completed:100,interrupted:0}[u.checklist.current_phase]||0),m=y(()=>{const l=new Date(u.checklist.created_at),k=new Date().getTime()-l.getTime(),g=Math.floor(k/(1e3*60*60)),I=Math.floor(k%(1e3*60*60)/(1e3*60));return g>0?"".concat(g,"h ").concat(I,"m"):"".concat(I,"m")}),z=y(()=>{if(!u.checklist.paused_at)return"";const l=new Date(u.checklist.paused_at),k=new Date().getTime()-l.getTime(),g=Math.floor(k/(1e3*60*60)),I=Math.floor(k%(1e3*60*60)/(1e3*60));return g>0?"".concat(g,"h ").concat(I,"m"):"".concat(I,"m")}),E=async()=>{await(await G.create({header:"Detalhes do Checklist",subHeader:"".concat(u.checklist.machine.name," - ").concat(u.checklist.patient.name),message:"\n      <strong>Técnico:</strong> ".concat(u.checklist.user.name,"<br>\n      <strong>Fase:</strong> ").concat(L.value,"<br>\n      <strong>Progresso:</strong> ").concat(P.value,"%<br>\n      <strong>Iniciado:</strong> ").concat(new Date(u.checklist.created_at).toLocaleString("pt-BR"),"<br>\n      ").concat(u.checklist.paused_at?"<strong>Pausado:</strong> ".concat(new Date(u.checklist.paused_at).toLocaleString("pt-BR"),"<br>"):"","\n    "),buttons:["Fechar"]})).present()};return(l,c)=>(p(),C("div",{class:X(["checklist-card",[A.value,{paused:l.checklist.paused_at}]])},[s("div",os,[s("div",ns,[s("h3",null,d(l.checklist.machine.name),1),s("p",is,d(l.checklist.machine.identifier),1)]),o(e(ce),{color:H.value,class:"phase-badge"},{default:r(()=>[M(d(L.value),1)]),_:1},8,["color"])]),s("div",ls,[o(e(n),{icon:e(xe),class:"patient-icon"},null,8,["icon"]),s("span",cs,d(l.checklist.patient.name),1)]),s("div",rs,[o(e(n),{icon:e(Fe),class:"user-icon"},null,8,["icon"]),c[3]||(c[3]=s("span",{class:"user-label"},"Técnico:",-1)),s("span",us,d(l.checklist.user.name),1)]),s("div",ds,[s("div",hs,[s("div",{class:"progress-fill",style:De({width:P.value+"%"})},null,4)]),s("span",ps,d(P.value)+"% completo",1)]),s("div",ms,[s("div",vs,[o(e(n),{icon:e(J),class:"time-icon"},null,8,["icon"]),c[4]||(c[4]=s("span",{class:"time-label"},"Iniciado há",-1)),s("span",gs,d(m.value),1)]),l.checklist.paused_at?(p(),C("div",fs,[o(e(n),{icon:e(ae),class:"time-icon paused"},null,8,["icon"]),c[5]||(c[5]=s("span",{class:"time-label"},"Pausado há",-1)),s("span",_s,d(z.value),1)])):b("",!0)]),s("div",ks,[l.checklist.paused_at?b("",!0):(p(),T(e(D),{key:0,fill:"outline",size:"small",onClick:c[0]||(c[0]=k=>l.$emit("continue",l.checklist)),class:"action-button continue"},{default:r(()=>[o(e(n),{icon:e(oe),slot:"start"},null,8,["icon"]),c[6]||(c[6]=M(" Continuar ",-1))]),_:1})),l.checklist.paused_at?(p(),T(e(D),{key:1,fill:"solid",size:"small",onClick:c[1]||(c[1]=k=>l.$emit("resume",l.checklist)),class:"action-button resume",color:"success"},{default:r(()=>[o(e(n),{icon:e(oe),slot:"start"},null,8,["icon"]),c[7]||(c[7]=M(" Retomar ",-1))]),_:1})):b("",!0),l.checklist.paused_at?b("",!0):(p(),T(e(D),{key:2,fill:"outline",size:"small",onClick:c[2]||(c[2]=k=>l.$emit("pause",l.checklist)),class:"action-button pause",color:"warning"},{default:r(()=>[o(e(n),{icon:e(ae),slot:"start"},null,8,["icon"]),c[8]||(c[8]=M(" Pausar ",-1))]),_:1})),o(e(D),{fill:"clear",size:"small",onClick:E,class:"action-button details"},{default:r(()=>[o(e(n),{icon:e(Ve),slot:"icon-only"},null,8,["icon"])]),_:1})]),s("div",{class:X(["status-indicator",A.value])},null,2)],2))}}),Cs=re(ws,[["__scopeId","data-v-279d50f9"]]),ys={class:"dashboard-container"},bs={key:0,class:"welcome-section"},$s={class:"welcome-header"},Ss={class:"welcome-text"},Is={class:"unit-display"},Ms={key:0,class:"unit-info-static"},Os={class:"unit-text-static"},Ds={class:"unit-name-static"},Us={key:1,class:"unit-info"},Ts={class:"unit-text"},As={class:"unit-name"},Ps={key:1,class:"quick-stats"},zs={key:0,class:"stats-update-badge"},Es={class:"stat-icon"},Rs={class:"stat-content"},Ls={class:"stat-number"},js={class:"stat-icon"},Bs={class:"stat-content"},qs={class:"stat-number"},Ns={class:"stat-icon"},Hs={class:"stat-content"},xs={class:"stat-number"},Fs={class:"primary-action"},Vs={class:"section"},Xs={class:"quick-actions"},Gs={class:"action-icon warning"},Js={class:"action-content"},Ws={class:"action-subtitle"},Ks={class:"action-icon tertiary"},Qs={class:"action-icon cleaning"},Ys={class:"action-icon primary"},Zs={key:2,class:"section"},et={class:"checklists-list"},st={class:"connection-status"},tt=le({__name:"DashboardPage",setup(W){const v=Te(),u=ss.getInstance(),L=u.getCurrentUserUseCase(),H=u.getLogoutUseCase(),{isDarkMode:A,toggleDarkMode:P}=ts(),m=_(null),z=_(navigator.onLine),E=_(!1),l=_(0),c=_(3),k=_(!1),g=_([]),I=_([]),R=_([]),U=_([]),$=_(null),S=_(null);y(()=>m.value&&{tecnico:"Técnico",admin:"Admin",gestor:"Gestor",coordenador:"Coordenador",supervisor:"Supervisor"}[m.value.role]||"Usuário");const x=y(()=>g.value.filter(a=>!a.paused_at).length);y(()=>g.value.filter(a=>a.paused_at).length);const F=y(()=>I.value.length),K=async()=>{try{m.value=await L.execute(),console.log("User loaded:",m.value),await ue()}catch(a){console.error("Error loading user:",a),await(await w.create({message:"Erro ao carregar dados do usuário",duration:3e3,color:"danger",position:"top"})).present(),setTimeout(()=>{v.replace("/login")},2e3)}},ue=async()=>{var a,t,i;try{const h=await(await fetch("/api/user-units",{credentials:"include",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();if(h.success){U.value=h.units||[];const O=h.current_unit_id;O?($.value=h.units.find(q=>q.id===O),S.value=O,console.log("Unidade já selecionada:",(a=$.value)==null?void 0:a.name)):h.units.length===1?(console.log("Apenas uma unidade disponível, selecionando automaticamente..."),await V(h.units[0].id),$.value=h.units[0],S.value=h.units[0].id):h.units.length>1&&(console.log("Múltiplas unidades disponíveis, forçando seleção..."),setTimeout(()=>{he()},500)),console.log("Unidades carregadas (mobile):",{total:U.value.length,current:(t=$.value)==null?void 0:t.name,currentId:S.value})}}catch(f){console.error("Error loading available units:",f),(i=m.value)!=null&&i.unit&&($.value=m.value.unit,S.value=m.value.unit.id,U.value=m.value.units||[m.value.unit])}},de=async()=>{const a=U.value.map(i=>({text:i.id===S.value?"✓ ".concat(i.name):i.name,cssClass:i.id===S.value?"unit-selected":"",handler:()=>{i.id!==S.value&&V(i.id)}}));a.push({text:"Cancelar",role:"cancel",handler:()=>{}}),await(await ee.create({header:"Selecionar Unidade",subHeader:"Escolha a unidade para visualizar",buttons:a,cssClass:"unit-selector-action-sheet"})).present()},he=async()=>{const a=U.value.map(i=>({text:i.name,handler:()=>{V(i.id)}}));await(await ee.create({header:"Selecione uma Unidade",subHeader:"Por favor, escolha a unidade para continuar",buttons:a,backdropDismiss:!1,cssClass:"unit-selector-action-sheet mandatory-selection"})).present()},V=async a=>{var t;try{const i=await Ee.create({message:"Alternando unidade...",spinner:"crescent",duration:1e4});await i.present();const h=await(await fetch("/api/user-units/switch",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({unit_id:a})})).json();await i.dismiss(),h.success&&($.value=h.current_unit,S.value=a,await(await w.create({message:"📍 Unidade alterada para ".concat(h.current_unit.name),duration:1500,color:"success",position:"top",cssClass:"custom-toast"})).present(),setTimeout(()=>{window.location.reload()},1500))}catch(i){console.error("Error switching unit:",i),S.value=(t=$.value)==null?void 0:t.id,await(await w.create({message:"Erro ao trocar de unidade",duration:3e3,color:"danger",position:"top"})).present()}},j=async()=>{try{await Promise.all([ve(),ge(),fe()]),l.value=g.value.length,c.value=R.value.length,E.value=!0,console.log("Stats loaded")}catch(a){console.error("Error loading stats:",a),E.value=!0}},{isRefreshing:B,hasUpdates:pe,forceRefresh:me}=as(j,{loadOnMount:!1,interval:15e3,onStatsUpdated:()=>{console.log("[Dashboard] Stats atualizados automaticamente")},debug:!1}),ve=async()=>{try{const t=await(await fetch("/api/checklists/active",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();t.success&&(g.value=t.checklists)}catch(a){console.error("Erro ao carregar checklists ativos:",a)}},ge=async()=>{try{const t=await(await fetch("/api/machines/available",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();t.success&&(I.value=t.machines)}catch(a){console.error("Erro ao carregar máquinas disponíveis:",a)}},fe=async()=>{try{const a=await fetch("/api/machines",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token")),"Content-Type":"application/json",Accept:"application/json"}});if(!a.ok){console.warn("Failed to load machines: ".concat(a.status)),R.value=[];return}const t=await a.json();t.success&&t.machines?R.value=t.machines:R.value=[]}catch(a){console.error("Erro ao carregar máquinas:",a),R.value=[]}},_e=async a=>{try{await Promise.all([K(),me()]),await(await w.create({message:"Dados atualizados",duration:1500,color:"success",position:"top"})).present()}catch(t){console.error("Error refreshing:",t)}finally{a.target.complete()}},ke=async()=>{await(await G.create({header:"Confirmar Saída",message:"Deseja realmente sair do aplicativo?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Sair",role:"confirm",handler:async()=>{try{await H.execute(),await(await w.create({message:"Logout realizado com sucesso",duration:2e3,color:"success",position:"top"})).present(),v.replace("/login")}catch(t){console.error("Logout error:",t),v.replace("/login")}}}]})).present()},we=()=>{console.log("Navigating to new checklist..."),v.push("/checklist/new")},Ce=()=>{console.log("Navigating to patients..."),v.push("/patients")},ye=()=>{console.log("Navigating to profile..."),v.push("/profile")},Q=()=>{console.log("Navigating to active checklists..."),v.push("/checklists")},Y=()=>{v.push("/machines")},be=()=>{v.push("/machines-overview")},$e=()=>{console.log("Navigating to cleaning controls..."),v.push("/cleaning-controls")},Se=a=>{v.push("/checklist/".concat(a.id))},Ie=async a=>{await(await G.create({header:"Pausar Checklist",message:"Deseja pausar o checklist da máquina ".concat(a.machine.name,"?"),buttons:[{text:"Cancelar",role:"cancel"},{text:"Pausar",handler:async()=>{try{const f=await(await fetch("/api/checklists/".concat(a.id,"/pause"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();if(f.success)await(await w.create({message:"Checklist pausado com sucesso.",duration:3e3,color:"success"})).present(),await j();else throw new Error(f.message)}catch(i){await(await w.create({message:"Erro ao pausar checklist.",duration:3e3,color:"danger"})).present()}}}]})).present()},Me=async a=>{try{const i=await(await fetch("/api/checklists/".concat(a.id,"/resume"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();if(i.success)await(await w.create({message:"Checklist retomado com sucesso.",duration:3e3,color:"success"})).present(),await j();else throw new Error(i.message)}catch(t){await(await w.create({message:"Erro ao retomar checklist.",duration:3e3,color:"danger"})).present()}},Oe=async()=>{P(),await(await w.create({message:"Modo ".concat(A.value?"escuro":"claro"," ativado"),duration:1500,color:"medium",position:"bottom"})).present()},Z=()=>{z.value=navigator.onLine};return Ue(async()=>{console.log("Dashboard mounted, loading data..."),k.value=!0;try{await K(),j(),window.addEventListener("online",Z),window.addEventListener("offline",Z)}catch(a){console.error("Dashboard initialization error:",a)}finally{k.value=!1}}),(a,t)=>(p(),T(e(ze),null,{default:r(()=>[o(e(Be),null,{default:r(()=>[o(e(Re),{color:"primary"},{default:r(()=>[o(e(Le),null,{default:r(()=>[...t[0]||(t[0]=[M("Hemodiálise Mobile",-1)])]),_:1}),o(e(je),{slot:"end"},{default:r(()=>[o(e(D),{onClick:Oe,fill:"clear",class:"theme-toggle-btn"},{default:r(()=>[o(e(n),{icon:e(A)?e(Xe):e(Ge),slot:"icon-only"},null,8,["icon"])]),_:1}),o(e(D),{onClick:ke,fill:"clear"},{default:r(()=>[o(e(n),{icon:e(Je),slot:"icon-only"},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),o(e(He),{fullscreen:!0,class:"dashboard-content"},{default:r(()=>{var i,f,h,O;return[o(e(qe),{slot:"fixed",onIonRefresh:_e},{default:r(()=>[o(e(Ne))]),_:1}),s("div",ys,[m.value?(p(),C("div",bs,[s("div",$s,[s("div",Ss,[s("h1",{onClick:ye,class:"user-name-link"},"Olá, "+d(m.value.name.split(" ")[0])+"! 👋",1)])]),s("div",Is,[U.value.length<=1?(p(),C("div",Ms,[o(e(n),{icon:e(ne),class:"unit-icon-static"},null,8,["icon"]),s("div",Os,[t[1]||(t[1]=s("span",{class:"unit-label-static"},"Unidade",-1)),s("span",Ds,d(((i=$.value)==null?void 0:i.name)||((f=m.value.unit)==null?void 0:f.name)||"Carregando..."),1)])])):(p(),C("div",Us,[o(e(n),{icon:e(ne),class:"unit-icon"},null,8,["icon"]),s("div",Ts,[t[2]||(t[2]=s("span",{class:"unit-label"},"Unidade Atual",-1)),s("span",As,d(((h=$.value)==null?void 0:h.name)||((O=m.value.unit)==null?void 0:O.name)||"Carregando..."),1)]),o(e(D),{fill:"clear",size:"small",onClick:de,class:"unit-change-btn"},{default:r(()=>[o(e(n),{slot:"icon-only",icon:e(We)},null,8,["icon"])]),_:1})]))])])):b("",!0),E.value?(p(),C("div",Ps,[e(pe)||e(B)?(p(),C("div",zs,[o(e(se),{color:"success",class:"update-chip"},{default:r(()=>[o(e(n),{icon:e(B)?"sync-outline":"checkmark-circle-outline",class:X({spinning:e(B)})},null,8,["icon","class"]),o(e(te),null,{default:r(()=>[M(d(e(B)?"Atualizando...":"Atualizado"),1)]),_:1})]),_:1})])):b("",!0),s("div",{class:"stat-card available",onClick:Y},[s("div",Es,[o(e(n),{icon:e(ie)},null,8,["icon"])]),s("div",Rs,[s("div",Ls,d(F.value),1),t[3]||(t[3]=s("div",{class:"stat-label"},"Disponíveis",-1))])]),s("div",{class:"stat-card active",onClick:Q},[s("div",js,[o(e(n),{icon:e(J)},null,8,["icon"])]),s("div",Bs,[s("div",qs,d(x.value),1),t[4]||(t[4]=s("div",{class:"stat-label"},"Em Andamento",-1))])]),s("div",{class:"stat-card total",onClick:be},[s("div",Ns,[o(e(n),{icon:e(Ke)},null,8,["icon"])]),s("div",Hs,[s("div",xs,d(c.value),1),t[5]||(t[5]=s("div",{class:"stat-label"},"Total Máquinas",-1))])])])):b("",!0),s("div",Fs,[s("button",{class:"primary-btn",onClick:we},[o(e(n),{icon:e(Qe)},null,8,["icon"]),t[6]||(t[6]=s("div",{class:"btn-text"},[s("span",{class:"btn-title"},"Novo Checklist"),s("span",{class:"btn-subtitle"},"Iniciar verificação de segurança")],-1)),F.value>0?(p(),T(e(ce),{key:0,color:"success"},{default:r(()=>[M(d(F.value),1)]),_:1})):b("",!0)])]),s("div",Vs,[t[11]||(t[11]=s("h2",{class:"section-title"},"Acesso Rápido",-1)),s("div",Xs,[x.value>0?(p(),C("div",{key:0,class:"action-btn",onClick:Q},[s("div",Gs,[o(e(n),{icon:e(J)},null,8,["icon"])]),s("div",Js,[t[7]||(t[7]=s("span",{class:"action-title"},"Checklists Ativos",-1)),s("span",Ws,d(x.value)+" em andamento",1)]),o(e(n),{icon:e(N),class:"chevron"},null,8,["icon"])])):b("",!0),s("div",{class:"action-btn",onClick:Y},[s("div",Ks,[o(e(n),{icon:e(ie)},null,8,["icon"])]),t[8]||(t[8]=s("div",{class:"action-content"},[s("span",{class:"action-title"},"Máquinas"),s("span",{class:"action-subtitle"},"Status e controle")],-1)),o(e(n),{icon:e(N),class:"chevron"},null,8,["icon"])]),s("div",{class:"action-btn",onClick:$e},[s("div",Qs,[o(e(n),{icon:e(Ye)},null,8,["icon"])]),t[9]||(t[9]=s("div",{class:"action-content"},[s("span",{class:"action-title"},"Controle de Limpeza"),s("span",{class:"action-subtitle"},"Limpeza e desinfecção")],-1)),o(e(n),{icon:e(N),class:"chevron"},null,8,["icon"])]),s("div",{class:"action-btn",onClick:Ce},[s("div",Ys,[o(e(n),{icon:e(Ze)},null,8,["icon"])]),t[10]||(t[10]=s("div",{class:"action-content"},[s("span",{class:"action-title"},"Pacientes"),s("span",{class:"action-subtitle"},"Buscar e gerenciar")],-1)),o(e(n),{icon:e(N),class:"chevron"},null,8,["icon"])])])]),g.value.length>0?(p(),C("div",Zs,[t[12]||(t[12]=s("h2",{class:"section-title"},"Em Andamento",-1)),s("div",et,[(p(!0),C(Ae,null,Pe(g.value,q=>(p(),T(Cs,{key:q.id,checklist:q,onContinue:Se,onPause:Ie,onResume:Me},null,8,["checklist"]))),128))])])):b("",!0),s("div",st,[o(e(se),{color:z.value?"success":"danger",class:"status-chip"},{default:r(()=>[o(e(n),{icon:e(es)},null,8,["icon"]),o(e(te),null,{default:r(()=>[M(d(z.value?"Online":"Offline"),1)]),_:1})]),_:1},8,["color"])])])]}),_:1})]),_:1}))}}),ct=re(tt,[["__scopeId","data-v-ff2c35a1"]]);export{ct as default};
