import{d as te,c as C,n as b,q as v,t as e,v as o,G as h,x as u,H as D,y as s,I as we,J as $,A as M,K as X,r as g,o as Ce,B as ye,F as be,L as $e}from"./vendor-BlPZouPF.js";import{j as ae,g as n,k as O,l as F,e as Ie,t as w,m as Se,n as De,o as Oe,p as Me,q as Pe,r as Ae,s as Ue,u as ze,i as Ee,v as Te,w as Be}from"./ionic-C-hOnMqp.js";import{p as Le,t as H,d as Y,f as Z,i as je,_ as oe,g as qe,h as Ne,j as Re,k as ee,n as xe,o as se,m as Fe,q as He,r as q,u as Ve,v as Ge,w as Je}from"./_plugin-vue_export-helper-B7Fc93E3.js";import{C as Ke,u as Qe}from"./main-DR8MU-et.js";const We={class:"card-header"},Xe={class:"machine-info"},Ye={class:"machine-id"},Ze={class:"patient-info"},es={class:"patient-name"},ss={class:"progress-section"},ts={class:"progress-bar"},as={class:"progress-text"},os={class:"time-info"},ns={class:"time-item"},is={class:"time-value"},ls={key:0,class:"time-item"},cs={class:"time-value"},rs={class:"actions"},us=te({__name:"ActiveChecklistCard",props:{checklist:{}},emits:["continue","pause","resume"],setup(V,{emit:f}){const r=V,j=C(()=>({pre_dialysis:"Pr칠-Di치lise",during_session:"Durante Sess칚o",post_dialysis:"P칩s-Di치lise",completed:"Conclu칤do",interrupted:"Interrompido"})[r.checklist.current_phase]||r.checklist.current_phase),N=C(()=>({pre_dialysis:"primary",during_session:"warning",post_dialysis:"secondary",completed:"success",interrupted:"danger"})[r.checklist.current_phase]||"medium"),P=C(()=>r.checklist.current_phase.replace("_","-")),A=C(()=>r.checklist.phase_completion!==void 0?Math.round(r.checklist.phase_completion):{pre_dialysis:25,during_session:50,post_dialysis:75,completed:100,interrupted:0}[r.checklist.current_phase]||0),p=C(()=>{const i=new Date(r.checklist.created_at),_=new Date().getTime()-i.getTime(),m=Math.floor(_/(1e3*60*60)),I=Math.floor(_%(1e3*60*60)/(1e3*60));return m>0?"".concat(m,"h ").concat(I,"m"):"".concat(I,"m")}),U=C(()=>{if(!r.checklist.paused_at)return"";const i=new Date(r.checklist.paused_at),_=new Date().getTime()-i.getTime(),m=Math.floor(_/(1e3*60*60)),I=Math.floor(_%(1e3*60*60)/(1e3*60));return m>0?"".concat(m,"h ").concat(I,"m"):"".concat(I,"m")}),z=async()=>{await(await F.create({header:"Detalhes do Checklist",subHeader:"".concat(r.checklist.machine.name," - ").concat(r.checklist.patient.name),message:"\n      <strong>Fase:</strong> ".concat(j.value,"<br>\n      <strong>Progresso:</strong> ").concat(A.value,"%<br>\n      <strong>Iniciado:</strong> ").concat(new Date(r.checklist.created_at).toLocaleString("pt-BR"),"<br>\n      ").concat(r.checklist.paused_at?"<strong>Pausado:</strong> ".concat(new Date(r.checklist.paused_at).toLocaleString("pt-BR"),"<br>"):"","\n    "),buttons:["Fechar"]})).present()};return(i,c)=>(v(),b("div",{class:X(["checklist-card",[P.value,{paused:i.checklist.paused_at}]])},[e("div",We,[e("div",Xe,[e("h3",null,h(i.checklist.machine.name),1),e("p",Ye,h(i.checklist.machine.identifier),1)]),o(s(ae),{color:N.value,class:"phase-badge"},{default:u(()=>[D(h(j.value),1)]),_:1},8,["color"])]),e("div",Ze,[o(s(n),{icon:s(Le),class:"patient-icon"},null,8,["icon"]),e("span",es,h(i.checklist.patient.name),1)]),e("div",ss,[e("div",ts,[e("div",{class:"progress-fill",style:we({width:A.value+"%"})},null,4)]),e("span",as,h(A.value)+"% completo",1)]),e("div",os,[e("div",ns,[o(s(n),{icon:s(H),class:"time-icon"},null,8,["icon"]),c[3]||(c[3]=e("span",{class:"time-label"},"Iniciado h치",-1)),e("span",is,h(p.value),1)]),i.checklist.paused_at?(v(),b("div",ls,[o(s(n),{icon:s(Y),class:"time-icon paused"},null,8,["icon"]),c[4]||(c[4]=e("span",{class:"time-label"},"Pausado h치",-1)),e("span",cs,h(U.value),1)])):$("",!0)]),e("div",rs,[i.checklist.paused_at?$("",!0):(v(),M(s(O),{key:0,fill:"outline",size:"small",onClick:c[0]||(c[0]=_=>i.$emit("continue",i.checklist)),class:"action-button continue"},{default:u(()=>[o(s(n),{icon:s(Z),slot:"start"},null,8,["icon"]),c[5]||(c[5]=D(" Continuar ",-1))]),_:1})),i.checklist.paused_at?(v(),M(s(O),{key:1,fill:"solid",size:"small",onClick:c[1]||(c[1]=_=>i.$emit("resume",i.checklist)),class:"action-button resume",color:"success"},{default:u(()=>[o(s(n),{icon:s(Z),slot:"start"},null,8,["icon"]),c[6]||(c[6]=D(" Retomar ",-1))]),_:1})):$("",!0),i.checklist.paused_at?$("",!0):(v(),M(s(O),{key:2,fill:"outline",size:"small",onClick:c[2]||(c[2]=_=>i.$emit("pause",i.checklist)),class:"action-button pause",color:"warning"},{default:u(()=>[o(s(n),{icon:s(Y),slot:"start"},null,8,["icon"]),c[7]||(c[7]=D(" Pausar ",-1))]),_:1})),o(s(O),{fill:"clear",size:"small",onClick:z,class:"action-button details"},{default:u(()=>[o(s(n),{icon:s(je),slot:"icon-only"},null,8,["icon"])]),_:1})]),e("div",{class:X(["status-indicator",P.value])},null,2)],2))}}),ds=oe(us,[["__scopeId","data-v-afd1addd"]]),hs={class:"dashboard-container"},ps={key:0,class:"welcome-section"},vs={class:"welcome-header"},ms={class:"welcome-text"},gs={class:"unit-display"},_s={key:0,class:"unit-info-static"},ks={class:"unit-text-static"},fs={class:"unit-name-static"},ws={key:1,class:"unit-info"},Cs={class:"unit-text"},ys={class:"unit-name"},bs={key:1,class:"quick-stats"},$s={class:"stat-icon"},Is={class:"stat-content"},Ss={class:"stat-number"},Ds={class:"stat-icon"},Os={class:"stat-content"},Ms={class:"stat-number"},Ps={class:"stat-card total"},As={class:"stat-icon"},Us={class:"stat-content"},zs={class:"stat-number"},Es={class:"primary-action"},Ts={class:"section"},Bs={class:"quick-actions"},Ls={class:"action-icon warning"},js={class:"action-content"},qs={class:"action-subtitle"},Ns={class:"action-icon tertiary"},Rs={class:"action-icon cleaning"},xs={class:"action-icon primary"},Fs={key:2,class:"section"},Hs={class:"checklists-list"},Vs={class:"connection-status"},Gs=te({__name:"DashboardPage",setup(V){const f=ye(),r=Ke.getInstance(),j=r.getCurrentUserUseCase(),N=r.getLogoutUseCase(),{isDarkMode:P,toggleDarkMode:A}=Qe(),p=g(null),U=g(navigator.onLine),z=g(!1),i=g(0),c=g(3),_=g(!1),m=g([]),I=g([]),E=g([]),T=g([]),S=g(null),y=g(null);C(()=>p.value&&{tecnico:"T칠cnico",admin:"Admin",gestor:"Gestor",coordenador:"Coordenador",supervisor:"Supervisor"}[p.value.role]||"Usu치rio");const R=C(()=>m.value.filter(a=>!a.paused_at).length);C(()=>m.value.filter(a=>a.paused_at).length);const x=C(()=>I.value.length),G=async()=>{try{p.value=await j.execute(),console.log("User loaded:",p.value),await ne()}catch(a){console.error("Error loading user:",a),await(await w.create({message:"Erro ao carregar dados do usu치rio",duration:3e3,color:"danger",position:"top"})).present(),setTimeout(()=>{f.replace("/login")},2e3)}},ne=async()=>{var a,t;try{const d=await(await fetch("/api/user-units",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();if(d.success){T.value=d.units||[];const k=d.current_unit_id;k?(S.value=d.units.find(L=>L.id===k),y.value=k):d.units.length>0&&(S.value=d.units[0],y.value=d.units[0].id),console.log("Unidades carregadas (mobile):",{total:T.value.length,current:(a=S.value)==null?void 0:a.name,currentId:y.value})}}catch(l){console.error("Error loading available units:",l),(t=p.value)!=null&&t.unit&&(S.value=p.value.unit,y.value=p.value.unit.id,T.value=p.value.units||[p.value.unit])}},ie=async()=>{const a=T.value.map(l=>({text:l.name,icon:l.id===y.value?"checkmark-circle-outline":"location-outline",cssClass:l.id===y.value?"unit-selected":"",handler:()=>{l.id!==y.value&&le(l.id)}}));a.push({text:"Cancelar",icon:"close-outline",handler:()=>{}}),await(await Te.create({header:"Selecionar Unidade",subHeader:"Escolha a unidade para visualizar",buttons:a,cssClass:"unit-selector-action-sheet"})).present()},le=async a=>{var t;try{const l=await Be.create({message:"Alternando unidade...",spinner:"crescent",duration:1e4});await l.present();const k=await(await fetch("/api/user-units/switch",{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token")),"Content-Type":"application/json"},body:JSON.stringify({unit_id:a})})).json();await l.dismiss(),k.success&&(S.value=k.current_unit,y.value=a,await(await w.create({message:"游늸 Unidade alterada para ".concat(k.current_unit.name),duration:2e3,color:"success",position:"top",cssClass:"custom-toast"})).present(),await B())}catch(l){console.error("Error switching unit:",l),y.value=(t=S.value)==null?void 0:t.id,await(await w.create({message:"Erro ao trocar de unidade",duration:3e3,color:"danger",position:"top"})).present()}},B=async()=>{try{await Promise.all([ce(),re(),ue()]),i.value=m.value.length,c.value=E.value.length,z.value=!0,console.log("Stats loaded")}catch(a){console.error("Error loading stats:",a),z.value=!0}},ce=async()=>{try{const t=await(await fetch("/api/checklists/active",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();t.success&&(m.value=t.checklists)}catch(a){console.error("Erro ao carregar checklists ativos:",a)}},re=async()=>{try{const t=await(await fetch("/api/machines/available",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();t.success&&(I.value=t.machines)}catch(a){console.error("Erro ao carregar m치quinas dispon칤veis:",a)}},ue=async()=>{try{const a=await fetch("/api/machines",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token")),"Content-Type":"application/json",Accept:"application/json"}});if(!a.ok){console.warn("Failed to load machines: ".concat(a.status)),E.value=[];return}const t=await a.json();t.success&&t.machines?E.value=t.machines:E.value=[]}catch(a){console.error("Erro ao carregar m치quinas:",a),E.value=[]}},de=async a=>{try{await Promise.all([G(),B()]),await(await w.create({message:"Dados atualizados",duration:1500,color:"success",position:"top"})).present()}catch(t){console.error("Error refreshing:",t)}finally{a.target.complete()}},he=async()=>{await(await F.create({header:"Confirmar Sa칤da",message:"Deseja realmente sair do aplicativo?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Sair",role:"confirm",handler:async()=>{try{await N.execute(),await(await w.create({message:"Logout realizado com sucesso",duration:2e3,color:"success",position:"top"})).present(),f.replace("/login")}catch(t){console.error("Logout error:",t),f.replace("/login")}}}]})).present()},pe=()=>{console.log("Navigating to new checklist..."),f.push("/checklist/new")},ve=()=>{console.log("Navigating to patients..."),f.push("/patients")},J=()=>{console.log("Navigating to active checklists..."),f.push("/checklists")},K=()=>{f.push("/machines")},me=()=>{console.log("Navigating to cleaning controls..."),f.push("/cleaning-controls")},ge=a=>{f.push("/checklist/".concat(a.id))},_e=async a=>{await(await F.create({header:"Pausar Checklist",message:"Deseja pausar o checklist da m치quina ".concat(a.machine.name,"?"),buttons:[{text:"Cancelar",role:"cancel"},{text:"Pausar",handler:async()=>{try{const d=await(await fetch("/api/checklists/".concat(a.id,"/pause"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();if(d.success)await(await w.create({message:"Checklist pausado com sucesso.",duration:3e3,color:"success"})).present(),await B();else throw new Error(d.message)}catch(l){await(await w.create({message:"Erro ao pausar checklist.",duration:3e3,color:"danger"})).present()}}}]})).present()},ke=async a=>{try{const l=await(await fetch("/api/checklists/".concat(a.id,"/resume"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}})).json();if(l.success)await(await w.create({message:"Checklist retomado com sucesso.",duration:3e3,color:"success"})).present(),await B();else throw new Error(l.message)}catch(t){await(await w.create({message:"Erro ao retomar checklist.",duration:3e3,color:"danger"})).present()}},fe=async()=>{A(),await(await w.create({message:"Modo ".concat(P.value?"escuro":"claro"," ativado"),duration:1500,color:"medium",position:"bottom"})).present()},Q=()=>{U.value=navigator.onLine};return Ce(async()=>{console.log("Dashboard mounted, loading data..."),_.value=!0;try{await G(),B(),window.addEventListener("online",Q),window.addEventListener("offline",Q)}catch(a){console.error("Dashboard initialization error:",a)}finally{_.value=!1}}),(a,t)=>(v(),M(s(Ie),null,{default:u(()=>[o(s(Me),null,{default:u(()=>[o(s(Se),{color:"primary"},{default:u(()=>[o(s(De),null,{default:u(()=>[...t[0]||(t[0]=[D("Hemodi치lise Mobile",-1)])]),_:1}),o(s(Oe),{slot:"end"},{default:u(()=>[o(s(O),{onClick:fe,fill:"clear",class:"theme-toggle-btn"},{default:u(()=>[o(s(n),{icon:s(P)?s(qe):s(Ne),slot:"icon-only"},null,8,["icon"])]),_:1}),o(s(O),{onClick:he,fill:"clear"},{default:u(()=>[o(s(n),{icon:s(Re),slot:"icon-only"},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),o(s(Ee),{fullscreen:!0,class:"dashboard-content"},{default:u(()=>{var l,d,k,L;return[o(s(Pe),{slot:"fixed",onIonRefresh:de},{default:u(()=>[o(s(Ae))]),_:1}),e("div",hs,[p.value?(v(),b("div",ps,[e("div",vs,[e("div",ms,[e("h1",null,"Ol치, "+h(p.value.name.split(" ")[0])+"! 游녦",1)])]),e("div",gs,[T.value.length<=1?(v(),b("div",_s,[o(s(n),{icon:s(ee),class:"unit-icon-static"},null,8,["icon"]),e("div",ks,[t[1]||(t[1]=e("span",{class:"unit-label-static"},"Unidade",-1)),e("span",fs,h(((l=S.value)==null?void 0:l.name)||((d=p.value.unit)==null?void 0:d.name)||"Carregando..."),1)])])):(v(),b("div",ws,[o(s(n),{icon:s(ee),class:"unit-icon"},null,8,["icon"]),e("div",Cs,[t[2]||(t[2]=e("span",{class:"unit-label"},"Unidade Atual",-1)),e("span",ys,h(((k=S.value)==null?void 0:k.name)||((L=p.value.unit)==null?void 0:L.name)||"Carregando..."),1)]),o(s(O),{fill:"clear",size:"small",onClick:ie,class:"unit-change-btn"},{default:u(()=>[o(s(n),{slot:"icon-only",icon:s(xe)},null,8,["icon"])]),_:1})]))])])):$("",!0),z.value?(v(),b("div",bs,[e("div",{class:"stat-card available",onClick:K},[e("div",$s,[o(s(n),{icon:s(se)},null,8,["icon"])]),e("div",Is,[e("div",Ss,h(x.value),1),t[3]||(t[3]=e("div",{class:"stat-label"},"Dispon칤veis",-1))])]),e("div",{class:"stat-card active",onClick:J},[e("div",Ds,[o(s(n),{icon:s(H)},null,8,["icon"])]),e("div",Os,[e("div",Ms,h(R.value),1),t[4]||(t[4]=e("div",{class:"stat-label"},"Em Andamento",-1))])]),e("div",Ps,[e("div",As,[o(s(n),{icon:s(Fe)},null,8,["icon"])]),e("div",Us,[e("div",zs,h(c.value),1),t[5]||(t[5]=e("div",{class:"stat-label"},"Total M치quinas",-1))])])])):$("",!0),e("div",Es,[e("button",{class:"primary-btn",onClick:pe},[o(s(n),{icon:s(He)},null,8,["icon"]),t[6]||(t[6]=e("div",{class:"btn-text"},[e("span",{class:"btn-title"},"Novo Checklist"),e("span",{class:"btn-subtitle"},"Iniciar verifica칞칚o de seguran칞a")],-1)),x.value>0?(v(),M(s(ae),{key:0,color:"success"},{default:u(()=>[D(h(x.value),1)]),_:1})):$("",!0)])]),e("div",Ts,[t[11]||(t[11]=e("h2",{class:"section-title"},"Acesso R치pido",-1)),e("div",Bs,[R.value>0?(v(),b("div",{key:0,class:"action-btn",onClick:J},[e("div",Ls,[o(s(n),{icon:s(H)},null,8,["icon"])]),e("div",js,[t[7]||(t[7]=e("span",{class:"action-title"},"Checklists Ativos",-1)),e("span",qs,h(R.value)+" em andamento",1)]),o(s(n),{icon:s(q),class:"chevron"},null,8,["icon"])])):$("",!0),e("div",{class:"action-btn",onClick:K},[e("div",Ns,[o(s(n),{icon:s(se)},null,8,["icon"])]),t[8]||(t[8]=e("div",{class:"action-content"},[e("span",{class:"action-title"},"M치quinas"),e("span",{class:"action-subtitle"},"Status e controle")],-1)),o(s(n),{icon:s(q),class:"chevron"},null,8,["icon"])]),e("div",{class:"action-btn",onClick:me},[e("div",Rs,[o(s(n),{icon:s(Ve)},null,8,["icon"])]),t[9]||(t[9]=e("div",{class:"action-content"},[e("span",{class:"action-title"},"Controle de Limpeza"),e("span",{class:"action-subtitle"},"Limpeza e desinfec칞칚o")],-1)),o(s(n),{icon:s(q),class:"chevron"},null,8,["icon"])]),e("div",{class:"action-btn",onClick:ve},[e("div",xs,[o(s(n),{icon:s(Ge)},null,8,["icon"])]),t[10]||(t[10]=e("div",{class:"action-content"},[e("span",{class:"action-title"},"Pacientes"),e("span",{class:"action-subtitle"},"Buscar e gerenciar")],-1)),o(s(n),{icon:s(q),class:"chevron"},null,8,["icon"])])])]),m.value.length>0?(v(),b("div",Fs,[t[12]||(t[12]=e("h2",{class:"section-title"},"Em Andamento",-1)),e("div",Hs,[(v(!0),b(be,null,$e(m.value,W=>(v(),M(ds,{key:W.id,checklist:W,onContinue:ge,onPause:_e,onResume:ke},null,8,["checklist"]))),128))])])):$("",!0),e("div",Vs,[o(s(Ue),{color:U.value?"success":"danger",class:"status-chip"},{default:u(()=>[o(s(n),{icon:s(Je)},null,8,["icon"]),o(s(ze),null,{default:u(()=>[D(h(U.value?"Online":"Offline"),1)]),_:1})]),_:1},8,["color"])])])]}),_:1})]),_:1}))}}),Xs=oe(Gs,[["__scopeId","data-v-133f57c1"]]);export{Xs as default};
