import{d as le,r as R,c as r,o as ce,B as U,q as c,x as o,y as t,v as a,H as g,t as e,n as d,J as _,G as l,I as q,F as V,L as $,z as de,K as F}from"./vendor-CuvbB8Nv.js";import{e as ue,t as G,o as re,q as W,x as ve,p as me,k as z,g as v,r as pe,s as _e,u as he,f as fe,B as D,C as O,M as E,N as H,i as ge,n as be,j as ye}from"./ionic-DQSKESAG.js";import{A as ke,m as we,r as J,t as K,X as Ce,E as xe,u as Me,v as L,w as Ie,a1 as Re,x as qe,_ as De}from"./_plugin-vue_export-helper-Dt2dLz-X.js";const Oe={class:"overview-container"},Ae={key:0,class:"loading-state"},Pe={key:1},Te={class:"summary-header"},Be={class:"summary-icon"},Ne={class:"summary-info"},je={class:"summary-description"},ze={class:"stats-grid"},Ee={class:"stat-box available"},He={class:"stat-box-header"},Le={class:"stat-box-number"},Xe={class:"stat-box-percentage"},Se={class:"stat-box occupied"},Ue={class:"stat-box-header"},Ve={class:"stat-box-number"},$e={class:"stat-box-percentage"},Fe={class:"stat-box maintenance"},Ge={class:"stat-box-header"},We={class:"stat-box-number"},Je={class:"stat-box-percentage"},Ke={class:"stat-box inactive"},Qe={class:"stat-box-header"},Ye={class:"stat-box-number"},Ze={class:"stat-box-percentage"},et={class:"utilization-bar"},tt={key:0},st={key:0},at={key:0},nt={key:0},ot={class:"activity-list"},it={class:"activity-content"},lt={class:"activity-title"},ct={class:"activity-subtitle"},dt={class:"activity-time"},ut={class:"machines-list"},rt=["onClick"],vt={class:"machine-info"},mt={class:"machine-name"},pt={class:"machine-model"},_t={class:"quick-actions"},ht=le({__name:"MachinesOverviewPage",setup(ft){const A=de(),h=R([]),y=R([]),k=R(!1),X=R(""),m=r(()=>h.value.length),P=r(()=>h.value.filter(n=>n.status==="available").length),T=r(()=>h.value.filter(n=>n.status==="occupied").length),B=r(()=>h.value.filter(n=>n.status==="maintenance").length),N=r(()=>h.value.filter(n=>!n.active).length),w=r(()=>m.value>0?Math.round(P.value/m.value*100):0),C=r(()=>m.value>0?Math.round(T.value/m.value*100):0),x=r(()=>m.value>0?Math.round(B.value/m.value*100):0),M=r(()=>m.value>0?Math.round(N.value/m.value*100):0),Q=r(()=>[...h.value].sort((n,s)=>{const i={occupied:1,available:2,maintenance:3,inactive:4},b=i[n.status]||5,u=i[s.status]||5;return b!==u?b-u:n.name.localeCompare(s.name)})),j=async()=>{var n;try{k.value=!0;const i=await(await fetch("/api/machines",{credentials:"include",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();i.success&&(h.value=i.machines);const u=await(await fetch("/api/me",{credentials:"include",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();u.success&&u.user&&(X.value=((n=u.user.unit)==null?void 0:n.name)||"sua unidade");const f=await(await fetch("/api/checklists/recent?limit=5",{credentials:"include",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();f.success&&f.checklists&&Array.isArray(f.checklists)?y.value=f.checklists.map(p=>{var S;return{id:p.id,type:p.completed_at?"completed":p.paused_at?"paused":"started",title:p.completed_at?"Checklist Concluído":p.paused_at?"Checklist Pausado":"Checklist Iniciado",machine_name:((S=p.machine)==null?void 0:S.name)||"Máquina desconhecida",created_at:p.completed_at||p.paused_at||p.created_at}}):y.value=[]}catch(s){console.error("Error loading overview data:",s),await(await G.create({message:"Erro ao carregar dados",duration:3e3,color:"danger",position:"top"})).present()}finally{k.value=!1}},Y=async()=>{const n=await be.create({message:"Atualizando...",spinner:"crescent"});await n.present(),await j(),await n.dismiss(),await(await G.create({message:"Dados atualizados",duration:1500,color:"success",position:"top"})).present()},Z=async n=>{await j(),n.target.complete()},ee=n=>({available:"success",occupied:"warning",maintenance:"danger",inactive:"medium"})[n]||"medium",te=n=>({available:"Disponível",occupied:"Em Uso",maintenance:"Manutenção",inactive:"Inativa"})[n]||"Desconhecido",se=n=>({started:L,paused:K,completed:J,cleaning:qe,disinfection:Re})[n]||L,ae=n=>{const s=new Date(n),b=new Date().getTime()-s.getTime(),u=Math.floor(b/6e4),I=Math.floor(u/60),f=Math.floor(I/24);return u<1?"Agora":u<60?"".concat(u,"min atrás"):I<24?"".concat(I,"h atrás"):f===1?"Ontem":"".concat(f," dias atrás")},ne=n=>{A.push("/machines")},oe=()=>{A.push("/machines")},ie=()=>{A.push("/checklist/new")};return ce(()=>{j()}),(n,s)=>(c(),U(t(ue),null,{default:o(()=>[a(t(pe),{translucent:!0},{default:o(()=>[a(t(re),{color:"primary"},{default:o(()=>[a(t(W),{slot:"start"},{default:o(()=>[a(t(ve),{"default-href":"/dashboard"})]),_:1}),a(t(me),null,{default:o(()=>[...s[0]||(s[0]=[g("Visão Geral das Máquinas",-1)])]),_:1}),a(t(W),{slot:"end"},{default:o(()=>[a(t(z),{onClick:Y,disabled:k.value},{default:o(()=>[a(t(v),{icon:t(ke)},null,8,["icon"])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),a(t(ge),{fullscreen:!0,class:"overview-content"},{default:o(()=>[e("div",Oe,[a(t(_e),{slot:"fixed",onIonRefresh:Z},{default:o(()=>[a(t(he))]),_:1}),k.value&&h.value.length===0?(c(),d("div",Ae,[a(t(fe),{name:"crescent"}),s[1]||(s[1]=e("p",null,"Carregando dados...",-1))])):(c(),d("div",Pe,[a(t(D),{class:"summary-card"},{default:o(()=>[a(t(O),null,{default:o(()=>[e("div",Te,[e("div",Be,[a(t(v),{icon:t(we)},null,8,["icon"])]),e("div",Ne,[e("h2",null,l(m.value),1),s[2]||(s[2]=e("p",null,"Máquinas Cadastradas",-1))])]),e("div",je,[e("p",null,"Total de equipamentos de hemodiálise na unidade "+l(X.value),1)])]),_:1})]),_:1}),e("div",ze,[e("div",Ee,[e("div",He,[a(t(v),{icon:t(J)},null,8,["icon"]),s[3]||(s[3]=e("span",{class:"stat-box-label"},"Disponíveis",-1))]),e("div",Le,l(P.value),1),e("div",Xe,l(w.value)+"%",1)]),e("div",Se,[e("div",Ue,[a(t(v),{icon:t(K)},null,8,["icon"]),s[4]||(s[4]=e("span",{class:"stat-box-label"},"Em Uso",-1))]),e("div",Ve,l(T.value),1),e("div",$e,l(C.value)+"%",1)]),e("div",Fe,[e("div",Ge,[a(t(v),{icon:t(Ce)},null,8,["icon"]),s[5]||(s[5]=e("span",{class:"stat-box-label"},"Manutenção",-1))]),e("div",We,l(B.value),1),e("div",Je,l(x.value)+"%",1)]),e("div",Ke,[e("div",Qe,[a(t(v),{icon:t(xe)},null,8,["icon"]),s[6]||(s[6]=e("span",{class:"stat-box-label"},"Inativas",-1))]),e("div",Ye,l(N.value),1),e("div",Ze,l(M.value)+"%",1)])]),a(t(D),{class:"chart-card"},{default:o(()=>[a(t(E),null,{default:o(()=>[a(t(H),null,{default:o(()=>[...s[7]||(s[7]=[g("Taxa de Utilização",-1)])]),_:1})]),_:1}),a(t(O),null,{default:o(()=>[e("div",et,[w.value>0?(c(),d("div",{key:0,class:"bar-segment available",style:q({width:w.value+"%"})},[w.value>10?(c(),d("span",tt,l(P.value),1)):_("",!0)],4)):_("",!0),C.value>0?(c(),d("div",{key:1,class:"bar-segment occupied",style:q({width:C.value+"%"})},[C.value>10?(c(),d("span",st,l(T.value),1)):_("",!0)],4)):_("",!0),x.value>0?(c(),d("div",{key:2,class:"bar-segment maintenance",style:q({width:x.value+"%"})},[x.value>10?(c(),d("span",at,l(B.value),1)):_("",!0)],4)):_("",!0),M.value>0?(c(),d("div",{key:3,class:"bar-segment inactive",style:q({width:M.value+"%"})},[M.value>10?(c(),d("span",nt,l(N.value),1)):_("",!0)],4)):_("",!0)]),s[8]||(s[8]=e("div",{class:"bar-legend"},[e("div",{class:"legend-item"},[e("span",{class:"legend-color available"}),e("span",null,"Disponíveis")]),e("div",{class:"legend-item"},[e("span",{class:"legend-color occupied"}),e("span",null,"Em Uso")]),e("div",{class:"legend-item"},[e("span",{class:"legend-color maintenance"}),e("span",null,"Manutenção")]),e("div",{class:"legend-item"},[e("span",{class:"legend-color inactive"}),e("span",null,"Inativas")])],-1))]),_:1})]),_:1}),y.value.length>0?(c(),U(t(D),{key:0,class:"activity-card"},{default:o(()=>[a(t(E),null,{default:o(()=>[a(t(H),null,{default:o(()=>[...s[9]||(s[9]=[g("Atividade Recente",-1)])]),_:1})]),_:1}),a(t(O),null,{default:o(()=>[e("div",ot,[(c(!0),d(V,null,$(y.value,i=>(c(),d("div",{key:i.id,class:"activity-item"},[e("div",{class:F(["activity-icon",i.type])},[a(t(v),{icon:se(i.type)},null,8,["icon"])],2),e("div",it,[e("div",lt,l(i.title),1),e("div",ct,l(i.machine_name),1),e("div",dt,l(ae(i.created_at)),1)])]))),128))])]),_:1})]),_:1})):_("",!0),a(t(D),{class:"machines-list-card"},{default:o(()=>[a(t(E),null,{default:o(()=>[a(t(H),null,{default:o(()=>[...s[10]||(s[10]=[g("Todas as Máquinas",-1)])]),_:1})]),_:1}),a(t(O),null,{default:o(()=>[e("div",ut,[(c(!0),d(V,null,$(Q.value,i=>(c(),d("div",{key:i.id,class:"machine-item",onClick:b=>ne(i)},[e("div",{class:F(["machine-status-indicator",i.status])},null,2),e("div",vt,[e("div",mt,l(i.name),1),e("div",pt,l(i.model),1)]),a(t(ye),{color:ee(i.status)},{default:o(()=>[g(l(te(i.status)),1)]),_:2},1032,["color"]),a(t(v),{icon:t(Ie),class:"chevron"},null,8,["icon"])],8,rt))),128))])]),_:1})]),_:1}),e("div",_t,[a(t(z),{expand:"block",onClick:oe},{default:o(()=>[a(t(v),{slot:"start",icon:t(Me)},null,8,["icon"]),s[11]||(s[11]=g(" Gerenciar Máquinas ",-1))]),_:1}),a(t(z),{expand:"block",fill:"outline",onClick:ie},{default:o(()=>[a(t(v),{slot:"start",icon:t(L)},null,8,["icon"]),s[12]||(s[12]=g(" Novo Checklist ",-1))]),_:1})])]))])]),_:1})]),_:1}))}}),kt=De(ht,[["__scopeId","data-v-476f0916"]]);export{kt as default};
