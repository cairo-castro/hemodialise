import{d as le,r as I,c as r,o as ce,B as X,q as c,x as o,y as t,v as a,H as f,t as e,n as d,J as _,G as l,I as R,F as U,L as $,z as de,K as F}from"./vendor-BOCCj2ty.js";import{e as ue,t as G,o as re,q as W,x as ve,p as me,k as j,g as v,r as pe,s as _e,u as he,f as fe,B as q,C as D,M as H,N as L,i as ge,n as be,j as ye}from"./ionic-DvfosJhB.js";import{y as ke,m as Ce,z as J,t as K,V as we,D as xe,q as Me,r as E,u as Ie,a1 as Re,v as qe,_ as De}from"./_plugin-vue_export-helper-BgNw2jzN.js";const Oe={class:"overview-container"},Pe={key:0,class:"loading-state"},Te={key:1},Be={class:"summary-header"},Ae={class:"summary-icon"},ze={class:"summary-info"},Ne={class:"summary-description"},je={class:"stats-grid"},He={class:"stat-box available"},Le={class:"stat-box-header"},Ee={class:"stat-box-number"},Se={class:"stat-box-percentage"},Ve={class:"stat-box occupied"},Xe={class:"stat-box-header"},Ue={class:"stat-box-number"},$e={class:"stat-box-percentage"},Fe={class:"stat-box maintenance"},Ge={class:"stat-box-header"},We={class:"stat-box-number"},Je={class:"stat-box-percentage"},Ke={class:"stat-box inactive"},Qe={class:"stat-box-header"},Ye={class:"stat-box-number"},Ze={class:"stat-box-percentage"},et={class:"utilization-bar"},tt={key:0},st={key:0},at={key:0},nt={key:0},ot={class:"activity-list"},it={class:"activity-content"},lt={class:"activity-title"},ct={class:"activity-subtitle"},dt={class:"activity-time"},ut={class:"machines-list"},rt=["onClick"],vt={class:"machine-info"},mt={class:"machine-name"},pt={class:"machine-model"},_t={class:"quick-actions"},ht=le({__name:"MachinesOverviewPage",setup(ft){const O=de(),h=I([]),P=I([]),y=I(!1),S=I(""),m=r(()=>h.value.length),T=r(()=>h.value.filter(n=>n.status==="available").length),B=r(()=>h.value.filter(n=>n.status==="occupied").length),A=r(()=>h.value.filter(n=>n.status==="maintenance").length),z=r(()=>h.value.filter(n=>!n.active).length),k=r(()=>m.value>0?Math.round(T.value/m.value*100):0),C=r(()=>m.value>0?Math.round(B.value/m.value*100):0),w=r(()=>m.value>0?Math.round(A.value/m.value*100):0),x=r(()=>m.value>0?Math.round(z.value/m.value*100):0),Q=r(()=>[...h.value].sort((n,s)=>{const i={occupied:1,available:2,maintenance:3,inactive:4},g=i[n.status]||5,u=i[s.status]||5;return g!==u?g-u:n.name.localeCompare(s.name)})),N=async()=>{var n;try{y.value=!0;const i=await(await fetch("/api/machines",{credentials:"include",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();i.success&&(h.value=i.machines);const u=await(await fetch("/api/me",{credentials:"include",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();u.success&&u.user&&(S.value=((n=u.user.unit)==null?void 0:n.name)||"sua unidade");const b=await(await fetch("/api/checklists/recent?limit=5",{credentials:"include",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();b.success&&(P.value=b.checklists.map(p=>{var V;return{id:p.id,type:p.completed_at?"completed":p.paused_at?"paused":"started",title:p.completed_at?"Checklist Concluído":p.paused_at?"Checklist Pausado":"Checklist Iniciado",machine_name:((V=p.machine)==null?void 0:V.name)||"Máquina desconhecida",created_at:p.completed_at||p.paused_at||p.created_at}}))}catch(s){console.error("Error loading overview data:",s),await(await G.create({message:"Erro ao carregar dados",duration:3e3,color:"danger",position:"top"})).present()}finally{y.value=!1}},Y=async()=>{const n=await be.create({message:"Atualizando...",spinner:"crescent"});await n.present(),await N(),await n.dismiss(),await(await G.create({message:"Dados atualizados",duration:1500,color:"success",position:"top"})).present()},Z=async n=>{await N(),n.target.complete()},ee=n=>({available:"success",occupied:"warning",maintenance:"danger",inactive:"medium"})[n]||"medium",te=n=>({available:"Disponível",occupied:"Em Uso",maintenance:"Manutenção",inactive:"Inativa"})[n]||"Desconhecido",se=n=>({started:E,paused:K,completed:J,cleaning:qe,disinfection:Re})[n]||E,ae=n=>{const s=new Date(n),g=new Date().getTime()-s.getTime(),u=Math.floor(g/6e4),M=Math.floor(u/60),b=Math.floor(M/24);return u<1?"Agora":u<60?"".concat(u,"min atrás"):M<24?"".concat(M,"h atrás"):b===1?"Ontem":"".concat(b," dias atrás")},ne=n=>{O.push("/machines")},oe=()=>{O.push("/machines")},ie=()=>{O.push("/checklist/new")};return ce(()=>{N()}),(n,s)=>(c(),X(t(ue),null,{default:o(()=>[a(t(pe),{translucent:!0},{default:o(()=>[a(t(re),{color:"primary"},{default:o(()=>[a(t(W),{slot:"start"},{default:o(()=>[a(t(ve),{"default-href":"/dashboard"})]),_:1}),a(t(me),null,{default:o(()=>[...s[0]||(s[0]=[f("Visão Geral das Máquinas",-1)])]),_:1}),a(t(W),{slot:"end"},{default:o(()=>[a(t(j),{onClick:Y,disabled:y.value},{default:o(()=>[a(t(v),{icon:t(ke)},null,8,["icon"])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),a(t(ge),{fullscreen:!0,class:"overview-content"},{default:o(()=>[e("div",Oe,[a(t(_e),{slot:"fixed",onIonRefresh:Z},{default:o(()=>[a(t(he))]),_:1}),y.value&&h.value.length===0?(c(),d("div",Pe,[a(t(fe),{name:"crescent"}),s[1]||(s[1]=e("p",null,"Carregando dados...",-1))])):(c(),d("div",Te,[a(t(q),{class:"summary-card"},{default:o(()=>[a(t(D),null,{default:o(()=>[e("div",Be,[e("div",Ae,[a(t(v),{icon:t(Ce)},null,8,["icon"])]),e("div",ze,[e("h2",null,l(m.value),1),s[2]||(s[2]=e("p",null,"Máquinas Cadastradas",-1))])]),e("div",Ne,[e("p",null,"Total de equipamentos de hemodiálise na unidade "+l(S.value),1)])]),_:1})]),_:1}),e("div",je,[e("div",He,[e("div",Le,[a(t(v),{icon:t(J)},null,8,["icon"]),s[3]||(s[3]=e("span",{class:"stat-box-label"},"Disponíveis",-1))]),e("div",Ee,l(T.value),1),e("div",Se,l(k.value)+"%",1)]),e("div",Ve,[e("div",Xe,[a(t(v),{icon:t(K)},null,8,["icon"]),s[4]||(s[4]=e("span",{class:"stat-box-label"},"Em Uso",-1))]),e("div",Ue,l(B.value),1),e("div",$e,l(C.value)+"%",1)]),e("div",Fe,[e("div",Ge,[a(t(v),{icon:t(we)},null,8,["icon"]),s[5]||(s[5]=e("span",{class:"stat-box-label"},"Manutenção",-1))]),e("div",We,l(A.value),1),e("div",Je,l(w.value)+"%",1)]),e("div",Ke,[e("div",Qe,[a(t(v),{icon:t(xe)},null,8,["icon"]),s[6]||(s[6]=e("span",{class:"stat-box-label"},"Inativas",-1))]),e("div",Ye,l(z.value),1),e("div",Ze,l(x.value)+"%",1)])]),a(t(q),{class:"chart-card"},{default:o(()=>[a(t(H),null,{default:o(()=>[a(t(L),null,{default:o(()=>[...s[7]||(s[7]=[f("Taxa de Utilização",-1)])]),_:1})]),_:1}),a(t(D),null,{default:o(()=>[e("div",et,[k.value>0?(c(),d("div",{key:0,class:"bar-segment available",style:R({width:k.value+"%"})},[k.value>10?(c(),d("span",tt,l(T.value),1)):_("",!0)],4)):_("",!0),C.value>0?(c(),d("div",{key:1,class:"bar-segment occupied",style:R({width:C.value+"%"})},[C.value>10?(c(),d("span",st,l(B.value),1)):_("",!0)],4)):_("",!0),w.value>0?(c(),d("div",{key:2,class:"bar-segment maintenance",style:R({width:w.value+"%"})},[w.value>10?(c(),d("span",at,l(A.value),1)):_("",!0)],4)):_("",!0),x.value>0?(c(),d("div",{key:3,class:"bar-segment inactive",style:R({width:x.value+"%"})},[x.value>10?(c(),d("span",nt,l(z.value),1)):_("",!0)],4)):_("",!0)]),s[8]||(s[8]=e("div",{class:"bar-legend"},[e("div",{class:"legend-item"},[e("span",{class:"legend-color available"}),e("span",null,"Disponíveis")]),e("div",{class:"legend-item"},[e("span",{class:"legend-color occupied"}),e("span",null,"Em Uso")]),e("div",{class:"legend-item"},[e("span",{class:"legend-color maintenance"}),e("span",null,"Manutenção")]),e("div",{class:"legend-item"},[e("span",{class:"legend-color inactive"}),e("span",null,"Inativas")])],-1))]),_:1})]),_:1}),P.value.length>0?(c(),X(t(q),{key:0,class:"activity-card"},{default:o(()=>[a(t(H),null,{default:o(()=>[a(t(L),null,{default:o(()=>[...s[9]||(s[9]=[f("Atividade Recente",-1)])]),_:1})]),_:1}),a(t(D),null,{default:o(()=>[e("div",ot,[(c(!0),d(U,null,$(P.value,i=>(c(),d("div",{key:i.id,class:"activity-item"},[e("div",{class:F(["activity-icon",i.type])},[a(t(v),{icon:se(i.type)},null,8,["icon"])],2),e("div",it,[e("div",lt,l(i.title),1),e("div",ct,l(i.machine_name),1),e("div",dt,l(ae(i.created_at)),1)])]))),128))])]),_:1})]),_:1})):_("",!0),a(t(q),{class:"machines-list-card"},{default:o(()=>[a(t(H),null,{default:o(()=>[a(t(L),null,{default:o(()=>[...s[10]||(s[10]=[f("Todas as Máquinas",-1)])]),_:1})]),_:1}),a(t(D),null,{default:o(()=>[e("div",ut,[(c(!0),d(U,null,$(Q.value,i=>(c(),d("div",{key:i.id,class:"machine-item",onClick:g=>ne(i)},[e("div",{class:F(["machine-status-indicator",i.status])},null,2),e("div",vt,[e("div",mt,l(i.name),1),e("div",pt,l(i.model),1)]),a(t(ye),{color:ee(i.status)},{default:o(()=>[f(l(te(i.status)),1)]),_:2},1032,["color"]),a(t(v),{icon:t(Ie),class:"chevron"},null,8,["icon"])],8,rt))),128))])]),_:1})]),_:1}),e("div",_t,[a(t(j),{expand:"block",onClick:oe},{default:o(()=>[a(t(v),{slot:"start",icon:t(Me)},null,8,["icon"]),s[11]||(s[11]=f(" Gerenciar Máquinas ",-1))]),_:1}),a(t(j),{expand:"block",fill:"outline",onClick:ie},{default:o(()=>[a(t(v),{slot:"start",icon:t(E)},null,8,["icon"]),s[12]||(s[12]=f(" Novo Checklist ",-1))]),_:1})])]))])]),_:1})]),_:1}))}}),kt=De(ht,[["__scopeId","data-v-7f46667f"]]);export{kt as default};
