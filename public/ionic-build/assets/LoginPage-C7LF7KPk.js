import{d as V,r as u,c as U,o as L,z as B,n as g,v as l,x as a,A,t as s,l as h,q as o,B as f,C as S}from"./vendor-C2XN_qWx.js";import{e as D,f as M,g as w,h as I,i as C,j as _,k as T,l as q,m as N,t as O}from"./ionic-BY6d-3MW.js";import{m as P,l as R,_ as $}from"./_plugin-vue_export-helper-DpvRZPJi.js";import{C as j}from"./index-BMQczj65.js";const z={key:0,class:"loading-container"},F={key:1,class:"login-container"},H={class:"login-header"},K={class:"logo-container"},Q={class:"form-group"},G={class:"form-group"},J=V({__name:"LoginPage",setup(W){const v=A(),d=j.getInstance(),y=d.getLoginUseCase(),b=d.getCurrentUserUseCase(),m=d.getAuthRepository(),n=u({email:"",password:""}),i=u(!1),c=u(!1),p=u({header:"",message:""}),x=U(()=>n.value.email.length>0&&n.value.password.length>0),k=async()=>{i.value=!0;try{await y.execute(n.value);const t=await b.execute();if(t.role!=="field_user")throw new Error("Este aplicativo é destinado apenas para usuários de campo. Use o sistema web para acessar a área administrativa.");await(await O.create({message:"Bem-vindo, ".concat(t.name,"!"),duration:2e3,color:"success",position:"top"})).present(),v.replace("/dashboard")}catch(t){console.error("Login error:",t),p.value={header:"Erro no Login",message:t.message||"Erro interno. Tente novamente."},c.value=!0}finally{i.value=!1}},E=async()=>{try{m.isAuthenticated()&&((await b.execute()).role==="field_user"?v.replace("/dashboard"):m.removeToken())}catch(t){m.removeToken()}};return L(()=>{E()}),(t,e)=>(g(),B(a(D),null,{default:l(()=>[s(a(N),{fullscreen:!0,class:"login-content"},{default:l(()=>[i.value?(g(),h("div",z,[s(a(M),{name:"crescent"}),e[3]||(e[3]=o("p",null,"Entrando...",-1))])):(g(),h("div",F,[o("div",H,[o("div",K,[s(a(w),{icon:a(P),class:"logo-icon"},null,8,["icon"])]),e[4]||(e[4]=o("h1",null,"Hemodiálise",-1)),e[5]||(e[5]=o("p",null,"Sistema Mobile de Segurança",-1))]),o("form",{onSubmit:S(k,["prevent"]),class:"login-form"},[o("div",Q,[s(a(I),{class:"mobile-input",fill:"outline"},{default:l(()=>[s(a(C),{position:"floating"},{default:l(()=>[...e[6]||(e[6]=[f("Email",-1)])]),_:1}),s(a(_),{modelValue:n.value.email,"onUpdate:modelValue":e[0]||(e[0]=r=>n.value.email=r),type:"email",required:"",disabled:i.value,placeholder:"Digite seu email"},null,8,["modelValue","disabled"])]),_:1})]),o("div",G,[s(a(I),{class:"mobile-input",fill:"outline"},{default:l(()=>[s(a(C),{position:"floating"},{default:l(()=>[...e[7]||(e[7]=[f("Senha",-1)])]),_:1}),s(a(_),{modelValue:n.value.password,"onUpdate:modelValue":e[1]||(e[1]=r=>n.value.password=r),type:"password",required:"",disabled:i.value,placeholder:"Digite sua senha"},null,8,["modelValue","disabled"])]),_:1})]),s(a(T),{expand:"block",type:"submit",class:"mobile-button",disabled:i.value||!x.value},{default:l(()=>[s(a(w),{icon:a(R),slot:"start"},null,8,["icon"]),e[8]||(e[8]=f(" Entrar ",-1))]),_:1},8,["disabled"])],32),s(a(q),{"is-open":c.value,header:p.value.header,message:p.value.message,buttons:["OK"],onDidDismiss:e[2]||(e[2]=r=>c.value=!1)},null,8,["is-open","header","message"]),e[9]||(e[9]=o("div",{class:"login-footer"},[o("p",null,"Sistema de Controle de Qualidade"),o("p",null,"Estado do Maranhão")],-1))]))]),_:1})]),_:1}))}}),ae=$(J,[["__scopeId","data-v-3f05bc85"]]);export{ae as default};
