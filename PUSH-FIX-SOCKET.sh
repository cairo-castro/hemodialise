#!/bin/bash

echo "=========================================="
echo "üöÄ PUSH FIX: PHP-FPM Socket (Cache Bust)"
echo "=========================================="
echo ""
echo "‚úÖ Commit pronto: 108a858"
echo "   fix: for√ßa rebuild Docker para aplicar listen.group PHP-FPM"
echo ""
echo "üì¶ Mudan√ßas:"
echo "   - Dockerfile.production: cache-busting timestamp"
echo "   - PROBLEMA-SOCKET-PHP-FPM-FINAL.md: documenta√ß√£o completa"
echo ""
echo "üéØ O Que Este Fix Resolve:"
echo "   - For√ßa rebuild SEM CACHE do Docker"
echo "   - Aplica listen.group = nginx no PHP-FPM"
echo "   - Socket ser√° criado com permiss√µes corretas"
echo "   - Nginx conseguir√° conectar ao PHP-FPM"
echo "   - 502 Bad Gateway ser√° resolvido!"
echo ""
echo "=========================================="
echo "EXECUTE AGORA:"
echo "=========================================="
echo ""
echo "cd /home/Hemodialise/sistema-hemodialise"
echo "git push"
echo ""
echo "=========================================="
echo "AP√ìS O PUSH:"
echo "=========================================="
echo ""
echo "1. Acesse: http://212.85.1.175:3000"
echo "2. Projects > qualidade > qualidadehd"
echo "3. ‚òëÔ∏è Marque: 'No Cache' ou 'Clean Build'"
echo "4. Clique: 'Redeploy'"
echo "5. Aguarde: ~10-15 minutos"
echo ""
echo "=========================================="
echo "VALIDA√á√ÉO:"
echo "=========================================="
echo ""
echo "# Ap√≥s deploy, verificar:"
echo "CONTAINER=\$(docker ps | grep qualidadehd | awk '{print \$1}')"
echo ""
echo "# 1. Verificar listen.group configurado:"
echo "docker exec \$CONTAINER cat /usr/local/etc/php-fpm.d/www.conf | grep '^listen'"
echo ""
echo "# Deve mostrar:"
echo "# listen = /var/run/php-fpm.sock"
echo "# listen.owner = nginx"
echo "# listen.group = nginx    ‚Üê ESTA LINHA!"
echo "# listen.mode = 0660"
echo ""
echo "# 2. Verificar socket existe:"
echo "docker exec \$CONTAINER ls -la /var/run/ | grep php"
echo ""
echo "# Deve mostrar:"
echo "# srw-rw---- 1 nginx nginx 0 php-fpm.sock"
echo ""
echo "# 3. Testar aplica√ß√£o:"
echo "curl -H 'Host: qualidadehd.direcaoclinica.com.br' http://localhost/"
echo ""
echo "# Deve retornar: HTML do Laravel (p√°gina de login)"
echo ""
echo "=========================================="
echo "üìñ Documenta√ß√£o: PROBLEMA-SOCKET-PHP-FPM-FINAL.md"
echo "=========================================="
